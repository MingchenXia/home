% !TeX spellcheck = en_US
% !TEX program = pdflatex
\documentclass[12pt,b5paper,notitlepage]{report}
\usepackage[b5paper, margin={0.5in,0.75in}]{geometry}
%\usepackage{fullpage}
\usepackage{amsmath,amscd,amssymb,amsthm,mathrsfs,amsfonts,layout,indentfirst,graphicx,caption,mathabx, stmaryrd,appendix,calc,imakeidx,upgreek} % mathabx for \wtidecheck
%\usepackage{ulem} %wave underline
\usepackage[dvipsnames]{xcolor}
\usepackage{palatino}  %template
\usepackage{slashed} % Dirac operator
\usepackage{mathrsfs} % Enable using \mathscr
%\usepackage{eufrak}  another template/font
\usepackage{extarrows} % long equal sign, \xlongequal{blablabla}
\usepackage{enumitem} % enumerate label change e.g. [label=(\alph*)]  shows (a) (b) 

\usepackage{fancyhdr} % date in footer

\usepackage{relsize} % use \mathlarger \larger \text{\larger[2]$...$} to enlarge the size of math symbols


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% circled colon and thick colon \hcolondel and \colondel

\usepackage{pdfrender}

\newcommand*{\hollowcolon}{%
	\textpdfrender{
		TextRenderingMode=Stroke,
		LineWidth=.1bp,
	}{:}%
}

\newcommand{\hcolondel}[1]{%
	\mathopen{\hollowcolon}#1\mathclose{\hollowcolon}%
}
\newcommand{\colondel}[1]{%
	\mathopen{:}#1\mathclose{:}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






\usepackage{tikz}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

\usepackage{tikz-cd}
\usepackage[nottoc]{tocbibind}   % Add  reference to ToC


\makeindex


% The following set up the line spaces between items in \thebibliography
\usepackage{lipsum}
\let\OLDthebibliography\thebibliography
\renewcommand\thebibliography[1]{
	\OLDthebibliography{#1}
	\setlength{\parskip}{0pt}
	\setlength{\itemsep}{2pt} 
}


\allowdisplaybreaks  %allow aligns to break between pages
\usepackage{latexsym}
\usepackage{chngcntr}
\usepackage[colorlinks,linkcolor=blue,anchorcolor=blue, linktocpage,
%pagebackref
]{hyperref}
\hypersetup{ urlcolor=cyan,
	citecolor=[rgb]{0,0.5,0}}


\setcounter{tocdepth}{1}	 %hide subsections in the content


\counterwithin{figure}{section}

\pagestyle{plain}

\captionsetup[figure]
{
	labelsep=none	
}













\theoremstyle{definition}
\newtheorem{df}{Definition}[section]
\newtheorem{eg}[df]{Example}
\newtheorem{exe}[df]{Exercise}
\newtheorem{rem}[df]{Remark}
\newtheorem{ass}[df]{Assumption}
\newtheorem{cv}[df]{Convention}
\newtheorem{prin}[df]{Principle}
\newtheorem{nota}[df]{Notation}
\newtheorem{st}{Step}
\newtheorem{thma}[df]{Theorem}
\newtheorem{coa}[df]{Theorem}
\theoremstyle{plain}
\newtheorem{thm}[df]{Theorem}
\newtheorem{ccl}[df]{Conclusion}
\newtheorem{thd}[df]{Theorem-Definition}
\newtheorem{pp}[df]{Proposition}
\newtheorem{co}[df]{Corollary}
\newtheorem{lm}[df]{Lemma}



\newtheorem{cond}{Condition}
\newtheorem{Mthm}{Main Theorem}
\renewcommand{\thecond}{\Alph{cond}} % "letter-numbered" theorems
\renewcommand{\theMthm}{\Alph{Mthm}} % "letter-numbered" theorems


%\substack   multiple lines under sum
%\underset{b}{a}   b is under a


% Remind: \overline{L_0}



\usepackage{calligra}
\DeclareMathOperator{\shom}{\mathscr{H}\text{\kern -3pt {\calligra\large om}}\,}
\DeclareMathOperator{\sext}{\mathscr{E}\text{\kern -3pt {\calligra\large xt}}\,}
\DeclareMathOperator{\Rel}{\mathscr{R}\text{\kern -3pt {\calligra\large el}~}\,}
\DeclareMathOperator{\sann}{\mathscr{A}\text{\kern -3pt {\calligra\large nn}}\,}
\DeclareMathOperator{\send}{\mathscr{E}\text{\kern -3pt {\calligra\large nd}}\,}


\newcommand{\fk}{\mathfrak}
\newcommand{\mc}{\mathcal}
\newcommand{\wtd}{\widetilde}
\newcommand{\wht}{\widehat}
\newcommand{\wch}{\widecheck}
\newcommand{\ovl}{\overline}
\newcommand{\udl}{\underline}
\newcommand{\tr}{\mathrm{t}} %transpose
\newcommand{\Tr}{\mathrm{Tr}}
\newcommand{\End}{\mathrm{End}} %endomorphism
\newcommand{\id}{\mathbf{1}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Conf}{\mathrm{Conf}}
\newcommand{\Res}{\mathrm{Res}}
\newcommand{\KZ}{\mathrm{KZ}}
\newcommand{\ev}{\mathrm{ev}}
\newcommand{\coev}{\mathrm{coev}}
\newcommand{\opp}{\mathrm{opp}}
\newcommand{\Rep}{\mathrm{Rep}}
\newcommand{\diag}{\mathrm{diag}}
\newcommand{\Dom}{\scr D}
\newcommand{\loc}{\mathrm{loc}}
\newcommand{\con}{\mathrm{c}}
\newcommand{\uni}{\mathrm{u}}
\newcommand{\ssp}{\mathrm{ss}}
\newcommand{\di}{\slashed d}
\newcommand{\Diffp}{\mathrm{Diff}^+}
\newcommand{\Diff}{\mathrm{Diff}}
\newcommand{\PSU}{\mathrm{PSU}(1,1)}
\newcommand{\Vir}{\mathrm{Vir}}
\newcommand{\Witt}{\mathscr W}
\newcommand{\Span}{\mathrm{Span}}
\newcommand{\pri}{\mathrm{p}}
\newcommand{\ER}{E^1(V)_{\mathbb R}}
\newcommand{\bk}[1]{\langle {#1}\rangle}
\newcommand{\prth}[1]{( {#1})}
\newcommand{\bigbk}[1]{\big\langle {#1}\big\rangle}
\newcommand{\Bigbk}[1]{\Big\langle {#1}\Big\rangle}
\newcommand{\biggbk}[1]{\bigg\langle {#1}\bigg\rangle}
\newcommand{\Biggbk}[1]{\Bigg\langle {#1}\Bigg\rangle}
\newcommand{\GA}{\mathscr G_{\mathcal A}}
\newcommand{\vs}{\varsigma}
\newcommand{\Vect}{\mathrm{Vec}}
\newcommand{\Vectc}{\mathrm{Vec}^{\mathbb C}}
\newcommand{\scr}{\mathscr}
\newcommand{\sjs}{\subset\joinrel\subset}
\newcommand{\Jtd}{\widetilde{\mathcal J}}
\newcommand{\gk}{\mathfrak g}
\newcommand{\hk}{\mathfrak h}
\newcommand{\xk}{\mathfrak x}
\newcommand{\yk}{\mathfrak y}
\newcommand{\zk}{\mathfrak z}
\newcommand{\pk}{\mathfrak p}
\newcommand{\hr}{\mathfrak h_{\mathbb R}}
\newcommand{\Ad}{\mathrm{Ad}}
\newcommand{\DHR}{\mathrm{DHR}_{I_0}}
\newcommand{\Repi}{\mathrm{Rep}_{\wtd I_0}}
\newcommand{\im}{\mathbf{i}}
\newcommand{\Co}{\complement}
%\newcommand{\Cu}{\mathcal C^{\mathrm u}}
\newcommand{\RepV}{\mathrm{Rep}^\uni(V)}
\newcommand{\RepA}{\mathrm{Rep}(\mathcal A)}
\newcommand{\RepN}{\mathrm{Rep}(\mathcal N)}
\newcommand{\RepfA}{\mathrm{Rep}^{\mathrm f}(\mathcal A)}
\newcommand{\RepAU}{\mathrm{Rep}^\uni(A_U)}
\newcommand{\RepU}{\mathrm{Rep}^\uni(U)}
\newcommand{\RepL}{\mathrm{Rep}^{\mathrm{L}}}
\newcommand{\HomL}{\mathrm{Hom}^{\mathrm{L}}}
\newcommand{\EndL}{\mathrm{End}^{\mathrm{L}}}
\newcommand{\Bim}{\mathrm{Bim}}
\newcommand{\BimA}{\mathrm{Bim}^\uni(A)}
%\newcommand{\shom}{\scr Hom}
\newcommand{\divi}{\mathrm{div}}
\newcommand{\sgm}{\varsigma}
\newcommand{\SX}{{S_{\fk X}}}
\newcommand{\DX}{D_{\fk X}}
\newcommand{\mbb}{\mathbb}
\newcommand{\mbf}{\mathbf}
\newcommand{\bsb}{\boldsymbol}
\newcommand{\blt}{\bullet}
\newcommand{\Vbb}{\mathbb V}
\newcommand{\Ubb}{\mathbb U}
\newcommand{\Xbb}{\mathbb X}
\newcommand{\Kbb}{\mathbb K}
\newcommand{\Abb}{\mathbb A}
\newcommand{\Wbb}{\mathbb W}
\newcommand{\Mbb}{\mathbb M}
\newcommand{\Gbb}{\mathbb G}
\newcommand{\Cbb}{\mathbb C}
\newcommand{\Nbb}{\mathbb N}
\newcommand{\Zbb}{\mathbb Z}
\newcommand{\Pbb}{\mathbb P}
\newcommand{\Rbb}{\mathbb R}
\newcommand{\Ebb}{\mathbb E}
\newcommand{\Dbb}{\mathbb D}
\newcommand{\Hbb}{\mathbb H}
\newcommand{\cbf}{\mathbf c}
\newcommand{\Rbf}{\mathbf R}
\newcommand{\wt}{\mathrm{wt}}
\newcommand{\Lie}{\mathrm{Lie}}
\newcommand{\btl}{\blacktriangleleft}
\newcommand{\btr}{\blacktriangleright}
\newcommand{\svir}{\mathcal V\!\mathit{ir}}
\newcommand{\Ker}{\mathrm{Ker}}
\newcommand{\Cok}{\mathrm{Coker}}
\newcommand{\Sbf}{\mathbf{S}}
\newcommand{\low}{\mathrm{low}}
\newcommand{\Sp}{\mathrm{Sp}}
\newcommand{\Rng}{\mathrm{Rng}}
\newcommand{\vN}{\mathrm{vN}}
\newcommand{\Ebf}{\mathbf E}
\newcommand{\Nbf}{\mathbf N}
\newcommand{\Stb}{\mathrm {Stb}}
\newcommand{\SXb}{{S_{\fk X_b}}}
\newcommand{\pr}{\mathrm {pr}}
\newcommand{\SXtd}{S_{\wtd{\fk X}}}
\newcommand{\univ}{\mathrm {univ}}
\newcommand{\vbf}{\mathbf v}
\newcommand{\ubf}{\mathbf u}
\newcommand{\wbf}{\mathbf w}
\newcommand{\CB}{\mathrm{CB}}
\newcommand{\Perm}{\mathrm{Perm}}
\newcommand{\Orb}{\mathrm{Orb}}
\newcommand{\Lss}{{L_{0,\mathrm{s}}}}
\newcommand{\Lni}{{L_{0,\mathrm{n}}}}
\newcommand{\UPSU}{\widetilde{\mathrm{PSU}}(1,1)}
\newcommand{\Sbb}{{\mathbb S}}
\newcommand{\Gc}{\mathscr G_c}
\newcommand{\Obj}{\mathrm{Obj}}
\newcommand{\bpr}{{}^\backprime}
\newcommand{\fin}{\mathrm{fin}}
\newcommand{\Ann}{\mathrm{Ann}}
\newcommand{\Real}{\mathrm{Re}}
\newcommand{\Imag}{\mathrm{Im}}
\newcommand{\cl}{\mathrm{cl}}
\newcommand{\Ind}{\mathrm{Ind}}
\newcommand{\Supp}{\mathrm{Supp}}
\newcommand{\Specan}{\mathrm{Specan}}
\newcommand{\red}{\mathrm{red}}
\newcommand{\uph}{\upharpoonright}
\newcommand{\Mor}{\mathrm{Mor}}
\newcommand{\pre}{\mathrm{pre}}
\newcommand{\rank}{\mathrm{rank}}
\newcommand{\Jac}{\mathrm{Jac}}
\newcommand{\emb}{\mathrm{emb}}
\newcommand{\Sing}{\mathrm{Sing}}










\usepackage{tipa} % wierd symboles e.g. \textturnh
\newcommand{\tipar}{\text{\textrtailr}}
\newcommand{\tipaz}{\text{\textctyogh}}
\newcommand{\tipaomega}{\text{\textcloseomega}}
\newcommand{\tipae}{\text{\textrhookschwa}}
\newcommand{\tipaee}{\text{\textreve}}
\newcommand{\tipak}{\text{\texthtk}}



\usepackage{tipx}
\newcommand{\tipxgamma}{\text{\textfrtailgamma}}
\newcommand{\tipxcc}{\text{\textctstretchc}}
\newcommand{\tipxphi}{\text{\textqplig}}















\numberwithin{equation}{section}




\title{Notes on Complex Analytic Geometry}
\author{{\sc Bin Gui}
	%\\
	%{\small Department of Mathematics, Rutgers university}\\
	%{\small bin.gui@rutgers.edu}
}
\date{Last update: September 2022}
\begin{document}\sloppy % avoid stretch into margins
	\pagenumbering{arabic}
	%\pagenumbering{gobble}
	\setcounter{page}{1}
	\setcounter{section}{-1}
	%\setcounter{equation}{6}
	



	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



	
	\maketitle
%\thispagestyle{empty}	 %remove page number of this page


Contents hyperlinks: \hyperlink{page.2}{Page 2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\vspace{-0.5cm}
\makeatletter
\newcommand*{\toccontents}{\@starttoc{toc}}
\makeatother
\toccontents
	
% title and table of contents same page, no content title

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage






\chapter{Basic notions of complex spaces}

\section{Notations and conventions}
The following notations and conventions are assumed throughout the monograph.

All commutative rings and algebras are assumed to have a unity $1$. Their morphisms are assumed to map $1$ to $1$.

$\Nbb=\{0,1,2,3,\dots\}$ and $\Zbb_+=\{1,2,3,\dots\}$.

$\im=\sqrt{-1}$.

$\{0\},\Cbb,\Cbb^2,\Cbb^3,\dots$ are called \textbf{(complex) number spaces}.

Unless otherwise stated, all vector spaces are over $\Cbb$.

A \textbf{precompact subset $U$} \index{00@Precompact subsets} of a topological space $X$ is a subset such that the closure $U^\cl$ in $X$ is compact. 

$\Cbb\{z_1,\dots,z_n\}$ \index{Cz@$\Cbb\{z_1,\dots,z_n\}:=\scr O_{\Cbb^n,0}$} denotes $\scr O_{\Cbb^n,0}$, the algebra of convergent power series of $z_1,\dots,z_n$. It is clearly an integral domain. $\Cbb[z_1,\dots,z_n]$ denotes the algebra of polynomials of $z_1,\dots,z_n$. \index{Cz@$\Cbb[z_1,\dots,z_n]$} 

We assume the readers are familiar with the basic notions of sheaves and their maps (morphisms), sheafifications, image sheaves, kernels and cokernels of sheaves. %(A review of these concepts can be found e.g. in \cite[Sec.A]{Gui22}.) 
For each presheaf $\scr E$ on a topological space $X$, we let $\scr E_x$ denote the stalk of $\scr E_x$ at $x$. If $\varphi:X\rightarrow Y$ is a continuous map of topological spaces, then the \textbf{direct image} $\varphi_*\scr E$\index{00@Direct image $\varphi_*\scr E$} denotes the sheaf on $Y$ whose space of sections over any open $V\subset Y$ is $\scr E(\varphi^{-1}(V))$, i.e.
\begin{align*}
(\varphi_*\scr E)(V)=\scr E(\varphi^{-1}(V)).
\end{align*}
If $\psi:Y\rightarrow Z$ is continuous, we clearly have
\begin{align*}
(\psi\circ\varphi)_*\scr E=\psi_*(\varphi_*\scr E).
\end{align*}
If $f:\scr E_1\rightarrow\scr E_2$ is an $X$-sheaf map, then we have a canonical $\varphi_*f:\varphi_*\scr E_1\rightarrow\varphi_*\scr E_2$. $\varphi_*$ is a \textbf{left exact functor} from the category of $X$-sheaves to that of $Y$-sheaves. (Cf. Rem. \ref{lb51}.)

If $\scr F$ is an $\scr O_Y$-module, the \textbf{inverse image} $\varphi^{-1}(\scr F)$ \index{00@Inverse image sheaf $\varphi^{-1}(\scr Y)$} is the sheafification of the presheaf on $X$ associating to each open subsets of $X$: 
\begin{align*}
U\mapsto \varinjlim_{V\supset\varphi(U)}\scr F(V)
\end{align*}
where the direct limit is over all open subset $V\subset Y$ containing $\varphi(U)$. For each $x\in X$ there is a natural equivalence
\begin{align}
(\varphi^{-1}\scr F)_x\simeq \scr F_{\varphi(x)}.
\end{align}




$\scr E_U$, $\scr E|U$, $\scr E|_U$, $\scr E\upharpoonright_U$ all denote the restriction of an  $X$-sheaf $\scr E$ to the open subset $U$. If $Y$ is a subset of $X$ and $\iota:Y\hookrightarrow X$ is the inclusion map, we define the \textbf{set theoretic restriction} \index{00@Set theoretic restriction $\scr E\uph_Y$}
\begin{align}
\scr E\uph_Y=\iota^{-1}(\scr E).
\end{align}
In particular, for each $y\in Y$, we have a canonical identification
\begin{align}
(\scr E\uph_Y)_y=\scr E_y.\label{eq4}
\end{align}
Warning: in the future, we will define the restriction $\scr E|_Y=\scr E|Y$ when $Y$ is a complex subspace of a complex space $X$ and $\scr E$ is an $\scr O_X$-module. $\scr E|Y$ will be different from $\scr E\uph_Y$. In particular, $(\scr E|_Y)_y$ is not $\scr E_y$. 





We also write $\scr E(U)$ as $H^0(U,\scr E)$.

Recall that the \textbf{support of an $X$-sheaf} $\scr E$, denoted by $\Supp(\scr E)$, \index{00@Support of a sheaf $\Supp(\scr E)$} is the subset of all $x\in X$ such that $\scr E_x\neq0$.


\begin{rem}
If $Y$ is a closed subset of a topological space $X$, then there is a one-to-one correspondence between $Y$-sheaves $\scr F$ and $X$-sheaves $\scr E$ satisfying $\Supp(\scr E)\subset Y$: For any open $U\subset X$,
\begin{align}
\scr F(U\cap Y)=\scr E(U).
\end{align}
Let $\iota:Y\hookrightarrow X$ be the inclusion. Then clearly $\iota_*\scr F=\scr E$ and $\scr E\uph_Y=\scr F$. We often view $\scr E$ and $\scr F$ as the same thing.
\end{rem}




If $U$ is an open subset of $\Cbb^N$, then a \textbf{holomorphic function} $f$ on $U$ is, by definition, a continuous function $f:U\rightarrow\Cbb$ which is separately holomorphic on each variable (i.e., if $z_1,\dots,z_{i-1},z_{i+1},\dots,z_N$ are fixed, then $f(z_\blt)=f(z_1,\dots,z_N)$ is holomorphic with respect to $z_i$).

\begin{rem}
The above definition agrees with our usual understanding of analytic functions, i.e., $f$ has convergent power series expansions $f(z_\blt)=\sum_{n_1,\dots,n_N\in\Nbb}a_{n_1,\dots,n_N}(z_1-w_1)^{n_1}\cdots (z_N-w_N)^{n_N}$ if $(w_\blt)\in U$. To see this, choose a holomorphic $f$ on $U$. Let us assume for simplicity $w_1=\cdots=w_N=0$, and $U$ is the polydisc $\Dbb_{R_\blt}=\{(z_\blt)\in\Cbb^N:|z_1|<R_1,\dots,|z_N|<R_N\}$ where $R_1,\dots,R_N>0$. Then for each $0<r_i<R_i$ and $z_\blt\in\Dbb_{r_\blt}$,
\begin{align*}
f(z_\blt)=\oint_{|\zeta_1|=r_1}\cdots\oint_{|\zeta_N|=r_N}\frac{f(\zeta_\blt)}{(\zeta_1-z_1)\cdots(\zeta_N-z_N)}\cdot \frac{d\zeta_1\cdots d\zeta_N}{(2\im\pi)^N}
\end{align*}
by applying residue theorem successively to the variables $\zeta_1,\dots,\zeta_N$. Write each $(\zeta_i-z_i)^{-1}$ as $\sum_{n_i=0}^\infty z_i^{n_i}/\zeta_i^{n_i+1}$ which converges absolutely and uniformly on $|\zeta_i|=r_i$ and $z_\blt$ on any compact subset of $\Dbb_{r_\blt}$, and substitute them into the above integral, we get the desired series expansion which is absolutely and uniformly convergent on $|z_1|\leq r_1,\dots,|z_N|\leq r_N$ for all $0<r_i<R_i$. This proves one direction. For the other direction, namely absolutely convergent power series give holomorphic functions, one simply applies Morera's theorem to each complex variable.
\end{rem}


\index{00@Identit\"atssatz}
\begin{lm}[\textbf{Identit\"atssatz}]\label{lb68}
If $U$ is an open connected subset of $\Cbb^n$, and if $h$ is a non-zero (i.e. not constantly zero) holomorphic function on $U$, then $h$ is non-zero when restricted to any open subset $W$ of $U$.
\end{lm}

\begin{proof}
Consider the special case that $U,W$ are open polydiscs. We know the lemma is true when $n=1$ (by e.g. taking power series). For a general $n$, if $h|_W=0$, we may enlarge successively the disc-shape domains of each variable $z_1,\dots,z_n$ on which $h$ is constantly zero to get $h=0$.

In general, we let $\Omega$ be the (clearly open) subset of all $x\in U$ such that $h$ is constantly zero on a neighborhood of $x$ (i.e. the germ of $h$ at $x$ is zero). If $x\in U\setminus\Omega$, then every open polydisc in $U$ containing $x$ must be disjoint from $\Omega$, according to the previous paragraph. So $U\setminus\Omega$ is open. Since $U$ is connected, $\Omega$ must be either $\emptyset$ or $U$. Thus $\Omega=\emptyset$ since $h\neq0$.
\end{proof}




\section{$\Cbb$-ringed spaces and sheaves of modules}

\subsection{$\Cbb$-ringed spaces}




\begin{df}\label{lb2}
A \textbf{$\Cbb$-ringed space} is a topological space $X$ together with a \textbf{sheaf  of local $\Cbb$-algebras} $\scr O_X$ on $X$ (i.e., for each open $U\subset X$, $\scr O_X(U)$ is a $\Cbb$-algebra with unity, and the additions and multiplications are compatible with the restriction to open subsets of $U$; each stalk $\scr O_{X,x}$ is a \textbf{local $\Cbb$-algebra}). 

By saying that $\scr O_{X,x}$ is a local $\Cbb$-algebra, we mean that there is a unique maximal ideal $\fk m_{X,x}$ of $\scr O_{X,x}$, and that we have an isomorphism of vector spaces \index{Cx@$\Cbb_x:=\scr O_{X,x}/\fk m_{X,x}$}
\begin{gather*}
\Cbb\xrightarrow{\simeq}\Cbb_x:=\scr O_{X,x}/\fk m_{X,x},\qquad \lambda\mapsto \lambda 1.
\end{gather*}
We write $\fk m_{X,x}$ as $\fk m_x$ \index{mx@$\fk m_{X,x}=\fk m_x$} when no confusion arises. For each $f\in\scr O_{X,x}$, we let $f(x)\in\Cbb$ denote the residue class of $f$ in $\scr O_{X,x}/\fk m_x$, called the \textbf{value} of $f$ at $x$. In this way, any section of $\scr O_X$ can be viewed as a function.

$\scr O_X$ is called the \textbf{structure sheaf} of $X$. Each open subset $U\subset X$ is automatically a $\Cbb$-ringed subspace of $X$ with structure sheaf $\scr O_U:=\scr O_X|_U$.\hfill\qedsymbol
\end{df}

For the sake of brevity, we write \index{OX@$\scr O(X):=\scr O_X(X)$}
\begin{align}
\scr O(X)=\scr O_X(X)
\end{align}

The following important fact is obvious:

\begin{pp}
An element $f\in\scr O_{X,x}$ is a unit (i.e. invertible in the ring $\scr O_{X,x}$) iff $f(x)\neq 0$.
\end{pp}
\begin{proof}
$f(x)=0$ iff $f\in\fk m_{X,x}$ iff $f$ is not a unit.
\end{proof}


\begin{df}
A \textbf{morphism of $\Cbb$-ringed spaces} $\varphi:X\rightarrow Y$ is a continuous map of topological spaces, together with a morphism of sheaves of $\Cbb$-algebras $\varphi^\#:\scr O_Y\rightarrow \varphi_*\scr O_X$ \index{zz@$\varphi^\#:\scr O_Y\rightarrow \varphi_*\scr O_X$} (namely, $\varphi^\#$ is a sheaf map, and $\varphi^\#:\scr O_Y(V)\rightarrow\scr O_X(\varphi^{-1}(V))$ is a morphism of $\Cbb$-algebras for each open $V\subset Y$), and for each $x\in X$ and $y=\varphi(x)$, the restriction $\varphi^\#:\scr O_{Y,y}\rightarrow \scr O_{X,x}$ is a \textbf{morphism of local $\Cbb$-algebras}, i.e. a morphism of $\Cbb$-algebras such that
\begin{align}
\varphi^\#(\fk m_{Y,y})\subset\fk m_{X,x}.
\end{align}
The set of morphisms of $\Cbb$-ringed spaces $X\rightarrow Y$ is denoted by $\Mor(X,Y)$. \index{Mor@$\Mor(X,Y)$} If $\varphi\in\Mor(X,Y)$ and $\psi\in\Mor(Y,Z)$, then their \textbf{composition} \index{00@Composition of morphisms of $\Cbb$-ringed spaces} $\psi\circ\varphi\in\Mor(X,Z)$ is the usual composition of maps of sets, together with
\begin{align*}
(\psi\circ\varphi)^\#=\varphi^\#\circ\psi^\#:\scr O_{Z,\psi\circ\varphi(x)}\rightarrow\scr O_{X,x}
\end{align*}
for all $x\in X$.
\end{df}

We leave it to the readers to define isomorphisms of $\Cbb$-ringed spaces.

\begin{pp}
For each section $f\in\scr O_Y$ defined at $y=\varphi(x)$, we have
\begin{align}
(\varphi^\#f)(x)=f\circ\varphi(x).\label{eq8}
\end{align}
\end{pp}

\begin{proof}
This is true when $f=1$ since $\varphi^\#$ preserves $1$. It is also true when $f\in\fk m_{Y,y}$. So it is true in general.
\end{proof}

Thus, $\varphi^\#$ may be viewed as the transpose of $\varphi$. When studying morphisms between complex spaces, we may write $\varphi^\# f$ as $f\circ\varphi$ (cf. Rem. \ref{lb6}).

\begin{eg}
A complex manifold is a $\Cbb$-ringed space if we define the structure sheaf $\scr O_X$ to be the sheaf of (germs of) holomorphic functions. If $X$ and $Y$ are complex manifolds, then a holomorphic map from $X$ to $Y$ is a morphism of $\Cbb$-ringed spaces.
\end{eg}





\subsection{Modules over $\Cbb$-ringed spaces}

We begin this section with the following general observation:
\begin{rem}\label{lb11}
If $\scr M,\scr N$ are two subsheaves of an $X$-sheaf such that $\scr M_x=\scr N_x$ for all $x\in X$, then $\scr M=\scr N$. (For any $s\in \scr M$, $s_x\in\scr M_x=\scr N_x$ for all $x$ on which $s$ is defined. So $s\in\scr N$. So $\scr M\subset\scr N$, and vice versa.) Thus, we can talk about`` the \emph{unique} subsheaf of a given sheaf whose stalks are..." where the unique part is automatic. 
\end{rem}

\begin{df}
A \textbf{presheaf of $\scr O_X$-modules} $\scr E$ on a $\Cbb$-ringed space $X$ is a sheaf such that for each open $U\subset X$, $\scr E(U)$ is an $\scr O(U)$-module, and that the linear combination and the action of $\scr O(U)$ on $\scr E(U)$ are compatible with the restriction to open subsets of $U$. If $\scr E$ is a sheaf, we call $\scr E$ an \textbf{$\scr O_X$-module}. We call the vector space \index{00@Fiber $\scr E\lvert x=\scr E_x/{\fk m_{X,x}\scr E_x}=\scr E_x\otimes(\scr O_{X,x}/\fk m_{X,x})$}
\begin{align}
\scr E|x=\scr E_x/{\fk m_{X,x}\scr E_x}=\scr E_x\otimes(\scr O_{X,x}/\fk m_{X,x})\label{eq5}
\end{align}
the \textbf{fiber} of $\scr E$ at $x$. The right most expression of \eqref{eq5} will be explained in Rem. \ref{lb4}. The residue class of $s\in \scr E$ in $\scr E|x$ is denoted by $s(x)$ or $s|x$. 
\end{df}

\begin{df}
A \textbf{morphism of (presheaves of) $\scr O_X$-modules} $\varphi:\scr E\rightarrow\scr F$, where $\scr E$ and $\scr F$ are (presheaves of) $\scr O_X$-modules, is a sheaf map intertwining the actions of $\scr O_X$. More precisely, for each open $U\subset X$, $\varphi:s\in\scr E(U)\mapsto \varphi(s)\in\scr F(U)$ is a morphism of $\scr O(U)$-modules; if $V\subset U$ is open, then $\varphi(s|_U)=\varphi(s)|_U$. 

$\varphi$ is called \textbf{injective} resp. \textbf{surjective} if it is so as a sheaf map, namely $\varphi:\scr E_x\rightarrow\scr F_x$ is injective resp surjective for all $x\in X$. $\scr E\xrightarrow{\varphi}\scr F\xrightarrow{\psi}\scr G$ is called \textbf{exact} if the corresponding sequence of stalk map $\scr E_x\xrightarrow{\varphi}\scr F_x\xrightarrow{\psi}\scr G_x$ is exact for all $x\in X$. $\varphi$ is an \textbf{isomorphism} of $\scr O_X$-modules iff $\varphi$ has an inverse iff $\varphi$ is both injective and surjective. \hfill\qedsymbol
\end{df}


\begin{rem}\label{lb47}
In the following diagrams, assume that all objects are $\scr O_X$-modules, that all horizontal arrows are morphisms of $\scr O_X$-modules, and that the two horizontal lines are exact.
\begin{equation}\label{eq21}
\begin{tikzcd}
0 \arrow[r] & \scr E \arrow[r] \arrow[d, "\alpha"'] & \scr F \arrow[r] \arrow[d, "\beta"'] & \scr G\arrow[d, "\gamma"']\\
0 \arrow[r] & \scr E' \arrow[r]                     & \scr F' \arrow[r]                    & \scr G'                    
\end{tikzcd}
\end{equation}
If there are morphisms $\beta,\gamma$ such that the second square in \eqref{eq21} commutes, then $\beta$ restricts to a (necessarily unique) morphism $\alpha$ such that the first square commutes. 
\begin{equation}\label{eq22}
\begin{tikzcd}
\scr E \arrow[r] \arrow[d, "\alpha"'] & \scr F \arrow[r] \arrow[d, "\beta"'] & \scr G \arrow[r] \arrow[d, "\gamma"'] & 0 \\
\scr E' \arrow[r]                     & \scr F' \arrow[r]                    & \scr G' \arrow[r]                     & 0
\end{tikzcd}
\end{equation}
If there are morphisms $\alpha,\beta$ such that the first square in \eqref{eq22} commutes, then $\beta$ descends to a (necessarily unique) morphism $\gamma$ such that the second square commutes.

Of course, the same observations hold for morphisms of modules of any commutative ring/algebra, and for general sheaf maps.\hfill\qedsymbol
\end{rem}



\begin{rem}[\textbf{Gluing construction of sheaves}]\label{lb12}
Let $(V_\alpha)_{\alpha\in\fk A}$ be an open cover of a topological space $X$. Suppose that for each $\alpha\in\fk A$, we have a sheaf $\scr E^\alpha$, that for any $\alpha,\beta\in\fk A$, we have a sheaf isomorphism $\phi_{\beta,\alpha}:\scr E^\alpha_{V_\alpha\cap V_\beta}\xrightarrow{\simeq}\scr E^\beta_{V_\alpha\cap V_\beta}$, that $\phi_{\alpha,\alpha}=\id$, and that $\phi_{\gamma,\alpha}=\phi_{\gamma,\beta}\phi_{\beta,\alpha}$ when restricted to $V_\alpha\cap V_\beta\cap V_\gamma$. Then we can define a sheaf $\scr E$ on $X$ as follows. For any open $U\subset X$, $\scr E(U)$ is the set of all $(s_\alpha)_{\alpha\in\fk A}\in\prod_{\alpha\in\fk A}\scr E^\alpha(U\cap V_\alpha)$ (where each component $s_\alpha$ is in $\scr E^\alpha(U\cap V_\alpha)$) satisfying that $s_\beta|_{V_\alpha\cap V_\beta}=\phi_{\beta,\alpha}(s_\alpha|_{V_\alpha\cap V_\beta})$ for any $\alpha,\beta\in\fk A$. If $W$ is an open subset of $U$, then the restriction $\scr E(U)\rightarrow\scr E(W)$ is defined by that of $\scr E^\alpha(U\cap V_\alpha)\rightarrow \scr E^\alpha(W\cap V_\alpha)$. Then for each $\beta\in\fk A$, we have a canonical isomorphism (trivialization) $\phi_\beta:\scr E_{V_\beta}\xrightarrow{\simeq} \scr E^\beta_{V_\beta}$ defined by $(s_\alpha)_{\alpha\in\fk A}\mapsto s_\beta$. It is clear that for each $\alpha,\beta\in\fk A$, we have $\phi_\beta=\phi_{\beta,\alpha}\phi_\alpha$ when restricted to $V_\alpha\cap V_\beta$.

In the case that $X$ is a $\Cbb$-ringed space, that each $\scr E^\alpha$ is an $\scr O_{V_\alpha}$-module, and that $\phi_{\beta,\alpha}$ is an equivalence of $\scr O_{V_\alpha\cap V_\beta}$-modules, then $\scr E$ is a sheaf of $\scr O_X$-modules. \hfill\qedsymbol
\end{rem}







Let $X$ be a $\Cbb$-ringed space.
\begin{df}
A set of sections $\fk S\subset\scr O_X(X)$ is said to \textbf{generate} the $\scr O_X$-module $\scr E$ if they generate each stalk $\scr E_x$, i.e., each element of $\scr E_x$ is an $\scr O_{X,x}$-linear combination of finitely many elements of $\fk S$. Equivalently, this means that the $\scr O_X$-module morphism
\begin{align}
\bigoplus_{s\in\fk S}\scr O_X\rightarrow\scr E,\qquad \oplus_s f_s\mapsto \sum_s f_s\cdot s 
\end{align}
(where $f_s\in \scr O_X$) is surjective. If it is also injective, we say $\fk S$ \textbf{generates freely} $\scr E$.
\end{df}






\begin{df}
We say an $\scr O_X$-module $\scr E$ is of \textbf{finite type} if each $x\in X$ is contained in a neighborhood $U$ such that the restriction $\scr E|_U$ is generated by finitely many elements of $\scr E(U)$, or equivalently, there is a surjective $\scr O_U$-module morphism $\scr O_U^n\rightarrow\scr E|_U$.
\end{df}




\begin{exe}
Show that if $\scr E$ is a finite type $\scr O_X$-module, then each stalk $\scr E_x$ is a finitely generated $\scr O_{X,x}$-module, and hence each fiber $\scr E|x$ is finite-dimensional.
\end{exe}
\begin{df}
If $\scr E_1,\scr E_2$ are $\scr O_X$-submodules of an $\scr O_X$-module $\scr F$. The sheafification of the presheaf
\begin{align}
(\scr E_1+\scr E_2)^\pre(U)=\scr E_1(U)+\scr E_2(U)
\end{align}
is denoted by $\scr E_1+\scr E_2$. \index{EE@$\scr E_1+\scr E_2$} It is the unique subsheaf of $\scr F$ (cf. Rem. \ref{lb11}) whose stalks are $(\scr E_1+\scr E_2)_x=\scr E_1+\scr E_2$. It follows that if $\scr E_1$ is generated by $s_1,s_2,\dots\in\scr E_1(X)$ and $\scr E_2$ is generated by $t_1,t_2,\dots\in\scr E_2(X)$, then $\scr E_1+\scr E_2$ is generated by $s_1,s_2,\dots,t_1,t_2,\dots$.
\end{df}


We recall the well-known

\begin{thm}[\textbf{Nakayama's lemma}]\index{00@Nakayama's lemma}
If $A$ is a $\Cbb$-local algebra with maximal ideal $\fk m$, and if $\mc M$ is a finitely generated $A$-module. Then a finite set of elements $s_1,\dots,s_n\in\mc M$ generate the $A$-module $\mc M$ (i.e. elements of $\mc M$ are $A$-linear combinations of $s_1,\dots,s_n$) iff their residue classes in $\mc M/\fk m\cdot\mc M$ span the vector space $\mc M/\fk m\cdot\mc M$.
\end{thm}
Indeed, this is true when $A$ is in general a local ring. In that case, $\mc M/\fk m\cdot\mc M$ is a vector space over the field $A/\fk m$.
\begin{proof}
\cite[Prop. 2.8]{AM}. %or \cite[Sec. A]{Gui22}.
\end{proof}


To apply Nakayama's lemma to sheaves of modules, we need the following observation:
\begin{rem}\label{lb17}
Let $\scr E$ be a finite-type $\scr O_X$-module. Let $s_1,\dots,s_n$ be sections of $\scr E$ defined on a neighborhood of $x\in X$. Suppose (the germs of) $s_1,\dots,s_n$ generate the $\scr O_{X,x}$-module $\scr E_x$. Then there is a neighborhood $U$ of $x$ such that $s_1,\dots,s_n$ generate $\scr E|_U$. In particular, ``$\scr E_x$ generates $\scr E|_U$".
\end{rem}


\begin{proof}
Since $\scr E$ is finite-type, we may find $U$ such that $\scr E|_U$ is generated by $t_1,\dots,t_m\in\scr E(U)$. Since $s_1,\dots,s_n$ generate $\scr O_x$, the germs of $t_1,\dots,t_m$ are $\scr O_{X,x}$-linear combinations of $s_1,\dots,s_n$. Thus, on a possibly smaller $U$, $t_1,\dots,t_m$ are $\scr O_X(U)$-linear combinations of $s_1,\dots,s_n$. So $s_1,\dots,s_n$ generate $\scr E|_U$.
\end{proof}


\begin{co}\label{lb43}
Let $\scr E$ be a finite-type $\scr O_X$-module. Then $\Supp(\scr E)$ is a closed subset of $X$.
\end{co}

\begin{proof}
Assume the setting of Rem. \ref{lb17}. If $\scr E_x=0$ then the stalks of $s_1,\dots,s_n$ are zero at $x$. So we may shrink $U$ so that $s_1=\cdots=s_n=0$ in $\scr E(U)$. So $\scr E|_U=0$.
\end{proof}






\begin{exe}\label{lb64}
Use Nakayama's lemma and Rem. \ref{lb17} to show that if $\scr E$ is a finite type $\scr O_X$-module, and if $s_1,\dots,s_n\in\scr E(U)$ (where $U$ is a neighborhood of $x$) are such that $s_1(x),\dots,s_n(x)$ span the fiber $\scr E|x$, then they generate $\scr E|_V$ for a possibly smaller neighborhood $V$ of $x$. (The opposite direction is obvious.) Nakayama's lemma is most often used in this form.
\end{exe}


\begin{co}
Let $\scr E$ be a finite-type $\scr O_X$-module. Then the \textbf{rank function} \index{00@Rank function} $x\in X\mapsto \dim(\scr E|x)$ is upper-semicontinuous.
\end{co}


\begin{df}
We say that an $\scr O_X$-module $\scr E$ is \textbf{free} if it is isomorphic to $\scr O_X^n$ for some $n\in\Nbb$. We say $\scr E$ is \textbf{locally free} if each $x\in X$ is contained in a neighborhood $U$ such that $\scr E|_U$ is free (or equivalently, that $\scr E|_U$ is generated freely by finitely many elements of $\scr E(U)$).
\end{df}

\begin{exe}
Show that for a complex manifold $X$, locally free $\scr O_X$-modules $\scr E$ are the same as holomorphic vector bundles on $X$. Describe local trivializations and transition functions in terms of local free generators of $\scr E$. %(See e.g. \cite[Sec. A]{Gui22} for details.)
\end{exe}


\begin{df}
An \textbf{ideal sheaf} \index{00@Ideal sheaves} $\mc I$ on a $\Cbb$-ringed space $X$ is an $\scr O_X$-submodule of $\scr O_X$. In particular, each stalk $\mc I_x$ is an ideal of $\scr O_{X,x}$. The \textbf{zero set} $N(\mc I)$ \index{00@Zero sets $N(\mc I)$} is defined to be
\begin{align}
\begin{aligned}\label{eq3}
&N(\mc I):=\{x\in X:f(x)=0\text{ for all }f\in\mc I_x\}=\{x\in X:\mc I_x\subset\fk m_{X,x}\}\\
=&\{x\in X:1\notin\mc I_x\}=\{x\in X:\mc I_x\neq\scr O_{X,x}\}=\Supp(\scr O_U/\mc I).
\end{aligned}
\end{align}
Note that this is a closed subset of $X$ by Cor. \ref{lb43}.
\end{df}

\begin{proof}
Note that $(\scr O_U/\mc I)_x=\scr O_{U,x}/\mc I_x$. So $x\in\Supp(\scr O_U/\mc I)$ iff $\scr O_{U,x}/\mc I_x\neq0$ iff $\mc I_x\subsetneq\scr O_{U,x}$ iff $\mc I_x\subset\fk m_x$ (as $\fk m_x$ is the unique maximal ideal) iff $f(x)=0$ for all $f\in\fk m_x$.
\end{proof}






\begin{rem}\label{lb1}
If $\mc I$ is generated by $f_1,\dots,f_n\in\scr O(X)$, written as
\begin{align*}
\mc I=f_1\scr O_X+\cdots+f_n\scr O_X,
\end{align*}
then clearly
\begin{align}
N(\mc I)=\{\text{The common zeros of }f_1,\dots,f_n\}.
\end{align}
We also write $N(\mc I)$ as $N(f_1,\dots,f_n)$. \index{00@Zero sets $N(f_1,\dots,f_n)$}
\end{rem}









\section{Complex spaces and subspaces}




\begin{df}
A \textbf{(complex) model space} \index{00@Model spaces} is
\begin{align}
\Specan(\scr O_U/\mc I):=\big(N(\mc I),(\scr O_U/\mc I)\uph_{N(\mc I)}\big)
\end{align}
where $U$ is an open subset of a number space $\Cbb^n$, $\scr O_U$ is the sheaf of holomorphic functions on $U$,  $\mc I$ is a \emph{finite-type} ideal of $\scr O_U$. $\Specan(\scr O_U/\mc I)$ is called the \textbf{analytic spectrum} \index{00@Analytic spectra $\Specan$} of the sheaf $\scr O_U/\mc I$. Its underlying topological space is $\Supp(\scr O_U/\mc I)$ as a subset of $U$, and its structure sheaf is $(\scr O_U/\mc I)\uph_{N(\mc I)}$, whose stalk at any $x\in N(\mc I)$ is $\scr O_{U,x}/\mc I_x$ (cf. \eqref{eq4}). With abuse of notations, one also writes for simplicity 
\begin{align}
\Specan(\scr O_U/\mc I):=\big(N(\mc I),\scr O_U/\mc I\big).
\end{align}
The stalk at $x\in N(\mc I)$ of the structure sheaf is a local $\Cbb$-algebra
\begin{align*}
\big(\scr O_{U,x}/\mc I_x,\fk m_{U,x}/\mc I_x\big)
\end{align*}
\end{df}


\begin{df}
A $\Cbb$-ringed Hausdorff space $X$ is called a \textbf{complex space} \index{00@Complex spaces} if each point $x\in X$ is contained in a neighborhood $V$ such that the $\Cbb$-ringed space $V$ (whose structure sheaf is defined by $\scr O_V:=\scr O_X|_V$) is isomorphic  to a model space. Sections of $\scr O_X(X)$ are called \textbf{holomorphic functions on $X$}. $\scr O_{X,x}$ is called an \textbf{analytic local $\Cbb$-algebra}. \index{00@Analytic local $\Cbb$-algebra $\scr O_{X,x}$} Equivalently, an analytic local $\Cbb$-algebra is $\Cbb\{z_1,\dots,z_n\}/I$ for some finitely generated ideal $I$.\footnote{As we shall see, $\Cbb\{z_1,\dots,z_n\}$ is Noetherian. So the condition that $I$ is finitely generated is redundant.} 

If $X,Y$ are complex spaces, a morphism $\varphi:X\rightarrow Y$ of $\Cbb$-ringed spaces is called a \textbf{holomorphic map}. \index{00@Holomorphic maps} If $\varphi$ has an inverse morphism $Y\rightarrow X$, we say that $\varphi$ is a \textbf{biholomorphism}. \index{00@Biholomorphism} Clearly, a holomorphic map $\varphi$ is a biholomorphism iff it is a homeomorphism of topological spaces and induces isomorphisms $\varphi^\#:\scr O_{Y,\varphi(x)}\xrightarrow{\simeq}\scr O_{X,x}$ for each $x\in X$.  \hfill\qedsymbol
\end{df}

\begin{df}\label{lb41}
A \textbf{morphism of (analytic) local $\Cbb$-algebras} \index{00@Morphisms of (analytic) local $\Cbb$-algebras} $\scr O_{Y,y}\rightarrow\scr O_{X,x}$ is a homomorphism of unital algebras sending $\fk m_{Y,y}$ into $\fk m_{X,x}$.
\end{df}



\begin{df}
Let $X$ be a complex space. An \textbf{open complex subspace} \index{00@Complex subspaces (open or closed)} is $(U,\scr O_X|_U)$ where $U$ is an open subset of $X$. A \textbf{closed complex subspace} is \index{00@Analytic spectra $\Specan$}
\begin{align}
\Specan(\scr O_X/\mc I):=\big(N(\mc I),(\scr O_X/\mc I)\uph_{N(\mc I)}\big)
\end{align}
where $\mc I$ is a finite type ideal of $\scr O_X$. The stalk of the structure sheaf at $x\in N(\mc I)$ is a local $\Cbb$-algebra
\begin{align*}
\big(\scr O_{X,x}/\mc I_x,\fk m_x/\mc I_x\big).
\end{align*}
\end{df}




\begin{rem}\label{lb10}
Let $X_0=\Specan(\scr O_X/\mc I)$. The construction of $\scr O_{X_0}=(\scr O_X/\mc I)\uph_{N(\mc I)}$ involves two sheafifications: one for quotient, and one for set-theoretic restriction. It would be convenient to combine these two into one: $\scr O_{X_0}$ is the sheafification of the presheaf $\scr O_{X_0}^\pre$ sending each open $U_0\subset X_0$ (more precisely, $U_0\subset N(\mc I)$) to 
\begin{align}
\scr O_{X_0}^\pre(U_0)=\varinjlim_{U\supset U_0}\scr O_X(U)/\mc I(U)\label{eq18}
\end{align}
where the direct limit is over all open $U\subset X$ containing $U_0$. Indeed, one can also take the direct limit over all open $U$ satisfying $U\cap N(\mc I)=U_0$.
\end{rem}

\begin{rem}
We have an obvious inclusion map which is holomorphic:
\begin{gather*}
\iota:X_0=\Specan(\scr O_X/\mc I)\hookrightarrow X
\end{gather*}
such that $\iota^\#:\scr O_X\rightarrow\iota_*\scr O_{X_0}=\iota_*\iota^{-1}(\scr O_X/\mc I)$ restricts to the quotient maps $\scr O_{X,x}\rightarrow\scr O_{X,x}/\mc I_x=(\iota_*\iota^{-1}(\scr O_X/\mc I))_x$ for all $x\in X$.
\end{rem}

\begin{proof}
We explain the existence of such sheaf map $\iota^\#$. Choose any open $U\subset X$. Then by passing to direct limits \eqref{eq18}, the quotient map $\scr O_X(U)\rightarrow\scr O_X(U)/\mc I(U)$ becomes a map $\scr O_X(U)\rightarrow\scr O_{X_0}^\pre(U\cap N(\mc I))$ whose composition with $\scr O_{X_0}^\pre\rightarrow\scr O_{X_0}$ gives $\scr O_X(U)\rightarrow\scr O_{X_0}(U\cap N(\mc I))=(\iota_*\scr O_{X_0})(U)$. 
\end{proof}





Complex spaces arise from 
\begin{rem}[\textbf{Gluing construction of complex spaces}]\label{lb5}
Suppose $X$ is a Hausdorff space with an open cover $\fk V=(V_\alpha)$. Suppose that for each $V_\alpha$ there is a homoemorphism $\varphi_\alpha:V_\alpha\rightarrow U_\alpha$ where $U_\alpha$ is a complex space. Suppose also that for each $\alpha,\beta$, the homeomorphism $\varphi_\beta\varphi_\alpha^{-1}:\varphi_\alpha(V_\alpha\cap V_\beta)\rightarrow\varphi_\beta(V_\alpha\cap V_\beta)$ (where the source and the target are regarded as open subspaces of $U_\alpha$ and $U_\beta$ respectively) can be extended to an isomorphism $\varphi_{\beta,\alpha}$ of $\Cbb$-ringed spaces satisfying the \textbf{cocycle condition}: for all $\alpha,\beta,\gamma$, we have $\varphi_{\alpha,\alpha}=\id$ and  $\varphi_{\gamma,\alpha}=\varphi_{\gamma,\beta}\varphi_{\beta,\alpha}$ (from $\varphi_\alpha(V_\alpha\cap V_\beta\cap V_\gamma)$ to $\varphi_\gamma(V_\alpha\cap V_\beta\cap V_\gamma)$). Then $X$ is naturally a complex space such that $\varphi_\alpha:V_\alpha\rightarrow U_\alpha$ is extended to an isomorphism  of $\Cbb$-ringed spaces such that $\varphi_\beta=\varphi_{\beta,\alpha}\varphi_\alpha$ (from $V_\alpha\cap V_\beta$ to $\varphi_\beta(V_\alpha\cap V_\beta)$). Indeed, $\scr O_X$ is constructed by gluing all the $V_\alpha$-sheaves $\varphi_\alpha^{-1}\scr O_{U_\alpha}$ (cf. Rem. \ref{lb12}). 
\end{rem}







Let us see some examples of complex spaces. We begin with an easier class of examples:

\begin{df}\label{lb154}
Let $X$ be a complex space, and let $\scr C_X$ \index{CX@$\scr C_X$} be the sheaf of complex valued continuous functions on $X$. Then there is a natural \textbf{morphism of sheaves of local $\Cbb$-algebras} \index{00@Morphism of sheaves of local $\Cbb$-algebras} (i.e. a morphism of $X$-sheaves which preserve the linear structures and algebra multiplications when restricted to each open subset, and whose stalk maps send the maximal ideals into maximal ones) \index{00@Reduction map $\red:\scr O_X\rightarrow\scr C_X$}
\begin{align}
\red:\scr O_X\rightarrow\scr C_X
\end{align}
sending each $f\in\scr O_X$ to $f$ as a function (cf. Def. \ref{lb2}). $\red$ is called the \textbf{reduction map} of $X$. If $\red:\scr O_{X,x}\rightarrow\scr C_{X,x}$ is injective, we say that $X$ is \textbf{reduced at $x\in X$}, or equivalently that $x$ is a \textbf{reduced point} of $X$. If $X$ is reduced everywhere, $X$ is called a \textbf{reduced complex space}. \index{00@Reduced complex spaces and reduced points}
\end{df}

Thus, a holomorphic function on a reduced complex space can be viewed as a genuine continuous function without losing information. (Formally speaking: $\scr O_X$ is a subsheaf of $\scr C_X$.) For non-reduced spaces, holomorphic functions cannot be viewed as genuine functions.

\begin{rem}
In commutative algebra, there is a notion of reducedness: $\scr O_{X,x}$ is called reduced if it has no non-zero nilpotent element. We will see later that a complex space $X$ is reduced at $x$ iff $\scr O_{X,x}$ is a reduced ring. This is the famous Nullstellensatz.
\end{rem}

\begin{eg}\label{lb3}
Let $U\subset \Cbb^m\times\Cbb^n$ be open, and let $\mc I=z_1\scr O_U+\cdots+z_m\scr O_U$. Then $X=\Specan(\scr O_U/\mc I)$ is naturally equivalent to the complex submanifold $U\cap (0\times\Cbb^n)\simeq U\cap\Cbb^n$ (whose structure sheaf is the sheaf of holomorphic functions $f(\zeta_1,\dots,\zeta_n)$).
\end{eg}

\begin{proof}
Clearly $N(\mc I)=U\cap \Cbb^n$ (cf. Rem. \ref{lb1}). Consider the identity map $\varphi:U\cap\Cbb^n\rightarrow X$ as a homeomorphism of topological spaces. In particular, we have an isomorphism $\red\varphi^\#:\scr C_X\rightarrow\scr C_{U\cap\Cbb^n}$. We shall construct $\varphi^\#:\scr O_X=\scr O_U/\mc I\uph_{N(\mc I)}\rightarrow\scr O_{U\cap\Cbb^n}$ such that $\varphi$ is an isomorphism of $\Cbb$-ringed spaces.

By \eqref{eq4}, for each $x\in U\cap\Cbb^n$,
\begin{align*}
\scr O_{X,x}=((\scr O_U/\mc I)\uph_{N(\mc I)})_x\simeq\scr O_{\Cbb^{m+n},x}/\mc I_x\simeq\scr O_{\Cbb^n,x}
\end{align*}
where the last isomorphism can be seen  by taking power series expansions of $f(z_\blt,\zeta_\blt)=f(z_1,\dots,z_m,\zeta_1,\dots,\zeta_n)$ at $n$ and throwing away every terms containing powers of $\zeta_\blt$. Define a sheaf map
\begin{align*}
\varphi^\#:\scr O_X\xrightarrow{\red}\scr C_X\xrightarrow[\simeq]{\red\varphi^\#}\scr C_{U\cap\Cbb^n}.
\end{align*}
Its stalk map is $\scr O_{\Cbb^n,x}\rightarrow\scr C_{U\cap\Cbb^n,x}$ sending each $f$ to the function $f$ itself. From this we see that the stalk map is injective and has image $\scr O_{U\cap\Cbb^n,x}$. This shows that $\varphi^\#$ is an injective sheaf map with image $\scr O_{U\cap\Cbb^n}$. So $\varphi^\#$ restricts to an isomorphism of sheaves of local $\Cbb$-algebras $\scr O_X\rightarrow\scr O_{U\cap\Cbb^n}$.
\end{proof}



\begin{rem}
The proof of Exp. \ref{lb3} suggests a way of understanding a \emph{reduced} model space $X=\Specan(\scr O_U/\mc I)$: 1. Find the underlying topological space $N(\mc I)$. 2. Understand each stalk $\scr O_{X,x}=\scr O_{U,x}/\mc I_x$ and show that $\red:\scr O_{X,x}\rightarrow\scr C_{X,x}$ is injective. 3. Find a familiar sheaf of local $\Cbb$-subalgebras $\scr A\subset\scr C_X$ such that $\scr A_x=\red(\scr O_{X,x})$. Then $X\simeq (N(\mc I),\scr A)$.
\end{rem}


\begin{exe}
Let $U$ be a neighborhood of $0\in\Cbb^2$. Let $z,w$ be the standard coordinates of $\Cbb^2$. Let $\mc I=zw\cdot \scr O_U$, the ideal sheaf generated by the function $zw$. Show that $\Specan(\scr O_U/\mc I)$ is equivalent to the $\Cbb$-ringed space whose underlying topological space  is $N(\mc I)=\{(z,w)\in U:z=0\text{ or }w=0\}$, and whose structure sheaf is the sheaf of continuous functions on open subsets of $N(\mc I)$ that are holomorphic when restricted respectively to the $z$-axis and to the $w$-axis.
\end{exe}


\begin{eg}
Let $k\in\Zbb_+$. Let $U$ be a neighborhood of $0\in\Cbb$. We call $\Specan(\scr O_U/z^k\scr O_U)=(0,\Cbb\{z\}/z^k\Cbb\{z\})=(0,\Cbb[z]/z^k\Cbb[z])$ the \textbf{$k$-fold point}. It is not reduced when $k>1$. A single reduced point is precisely a $1$-fold point, which is the same as the connected $0$-dimensional complex manifold $\Cbb^0$.  
\end{eg}




We close this section by discussing a useful relationship between local-freeness and rank functions. A locally-free sheaf clearly has locally constant rank. The converse holds under some conditions which are often easy to verify:



\begin{pp}\label{lb65}
Let $X$ be a {\color{red}reduced} complex space, and let $\scr E$ be a finite-type $\scr O_X$-module. Then $\scr E$ is locally free if and only if the rank function $\Rbf:x\in X\mapsto \dim(\scr E|x)$ is locally constant. Moreover, if $\Rbf$ has constant value $n$, and if $s_1,\dots,s_n\in\scr E(X)$ generate $\scr E$, then $s_1,\dots,s_n$ generate $\scr E$ freely.
\end{pp}


\begin{proof}
Suppose $\Rbf$ has constant value $n$ and $s_1,\dots,s_n\in\scr E(X)$ generate $\scr E$. Then for each open $U\subset X$ and $f_1,\dots,f_n\in\scr O(U)$ satisfying $f_1s_1+\cdots+f_ns_n=0$, we have for each $x\in U$ that $f_1(x)s_1(x)+\cdots+f_n(x)s_n(x)=0$ where $s_i(x)$ is the restriction of $s_i$ to the fiber $\scr E|x$. Clearly $s_1(x),\dots,s_n(x)$ span $\scr E|x$. Since $\dim(\scr E|x)=n$, $s_1(x),\dots,s_n(x)$ form a basis of $\scr E|x$. So $f_1(x)=\cdots=f_n(x)=0$. As holomorphic functions on a reduced space are determined by their values, we have $f_1=\cdots=f_n=0$. This proves that $s_1,\dots,s_n$ are $\scr O_X$-free.

Assume in general that $\scr E$ is finite-type and $\Rbf$ is locally constant. By shrinking $X$ to a neighborhood of $x\in X$ we may assume $\Rbf$ has constant value $n$. Choose $s_1,\dots,s_n\in\scr E_x$ whose values at $x$ form a basis of $\scr E|x$. By Nakayam's lemma (Exe. \ref{lb64}), we may shrink $X$ so that $s_1,\dots,s_n\in\scr E(X)$ generate $\scr E$. So by the first paragraph, $\scr E$ is locally-free.
\end{proof}



















\section{Holomorphic maps}

In order to construct complex spaces by gluing model spaces (Rem. \ref{lb5}), and to understand holomorphic maps between complex spaces, we need to understand morphisms (i.e. holomorphic maps) between model spaces $\Specan(\scr O_U/\mc I)\rightarrow\Specan(\scr O_V/\mc J)$ (where $U\subset\Cbb^m$ and $V\subset \Cbb^n$ are open). This is a main goal of this section. 

The first step is to understand the case that target is just $V$. As one may expect, holomorphic maps in this case are described by an $n$-tuple of holomorphic functions. Recall that $\Mor(X,Y)$ is the set of holomorphic maps from the complex space $X$ to  $Y$. Let $z_1,\dots,z_n$ be the standard coordinates of $\Cbb^n$.


\begin{thm}\label{lb7}
Let $X$ be a complex space. Then the following map is bijective:
\begin{gather}
\Mor(X,\Cbb^n)\rightarrow\scr O(X)^n,\qquad \varphi\mapsto (\varphi^\#z_1,\dots,\varphi^\#z_n).\label{eq6}
\end{gather}
\end{thm}











\begin{rem}\label{lb6}
Due to this theorem, if $\psi:X\rightarrow Y$ is a holomorphic map and $f\in\scr O(Y)$, then we may write
\begin{align}
f\circ\psi=\psi^\#f
\end{align}
by viewing $f$ as a holomorphic map $Y\rightarrow\Cbb$.
\end{rem}



The proof of Thm. \ref{lb7} relies on the Noetherian property of $\scr O_{X,x}$, whose proof is deferred to the next section.



\begin{proof}[Proof that \eqref{eq6} is surjective assuming \eqref{eq6} is injective]
Assume \eqref{eq6} is injective for all complex spaces. Fix $X$ and $F=(f_1,\dots,f_n)\in\scr O(X)^n$. We claim that each $x\in X$ is contained in a neighborhood $U_x$ such that $F|_{U_x}\in\scr O(U_x)^n$ corresponds to some $\varphi_x\in\Mor(U_x,\Cbb^n)$. By the injectivity, for every $x,y\in X$, $\varphi_x$ and $\varphi_y$ agree on $U_x\cap U_y$. Gluing all $\varphi_x$ together gives the desired $\varphi$ corresponding to $F$.

To prove the claim, we may assume $U_x$ is a model space $\Specan(\scr O_V/\mc I)$ where $V\subset\Cbb^m$ is open and $\mc I$ is finite-type. Since the stalk $(\scr O_V/\mc I)|_x$ equals $\scr O_{V,x}/\mc I_x$, we can further shrink $U_x$ so that $F|_{U_x}$ can be lifted to $\wtd F|_V\in\scr O(V)^n$. $\wtd F$ can be viewed as a holomorphic map $V\rightarrow\Cbb^n$. Its composition with the inclusion $\iota:\Specan(\scr O_V/\mc I)\hookrightarrow V$ gives the desired holomorphic map $\varphi$.
\end{proof}


\begin{proof}[Proof that \eqref{eq6} is injective]
Let $\varphi_1,\varphi_2\in\Mor(X,\Cbb^n)$ correspond to the same element $(f_1,\dots,f_n)$ of $\scr O(X)^n$. By \eqref{eq8}, $z_i\circ\varphi_\blt(x)=(\varphi_\blt^\# z_i)(x)=f_i(x)$. So $\varphi_1$ equals $\varphi_2$ as set maps, i.e. $\varphi_\blt(x)=(f_1(x),\dots,f_n(x))$. Checking that they are equal as morphisms of $\Cbb$-ringed spaces is equivalent to showing for any $x$ that $\varphi_1^\#=\varphi_2^\#$ as maps from $\scr O_{\Cbb^n,\varphi_\blt(x)}=\scr O\{z_1-f_1(x),\dots,z_n-f_n(x)\}$ to $\scr O_{X,x}$. We know that they both send each $z_i-f_i(x)$ to $f_i-f_i(x)$. So they are equal by the uniqueness part of the following proposition.
\end{proof}

The following proposition can be viewed as the infinitesimal version of Thm. \ref{lb7}. (This will become clear after the readers read Thm. \ref{lb19}.)

\begin{pp}\label{lb8}
Let $\scr O_{X,x}$ be an analytic local $\Cbb$-algebra. Fix $n\in\Nbb$ and $f_1,\dots,f_n\in\scr O_{X,x}$. Then there is a unique morphism of local $\Cbb$-algebras satisfying
\begin{align}
\Phi:\scr O_{\Cbb^n,0}=\Cbb\{z_1,\dots,z_n\}\rightarrow \scr O_{X,x},\qquad z_i\mapsto f_i-f_i(x).
\end{align}
\end{pp}

Note that as a morphism of \emph{local} rings, $\Phi$ is assumed to send $\fk m_{\Cbb^n,0}=\sum_{j=1}^n z_j\Cbb\{z_1,\dots,z_n\}$ into $\fk m_{X,x}$.



\begin{proof}
Existence: By the second paragraph of the proof that \eqref{eq6} is surjective (which does not rely on the injectivity of \eqref{eq6}), by shrinking $X$, we may choose a holomorphic map $\phi:X\rightarrow\Cbb^n$ corresponding to $(f_1-f_1(x),\dots,f_n-f_n(x))$. Then the stalk map $\phi^\#:\scr O_{\Cbb^n,0}\rightarrow\scr O_{X,x}$ gives $\Phi$.

Injectivity: Assume $\Phi_1,\Phi_2$ both satisfy the requirement. Then they clearly agree when restricted to the polynomial ring $\Cbb[z_1,\dots,z_n]$. Now we choose $g\in\Cbb\{z_\blt\}$. For each $k\in\Nbb$, we may write $g$ as a polynomial of $z_\blt$ plus $g_k\in\fk m_{\Cbb^n,0}^k$. So $\Phi_1(g)-\Phi_2(g)$ equals $\Phi_1(g_k)-\Phi_2(g_k)$, which belongs to $\fk m_{X,x}^k$ since  $\Phi_i$  sends $\fk m_{\Cbb,0}$ into $\fk m_{X,x}$. So $\Phi_1(g)-\Phi_2(g)$ belongs to $\bigcap_{k\in\Nbb}\fk m_{X,x}^k$, which is $0$ due to the following theorem \emph{and the fact that $\scr O_{X,x}$ is Noetherian}.
\end{proof}



\begin{thm}[\textbf{Krull's intersection theorem}]\label{lb162} \index{00@Krull's intersection theorem}
Let $(A,\fk m)$ be a Noetherian local ring, and let $\mc M$ be a finitely-generated $A$-module. Then $\bigcap_{k\in\Nbb}\fk m^k\cdot \mc M=0$.
\end{thm}

\begin{proof}
The submodule $\mc N=\bigcap_{k\in\Nbb}\fk m^k\cdot \mc M$ is also finitely generated as $A$ is Noetherian. Then $\mc N=0$ will follow from $\fk m\mc N=\mc N$ (equivalently, $0$ spans the ``fiber" $\mc N/\fk m\mc N$) and  Nakayama's lemma. That  $\fk m\mc N=\mc N$ is due to Artin-Rees lemma (applied to the $\fk m$-stable filtration $(\fk m^k\mc M)_{k\in\Nbb}$ to show that $(\mc N\cap\fk m^k\mc M)_{k\in\Nbb}=(\mc N)_{k\in\Nbb}$ is $\fk m$-stable).
\end{proof}

Recall that if $I$ is an ideal of a ring $A$, an \textbf{$I$-filtration} $(\mc M_n)_{n\in\Nbb}$ (of $\mc M_0$) is a descending chain of $A$-modules $\mc M_0\supset\mc M_1\supset\mc M_2\supset\cdots$ satisfying $I\mc M_n\subset\mc M_{n+1}$ for all $n\in\Nbb$. It is called \textbf{$I$-stable} if for some $N\in\Nbb$ we have $I\mc M_n=\mc M_{n+1}$ for all $n\geq N$.

\begin{thm}[\textbf{Artin-Rees lemma}] \index{00@Artin-Rees lemma}
Let $I$ be an ideal of a Noetherian ring $A$. Then for any $I$-stable filtration $(\mc M_n)_{n\in\Nbb}$ inside a finitely-generated $A$-module $\mc M$, and for any submodule $\mc N\subset\mc M$, $(\mc N\cap\mc M_n)_{n\in\Nbb}$ is $I$-stable.
\end{thm}

\begin{proof}
This follows from two ingredients: 1. The graded ring $A_\blt=(A,I,I^2,\cdots)$ is a quotient of the Noetherian ring $A[z_1,\dots,z_m]$ if $I$ is generated by $m$ elements. So $A_\blt$ is Noetherian. 2. An $I$-filtration $(\mc M_0)_{n\in\Nbb}$ of finitely-generated $A$-modules is $I$-stable iff the graded $A_\blt$-module $\mc M_\blt=(\mc M_0,\mc M_1,\mc M_2,\cdots)$ is finitely-generated. See \cite[Sec. 10.3]{AM} for details.
\end{proof}


The uniqueness part of Thm. \ref{lb7} can be formulated in the following form.
\begin{rem}[\textbf{Substitution rule}]\label{lb27}
Let $X$ be a complex space, let $\mc I$ be a finite type ideal of $\scr O_X$ containing $f_1-g_1,\dots,f_n-g_n$ where $f_\blt,g_\blt\in\scr O(X)$. Let $F=(f_1,\dots,f_n)$ and $G=(g_1,\dots,g_n)$. Let $h\in\scr O_{\Cbb^n}$. Then $F^\#h$ and $G^\#h$ restrict to the same (locally defined) holomorphic function of $Y=\Specan(\scr O_X/\mc I)$, i.e. they are equal as elements of $\scr O_X/\mc I$.
\end{rem}
\begin{proof}
$f_i$ and $g_i$ are equal as holomorphic functions of $Y$. So by Thm. \ref{lb7}, $F$ and $G$ are the same holomorphic map $X\rightarrow\Cbb^n$. So $F^\#h$ equals $G^\#h$ as elements of $\scr O_Y$.
\end{proof}

\begin{eg}
Let $U\subset\Cbb^2$ be open, let $f\in\scr O(U)$, and let $\mc I$ be the ideal sheaf of $\scr O_U$ generated by $z_2-f(z_1,z_2)$. Then for each $h\in\scr O_{\Cbb^2}$, $h(z_1,z_2)$ and $h(z_1,f(z_1,z_2))$ are equal as elements of $\scr O_U/\mc I$. %This is because $z_2$ equals $f(z_1,z_2)$ as holomorphic functions on $X=\Specan(\scr O_U/\mc I)$. So $(z_1,z_2)$ and $(z_1,f(z_1,z_2))$ are the same holomorphic maps $X\rightarrow\Cbb^2$ by Thm. \ref{lb7}. So their composition with $h$ are equal.
\end{eg}




We have seen how a holomorphic map from a model space $\Specan(\scr O_U/\mc I)$ to $V\subset\Cbb^n$ looks like. The next question is when this map ``has image in $\Specan(\scr O_V/\mc J)$"? This is answered by the following theorem whose proof does not rely on the Noetherian property.



\begin{thm}\label{lb13}
Let $\varphi:X\rightarrow Y$ be a holomorphic map of complex spaces. Let $X_0=\Specan(\scr O_X/\mc I)$ and $Y_0=\Specan(\scr O_Y/\mc J)$ be closed complex subspaces of $X$ and $Y$ respectively. Then the following are equivalent:
\begin{enumerate}[label=(\alph*)]
\item There is a (necessarily unique) holomorphic map $\psi:X_0\rightarrow Y_0$ such that the following diagram commutes:
\begin{equation}\label{eq7}
\begin{tikzcd}
X_0 \arrow[r, "\psi"] \arrow[d, hook] & Y_0 \arrow[d, hook] \\
X \arrow[r,"\varphi"]                                            & Y               
\end{tikzcd}
\end{equation}
\item For each $x\in X$ and $y=\varphi(x)$, the stalk map $\varphi^\#:\scr O_{Y,y}\rightarrow\scr O_{X,x}$ satisfies
\begin{align*}
\varphi^\#(\mc J_y)\subset\mc I_x
\end{align*}
\end{enumerate}
\end{thm}

\begin{proof}
Assume (a). If $x\in X_0$, then each $f\in\mc J_y\subset\scr O_{Y,y}$ is sent by the transpose $\iota_{Y_0,Y}^\#$ to $0$. Also $f$ is sent by $\varphi^\#$ to $\varphi^\#(f)\in\scr O_{X,x}$, and then sent by $\iota_{X_0,X}^\#$ to $\varphi^\#(f)+\mc I_x$ in $\scr O_{X_0,x}=\scr O_{X,x}/\mc I_x$, which must be $0$ since \eqref{eq7} commutes. So $\varphi^\#(f)\in\mc I_x$.

If $x\in X\setminus X_0$, then $x\neq N(\mc I)$. So $\mc I_x=\scr O_{X,x_0}$. Then clearly $\varphi^\#(\mc J_y)\subset\mc I_x$. (b) is proved.

Now assume (b). If $y\notin N(\mc J)$, then $\mc J_y=\scr O_{Y,y}$. So $1\in\mc J_y$, and so $1=\varphi^\#(1)$ belongs to $\mc I_x$. Therefore $x\notin N(\mc I)$. This proves $\varphi(N(\mc I))\subset N(\mc J)$. So $\psi$ exists as a continuous map of topological spaces, and such a map is clearly unique.

Choose $x\in X_0$ i.e. $x\in N(\mc I)$. By (b), we have a commutative diagram
\begin{equation*}
\begin{tikzcd}
\scr O_{X_0,x}=\scr O_{X,x}/\mc I_x                     & \scr O_{Y_0,y}=\scr O_{Y,y}/\mc J_y \arrow[l,"\psi^\#"']                      \\
\scr O_{X,x} \arrow[u, two heads] & \scr O_{Y,y} \arrow[l,"\varphi^\#"'] \arrow[u, two heads]
\end{tikzcd}
\end{equation*}
for a unique stalk map $\psi^\#:\scr O_{Y_0,y}\rightarrow\scr O_{X_0,x}$, which is clearly a morphism of local $\Cbb$-algebras. It remains to show that these stalk maps can be assembled into a sheaf map. 

Recall the presheaves in Rem. \ref{lb10}. For each open $V\subset Y$,  (b) implies $\varphi^\#(\mc J(V))\subset\mc I(\varphi^{-1}(V))$. So the map $\varphi^\#:\scr O_Y(V)\rightarrow (\varphi_*\scr O_X)(V)=\scr O_X(\varphi^{-1}(V))$ descends to
\begin{align*}
\scr O_Y(V)/\mc J(V)\rightarrow \scr O_X(\varphi^{-1}(V))/\mc I(\varphi^{-1}(V)).
\end{align*}
By taking direct limit over all $V$ containing a fixed open $V_0\subset Y_0$, we obtain
\begin{align*}
\scr O_{Y_0}^\pre(V_0)\rightarrow \scr O_{X_0}^\pre(\psi^{-1}(V_0))
\end{align*}
Its composition with
\begin{align*}
\scr O_{X_0}^\pre(\psi^{-1}(V_0))\rightarrow\scr O_{X_0}(\psi^{-1}(V_0))=(\psi_*\scr O_{X_0})(V_0)
\end{align*}
gives a presheaf map $\scr O_{Y_0}^\pre\rightarrow\psi_*\scr O_{X_0}$  whose sheafification is the desired $\psi^\#:\scr O_{Y_0}\rightarrow\psi_*\scr O_{X_0}$.
\end{proof}



\section{Weierstrass division theorem and Noetherian property of $\scr O_{X,x}$}


\subsection{Main results}

Now that we have seen the importance of the Noetherian property, we prove this in this section. Since $\scr O_{X,x}$ is a quotient of $\scr O_{\Cbb^n,0}$, it suffices to prove that $\scr O_{\Cbb^n,0}$ is Noetherian. The proof relies on Weierstrass division theorem, which we state below.

\begin{df}\label{lb61}
We say that $f(z)\in\Cbb\{z\}$ has \textbf{order} $k\in\Nbb\cup\{\infty\}$ if $f(z)=z^k(a_k+a_{k+1}z+a_{k+2}z^2+\cdots)$ and $a_k\neq0$; $f$ has order $\infty$ iff $f=0$. More generally, for $m\in\Nbb$, we say that $f(w_\blt,z)=f(w_1,\dots,w_m,z)\in\Cbb\{w_\blt,z\}$ has \textbf{order $k$ (in $z$)}  if $f(0,z)\in\Cbb\{z\}$ has order $k$. \index{00@Orders of elements of $\Cbb\{w_\blt,z\}$} Equivalently, $f(w_\blt,z)=\sum_{i=0}^\infty a_k(w_\blt)z^k$ where
\begin{align}
a_0(0)=\cdots=a_{k-1}(0)=0,\qquad a_k(0)\neq 0.
\end{align}
That $f$ has order $\infty$ in $z$ means $a_i(0)=0$ for all $i$. 

Recall that the \textbf{degree} of a polynomial $p(w_\blt,z)\in \Cbb\{w_\blt\}[z]$ is the smallest power of $z$ whose coefficient is a non-zero element of $\Cbb\{w_\blt\}$. The degree of zero polynomial is set to be $-\infty$. \hfill\qedsymbol
\end{df}

\begin{rem}\label{lb16}
Let $f(w_\blt,z)$ have order $k<\infty$ in $z$, defined on a neighborhood of $0$. Then inside this neighborhood we can find a smaller one  $U\times V\subset\Cbb^m\times\Cbb$ such that $f(0,z)$ has one zero in $V^\cl$ (namely $z=0$) with multiplicity $k$. By Rouch\'e's theorem, we may shrink $U$ such that for each fixed $w_\blt\in U$, the holomorphic function $f(w_\blt,z)$ of $z$ has $k$ zeros in $V$ counting multiplicities; see Fig. \ref{fig1}.
\begin{figure}[h]
	\centering



\scalebox{1}{\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

%Flowchart: Process [id:dp43048504471762983] 
\draw   (257.42,59.7) -- (281.68,59.7) -- (281.68,129.5) -- (257.42,129.5) -- cycle ;
%Curve Lines [id:da4002736123725257] 
\draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ][line width=0.75]    (258.08,88.79) .. controls (269.74,86.33) and (267.57,105.94) .. (280.93,105.44) ;
%Curve Lines [id:da507595058105385] 
\draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ][line width=0.75]    (258.08,104.8) .. controls (274.5,98.34) and (264.35,90.14) .. (281.53,88.15) ;
%Curve Lines [id:da1716431524122486] 
\draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (258.08,96.48) .. controls (268.6,94.88) and (268.54,98.51) .. (282.28,95.03) ;
%Straight Lines [id:da29626072607817044] 
\draw    (250.16,79.48) -- (250.35,56.37) ;
\draw [shift={(250.37,54.37)}, rotate = 90.48] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Straight Lines [id:da21464363781912077] 
\draw    (276.89,137.07) -- (294.19,136.98) ;
\draw [shift={(296.19,136.97)}, rotate = 179.7] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;

% Text Node
\draw (237.62,57.13) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {$\displaystyle z$};
% Text Node
\draw (288.84,123.67) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {$\displaystyle w_\blt$};


\end{tikzpicture}}
	\caption{}
	\label{fig1}
\end{figure}
\end{rem}


In the following, we suppress the variable $w_\blt$ when necessary.

\begin{thm}[\textbf{Weierstrass division theorem (WDT)}] \index{00@WDT: Weierstrass division theorem}
Suppose $g\in\Cbb\{w_\blt,z\}$ has order $k<\infty$ in $z$. Then for each $f\in\Cbb\{w_\blt,z\}$, there exist unique $q\in\Cbb\{w_\blt,z\}$ and $r\in\Cbb\{w_\blt\}[z]$ with degree $<k$ such that $f=gq+r$.
\end{thm}


We shall prove the Noetherian property using the following (almost) equivalent form of WDT.
\begin{thm}[\textbf{Weierstrass division theorem (WDT)}] 
Suppose $g\in\Cbb\{w_\blt,z\}=\scr O_{\Cbb^{m+1}}$ has order $k<\infty$ in $z$. Then $\scr O_{\Cbb^{m+1},0}/g\scr O_{\Cbb^{m+1},0}$ is a rank-$k$ free $\scr O_{\Cbb^m}$-module. $1,z,\dots,z^{k-1}$ are a set of free generators.
\end{thm}


\begin{thm}\label{lb70}
Every analytic local $\Cbb$-algebra $\scr O_{X,x}$ is Noetherian.
\end{thm}

\begin{proof}
It suffices to discuss $\scr O_{\Cbb^n,0}$. We prove this by induction on $n$. The case $n=0$ is trivial. Suppose the case $m=n-1$ is known. We prove the case $m+1$. Choose any ideal non-zero $I\subset\scr O_{\Cbb^{m+1},0}$. Choose $0\neq g\in I$. Then  on a complex line passing through $0$, $0$ must be an isolated zero of $h$. (Otherwise, on each line, $g$ vanishes on a neighborhood of $0$. So $g$ vanishes on each line (and hence each domain containing $0$) by complex analysis.) By choosing new coordinates, we may assume the last coordinate axis is that line. Namely, writing $g=g(w_1,\dots,w_m,z)$, $g$ has finite order in $z$.

By WDT, $\scr O_{\Cbb^{m+1},0}/g\scr O_{\Cbb^{m+1},0}$ is a finitely-generated $\scr O_{\Cbb^m,0}$-module. Its submodule $I/I\cap g\scr O_{\Cbb^{m+1},0}$ is generated by finitely many elements $f_1,\dots,f_N\in I$, thanks to the assumption that $\scr O_{\Cbb^m,0}$ is Noetherian. So elements of $I$ are  $\scr O_{\Cbb^{m+1},0}$-linear combinations of $f_1,\dots,f_N,g$.
\end{proof}


\subsection{Proof of WDT}

We prove the first version of WDT following \cite{GR}.
\begin{proof}[Proof of the uniqueness]
Let $f=gq_1+r_1=gq_2+r_2$. Then $g(q_1-q_2)=r_2-r_1$. Choose a small enough neighborhood $U\times V\subset\Cbb^m\times\Cbb$ as in Rem. \ref{lb16} such that for all fixed $w_\blt\in U$, $g(z)$ has $k$ zeros in $V$ (counting multiplicities). So $g(q_1-q_2)$ has $\geq k$ zeros in $z$. Since $r_2-r_1$ has degree $<k$ in $z$, for the fixed $w_\blt$, the number of zeros of $r_2-r_1$ is either $<k$ (which is impossible), or is $\infty$. Since the latter is the only possible case, we conclude $(r_1-r_2)(z)=0$ for all $w_\blt$. And $(q_1-q_2)(z)=0$  since it is so outside the (finitely many) zeros of $g$. (One can also deduce $q_1=q_2$ from the fact that $\scr O_{\Cbb^{m+1},0}$ is an integral domain.)
\end{proof}




\begin{proof}[Discussion]
We now discuss the proof of the existence part. Let $\wht f,\wht g$ be the first $k$ terms in their power series expansions of $z$. So
\begin{gather*}
g(w_\blt,z)=\underbrace{a_0+a_1z+\cdots+a_{k-1}z^{k-1}}_{\wht g}+z^k(a_k+a_{k+1}z+a_{k+2}z^2+\cdots)
\end{gather*}
where all $a_i=a_i(w_\blt)\in\Cbb\{w_\blt\}$ and $a_0(0)=\cdots=a_{k-1}(0)=0$, $a_k(0)\neq 0$. So $(g-\wht g)z^{-k}$ and similarly $(f-\wht f)z^{-k}$ are naturally elements of $\Cbb\{w_\blt,z\}$. Moreover, $(g-\wht g)z^{-k}$ is a unit.

A na\"ive attempt to find the decomposition $f=gq+r$ is to write
\begin{align*}
f=g\cdot \frac{f-\wht f}{g}+\wht f
\end{align*}
since clearly $\wht f\in\Cbb\{w_\blt\}[z]$ has degree $<k$ in $z$. This certainly works for single-variable functions. However, when $m>0$, the expression $(f-\wht f)/g$ might not be continuous at the origin. (Take for instance the quotient to be $z^2/(wz+z^2)$.) We can only divide $f-\wht f$ by $g-\wht g$, which gives an element of $\Cbb\{w_\blt,z\}$. So we write
\begin{align*}
f=(g-\wht g)\cdot\frac{f-\wht f}{g-\wht g}+\wht f=g\cdot\frac{f-\wht f}{g-\wht g}+\wht f+\underbrace{\left(-\wht g\cdot \frac{f-\wht f}{g-\wht g}\right)}_{f_1}
\end{align*}

We then decompose $f_1$, find $f_2$, and then repeat this procedure again and again to produce an infinite series, which we hope would converge to the expected decomposition. Namely, we let $f_0=f$. So the above defines $f_1$ in terms of $f_0$. We define in a similar way $f_{n+1}$ in terms of $f_n$:
\begin{align}
f_n=g\cdot\frac{f_n-\wht f_n}{g-\wht g}+\wht f_n+f_{n+1}.\label{eq11}
\end{align}  
Substituting $f_0,f_1,\dots,f_n$ into $f$, we get
\begin{align}
&f=\left(g\cdot\frac{f_0-\wht f_0}{g-\wht g}+\wht f_0\right)+f_1\nonumber\\
=&\left(g\cdot\frac{f_0-\wht f_0}{g-\wht g}+\wht f_0\right)+\left(g\cdot\frac{f_1-\wht f_1}{g-\wht g}+\wht f_1\right)+f_2=\cdots\nonumber\\
=&g\cdot\sum_{i=0}^n\frac{f_i-\wht f_i}{g-\wht g}+\sum_{i=0}^n \wht f_i+f_{n+1}.\label{eq14}
\end{align}
In the following formal proof, we give careful analysis when $n\rightarrow\infty$.
\end{proof}





\begin{proof}[Finishing the proof of WDT]
For each $(r_\blt,\rho)=(r_1,\dots,r_m,\rho)\in\Rbb_{>0}^m\times\Rbb_{>0}$, define a norm $\lVert\cdot \lVert_{r_\blt,\rho}$ on $\Cbb\{w_\blt,z\}$ as follows: if $h=\sum_{i_1,\dots,i_m,j\in\Nbb}b_{i_\blt,j}w_1^{i_1}\cdots w_m^{i_m}z^j$ then
\begin{align*}
\lVert h\lVert_{r_\blt,\rho}=\sum_{i_1,\dots,i_m,j\in\Nbb}|b_{i_\blt,j}|r_1^{i_1}\cdots r_m^{i_m}\rho^j,
\end{align*}
which might take value $\infty$. We have
\begin{align}
\lVert h_1h_2\lVert_{r_\blt,\rho}\leq \lVert h_1\lVert_{r_\blt,\rho}\cdot\lVert h_2\lVert_{r_\blt,\rho}\qquad \lVert h-\wht h\lVert_{r_\blt,\rho}\leq \lVert h\lVert_{r_\blt,\rho}.\label{eq13}
\end{align}


We write \eqref{eq11} as
\begin{align}
-f_{n+1}=&\frac{\wht g}{(g-\wht g)}\cdot (f_n-\wht f_n)\nonumber\\
=&\frac{\wht g}{z^{-k}(g-\wht g)}\cdot z^{-k}(f_n-\wht f_n)=:\beta\cdot \alpha_n.\label{eq12}
\end{align}
By the first paragraph in the previous \emph{Discussion}, we have $\beta,\alpha_n\in\Cbb\{w_\blt,z\}$. Choose $r_\blt,\rho$ such that $f,g$ are defined (and holomorphic) and $g-\wht g$ has no zeros in the polydisc $D$ with multiradii $r_\blt,\rho$ except at the origin. Then \eqref{eq12} shows that all $f_n$ are defined in this domain.

Slightly shrink $\rho$ so that $C:=\lVert f\lVert_{r_\blt,\rho}<\infty$. \emph{Now we use the condition that $g$ has order $k$ in $z$ in full power}: it tells us that $\beta(0,z)=0$. So we may shrink $r_\blt$ such that $\lVert\beta\lVert_{r_\blt,\rho}<\frac 12\rho^k$. Clearly $\lVert f_n-\wht f_n\lVert_{r_\blt,\rho}=\rho^k\lVert\alpha_n\lVert_{r_\blt,\rho}$. So by \eqref{eq13}, 
\begin{align*}
\lVert f_{n+1}\lVert_{r_\blt,\rho}<\frac 12\lVert f_n-\wht f_n\lVert_{r_\blt,\rho}\leq \frac 12\lVert f_n\lVert_{r_\blt,\rho}.
\end{align*}
Thus $\lVert f_n\lVert_{r_\blt,\rho}< 2^{-n}C$. So $\lVert z^{-k}(f_n-\wht f_n)\lVert_{r_\blt,\rho}<2^{-n}\rho^{-k}C$ and $\lVert\wht f_n\lVert_{r_\blt,\rho}<2^{-n}C$.

The uniform norm on the polydisc with multi-radii $(r_\blt,\rho)$ is clearly $\leq \lVert\cdot\lVert_{r_\blt,\rho}$. So $f_n\rightarrow 0$ uniformly on the polydisc $D$. 
The infinite series $\sum_{i=0}^\infty\frac{z^{-k}(f_i-\wht f_i)}{z^{-k}(g-\wht g)}$ converges uniformly to a continuous function $q$ on any compact subset of $D$. $q$ is holomorphic, since it is so on each variable by Morera's theorem. Similarly, $\sum_{i=0}^\infty\wht f_i$ converges uniformly to a holomorphic $r$. Residue theorem and the fact that contour integrals commute with (uniformly convergent) infinite sum show that $r$ does not have $\geq k$ powers of $z$ (since each $\wht f_n$ does not). Thus, we obtain the decomposition $f=gq+r$ by letting $n\rightarrow\infty$ in \eqref{eq14}.
\end{proof}


\section{Germs of complex spaces}


\begin{df}
The \textbf{category of germs of complex spaces} denotes the one whose objects are $(X,x)$ where $X$ is a complex space and $x$ is a marked point. If $U\subset X$ is a neighborhood of $x$ then $(X,x)$ is identified with $(U,x)$. A \textbf{morphism of germs} from $(X,x)$ to $(Y,y)$ is a holomorphic map $\varphi:U\rightarrow Y$ where $U\subset X$ is a neighborhood of $x$ such that $\varphi(x)=y$. Two morphisms $\varphi_1,\varphi_2:(X,x)\rightarrow (Y,y)$ are regarded equal if there is a neighborhood $U$ of $x$ such that $\varphi_1|_U$ equals $\varphi_2|_U$ as holomorphic maps $U\rightarrow Y$. Composition of morphisms are the usual one for holomorphic functions (i.e. for $\Cbb$-ringed spaces). 

An \textbf{isomorphism of germs of complex spaces} $\varphi:(X,x)\rightarrow(Y,y)$ is a morphism of germs with inverses, namely, there is a morphism $\psi:(Y,y)\rightarrow (X,x)$ such that $\psi\circ\varphi$ and $\varphi\circ\psi$ are $\id$ on neighborhoods of $x$ and $y$ respectively. Equivalently, there are neighborhoods $U\ni x$ and $V\ni y$ such that $\varphi:U\rightarrow V$ is a biholomorphism, and that $\varphi(x)=y$. \hfill\qedsymbol
\end{df}




The category of analytic local $\Cbb$-algebras is understood in the obvious way: the morphisms are defined by Def. \ref{lb41}.


\begin{thm}\label{lb19}
The contravariant functor $\fk F$ from the category of germs of complex spaces to the category of analytic local $\Cbb$-algebras, sending $(X,x)$ to $\scr O_{X,x}$ and sending $\varphi:(X,y)\rightarrow(Y,y)$ to $\varphi^\#:\scr O_{Y,y}\rightarrow\scr O_{X,x}$, is an \textbf{antiequivalence of categories}. \index{00@Antiequivalence of categories} Namely:
\begin{enumerate}[label=(\arabic*)]
\item For each $(X,x)$ and $(Y,y)$, the following map is bijective
\begin{align}
\fk F:\Mor\big((X,x),(Y,y)\big)\rightarrow \Mor\big(\scr O_{Y,y},\scr O_{X,x}\big),\qquad \varphi\mapsto\varphi^\#.\label{eq15}
\end{align}
\item Each analytic local $\Cbb$-algebra is isomorphic to $\fk F((X,x))$ for some germ of complex space $(X,x)$.
\end{enumerate}
\end{thm}




Part (2) is obvious. Let us prove part (1).


\begin{proof}
Assume without loss of generality that $Y$ is a model space $\Specan(\scr O_V/\mc J)$ where $V\subset\Cbb^n$ is open and $y=0$. 

Suppose $\varphi_1^\#,\varphi_2^\#:\scr O_{Y,y}=\scr O_{\Cbb^n,0}/\mc J_0\rightarrow\scr O_{X,x}$ are equal. Then for each $j=1,\dots,n$, $\varphi_1^\#z_j$ equals $\varphi_2^\#z_j$ as elements of $\scr O_{X,x}$. So they are equal on $X$ if we shrink $X$ to a smaller neighborhood of $x$. By Thm. \ref{lb7}, $\varphi_1$ and $\varphi_2$ are equal as holomorphic maps $X\rightarrow V$, and hence are equal as $X\rightarrow Y$. So the map $\fk F$ in \eqref{eq15} is injective.

Next, we choose a morphism $\Phi:\scr O_{\Cbb^n,0}/\mc J_0\rightarrow\scr O_{X,x}$. Let $f_1=\Phi(z_1),\dots,f_n=\Phi(z_n)$, which are elements of $\scr O(X)$ if we shrink $X$ to a smaller neighborhood of $x$. View $F=(f_1,\dots,f_n)\in\scr O(X)^n$ as a holomorphic map $\varphi:X\rightarrow\Cbb^n$. Replace $X$ by $\varphi^{-1}(V)$ such that $\varphi:X\rightarrow V$. Note that $\varphi(x)=0$. So $h\in\scr O_{\Cbb^n,0}\mapsto h\circ \varphi=\varphi^\#h\in\scr O_{X,x}$ is a morphism of local $\Cbb$-algebras. It agrees with $\scr O_{\Cbb^n,0}\rightarrow\scr O_{\Cbb^n,0}/\mc J_0\xrightarrow{\Phi}\scr O_{X,x}$ on $z_1,\dots,z_n$ by the very definition of $F$. So they agree on any element of $\scr O_{\Cbb^n,0}$ due to Prop. \ref{lb8}. We conclude $\varphi^\#(h)=\Phi([h])$  for all $h\in\scr O_{\Cbb^n,0}$ (where $[h]$ denotes the residue class of $h$ in $\scr O_{\Cbb^n,0}/\mc J_0$). In particular, we have $\varphi^\#\mc J_0=0$ in $\scr O_{X,x}$.

Shrink $V$ and $X\subset\varphi^{-1}(V)$, and choose $g_1,\dots,g_k\in\scr O_{\Cbb^n}(V)$ generating the ideal $\mc J_0$ and sent by $\varphi^\#$ to $0\in\scr O(X)$. Since $\mc J$ is finite-type, by Rem. \ref{lb17}, we can shrink $V$ such that $g_1,\dots,g_k$ generate $\mc J$. Thus $\varphi^\#\mc J=0$ in $\varphi_*\scr O_X$. By Thm. \ref{lb13}, $\varphi$ restricts to a holomorphic map $\wtd\varphi:X\rightarrow Y$. $\wtd\varphi^\#:\scr O_{Y,y}=\scr O_{\Cbb^n,0}/\mc J_0\rightarrow\scr O_{X,x}$ equals $\Phi$ since $\varphi^\#:\scr O_{\Cbb^n,0}\rightarrow\scr O_{X,x}$ factors as $\scr O_{\Cbb^n,0}\rightarrow\scr O_{\Cbb^n,0}/\mc J_0\xrightarrow{\wtd\varphi^\#}\scr O_{X,x}$. This proves that $\fk F$ is surjective.
\end{proof}

\begin{co}\label{lb18}
Let $X,Y$ be complex spaces, $x\in Y,y\in Y$, and $\Phi:\scr O_{Y,y}\xrightarrow{\simeq}\scr O_{X,x}$ be an isomorphism of local algebras. Then there are neighborhoods $U\ni x,V\ni y$ and a biholomorphism $\varphi:U\xrightarrow{\simeq}V$ whose transpose $\varphi^\#:\scr O_{V,y}\rightarrow\scr O_{U,x}$ equals $\Phi$.
\end{co}

\begin{df}
An analytic local $\Cbb$-algebra is called \textbf{regular} \index{00@Recular analytic local $\Cbb$-algebras $\scr O_{\Cbb^n,0}$} if it is isomorphic to $\scr O_{\Cbb^n,0}=\Cbb\{z_1,\dots,z_n\}$ for some $n$.
\end{df}

\begin{co}\label{lb130}
Let $X$ be a complex space and $x\in X$. If $\scr O_{X,x}$ is regular, then there is a neighborhood $U$ of $x$ biholomorphic to an open subset of $\Cbb^n$ for some $n$.
\end{co}

\begin{df}\label{lb129}
We say that $X$ is \textbf{smooth at $x$} (equivalently, $x$ is a \textbf{smooth point} of $X$) if $\scr O_{X,x}$ is regular.  We say that $X$ is \textbf{smooth} (equivalently, $X$ is a complex manifold) if it is smooth everywhere. \index{00@Smooth at a point} \index{00@Smooth complex spaces=complex manifolds}
\end{df}



















\section{Immersions and closed embeddings; generating $\scr O_{X,x}$ analytically}

\begin{df}
A holomorphic map $\varphi:X\rightarrow Y$ is called an \textbf{immersion at $x\in X$} \index{00@Immersions}  if $\varphi^\#:\scr O_{Y,\varphi(y)}\rightarrow\scr O_{X,x}$ is surjective. $\varphi$ is called an \textbf{immersion} if it is an immersion at every $x\in X$. $\varphi$ is called a \textbf{closed (resp. open) embedding} if there is a commutative diagram \index{00@Closed embeddings} \index{00@Open embeddings}
\begin{equation}
\begin{tikzcd}
X \arrow[rd,"\simeq"] \arrow[rr,"\varphi"] &              & Y \\
                        & Y_0 \arrow[ru,hook,"\iota"] &  
\end{tikzcd}
\end{equation}
where $Y_0$ is a closed (resp. open) complex subspace of $Y$ and $X\xrightarrow{\simeq}Y_0$ is a biholomorphic map.
\end{df}


A closed embedding is clearly an immersion. Moreover, an immersion is locally a closed embedding:




\begin{pp}\label{lb21}
Let $\varphi:X\rightarrow Y$ be an immersion at $x$. Then there are neighborhoods $V$ of $y=\varphi(x)$ and $U\subset\varphi^{-1}(V)$ of $x$  such that $\varphi:U\rightarrow V$ is a closed embedding. In particular, $\varphi$ is an immersion on $U$.
\end{pp}




\begin{proof}
By assumption, $\varphi^\#:\scr O_{Y,y}\rightarrow\scr O_{X,x}$ is surjective. Let $J$ be its kernel, and choose generating elements $g_1,\dots,g_k\in J$. By shrinking $Y$ to a neighborhood of $y$ (and shrink $X$ accordingly), we assume $g_1,\dots,g_k\in\scr O_Y(Y)$. Let $\mc J=g_1\scr O_Y+\cdots+g_k\scr O_Y$. Then $\mc J_x=J$. Define a closed subspace $Z=\Specan(\scr O_Y/\mc J)$ of $Y$. Then $\varphi$ factors as
\begin{align*}
\varphi^\#:\scr O_{Y,y}\twoheadrightarrow \scr O_{Y,y}/J=\scr O_{Z,y}\xlongrightarrow[\simeq]{\Psi}\scr O_{X,x}.
\end{align*}
By Cor. \ref{lb18}, we may shrink $X$ so that there is an open embedding $\wtd\varphi:X\rightarrow Z$, $\wtd\varphi(x)=y$, such that $\wtd\varphi^\#:\scr O_{Z,y}\rightarrow\scr O_{X,x}$ equals $\Psi$. Let $\iota:Z\rightarrow Y$ be the inclusion. Then $(\iota\wtd\varphi)^\#=\wtd\varphi^\#\iota^\#:\scr O_{Y,y}\rightarrow\scr O_{X,x}$ equals $\varphi^\#$. By Thm. \ref{lb19}, we may find open $U\ni x$  such that $\varphi=\iota\wtd\varphi$ on $U$. Since $\wtd\varphi(U)$ is an open subset of $Z$, we may find open $V\subset Y$ such that $\wtd\varphi(U)=V\cap Z=V\cap N(\mc J)$. So $\varphi$ restricts to the biholomorphism $\wtd\varphi:U\rightarrow\wtd\varphi(U)$ where $\wtd\varphi(U)$ is a closed subspace of $V$.
\end{proof}





We now discuss when an immersion is a closed embedding and give some examples.

\begin{pp}\label{lb14}
Let $X$ be complex spaces and  $\varphi:X\rightarrow Y$ a holomorphic immersion. Assume that $\varphi$ is an injective and closed map\footnote{$\varphi$ is called closed if it maps closed subsets to closed subsets.} of topological spaces. Suppose we have a finite type ideal $\mc J$ of $\scr O_Y$ such that $N(\mc J)$ equals the image of $\varphi$, and that
\begin{align}
\mc J_y=\Ker(\scr O_{Y,y}\xrightarrow{\varphi^\#}\scr O_{X,x})\label{eq9}
\end{align}
for all $x\in X$ and $y=\varphi(x)$. Then $\varphi$ is a closed embedding. More precisely, $\varphi$ restricts to a biholomorphism
\begin{align}
\wtd\varphi:X\xrightarrow{\simeq}\Specan(\scr O_Y/\mc J).\label{eq10}
\end{align}
\end{pp}

We will see in Cor. \ref{lb84} that the assumption on the existence of $\mc J$ is redundant.






\begin{proof}
Let $Y_0:=\Specan(\scr O_Y/\mc J)$. By Thm. \ref{lb13}, the restriction \eqref{eq10} as a holomorphic map exists, i.e., we have a commutative diagram
\begin{equation*}
\begin{tikzcd}
X \arrow[r, "\wtd\varphi"] \arrow[rd, "\varphi"'] & Y_0 \arrow[d, hook] \\
                                  & Y                
\end{tikzcd}
\end{equation*}
The underlying topological space of $Y_0:=\Specan(\scr O_X/\mc J)$ is $N(\mc J)$. So $\wtd\varphi$ is a continuous closed bijection from $X$ to $N(\mc J)$, which is therefore a homeomorphism. For each $x\in X,y=\varphi(x)$, the stalk map $\wtd\varphi^\#:\scr O_{Y_0,y}=\scr O_{Y,y}/\mc J_y\rightarrow\scr O_{X,x}$ is surjective since $\varphi$ is an immersion, and is injective by \eqref{eq9}. So $\wtd\varphi$ is a biholomorphism.
\end{proof}



\begin{eg}\label{lb22}
The holomorphic map $\iota:0\times\Cbb^n\rightarrow\Cbb^m\times\Cbb^n$ is an immersion and a closed injective map, and the kernels of $\iota^\#$ at the level  of stalks are the stalks of the ideal $\mc I=z_1\scr O_{\Cbb^{m+n}}+\cdots+ z_m\scr O_{\Cbb^{m+n}}$. Thus, by Prop. \ref{lb14}, $\iota$ restricts to a biholomorphism $0\times\Cbb^n\xrightarrow{\simeq}\Specan(\scr O_{\Cbb^{m+n}}/\mc I)$. This reproves Exp. \ref{lb3}.
\end{eg}



\begin{eg}\label{lb23}
Let $X$ be a complex space, and let $\mc I,\mc J$ be finite-type ideals of $\scr O_X$. Let $Y=\Specan(\scr O_X/\mc I)$. So $\scr O_Y=(\scr O_X/\mc I)|_{N(\mc I)}$. Then
\begin{align*}
\wtd {\mc J}=\big((\mc I+\mc J)/\mc I\big)\uph_{N(\mc I)}
\end{align*}
is a finite-type ideal of $\scr O_Y$, and is the unique ideal whose stalk at each $x\in N(\mc I)$ equals $(\mc I_x+\mc J_x)/\mc I_x$. Then there is a biholomorphism
\begin{align}
\Specan(\scr O_X/(\mc I+\mc J))\xlongrightarrow[\simeq]{\varphi} \Specan(\scr O_Y/\wtd{\mc J}).
\end{align}
which equals $N(\mc I+\mc J)\xrightarrow{=}N(\mc I)\cap N(\mc J)$ as maps of topological spaces, and whose stalk maps are
\begin{align*}
\scr O_{Y,x}/\wtd{\mc J}_x=\frac{\scr O_{X,x}/\mc I_x}{(\mc I_x+\mc J_x)/\mc I_x}\quad\xlongrightarrow{\simeq}\quad\scr O_{X,x}/(\mc I_x+\mc J_x).
\end{align*}
\end{eg}



\begin{proof}
The key point is to show that the above stalk isomorphisms can be assembled into a sheaf isomorphism. Consider the diagram
\begin{equation}\label{eq16}
\begin{tikzcd}
                                             & \Specan(\scr O_Y/\wtd{\mc J}) \arrow[d, hook] \\
\Specan(\scr O_X/(\mc I+\mc J)) \arrow[r, "\alpha"] \arrow[rd,hook ] \arrow[ru,"\varphi"] & Y \arrow[d, hook] \\
                                             & X                
\end{tikzcd}
\end{equation}
By Thm. \ref{lb13}, there is a holomorphic map $\alpha$ such that the lower triangle commutes. The stalk maps are $\alpha^\#:\scr O_{X,x}/\mc I_x\rightarrow\scr O_{X,x}/(\mc I_x+\mc J_x)$, with kernel $(\mc I_x+\mc J_x/\mc I_x)$. These kernels can be assembled into the ideal sheaf $\wtd{\mc J}$ on $N(\mc I)$. Thus, Prop. \ref{lb14} guarantees that there is a biholomorphism making the upper triangle in \eqref{eq16} commutes.
\end{proof}



Exp. \ref{lb23} shows that a closed complex subspace of a closed subspace is again a closed subspace of the original space. Thus, we have more generally:
\begin{co}\label{lb81}
If $\alpha:X\rightarrow Y$ and $\beta:Y\rightarrow Z$ are closed embeddings, then so is the composition $\beta\circ\alpha:X\rightarrow Z$.
\end{co}











Let us consider the special case $\varphi:X\rightarrow\Cbb^n$, where $\varphi$ is represented by $(f_1,\dots,f_n)\in\scr O_X^n$ (cf. Thm. \ref{lb7}). Then $\varphi$ is an immersion at $x$ iff the morphism of analytic local $\Cbb$-algebras  defined in Prop. \ref{lb8}, namely $\Cbb\{z_\blt\}\rightarrow\scr O_{X,x}$ sending $z_j$ to $f_j-f_j(x)$, is surjective. This actually mean that \emph{$f_1,\dots,f_n$ generate (analytically) the analytic local $\Cbb$-algebra $\scr O_{X,x}$}. (They certainly do not generate the ring $\scr O_{X,x}$ algebraically. But one can imagine that the subalgebra generated algebraically by $f_\blt$ is ``dense" in $\scr O_{X,x}$, where the density means approximation by power series of $f_1,\dots,f_n$.) The situation is similar to the case of a surjective morphism of $\Cbb$-algebras $\Cbb[z_\blt]\rightarrow A$, whose algebro-geometric meaning is that the affine scheme $\mathrm{Spec}(A)$ is embedded into the affine plane $\Cbb^n$.



We must find a criterion on whether $f_1,\dots,f_n$ generate $\scr O_{X,x}$ (analytically). At first sight, this problem seems not easy even if $X$ is smooth. (For instance, take $f_1,\dots,f_n$ to be some arbitrary holomorphic functions and deduce whether they generate $\scr O_{X,x}$.) There is indeed a simple criterion, which is proved using the (holomorphic version of) inverse function theorem. To begin with, we define:
\begin{df}
If $X$ is a complex space and $x\in X$, the vector space $\fk m_{X,x}/\fk m_{X,x}^2$ is called the \textbf{cotangent space}  of $X$ at $x$, and its dual space $(\fk m_x/\fk m_x^2)^*$ is called the \textbf{tangent space}.\index{00@Cotangent space $\fk m_x/\fk m_x^2$ and tangent space $(\fk m_x/\fk m_x^2)^*$} Since $\scr O_{X,x}$ is Noetherian, $\fk m_{X,x}$ is finitely-generated, and hence $\fk m_{X,x}/\fk m_{X,x}^2$ is finite-dimensional.
\end{df}

It is inspiring to write the residue class of $f-f(x)$ (where $f\in\scr O(X)$) in the cotangent space $\fk m_{X,x}/\fk m_{X,x}^2$ as $d_xf$.





\begin{thm}\label{lb25}
Let $X$ be a complex space and $x\in X$. Let $f_1,\dots,f_n\in\scr O(X)$. Consider $(f_1,\dots,f_n)$ as a holomorphic map $\varphi:X\rightarrow\Cbb^n$ (cf. Thm. \ref{lb7}). The following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is an immersion at $x$.
\item The morphism of analytic local $\Cbb$-algebras $\Phi:\scr O_{\Cbb^n,\varphi(x)}\rightarrow\scr O_{X,x}$ sending each $z_i$ to $f_i$ (cf. Prop. \ref{lb8}) is surjective. 
\item (The residue classes of) $f_1-f_1(x),\dots,f_n-f_n(x)$ span $\fk m_{X,x}/\fk m_{X,x}^2$.
\item (The germs of) $f_1-f_1(x),\dots,f_n-f_n(x)$ generate the ideal $\fk m_{X,x}$.
\end{enumerate}
If any of these conditions holds, we say that $f_1,\dots,f_n$ \textbf{generate (the algebra) $\scr O_{X,x}$ analytically}. \index{00@Analytically generating $\scr O_{X,x}$}
\end{thm}

\begin{proof}
Assume for simplicity that $\varphi(x)=0$. Clearly (1)$\Leftrightarrow$(2) and (3)$\Leftrightarrow$(4). (Note that (3)$\Rightarrow$(4) follows from Nakayama's lemma.) It remains to prove (2)$\Leftrightarrow$(3). 

Assume (2). Choose any $g\in\fk m_{X,x}$. Then there is $h(z_\blt)\in\scr O_{\Cbb^n,0}$ sent by $\Phi$ to $g$. We may write $h(z_\blt)=\sum_i a_iz_i+\text{an element of }\fk m_{\Cbb^n,0}^2$ where $a_i\in\Cbb$. Since $\Phi(z_i)=f_i$ and $\Phi(\fk m_{\Cbb}^2)\subset\fk m_{X,x}^2$, we have $g\in \sum_i a_i f_i+\fk m_{X,x}^2$. This proves (3).

Asume (3). By discarding some elements, we may assume that $f_1,\dots,f_n$ form a basis of $\fk m_{X,x}/\fk m_{X,x}^2$. Assume $X$ is a model space $\Specan(\scr O_U/\mc I)$ where $U\subset\Cbb^N$ is open and $x=0$. So $\scr O_{X,x}=\scr O_{\Cbb^N,0}/\mc I_0$, $\fk m_{X,x}=\fk m_{\Cbb^N,0}/\mc I_0$, and hence
\begin{align}
\fk m_{X,x}/\fk m_{X,x}^2=\fk m_{\Cbb^N,0}/(\fk m_{\Cbb^N,0}^2+\mc I_0).\label{eq60}
\end{align}
Lift $f_\blt$ to elements of $\scr O_{\Cbb^N,0}$, still denoted by $f_\blt$. Then we can extend $f_1,\dots,f_n$ to a list $f_1,\dots,f_N$ whose residue classes form a basis of $\fk m_{\Cbb^N,0}/\fk m_{\Cbb^N,0}^2$ such that $f_{n+1},\dots,f_N\in\mc I_0$. By the inverse function theorem, we may assume $x=0$ and $f_1,\dots,f_N$ are the standard coordinates $z_1,\dots,z_N$ of $\Cbb^N$. By shrinking $U$, we may assume $z_{n+1},\dots,z_N\in\mc I(U)$.

Assume for simplicity that $\mc I$ is generated by $z_{n+1},\dots,z_N$ together with $g_1,\dots,g_k\in\mc I(U)$. Let $\mc I_1=z_{n+1}\scr O_U+\cdots+z_N\scr O_U$. Then by Exp. \ref{lb23}, $X=\Specan(\scr O_U/\mc I)$ is naturally a closed subspace of $X_1=\Specan(\scr O_U/\mc I_1)$ (defined by $g_1,\dots,g_k$). By Exp. \ref{lb22}, $X_1$ is naturally equivalent to $U\cap(\Cbb^n\times 0)$. So the map $(z_1,\dots,z_n):X_1\rightarrow \Cbb^n$ is an open embedding. $\varphi$ is its restriction to $X$, which is therefore an immersion at $0$. This proves (1) and hence (2).
\end{proof}



We give an application of analytically generating elements.


\begin{pp}\label{lb24}

\item Let $\Phi,\Psi:\scr O_{Y,y}\rightarrow\scr O_{X,x}$ be morphisms of analytic local $\Cbb$-algebras. Assume $f_1,\dots,f_n\in\scr O_{Y,y}$ generate the algebra $\scr O_{Y,y}$ analytically. 
\begin{enumerate}[label=(\arabic*)]
\item If $\Phi(f_i)=\Psi(f_i)$ for all $i=1,\dots,n$, then $\Phi=\Psi$.
\item Let $I$ be the ideal of $\scr O_{X,x}$ generated by $\Phi(f_i)-\Psi(f_i)$ for all $i$. Then $I$ contains $\Phi(h)-\Psi(h)$ for every $h\in\scr O_{Y,y}$.
\end{enumerate}
\end{pp}

\begin{proof}
(1): By Prop. \ref{lb8}, we have a (unique) morphism $\Upsilon:\scr O_{\Cbb^n,0}\rightarrow\scr O_{Y,y}$ sending $z_i$ to $f_i-f_i(x)$. So $\Phi\circ\Upsilon$ and $\Psi\circ\Upsilon$ agree at $z_1,\dots,z_n$. So $\Phi\circ\Upsilon=\Psi\circ\Upsilon$ by Prop. \ref{lb8}. By assumption, $\Upsilon$ is surjective. So $\Phi=\Psi$. 

(2): Apply (1) to the restriction $\Phi,\Psi:\scr O_{Y,y}\rightarrow\scr O_{X,x}/I$.
\end{proof}


Prop. \ref{lb24}-(2) is the stalk version of a geometric construction called equalizer.


\section{Equalizers of $X\rightrightarrows Y$}

\begin{df}\label{lb139}
Let $\varphi,\psi:X\rightarrow Y$ be holomorphic maps of complex spaces. A \index{00@Equalizers} \textbf{kernel} or an \textbf{equalizer of the double arrow} $\begin{tikzcd}
X \arrow[r,shift left, "\varphi"] \arrow[r,shift right,"\psi"'] & Y
\end{tikzcd}$
is a complex space $E$ and a holomorphic map $\iota:E\rightarrow X$ such that $\varphi\circ\iota=\psi\circ\iota$, and that for every complex space $S$ and holomorphic map $\mu:S\rightarrow X$ satisfying $\varphi\circ\mu=\psi\circ\mu$ there is a unique holomorphic $\wtd\mu:S\rightarrow E$ such that $\mu=\iota\circ\wtd\mu$.
\begin{equation}\label{eq17}
\begin{tikzcd}
S \arrow[rd, "\mu"] \arrow[d, "{\wtd\mu}"', dashed] &                                                           &   \\
E \arrow[r, "\iota"']                   & X \arrow[r, "\psi"', shift right] \arrow[r, "\varphi", shift left] & Y
\end{tikzcd}
\end{equation}
It is easy to see that equalizers are unique up to isomorphisms.
\end{df}

The main result of this section is:

\begin{thm}\label{lb26}
Every double arrow $\begin{tikzcd}
X \arrow[r,shift left, "\varphi"] \arrow[r,shift right,"\psi"'] & Y
\end{tikzcd}$ of holomorphic maps has an equalizer which is the inclusion map of a closed subspace $\iota:E=\Specan(\scr O_X/\mc I)\hookrightarrow X$. This is called the \textbf{canonical equalizer}. \index{00@Canonical equalizers} The finite-type ideal $\mc I$ is uniquely determined by the fact that for all $x\in X$:
\begin{enumerate}[label=(\alph*)]
\item If $\varphi(x)\neq\psi(x)$, then $\mc I_x=\scr O_{X,x}$.
\item If $\varphi(x)=\psi(x)$, then by considering $\varphi^\#,\psi^\#$ as stalk maps $\scr O_{Y,\varphi(x)}\rightarrow\scr O_{X,x}$, $\mc I_x$ is the ideal of $\scr O_{X,x}$ generated by all $\varphi^\#(f)-\psi^\#(f)$ (where $f\in\scr O_{Y,\varphi(x)}$).
\end{enumerate}
Moreover, $N(\mc I)$, the underlying set of $E$, is $\Delta=\{x\in X:\varphi(x)=\psi(x)\}$.
\end{thm}

From Prop. \ref{lb24}, it is clear that $\mc I_x$ is generated by $\varphi^\#(f_i)-\psi^\#(f_i)$ if $f_1,\dots,f_n\in\scr O_{Y,y}$ generate the algebra $\scr O_{Y,y}$ analytically, e.g. $z_1,\dots,z_n$ if $Y$ is a model space in $\Cbb^n$.

\begin{rem}\label{lb42}
From Thm. \ref{lb26}, it is clear that if $E_0\rightarrow X$ is an equalizer of $X\rightrightarrows Y$, then it is a closed embedding, and equals the composition of a unique biholomorphism $E_0\xrightarrow{\simeq} E$ and the inclusion map $E\hookrightarrow X$ where $E$ is the canonical equalizer.
\end{rem}



\begin{proof}[Construction of $E$]
We define a finite-type ideal $\mc I$ satisfying (a) and (b). We shall first define it locally and then glue the pieces. Then $\mc I$ gives $E$.

Let $\Omega=X\setminus \Delta$ which is open.  We set $\mc I_\Omega=\scr O_X|_\Omega$. For each $x\in \Delta$, we choose a neighborhood $V_y\subset Y$ of $y=\varphi(x)$ biholomorphic to a model space. So we can choose finitely many $f_1,\dots f_n\in\scr O_Y(V_y)$ embedding $V_y$ onto a closed subspace of an open subset of $\Cbb^n$. $U_x=\varphi^{-1}(V_y)\cap \psi^{-1}(V_y)$ is a neighborhood of $x$, and we set $\mc I_{U_x}$ to be the ideal of $\scr O_{U_x}$ generated by $\varphi^\#(f_1)-\psi^\#(f_1),\dots,\varphi^\#(f_n)-\psi^\#(f_n)$ (defined on $U_x$).

We claim that these locally defined finitely-generated ideals are compatible. If $p\in U_x\cap \Delta$ then, as $\varphi(p)=\psi(p)$, by Prop. \ref{lb24} or by substitution rule (Rem. \ref{lb27}), the stalk $(\mc I_{U_x})_p$ is the ideal generated by all $\varphi^\#(f)-\psi^\#(f)\in\scr O_{X,p}$ where $f\in\scr O_{Y,\varphi(p)}$. If $p\in U_x\cap\Omega$, then as $\varphi(p)\neq\psi(p)$ and $(f_1,\dots,f_n)$ is an embedding, there is some $f_i$ among $f_1,\dots,f_n$ such that $\varphi^\#(f_i)-\psi^\#(f_i)$ has non-zero value at $p$, and hence its germ at $p$ is not in $\fk m_{X,p}$. This proves $(\mc I_{U_x})_p=\scr O_{X,p}$. Combining these two cases together, we see that $\mc I_\Omega$ and $\mc I_{U_x}$ (for all $x\in\Delta$) are compatible. This defines $\mc I$.

If $\varphi(x)\neq\psi(x)$, then $\mc I_x=\scr O_{X,x}$ shows $x\notin N(\mc I)$. If $\varphi(x)=\psi(x)$, then $\varphi^\#(f)-\psi^\#(f)$ vanishes at $x$ by \eqref{eq8}. So $\mc I_x$ vanishes at $x$. So $x\in N(\mc I)$. This proves $\Delta=N(\mc I)$.
\end{proof}



\begin{proof}[Proof that $E$ is an equalizer]
It is easy to check $\varphi\circ\iota=\psi\circ\iota$. Choose any holomorphic $\mu:S\rightarrow X$ such that $\varphi\circ\mu=\psi\circ\mu$. For any $s\in S$, let $x=\mu(s)$. Then $\varphi(x)=\psi(x)$. Choose any $f\in\scr O_{Y,\varphi(x)}$. Then $\varphi\circ\mu=\psi\circ\mu$ shows that $\mu^\#$ sends $\varphi^\#(f)-\psi^\#(f)$ to $0\in\scr O_{S,s}$. Thus $\mu^\#:\scr O_{X,x}\rightarrow\scr O_{S,s}$ vanishes on $\mc I_x$. Thus, by Thm. \ref{lb13}, there is a unique holomorphic $\wtd\mu:S\rightarrow E$ such that the triangle in \eqref{eq17} commutes.
\end{proof}
The proof of Thm. \ref{lb26} is finished. From the proof, we know:


\begin{rem}\label{lb38}
Assume the setting of Thm. \ref{lb26}. Assume $\varphi(x)=\psi(x)=:y$. Let $V_y$ be a neighborhood of $y$ biholomorphic to a model space. More precisely, we choose $(f_1,\dots,f_n)\in\scr O_Y(V_y)^n$ which, considered as a holomorphic map $V_y\rightarrow\Cbb^n$, is a closed embedding of $V_y$ into an open subset of $\Cbb^n$. Let $U_x=\varphi^{-1}(V_y)\cap\psi^{-1}(V_y)$. Then the ideal sheaf $\mc I|_{U_x}$ is generated by $\varphi^\#(f_1)-\psi^\#(f_1),\dots,\varphi^\#(f_n)-\psi^\#(f_n)\in\scr O(U_x)$.
\end{rem}




















\section{$\scr E\otimes_{\scr O_X}\scr F$, $\Hom_{\scr O_X}(\scr E,\scr F)$, and $\shom_{\scr O_X}(\scr E,\scr F)$}


We fix a $\Cbb$-ringed space $X$. 

\subsection{Tensor product}



\begin{df}
Let $\scr E$ and $\scr F$ be $\scr O_X$-modules. Consider the presheaf $\scr G$ of $\scr O_X$-modules defined by $\scr G(U)=\scr E(U)\otimes_{\scr O(U)}\scr F(U)$. The tensor product of restriction maps $\scr E(U)\rightarrow\scr E(V)$ and $\scr F(U)\rightarrow\scr F(V)$ gives the restriction map $\scr G(U)\rightarrow\scr G(V)$. The sheafification of $\scr G$ is denoted by $\scr E\otimes_{\scr O_X}\scr F$ or simply $\scr E\otimes\scr F$ \index{00@Tensor product $\scr E\otimes_{\scr O_X}\scr F$} and called the \textbf{tensor product} of $\scr E$ and $\scr F$.
\end{df}



\begin{rem}
Let $A$ be a commutative ring, and fix an $A$-module $\mc N$. Recall the following basic facts:
\begin{enumerate}[label=\arabic*.]
\item \textbf{Tensor products commute with direct limits}. More precisely, let $(\mc M_\alpha)$ be a direct system of $A$-modules. Then the canonical map $\mc M_\beta\otimes_A\mc N\rightarrow(\varinjlim_\alpha \mc M_\alpha)\otimes_A\mc N$ (for each fixed $\beta$) defines, by passing to the direct limit, an isomorphism
\begin{align}
\varinjlim_\alpha (\mc M_\alpha\otimes_A\mc N)\xrightarrow{\simeq} (\varinjlim_\alpha \mc M_\alpha)\otimes_A\mc N.
\end{align}
(Proof: Construct the inverse map explicitly.)
\item \textbf{The tensor product functor $-\otimes\mc N$ is right exact}. \index{00@Right exact} Namely, if
\begin{align*}
\mc M_1\xrightarrow{f}\mc M_2\xrightarrow{g}\mc M_3\rightarrow0
\end{align*}
is an exact sequence of $A$-modules, then so is
\begin{align*}
\mc M_1\otimes\mc N\xrightarrow{f\otimes\id}\mc M_2\otimes\mc N\xrightarrow{g\otimes\id}\mc M_3\otimes\mc N\rightarrow 0.
\end{align*}
Identify $\mc M_3$ with $\Cok f=\mc M_2/f(\mc M_1)$. Then the right exactness of tensor product is equivalent to that \textbf{tensor products commute with cokernels}: we have an equivalence of $A$-modules
\begin{align}
\Cok\big(\mc M_1\otimes_A\mc N\xrightarrow{f\otimes\id}\mc M_2\otimes_A\mc N \big)\quad\xlongrightarrow{\simeq}\quad \Cok\big(\mc M_1\xrightarrow{f}\mc M_2\big)\otimes_A\mc N\label{eq1}
\end{align}
descended from the canonical morphism
\begin{align}
\mc M_2\otimes_A\mc N\longrightarrow \frac{\mc M_2}{f(\mc M_1)}\otimes_A\mc N.
\end{align}
\end{enumerate}
\hfill\qedsymbol
\end{rem}

\begin{proof}
We have a well-defined map sending $\frac{\mc M_2}{f(\mc M_1)}\times\mc N$ to $\frac{\mc M_2\otimes_A\mc N}{(f\otimes\id)(\mc M_1\otimes_A\mc N)}$ (i.e. the LHS of \eqref{eq1}) sending $[\xi]\times\eta$ to $[\xi\otimes_A\eta]$, where $[\cdots]$ stands for the residue classes, and $\xi\in\mc M_2,\eta\in\mc N$. This map is clearly $A$-biinvariant. So it gives an $A$-module morphism from the RHS to the LHS of \eqref{eq1}, which is clearly the inverse of the map in \eqref{eq1} from LHS to RHS. So \eqref{eq1} is an isomorphism.
\end{proof}




\begin{rem}\label{lb4}
We can now use \eqref{eq1} to explain the last equality of \eqref{eq5}:
\begin{align*}
&\scr E_x\otimes_{\scr O_{X,x}}(\scr O_{X,x}/\fk m_x)=\scr E_x\otimes \Cok(\fk m_x\hookrightarrow \scr O_{X,x})\\
\simeq&\Cok(\scr E_x\otimes\fk m_x\rightarrow \scr E_x\otimes\scr O_{X,x})\simeq\Cok(\scr E_x\otimes\fk m_x\rightarrow \scr E_x)=\scr E_x/{\fk m_x\scr E_x}
\end{align*}
since the image of the multiplication map $\scr E_x\otimes\fk m_x\rightarrow \scr E_x$ is $\fk m_x\scr E_x$.
\end{rem}


\begin{pp}
The canonical morphism of $\scr O(U)$-modules
\begin{align*}
\scr E(U)\otimes_{\scr O(U)}\scr F(U)\rightarrow\scr E_x\otimes_{\scr O_{X,x}}\scr F_x
\end{align*}
(where $U\ni x$ is open and the map is the tensor product of $\scr E(U)\rightarrow\scr E_x$ and $\scr F(U)\rightarrow\scr F_x$) induces an isomorphism
\begin{align}
(\scr E\otimes\scr F)_x=\varinjlim_{U\ni x}\scr E(U)\otimes_{\scr O(U)}\scr F(U)\quad\xlongrightarrow{\simeq}\quad\scr E_x\otimes_{\scr O_{X,x}}\scr F_x.\label{eq2}
\end{align}
\end{pp}
\begin{proof}
Define a canonical map from $\scr E_x\times\scr F_x$ to $\varinjlim_{U\ni x}\scr E(U)\otimes_{\scr O(U)}\scr F(U)$ and show that it is $\scr O_{X,x}$-biinvariant.  This descends to the inverse map of \eqref{eq2}.
\end{proof}

\begin{co}\label{lb44}
For each $\scr O_X$-module $\scr F$, the functor $-\otimes\scr F$ on the abelian category of $\scr O_X$-modules is right exact: if
\begin{align*}
\scr E_1\rightarrow\scr E_2\rightarrow\scr E_3\rightarrow 0
\end{align*}
is exact, then so is
\begin{align*}
\scr E_1\otimes\scr F\rightarrow\scr E_2\otimes\scr F\rightarrow\scr E_3\otimes\scr F\rightarrow 0.
\end{align*}
\end{co}

\begin{proof}
Exactness of sheaves can be checked at the level of stalks. Then this follows from the isomorphism \eqref{eq2} and the right exactness of $-\otimes_{\scr O_{X,x}}\scr F_x$.
\end{proof}


\subsection{Hom}

We leave it to the readers to check the following easy facts:
\begin{rem}\label{lb51}
Let $A$ be a commutative ring, and fix an $A$-module $\mc N$:
\begin{enumerate}[label=\arabic*.]
\item \textbf{$\Hom_A(\mc N,-)$ is a left exact functor}. \index{00@Left exact (contravarient) functor} Namely, for any exact sequence of $A$-modules
\begin{align}
0\rightarrow\mc M_1\xrightarrow{f} \mc M_2\xrightarrow{g}\mc M_3,
\end{align}
we have an exact sequence 
\begin{align*}
0\rightarrow\Hom_A(\mc N,\mc M_1)\xrightarrow{f_*} \Hom_A(\mc N,\mc M_2)\xrightarrow{g_*}\Hom_A(\mc N,\mc M_3)
\end{align*}
where $f_*$ sends $T$ to $f\circ T$ and $g_*$ is defined similarly. Equivalently, \textbf{$\Hom_A(\mc N,-)$ commutes with kernels}: there is a equivalence
\begin{align}
\Hom_A\big(\mc N,\Ker(\mc M_2\xrightarrow{g}\mc M_3)\big)\simeq \Ker \big(\Hom_A(\mc N,\mc M_2)\xrightarrow{g_*}\Hom_A(\mc N,\mc M_3)\big)
\end{align}
induced by the obvious inclusion
\begin{align*}
\Hom_A\big(\mc N,\Ker(\mc M_2\xrightarrow{g}\mc M_3)\big)\hookrightarrow\Hom_A(\mc N,\mc M_2).
\end{align*}
\item \textbf{$\Hom_A(-,\mc N)$ is a left exact contravariant functor}. \index{00@Left exact (contravarient) functor} for any exact sequence of $A$-modules
\begin{align}
\mc M_1\xrightarrow{f} \mc M_2\xrightarrow{g}\mc M_3\rightarrow 0
\end{align}
we have an exact sequence 
\begin{align*}
0\rightarrow\Hom_A(\mc M_3,\mc N)\xrightarrow{g^*} \Hom_A(\mc M_2,\mc N)\xrightarrow{f^*}\Hom_A(\mc M_1,\mc N)
\end{align*}
where $f^*$ sends $T$ to $T\circ f$ and $g^*$ is defined similarly. Equivalently, \textbf{$\Hom_A(-,\mc N)$ turns cokernels into kernels}: there is a canonical equivalence
\begin{align}
\Hom_A\big(\Cok(\mc M_1\xrightarrow{f}\mc M_2),\mc N\big)\simeq \Ker \big(\Hom_A(\mc M_2,\mc N)\xrightarrow{f^*}\Hom_A(\mc M_1,\mc N)\big)
\end{align}
induced by the obvious inclusion
\begin{align*}
\Hom_A\big(\Cok(\mc M_1\xrightarrow{f}\mc M_2),\mc N\big)\hookrightarrow\Hom_A(\mc M_2,\mc N).
\end{align*}
\end{enumerate}
\end{rem}



\begin{df}
Let $\scr E,\scr F$ be $\scr O_X$-modules.  The \textbf{hom space} $\Hom_{\scr O_X}(\scr E,\scr F)$ is defined to be the space of all $\scr O_X$-module morphims from $\scr E$ to $\scr F$. \index{Hom@$\Hom_{\scr O_X}(\scr E,\scr F)$, $\shom_{\scr O_X}(\scr E,\scr F)$} 

The presheaf of $\scr O_X$-modules sending each open $U\subset X$ to the $\scr O(U)$-module $\Hom_{\scr O_U}(\scr E_U,\scr F_U)$, and whose restriction map is the obvious restriction of sheaf morphisms, is automatically a sheaf of $\scr O_X$-modules. It is called the \textbf{hom sheaf} and denoted by  $\shom_{\scr O_X}(\scr E,\scr F)$.

The dual and the double dual of $\scr E$ is defined by \index{00@Dual sheaf $\scr E^\vee$}
\begin{gather}
\scr E^\vee=\shom_{\scr O_X}(\scr E,\scr O_X),\qquad \scr E^{\vee\vee}=(\scr E^\vee)^\vee.
\end{gather}
\hfill\qedsymbol
\end{df}

\begin{exe}
Describe canonical equivalences
\begin{align}
\scr E\simeq\scr E\otimes_{\scr O_X}\scr O_X\simeq\scr O_X\otimes_{\scr O_X}\scr E\simeq \shom_{\scr O_X}(\scr O_X,\scr E).
\end{align}
\end{exe}

In general, the stalks of $\shom_{\scr O_X}(\scr E,\scr F)$ cannot be identified with $\Hom_{\scr O_{X,x}}(\scr E_x,\scr F_x)$. But good things happen when $\scr E$ is coherent, as we will see in Cor. \ref{lb50}.



\section{$(\scr O_X\mathrm{-mod})\otimes_{\scr O_S}(\scr O_S\mathrm{-mod})$; pullback sheaves}


\begin{df}
Let $\varphi:X\rightarrow S$ be a holomorphic map of complex spaces. Let $\scr E$ be an $\scr O_X$-module and $\scr M$ an $\scr O_S$-module. Then $\scr E\otimes_{\scr O_S}\scr M=\scr M\otimes_{\scr O_S}\scr E$ \index{00@Tensor product $\scr E\otimes_{\scr O_S}\scr M\simeq \scr E\otimes_{\scr O_X}\varphi^*\scr M$} denotes the sheafification of the presheaf of $\scr O_X$-modules sending each open $U\subset X$ to
\begin{align}
(\scr E\otimes_{\scr O_S}\scr M)^\pre(U)=\varinjlim_{V\supset\varphi(U)}\scr E(U)\otimes_{\scr O_S(V)}\scr M(V)
\end{align}
where the direct limit is over all open subset $V\subset S$ containing $\varphi(U)$, and $g\in\scr O_S(V)$ acts on $\sgm\in\scr E(U)$ as
\begin{align}
g\cdot \sgm:=\varphi^\#(g)\cdot \sgm.\label{eq19}
\end{align}
For each $x\in X$, we have a canonical equivalence
\begin{align}
(\scr E\otimes_{\scr O_S}\scr M)_x\simeq\scr E_x\otimes_{\scr O_{S,\varphi(x)}}\scr M_{\varphi(x)}.
\end{align}
Thus $\scr M\mapsto \scr E\otimes_{\scr O_S}\scr M$ is a right exact functor.
\end{df}

\begin{df}
The \textbf{pullback sheaf} of $\scr M$ along $\varphi$ is the $\scr O_X$-module defined by \index{00@Pullback sheaf $\varphi^*\scr M$, pullback of sections  and morphisms}
\begin{align}
\varphi^*\scr M:=\scr O_X\otimes_{\scr O_S}\scr M
\end{align} 
whose stalk at $x$ is $\scr O_{X,x}\otimes_{\scr O_{S,\varphi(x)}}\scr M_x$. It can be viewed as the induced representation of $\scr M$. Thus we may write
\begin{align}
\scr E\otimes_{\scr O_S}\scr M=\scr E\otimes_{\scr O_X}\varphi^*\scr M.
\end{align}
If $V\subset S$ is open and $\sigma\in\scr M(V)$, then the \textbf{pullback section} $\varphi^*(\sigma)\in\varphi^*\scr M(\varphi^{-1}(V))$ is the image of
\begin{align}
1\otimes \sigma\in\scr O(\varphi^{-1}(V))\otimes_{\scr O(V)}\scr M(V)\rightarrow(\scr O_X\otimes_{\scr O_S}\scr M)(\varphi^{-1}(V))=(\varphi_*\varphi^*\scr M)(V).
\end{align}
This gives a canonical morphism of $\scr O_S$-modules
\begin{align}
\scr M\rightarrow\varphi_*\varphi^*\scr M.
\end{align}


If $g:\scr M_1\rightarrow\scr M_2$ is a morphism of $\scr O_S$-modules, we define an $\scr O_X$-module morphism
\begin{align}
\varphi^*g:=\id\otimes g:\scr O_X\otimes_{\scr O_X}\scr M_1\rightarrow\scr O_X\otimes_{\scr O_X}\scr M_2,
\end{align}
called the \textbf{pullback of $g$}. %If $\sigma\in\scr M_1(V)$, then
%\begin{align}
%\varphi^*g(\varphi^*\sigma)=\varphi^*(g(\sigma))\qquad\in\scr M_2(\varphi^{-1}(V)).
%\end{align}
%\hfill\qedsymbol
\end{df}

The notation $\scr E\otimes_{\scr O_S}\scr M$ is a generalization of $\scr E\otimes_\Cbb W$ for a ($\Cbb$-)vector space $W$ by viewing $\Cbb$ as the structure sheaf of the single reduced point $\{0\}$, and by viewing the holomorphic map as the obvious one $X\rightarrow\{0\}$.



\begin{pp}
$(\varphi^*,\varphi_*)$ is a pair of \textbf{adjoint functors} between the categories of $\scr O_X$-modules and $\scr O_S$-modules \index{00@Adjoint functors} (with $\varphi^*$ the left adjoint and $\varphi_*$ the right one). Namely, there is a functorial isomphism
\begin{align}
\Hom_{\scr O_X}(\varphi^*\scr M,\scr E)\xrightarrow{\simeq}\Hom_{\scr O_S}(\scr M,\varphi_*\scr E).
\end{align}
The word \textbf{functorial} (also called \textbf{natural}) \index{00@Functorial (i.e. natural) morphisms} means that for any morphisms $g:\scr M_2\rightarrow\scr M_1$ of $\scr O_S$-modules and $f:\scr E_1\rightarrow\scr E_2$ of $\scr O_X$-modules, $\varphi^*g$ and $\varphi_*f$ induce a commutative diagram
\begin{equation}
\begin{tikzcd}
\Hom_{\scr O_X}(\varphi^*\scr M_1,\scr E_1) \arrow[d] \arrow[r,"\simeq"] & \Hom_{\scr O_S}(\scr M_1,\varphi_*\scr E_1) \arrow[d] \\
\Hom_{\scr O_X}(\varphi^*\scr M_2,\scr E_2) \arrow[r,"\simeq"]           & \Hom_{\scr O_S}(\scr M_2,\varphi_*\scr E_2)          
\end{tikzcd}
\end{equation}
\end{pp}

\begin{proof}
Given a morphism $F:\varphi^*\scr M\rightarrow\scr E$, the composition of $\scr M\rightarrow\varphi_*\varphi^*\scr M$ with $\varphi_*F:\varphi_*\varphi^*\scr M\rightarrow\varphi_*\scr E$ gives a morphism $G:\scr M\rightarrow\varphi_*\scr E$. Informally,
\begin{align}
G(\sigma)=F(1\otimes\sigma).
\end{align}
We leave it to the readers to check that $F\mapsto G$ is functorial.

Conversely, given $G:\scr M\rightarrow\varphi_*\scr E$. The $\scr O(U)$-module morphisms
\begin{gather*}
\scr O(U)\otimes_{\scr O(V)}\scr M(V)\rightarrow\scr E(U),\qquad f\otimes\sigma\mapsto f\cdot G(\sigma)|_U
\end{gather*}
for all open $U\subset X$ and $V\supset \varphi(U)$ pass to $F:\varphi^*\scr M\rightarrow\scr E$. This gives the inverse of the above construction.
\end{proof}










\begin{df}
Let $\iota:Y=\Specan(\scr O_X/\mc I)\hookrightarrow X$ be a closed subspace of $X$. Let $\scr E$ be an $\scr O_X$-module. Then the \textbf{(sheaf theoretic) restriction of $\scr E$ to $Y$}, denoted by $\scr E|_Y$ or $\scr E|Y$ \index{00@Restriction of sheaves of modules $\scr E\lvert Y\equiv\scr E\lvert_Y$} is 
\begin{align}
\scr E|_Y=\iota^*\scr E=(\scr O_X/\mc I)\uph_{N(\mc I)}\otimes_{\scr O_X}\scr E.
\end{align}
\end{df}

\begin{rem}\label{lb52}
If $\iota:Y=\Specan(\scr O_X/\mc I)\rightarrow X$ is an embedding of closed complex subspace, one may view an $\scr O_Y$-module $\scr F$ as the corresponding $\scr O_X$-module $\iota_*\scr F$. A more precise statement is that the functor $\iota_*$ from the category of $\scr O_Y$-modules to the category of $\scr O_X$-modules annihilated by the multiplication of $\mc I$, sending each morphism $\varphi$ to $\iota_*\varphi$, is an equivalence of categories. (Cf. Thm. \ref{lb19} or Thm. \ref{lb49} for the precise meaning.) An inverse functor can be chosen to be $\iota^*$. In particular, we have a canonical equivalence $\scr F\simeq\iota^*\iota_*\scr F$ for any $\scr O_Y$-module $\scr F$ and $\scr E\simeq\iota_*\iota^*\scr E$ for any $\scr O_X$-module $\scr E$ annihilated by $\mc I$ (so that $\scr E=\scr E/\mc I\scr E\simeq\scr E\otimes_{\scr O_X}(\scr O_X/\mc I)$). These equivalences are the identity maps at the level of stalks.

Moreover, the functor $\iota_*$ is an equivalence of tensor categories. Namely, we have functorial isomorphisms
\begin{gather*}
\iota_*(\scr F_1\otimes_{\scr O_Y}\scr F_2)\simeq (\iota_*\scr F_1)\otimes_{\scr O_X}(\iota_*\scr F_2).
\end{gather*}
Note that since $\scr O_{X,y}\rightarrow\scr O_{Y,y}$ is surjective (if $y\in Y$), we have
\begin{align}
\scr F_{1,y}\otimes_{\scr O_{Y,y}}\scr F_{2,y}\simeq \scr F_{1,y}\otimes_{\scr O_{X,y}}\scr F_{2,y}.
\end{align}
If $\scr E$ is an $\scr O_X$-module, we also have a natural isomorphism
\begin{align}
\iota_*(\scr E|_Y)\simeq (\scr O_X/\mc I)\otimes_{\scr O_X}\scr E.
\end{align}
Thus, the study of the restriction $\scr E|_Y$ can be turned into the study of an $\scr O_X$-module. \hfill\qedsymbol
\end{rem}




\section{Fiber products}


\begin{df}\label{lb36}
Let $\varphi:X\rightarrow S$ and $\psi:Y\rightarrow S$ be holomorphic maps of complex spaces. A \textbf{fiber product} of these two maps \index{00@Fiber products/pullbacks/base changes $X\times_SY$} is a complex space $X\times_SY$ together with holomorphic maps $\pr_X:X\times_SY\rightarrow X$ and $\pr_Y:X\times_SY\rightarrow Y$ satisfying:
\begin{enumerate}[label=(\arabic*)]
\item $\varphi\circ\pr_X=\psi\circ\pr_Y$.
\item For each complex space $Z$ and holomorphic maps $\alpha:Z\rightarrow X$ and $\beta:Z\rightarrow Y$ satisfying $\varphi\circ\alpha=\psi\circ\beta$ there is a unique holomorphic map $\alpha\vee\beta:Z\rightarrow X\times_SY$ \index{zz@$\alpha\vee\beta$} such that $\alpha=\pr_X\circ(\alpha\vee\beta)$ and that $\beta=\pr_Y\circ(\alpha\vee\beta)$.
\end{enumerate}
\begin{equation}
\begin{tikzcd}
                  &                                    & Z \arrow[ld, "\alpha\vee\beta" description, dashed] \arrow[lld, "\alpha"',bend right=15] \arrow[ldd, "\beta", bend left=15] \\
X \arrow[d, "\varphi"'] & X\times_SY \arrow[l, "\pr_X"] \arrow[d, "\pr_Y"'] &                                                               \\
S                 & Y \arrow[l, "\psi"]                  &                                                              
\end{tikzcd}
\end{equation}
The commutative square diagram above involving $S,X,Y,X\times_SY$ is called a \textbf{Cartesian square}. \index{00@Cartesian square}  $\pr_Y:X\times_SY\rightarrow Y$ is called the \textbf{pullback/base change} of $\varphi:X\rightarrow S$ along $\psi:Y\rightarrow S$.  \hfill\qedsymbol 
\end{df}

The following is easy to check:

\begin{pp}\label{lb37}
In Def. \ref{lb36}, let $\gamma:Z'\rightarrow Z$ be a holomorphic map. Then
\begin{align}
(\alpha\vee\beta)\circ\gamma=(\alpha\circ\gamma)\vee(\beta\circ\gamma):Z'\rightarrow X\times_SY.
\end{align}
\end{pp}

Fiber products are clearly unique up to isomorphisms. The following is easy to check.
\begin{rem}\label{lb31}
Suppose that the following two small commuting square diagrams are both Cartesian, then the largest rectangular square is also Cartesian.
\begin{equation*}
\begin{tikzcd}
X \arrow[d] & X\times_SY \arrow[l] \arrow[d] & (X\times_SY)\times_YZ \arrow[l] \arrow[d] \\
S           & Y \arrow[l]                    & Z \arrow[l]                              
\end{tikzcd}
\end{equation*}
Namely, $(X\times_SY)\times_YZ$, together with its maps to $X$ and $Z$, is a pullback of $X\rightarrow S$ along $Z\rightarrow S$. This can be generalized to more complicated situations. For instance, if the following $4$ small cells are Cartesian squares, then so is the largest square diagram.
\begin{equation*}
\begin{tikzcd}
X_1 \arrow[d] & Z_1 \arrow[l] \arrow[d] & Z_3 \arrow[l] \arrow[d] \\
X \arrow[d]   & Z \arrow[l] \arrow[d]   & Z_2 \arrow[l] \arrow[d] \\
S             & Y \arrow[l]             & Y_1 \arrow[l]          
\end{tikzcd}
\end{equation*}
\end{rem}


\begin{eg}\label{lb34}
Let $U,V$ be open subsets of a complex space $X$. Then $U\cap V$ is a fiber product $U\times_XV$: we have Cartesian square
\begin{equation*}
\begin{tikzcd}
U \arrow[d, hook'] & U\cap V \arrow[l, hook'] \arrow[d, hook'] \\
X                  & V \arrow[l, hook']                       
\end{tikzcd}
\end{equation*}
\end{eg}


\begin{df}\label{lb28}
Let $\varphi:X\rightarrow S$, $\psi:Y\rightarrow S$, $\alpha:X'\rightarrow X$, $\beta:Y'\rightarrow Y$ be holomorphic maps of complex spaces. Assume $X\times_SY$ exists. Assume we have a fiber product $X'\times_SY'$ of $\varphi\circ\alpha:X'\rightarrow S$ and $\psi\circ\beta:Y'\rightarrow S$. Then \index{zz@$\alpha\times\beta:X'\times_S Y'\rightarrow X\times_SY$}
\begin{align}
\alpha\times\beta:X'\times_S Y'\rightarrow X\times_SY
\end{align}
denotes $(\alpha\circ\pr_{X'})\vee(\beta\circ\pr_{Y'})$, the unique holomorphic map making the following diagram commute.
\begin{equation}
\begin{tikzcd}
                  &           X'     \arrow[ld,"\alpha"']                    & X'\times_SY' \arrow[ld, "\alpha\times\beta" description] \arrow[l, "\pr_{X'}"'] \arrow[d, "\pr_{Y'}"] \\
X \arrow[d, "\varphi"'] & X\times_SY \arrow[l, "\pr_X"] \arrow[d, "\pr_Y"'] &              Y' \arrow[ld,"\beta"]                                                 \\
S                 & Y \arrow[l, "\psi"]                  &                                                              
\end{tikzcd}
\end{equation}
\end{df}

The following is easy to check:
\begin{pp}\label{lb30}
In Def. \ref{lb28}, let $\mu:Z\rightarrow X'$, $\nu:Z\rightarrow Y'$ be holomorphic maps of complex spaces such that $\varphi\circ\alpha\circ\mu=\psi\circ\beta\circ\nu$. Then we have equality
\begin{align}
(\alpha\times\beta)\circ (\mu\vee\nu)=(\alpha\circ\mu)\vee(\beta\circ\nu):Z\rightarrow X\times_SY.
\end{align}
Let $\wtd\alpha:X''\rightarrow X'$, $\wtd\beta:Y''\rightarrow Y'$ be holomorphic maps of complex spaces, and assume that a fiber product $X''\times_SY''$ exists for $\varphi\circ\alpha\circ\wtd\alpha:X''\rightarrow S$ and $\psi\circ\beta\circ\wtd\beta:Y''\rightarrow S$. Then
\begin{align}
(\alpha\times\beta)\circ(\wtd\alpha\times\wtd\beta)=(\alpha\circ\wtd\alpha)\times(\beta\circ\wtd\beta):X''\times_SY''\rightarrow X\times_SY.
\end{align}
\end{pp}





\begin{rem}\label{lb29}
There are no canonical fiber products of give holomorphic $\varphi:X\rightarrow S$, $\psi:Y\rightarrow S$. But suppose that a fiber product $X\times_SY$ exists and is fixed. Then for each open $U\subset X$ and $X\subset Y$, there is a unique (open) \textbf{fiber product $U\times_SV$ inside $X\times_S Y$}. \index{00@Fiber products inside a fiber product} which is the open complex subspace
\begin{align*}
U\times_SV:=\pr_X^{-1}(U)\cap\pr_Y^{-1}(V)
\end{align*}
of $X\times_SY$. The projections $\pr_U:U\times_SV\rightarrow U$ and $\pr_V:U\times_SV\rightarrow V$ are defined respectively by the restrictions of $\pr_X,\pr_Y$.

Moreover, assume that $\alpha:X'\rightarrow X$, $\beta:Y'\rightarrow Y$ are holomorphic, and a fiber product $X'\times_S Y'$ is fixed. Let $U'\subset X'$ and $V'\subset Y'$ be open such that $\alpha(U')\subset U$, $\beta(V')\subset V$. Let $U'\times_S V'$ be the fiber product inside $X'\times_S Y'$. The we have a commutative diagram
\begin{equation}
\begin{tikzcd}
X'\times_SY' \arrow[rr, "\alpha\times\beta"]                            &  & X\times_SY                 \\
U'\times_SV' \arrow[rr, "\alpha|_{U'}\times\beta|_{V'}"] \arrow[u, hook']& & U\times_S V \arrow[u, hook']
\end{tikzcd}
\end{equation}
\hfill\qedsymbol
\end{rem}
\begin{proof}
Show that the inclusion $U\times_S V\hookrightarrow X\times_SY$ is the product of $U\hookrightarrow X$ and $V\hookrightarrow Y$ and $U'\times_S V'\hookrightarrow X'\times_SY'$ similarly. Then apply Prop. \ref{lb30}.
\end{proof}



With the help of the above observation, we can prove:

\begin{lm}[\textbf{Gluing fiber products}]\label{lb33}
Let $\varphi:X\rightarrow S$ and $\psi:Y\rightarrow S$ be holomorphic maps of complex spaces. Let $(U_i)_{i\in\fk I}$ and $(V_t)_{t\in\fk T}$ be open covers of $X$ and $Y$ respectively. Suppose that for each $i\in\fk I$ and $t\in\fk T$ there exists a fiber product $U_i\times_S V_t$. Then a fiber product $X\times_SY$ exists.
\end{lm}





\begin{proof}
It suffices to assume $(V_t)$ has only one member, which is $Y$. So each $U_i\times_S Y$ exists. To simplify notations, for each $i,j,k\in\fk I$ we set $U_{ij}=U_i\cap U_j$, $U_{ijk}=U_i\cap U_j\cap U_k$. We let $U_{ij}\times_i Y$ and $U_{ijk}\times_i Y$ denote the corresponding open fiber products inside $U_i\times_S Y$. So $U_{ij}\times_i Y$ and $U_{ij}\times_jY$ are isomorphism but not identical.

We now apply the gluing construction Rem. \ref{lb5} to construct $X\times Y$ by gluing all $U_i\times Y$ together. As gluing of topological spaces the process is trivial. To glue the structures of complex spaces, we must assign an isomorphism $\pi_{j,i}:U_{ij}\times_i Y\xrightarrow{\simeq}U_{ij}\times_jY$ for all $i,j$. This is chosen to be $\id_{U_{ij}}\times_{j,i}\id_Y$ defined by Def. \ref{lb28}. (Note that this is not an identity map since the source does not equal the target. The symbol $\times_{j,i}$ reflects the fact that this product relies on both $i$ and $j$.)

Clearly $\pi_{i,i}$ is the identity. To finish checking the cocycle condition, we must show that the holomorphic maps $\pi_{k,i}$ and  $\pi_{k,j}\circ\pi_{j,i}$ are equal  when restricted to open subsets $U_{ijk}\times_iY\rightarrow U_{ijk}\times_k Y$. By Rem. \ref{lb29}, $\pi_{k,i}$ restricts to $\id_{U_{ijk}}\times_{k,i} \id_Y$, and $\pi_{k,j}\circ\pi_{j,i}$ restricts to  $(\id_{U_{ijk}}\times_{k,j} \id_Y)\circ(\id_{U_{ijk}}\times_{j,i} \id_Y)$, which equals $\id_{U_{ijk}}\times_{k,i} \id_Y$ by Prop. \ref{lb30}. 

Thus the complex space $X\times_SY$ is constructed. We leave it to the readers to define $\pr_X$ and $\pr_Y$.
\end{proof}







\section{Fiber products and inverse images of subspaces}


\begin{pp}\label{lb39}
Let $\varphi:X\rightarrow S$ be a holomorphic map of complex spaces, and let $\mc J$ be a finite type ideal of $\scr O_S$. Then we have a Cartesian square
\begin{equation}\label{eq20}
\begin{tikzcd}
X \arrow[d,"\varphi"'] & \varphi^{-1}(S_0):=\Specan(\scr O_X/\mc J\scr O_X) \arrow[d,"\wtd\varphi"'] \arrow[l, hook'] \\
S           & S_0:=\Specan(\scr O_S/\mc J) \arrow[l, hook']          
\end{tikzcd}
\end{equation}
where $\mc J\scr O_X$ is the (necessarily unique) finite-type ideal of $\scr O_X$ whose stalks $(\mc J\scr O_X)_x$ are generated by $\mc J_{\varphi(x)}$ (more precisely, by $\varphi^\#(\mc J_{\varphi(x)})$, cf. \eqref{eq19}). $\varphi^{-1}(S_0):=\Specan(\scr O_X/\mc J\scr O_X)$ is called the \textbf{inverse image of $S_0$} along $\varphi$. \index{00@Inverse images of closed subspaces $\varphi^{-1}(S_0)$}
\end{pp}



\begin{proof}
If $V\subset S$ is open and $\mc J|_V$ is generated by finitely many $g_1,g_2,\dots\in\mc J(V)$, then $(\mc J\scr O_X)|_{\varphi^{-1}(V)}$ is defined to be the ideal of $\scr O_X|_{\varphi^{-1}(V)}$ generated by $\varphi^\#(g_1),\varphi^\#(g_2),\dots$. Clearly the stalks of $(\mc J\scr O_X)|_{\varphi^{-1}(V)}$ satisfy the requirement. Thus, these ideals are compatible for different $V$, and can be glued together and form the desired ideal  $\mc J\scr O_X$.   To check that \eqref{eq20} is Cartesian one uses Thm. \ref{lb13}.
\end{proof}


\begin{rem}
Using the explicit construction of $\mc J$ in the proof of Prop. \ref{lb39}, one sees that the underlying set of $\varphi^{-1}(S_0)$ is the usual preimage of $S_0$, i.e., $\{x\in X:\varphi(x)\in S_0\}$.
\end{rem}


\begin{rem}\label{lb58}
As an $\scr O_X$-module, $\scr O_{\varphi^{-1}(S_0)}$ has a natural equivalence
\begin{align}
\scr O_{\varphi^{-1}(S_0)}=\scr O_X/\mc J\scr O_X\simeq \scr O_X\otimes_{\scr O_S}(\scr O_S/\mc J)=\varphi^*(\scr O_{S_0}).
\end{align}
\end{rem}
\begin{proof}
Using the right exactness of $\scr O_X\otimes_{\scr O_S}-$, we have
\begin{align*}
&\scr O_X\otimes_{\scr O_S}(\scr O_S/\mc J)=\scr O_X\otimes_{\scr O_S}\Cok(\mc J\hookrightarrow\scr O_S)\\
\simeq &\Cok (\scr O_X\otimes_{\scr O_S}\mc J\rightarrow \scr O_X\otimes_{\scr O_S}\scr O_S)\simeq \Cok(\scr O_X\otimes_{\scr O_S}\mc J\rightarrow\scr O_X)
\end{align*}
which equals $\scr O_X/\mc J\scr O_X$ since the term insider the last $\Cok$ is the multiplication map. (Compare Rem. \ref{lb4}.)
\end{proof}


\begin{eg}\label{lb79}
Let $\mc I,\mc J$ be finite-type ideals of $\scr O_S$. Using Thm. \ref{lb13} again, one easily checks that there is a  Cartesian square that breaks into two commuting triangles.
\begin{equation}
\begin{tikzcd}
X=\Specan(\scr O_S/\mc I) \arrow[d,hook'] & X\cap Y:=\Specan(\scr O_S/(\mc I+\mc J)) \arrow[d] \arrow[l] \arrow[ld, dashed, hook']\\
S           &Y= \Specan(\scr O_S/\mc J) \arrow[l, hook']          
\end{tikzcd}
\end{equation}
Thus, the inverse image of $Y$ along $X$ is naturally equivalent to the closed subspace $X\cap Y:=\Specan(\scr O_S/(\mc I+\mc J))$ of $S$, called the \textbf{intersection of $X$ and $Y$}. \index{00@Intersection of closed subspaces} (Compare this with Exp. \ref{lb23}.) In view of this equivalence, we shall view $X\cap Y$ as closed subspaces of $X$ and $Y$ in the future.
\end{eg}









\begin{pp}\label{lb32}
Let $\varphi:X\rightarrow S$ and $\psi:Y\rightarrow S$ be holomorphic, and let $X_0$ and $Y_0$ be complex subspaces of $X,Y$ respectively. Assume that $X\times_SY$ is a fiber product of $\varphi$ and $\psi$. Recall $\pr_X:X\times_SY\rightarrow X$ and $\pr_Y:X\times_SY\rightarrow Y$. Then the intersection
\begin{align*}
X_0\times_S Y_0:=\pr_X^{-1}(X_0)\cap \pr_Y^{-1}(Y_0)
\end{align*}
is a fiber product of $X_0\hookrightarrow X\xrightarrow{\varphi}S$ and $Y_0\hookrightarrow Y\xrightarrow{\psi}S$, called the \textbf{(closed) fiber product inside $X\times_SY$}. \index{00@Fiber products inside a fiber product} The projections of $\pr_X^{-1}(X_0)\cap\pr_Y^{-1}(Y_0)$ to $X_0$ and $Y_0$ are respectively the restrictions of $\pr_X$ and $\pr_Y$. Moreover, the inclusion $X_0\times_S Y_0\hookrightarrow X\times_SY$ equals the product of $X_0\hookrightarrow X$ and $Y_0\hookrightarrow Y$.
\end{pp}


\begin{proof}
The four cells are Cartesian squares. So is the largest one (Rem. \ref{lb31}).
\begin{equation}
\begin{tikzcd}
X_0 \arrow[d, hook']    & \pr_X^{-1}(X_0) \arrow[l] \arrow[d, hook']   & X_0\times_S Y_0 \arrow[l, hook'] \arrow[d, hook'] \\
X \arrow[d, "\varphi"'] & X\times_SY \arrow[l,"\pr_X"'] \arrow[d,"\pr_Y"'] & \pr_Y^{-1}(Y_0) \arrow[l, hook'] \arrow[d]        \\
S                       & Y \arrow[l, "\psi"']           & Y_0 \arrow[l, hook']               
\end{tikzcd}
\end{equation}
The claim about inclusions is obvious.
\end{proof}


\begin{rem}\label{lb35}
The closed fiber product $X_0\times_SY_0\subset X\times_SY$ can be written more explicitly. Choose finite-type ideals $\mc I\subset\scr O_X$ and $\mc J\subset\scr O_Y$ defining $X_0,Y_0$ respectively. Then $X_0\times_SY_0$ is defined by the ideal $\mc K\subset \scr O_{X\times_SY}$ generated by $\pr_X^\#(\mc I)$ and $\pr_Y^\#(\mc J)$. More precisely: each stalk $\mc K_{x\times y}$ is generated by $\pr_X^\#(\mc I_x)$ and $\pr_Y^\#(\mc J_y)$.

In practice, we may assume $X$ and $Y$ are small enough such that $\mc I$ is generated by $f_1,\dots,f_m\in\scr O(X)$ and $\mc J$ is generated by $g_1,\dots,g_n\in\scr O(Y)$. Then all $\pr_X^\#(f_i)$ and $\pr_Y^\#(g_j)$ generate $\mc K$.  \hfill\qedsymbol
\end{rem}




\begin{rem}
Similar to Rem. \ref{lb29}, suppose we have holomorphic $\alpha:X'\rightarrow X$, $\beta:Y'\rightarrow Y$, $\varphi:X\rightarrow S$, $\psi:Y\rightarrow S$. Let $X_0\subset X,Y_0\subset Y,X_0'\subset X',Y_0'\subset Y'$ be closed subspaces such that $\alpha$ restricts to $\alpha:X_0'\rightarrow X_0$ and $\beta$ restricts to $\beta:Y_0'\rightarrow Y_0$ (in the sense of Thm. \ref{lb13}). Then for the closed fiber products $X_0\times_S Y_0\subset X\times_SY$ and $X_0'$, the following diagram commutes.
\begin{equation}
\begin{tikzcd}
X'\times_SY' \arrow[rr, "\alpha\times\beta"]                            &  & X\times_SY                 \\
X_0'\times_SY_0' \arrow[rr, "\alpha|_{X_0'}\times\beta|_{Y_0'}"] \arrow[u, hook']& & X_0\times_S Y_0 \arrow[u, hook']
\end{tikzcd}
\end{equation}
\end{rem}




\section{Fiber products, direct products, and equalizers}

\begin{df}
Let $X,Y$ be complex spaces. A \textbf{direct product} of $X,Y$, or simply a \textbf{product} of $X,Y$, is a fiber product of $X\rightarrow 0$ and $Y\rightarrow 0$ and denoted by $X\times Y$ (together with the projections $\pr_X:X\times Y\rightarrow X$ and $\pr_Y:X\times Y\rightarrow Y$).

To spell out the definition: For each complex space $Z$ and holomorphic $\alpha:Z\rightarrow X,\beta:Z\rightarrow Y$, there is a unique holomorphic map $\alpha\vee\beta:Z\rightarrow X\times Y$ such that the following diagram commute.
\begin{equation*}
\begin{tikzcd}
  & Z \arrow[ld, "\alpha"'] \arrow[rd, "\beta"] \arrow[d,"\alpha\vee\beta"'] &   \\
X & X\times Y \arrow[l, "\pr_X"] \arrow[r, "\pr_Y"']              & Y
\end{tikzcd}
\end{equation*}

If $f\in\scr O_X$ and $g\in\scr O_Y$, we write \index{fg@$f\otimes g\in\scr O_{X\times Y}$}
\begin{align}
f\otimes 1:=\pr_X^\#(f),\qquad 1\otimes g:=\pr_Y^\#(g),\qquad f\otimes g:=\pr_X^\#(f)\pr_Y^\#(g).\label{eq78}
\end{align}
If $x\in X$ and $y\in Y$, we define the \textbf{completed tensor product}
\begin{align*}
\scr O_{X,x}\wht\otimes\scr O_{Y,y}:=\scr O_{X\times Y,x\times y}
\end{align*}
which is well-defined up to isomorphisms by Cor. \ref{lb18}.\hfill\qedsymbol
\end{df}


\begin{rem}
One can also view $\scr O_{X\times_SY,x\times y}$ as $\scr O_{X,x}\wht\otimes_{\scr O_{S,s}}\scr O_{Y,y}$ (if $s=\varphi(x)=\psi(y)$), a completed tensor product over  $\scr O_{S,s}$. In the case that either $\varphi$ or $\psi$ is ``finite", the stalk $\scr O_{X\times_SY,x\times y}$ is actually equal to the usual tensor product $\scr O_{X,x}\otimes_{\scr O_{S,s}}\scr O_{Y,y}$. This will be studied in the next chapter. 
\end{rem}


\begin{eg}\label{lb182}
$\Cbb^{m+n}$ is naturally a product of $\Cbb^m$ and $\Cbb^n$.
\end{eg}

\begin{proof}
Apply Thm. \ref{lb7}.
\end{proof}




\begin{lm}
For every complex spaces $X,Y$ there is a product $X\times Y$.
\end{lm}

\begin{proof}
We know this is true when $X,Y$ are number spaces, and hence when $X,Y$ are open subspaces of number spaces (cf. Exp. \ref{lb29}), and hence if $X,Y$ are model spaces (due to Prop. \ref{lb32}), and hence for all complex spaces (by Lemma \ref{lb33}).
\end{proof}



\begin{rem}
If $X$ and $Y$ are model spaces $\Specan(\scr O_U/\mc I)$ and $\Specan(\scr O_V/\mc J)$ where $U\subset\Cbb^m$ and $V\subset\Cbb^n$ are open,  $\mc I$ is generated by $f_1,f_2,\dots\in\mc I(U)$, and $\mc J$ is generated by $g_1,g_2,\dots\in\mc J(V)$, then $X\times Y$ as a closed direct product inside $U\times V$ can be written down explicitly with the help of Rem. \ref{lb35}: it is the model space $\Specan(\scr O_{U\times V}/\mc K)$ where $\mc K$ is the ideal generated by all $f_i\otimes 1$ and $1\otimes g_j$.
\end{rem}



In the following, we give two proofs that fiber products always exist. We need the following notion:

\begin{pp}\label{lb80}
Let $\varphi:X\rightarrow Y$ be a holomorphic map. Then $\id_X\vee\varphi:X\rightarrow X\times Y$ is an equalizer:
\begin{equation}
\begin{tikzcd}
X \arrow[r,"\id\vee\varphi"] & X\times Y \arrow[r, shift left, "\varphi\circ\pr_X"] \arrow[r, shift right, "\pr_Y"'] & Y
\end{tikzcd}
\end{equation}
The canonical equalizer $\fk G(\varphi)$ of $X\times Y\rightrightarrows Y$ (which is a closed subspace of $X\times Y$) is called the \textbf{graph of $\varphi$}. \index{00@Graphs of holomorphic maps}
\end{pp}

\begin{proof}
Let $Z$ be a complex space. Any holomorphic map $Z\rightarrow X\times Y$ is $\alpha\vee\beta$ for some $\alpha:Z\rightarrow X$ and $\beta:Z\rightarrow Y$. Suppose that the compositions of $\alpha\vee\beta$ with $\varphi\circ\pr_X$ and with $\pr_Y$ are equal. Then $\varphi\circ\alpha=\beta$. Then we may find a holomorphic map $Z\rightarrow X$ such that the following diagram commutes.
\begin{equation*}
\begin{tikzcd}
Z \arrow[d] \arrow[rd, "\alpha\vee\beta"] &           \\
X \arrow[r, "\id\vee\varphi"]             & X\times Y
\end{tikzcd}
\end{equation*}
Indeed, we can choose this map to be $\alpha$. Then by Prop. \ref{lb37}, $(\id\vee\varphi)\circ\alpha=\alpha\vee(\varphi\circ\alpha)=\alpha\vee\beta$. On the other hand, if we have another such holomorphic map $\psi:Z\rightarrow X$. Composing the above triangle with $\pr_X:X\times Y\rightarrow X$ shows that $\psi=\pr_X\circ(\id\vee\varphi)\circ\psi$ equals $\pr_X\circ (\alpha\vee\beta)=\alpha$. This proves the uniqueness of such $\psi$.
\end{proof}




\begin{rem}\label{lb15}
Using Thm. \ref{lb26}, one can give a more explicit description of the graph of $\varphi:X\rightarrow Y$. We write it as $\Specan(\scr O_{X\times Y}/\mc J)$ for a finite-type ideal $\mc J$. Let $x\in X,y\in Y$. If $y\neq\varphi(x)$ then $\mc J_{x\times y}=\scr O_{X\times Y,x\times y}$. If $y=\varphi(x)$ then $\mc J_{x\times y}$ is the ideal of $\scr O_{X\times Y,x\times y}$ generated by
\begin{align}
(f\circ\varphi)\otimes 1-1\otimes f
\end{align}
for all $f\in\scr O_{Y,y}$ (equivalently, for a set of $f$ generating the algebra $\scr O_{Y,y}$ analytically). The underlying topological space of the graph is $\{x\times y\in X\times Y:y=\varphi(x)\}$.
\end{rem}

\begin{rem}\label{lb40}
The graph construction shows that every holomorphic map $\varphi:X\rightarrow Y$ is the composition of a closed embedding $X\xrightarrow{\id\vee\varphi}X\times Y$ (cf. Rem. \ref{lb42}) and a projection of direct product $X\times Y\xrightarrow{\pr_Y}Y$. Thus, very often, the study of general holomorphic maps reduces to the studies of these two special types of maps. As an application of this observation, we prove:
\end{rem}


\begin{thm}
For any holomorphic maps of complex spaces $\varphi:X\rightarrow S,\psi:Y\rightarrow S$, there exists a fiber product $X\times_SY$.
\end{thm}
\begin{proof}
We want to show that the pullback of $\varphi$ along $\psi$ exists. We know it exists when $\psi$ is a closed embedding due to Prop. \ref{lb39}. It also exists when $\psi$ is a projection $S\times Y_1\rightarrow S$: in that case $X\times_SY$ is given by the Cartesian square
\begin{equation}
\begin{tikzcd}
X \arrow[d, "\varphi"'] & X\times Y_1 \arrow[l] \arrow[d, "\varphi\times\id"'] \\
S                       & S\times Y_1 \arrow[l]                               
\end{tikzcd}
\end{equation}
(We leave it to the readers to check that this commutative diagram is indeed Cartesian.) The general case follows from Rem. \ref{lb40} and the fact that the pullback of a pullback is a pullback (Rem. \ref{lb31}).
\end{proof}



We now give another way of constructing fiber products. This construction is very explicit when $X$ and $Y$ are model spaces.


\begin{pp}\label{lb90}
Let $\varphi:X\rightarrow S,\varphi:Y\rightarrow S$ be holomorphic maps of complex spaces. Let $\pr_X:X\times Y\rightarrow X$ and $\pr_Y:X\times Y\rightarrow Y$ be the projections of $X\times Y$. Then the canonical equalizer $E$ of the following double arrow is a fiber product $X\times_SY$:
\begin{equation}
\begin{tikzcd}
E \arrow[r,hook,"\iota"] & X\times Y \arrow[r, shift left, "\varphi\circ\pr_X"] \arrow[r, shift right, "\psi\circ\pr_Y"'] & S
\end{tikzcd}
\end{equation}
The projections of $E$ to $X,Y$ are $\pr_X\circ\iota$ and $\pr_Y\circ\iota$ respectively. We call $E$ the (closed) \textbf{fiber product of $X,Y$ inside the direct product $X\times Y$}. \index{00@Fiber products inside direct products}
\end{pp}


\begin{proof}
That $E$ is an equalizer means that $\varphi\circ(\pr_X\circ\iota)=\psi\circ(\pr_Y\circ\iota)$, and that for every holomorphic $\alpha\vee\beta:Z\rightarrow X\times Y$ whose compositions with $\varphi\circ\pr_X$ and with $\psi\circ\pr_Y$ are the same (namely, $\varphi\circ\alpha=\psi\circ\beta$) there is a unique holomorphic $\gamma:Z\rightarrow E$ such that $\iota\circ\gamma=\alpha\vee\beta$ (namely, $(\pr_X\circ\iota)\circ\gamma=\alpha$ and $(\pr_Y\circ\iota)\circ\gamma=\beta$). This means precisely that $E$ equipped with $\pr_X\circ\iota$ and $\pr_Y\circ\iota$ is a fiber product. 
\end{proof}

\begin{rem}\label{lb101}
Using Thm. \ref{lb26}, we can describe the fiber product $X\times_SY$ inside a given $X\times Y$ easily: It is $\Specan(\scr O_{X\times Y}/\mc J)$ where $\mc J$ is a finite-type ideal. Let $x\in X,y\in Y$. If $\varphi(x)\neq\psi(y)$ then $\mc J_{x\times y}=\scr O_{X\times Y,x\times y}$. If $\varphi(x)=\psi(y)$ then $\mc J_{x\times y}$ is the ideal of $\scr O_{X\times Y,x\times y}$ generated by
\begin{align}
(f\circ\varphi)\otimes 1-1\otimes (f\circ\psi)
\end{align}
for all $f\in\scr O_{S,\varphi(x)}$ (equivalently, for a set of $f$ generating the algebra $\scr O_{S,\varphi(x)}$ analytically). The underlying topological space of $X\times_SY$ is  $\{x\times y\in X\times Y:\varphi(x)=\psi(y)\}$.

From this, it is clear that given a fiber product $X\times_SY$, if $x\in X,y\in Y$ and $\varphi(x)=\psi(y)$, then there is a unique point of $X\times_SY$, denoted by $(x,y)$ or $x\times y$, \index{xy@$x\times y\in X\times_SY$} whose projections to $X,Y$ are $x,y$ respectively. Moreover, all points of $X\times_SY$ are in this form. \hfill\qedsymbol
\end{rem}

\begin{exe}
Show that the pullback of $\varphi\times\psi:X\times Y\rightarrow S\times S$ along the \textbf{diagonal map} $\Delta_S$ defined by $\id_S\vee\id_S:S\rightarrow S\times S$ is a fiber product $X\times_SY$.
\end{exe}


We have seen that fiber products can be constructed from equalizers. Conversely, equalizers can also be viewed as special cases of fiber products:

\begin{pp}
Let $\varphi,\psi:X\rightarrow Y$ be holomorphic maps, and let $\Delta_Y:Y\rightarrow Y\times Y$ be the diagonal map of $Y$ with image $\wtd Y$ being a closed subspace of $Y\times Y$, called the \textbf{diagonal of $Y\times Y$}. \index{00@Diagonal of $X\times X$} Then the inverse image $E$ of $\wtd Y$ along $\varphi\vee\psi:X\rightarrow Y\times Y$ is the canonical equalizer of $\begin{tikzcd}
X\arrow[r,shift right,"\psi"']\arrow[r,shift left,"\varphi"]& Y.
\end{tikzcd}$
\end{pp}

\begin{proof}
Write $\wtd Y$ as $\Specan(\scr O_{Y\times Y},\mc J)$. Then by Rem. \ref{lb15}, $\mc J_{y,y'}=\scr O_{Y\times Y,y\times y'}$ if $y\neq y'$, and $\mc J_{y,y'}$ is generated by all $f\otimes 1-1\otimes f$ where $f\in\scr O_{Y,y}$. 

Write $E$ as $\Specan(\scr O_X/\mc I)$. Then by Prop. \ref{lb39}, if $\varphi(x)\neq\psi(x)$ then $\mc I_x$ equals $\scr O_{X,x}$ (since $\mc J_{\varphi(x),\psi(x)}=\scr O_{Y\times Y,\varphi(x)\times\psi(x)}$); if $\varphi(x)=\psi(x)$ then $\mc I_x$ is generated by $(f\otimes 1-1\otimes f)\circ (\varphi\vee\psi)$ (i.e. by $f\circ\varphi-f\circ\psi$) for all $f\in\scr O_{Y,\varphi(x)}$. Comparing this description with Thm. \ref{lb26}, we see that $E$ is the canonical equalizer.
\end{proof}



















\chapter{Finite holomorphic maps and coherence}

\section{Coherent sheaves}

We fix a $\Cbb$-ringed space $X$.

\begin{df}
An $\scr O_X$-module $\scr E$ is called \textbf{coherent} if the following conditions are satisfied:
\begin{enumerate}
\item $\scr E$ is of finite-type.
\item For every open set $U\subset X$, any $n\in\Nbb$, and any $\scr O_U$-module morphism $\varphi:\scr O_U^n\rightarrow\scr E|_U$, the kernel $\Ker\varphi$ is a finite-type $\scr O_U$-module. 
\end{enumerate}
Set $s_1=\varphi(1,0,\cdots,0),\dots,s_n=\varphi(0,0,\dots,1)$. Then $\Ker\varphi$ is called the \textbf{sheaf of relations of $s_1,\dots,s_n$} and denoted by $\Rel(s_\blt)=\Rel(s_1,\dots,s_n)$. \index{00@Sheaves of relations $\Rel(s_1,\dots,s_n)$}
\end{df}

In other words, $\Rel(s_\blt)$ is the sheaf of all $(f_1,\dots,f_n)\in\scr O_U^n$ such that $f_1s_1+\cdots+f_ns_n=0$. A coherent $\scr O_X$-module is a finite-type $\scr O_X$-module such that any sheaf of relations is finite-type.



\begin{rem}
It is clear that a finite type submodule of a coherent $\scr O_X$-module is coherent.
\end{rem}





\begin{thm}\label{lb20}
Let $0\rightarrow\scr E\rightarrow\scr F\xrightarrow{\varphi}\scr G\rightarrow0$ be an exact sequence of $\scr O_X$-modules. If two of the three sheaves are coherent, then the remaining one is also coherent.
\end{thm}

We view $\scr E$ as a subsheaf of $\scr F$.

\begin{proof}[Proof of $\scr E,\scr F$ coherent $\Rightarrow$ $\scr G$ coherent]
Since $\scr F$ is finite-type and $\varphi$ is surjective, $\scr G$ is finite-type. Choose any $x\in X$, any neighborhood $U\ni x$, and any $t_1,\dots,t_n\in\scr G(U)$. We shall show that $\Rel(t_\blt)$ is generated by finitely many global sections after shrinking $U$ to a smaller neighborhood of $x$. 

Shrink $U$ so that we can find $s_1,\dots,s_n\in \scr F(U)$ sent to $t_1,\dots,t_n$ by $\varphi$, and that $\scr E|_U$ is generated by some elements $e_1,\dots,e_k\in\scr E(U)$. As $\scr F$ is coherent, $\Rel(e_\blt,s_\blt)$ is finite-type. So we can further shrink $U$ so that $\Rel(e_\blt,s_\blt)$ is generated by $(f_1^l,\dots,f_k^l,g_1^l,\dots,g_n^l)\in\scr O(U)^{k+n}$ for finitely many $l$.

Clearly $(g_1^l,\dots,g_n^l)\in\scr O(U)^n$ are in $\Rel(t_\blt)$. We claim that they generate $\Rel(t_\blt)$. Choose any $y\in U$ and $h_1,\dots,h_n\in\scr O_{X,y}$ such that $h_1t_1+\cdots+h_nt_n=0$ in $\scr G_x$. So $h_1s_1+\cdots+h_ns_n\in\scr E_y$. So $\mu_1e_1+\cdots+\mu_ke_k+h_1s_1+\cdots+h_ns_n=0$ in $\scr F_y$ for some $\mu_1,\dots,\mu_k\in\scr O_{X,y}$. So $(\mu_\blt,h_\blt)\in\Rel(e_\blt,s_\blt)_y$. So $(\mu_\blt,h_\blt)$ is an $\scr O_{X,y}$-linear combination of $(f_\blt^l,g_\blt^l)$. Hence $(h_\blt)$ is an $\scr O_{X,y}$-linear combination of $(g_\blt^l)$.
\end{proof}


\begin{proof}[Proof of $\scr F,\scr G$ coherent $\Rightarrow$ $\scr E$ coherent]
As $\scr E$ is a subsheaf of $\scr F$ and $\scr F$ is coherent, the sheaves of relations of $\scr E$ are clearly finite-type. Let us prove that $\scr E$ is finite-type. Choose $x\in X$ and a neighborhood $U\ni x$ such that $\scr F|_U$ is generated by $s_1,\dots,s_n\in\scr F(U)$. Then each $t_i=\varphi(s_i)$ is in $\scr G(U)$. Since $\scr G$ is coherent, $\Rel(t_\blt)$ is finite-type. Thus, after shrinking $U$ to a smaller neighborhood, $\Rel(t_\blt)$ is generated by $(f_1^l,\dots,f_n^l)\in\scr O(U)^n$ for finitely many $l$.

Let $e^l=f_1^ls_1+\cdots+f_n^ls_n$. Then $\varphi(e^l)=0$, and hence $e^l\in\scr E(U)$. We claim that $e^1,e^2,\dots$ generate $\scr E|_U$. Choose any $y\in U$ and $\sigma\in\scr E_y$. Then $\varphi(\sigma)=0$ and $\sigma=g_1s_1+\cdots+g_ns_n$ for some $g_1,\dots,g_n\in\scr O_{X,y}$. So $(g_\blt)\in\Rel(t_\blt)_y$. Hence $(g_\blt)$ is an $\scr O_{X,y}$-linear combination of $(f_\blt^1),(f_\blt^2),\dots$. So $\sigma$ is the same $\scr O_{X,y}$-linear combination of $e^1,e^2,\dots$.
\end{proof}


\begin{proof}[Proof of $\scr E,\scr G$ coherent $\Rightarrow$ $\scr F$ coherent]
Step 1. We prove that $\scr F$ is finite-type. Choose $x\in X$ and a neighborhood $U\ni x$. Shrink $U$ so that we can find $s_1,\dots,s_n\in\scr F(U)$ such that $t_1=\varphi(s_1),\dots,t_n=\varphi(s_n)$ generate $\scr G|_U$, and that there are $e_1,\dots,e_k\in\scr E(U)$ generating $\scr E|_U$. Then for each $y\in U$ and $\sigma\in\scr E_y$, $\varphi(\sigma)=f_1t_1+\cdots+f_nt_n$ for some $f_1,\dots,f_n\in\scr O_{X,y}$. So $\sigma-f_1s_1-\cdots-f_ns_n$ belongs to $\scr E_y$, which is an $\scr O_{X,y}$-linear combination of $e_1,\dots,e_k$. This shows that $s_1,\dots,s_n,e_1,\dots,e_k$ generate $\scr F|_U$.

Step 2. We prove that all sheaves of relations of $\scr F$ are finite-type. Again we choose $x\in X$ and a neighborhood $U\ni x$. Choose any $s_1,\dots,s_n\in\scr F(U)$, and let $t_\blt=\varphi(s_\blt)$. Since $\Rel(t_\blt)$ is finite-type, we may shrink $U$ to a smaller neighborhood such that we can find $G\in \scr O(U)^{n\times k}$ (i.e. an $\scr O(U)$-valued $n\times k$ matrix) such that the columns $G_{\blt,1},\dots,G_{\blt,k}\in\scr O(U)^n$ generate $\Rel(t_\blt)$. Set
\begin{align*}
(e_1,\dots,e_k)=(s_1,\dots,s_n)G\qquad\in\scr F(U)^k,
\end{align*}
namely, $e_j=\sum_{i=1}^ns_iG_{i,j}$. Then $e_1,\dots,e_n$ are killed by $\varphi$, i.e. they are in $\scr E(U)$. As $\Rel(e_\blt)$ is finite-type, we may shrink $U$ and find a $k\times m$ matrix $E\in\scr O(U)^{k\times m}$ whose columns generate $\Rel(e_\blt)$. Let $F=GE$ (which is in $\scr O(U)^{n\times m}$). We claim that the columns of $F$ generate $\Rel(s_\blt)$.

Choose any $y\in U$ and an element of $\Rel(s_\blt)_y$, written as an $n\times 1$ matrix $A\in\scr O_{X,x}^{n\times 1}$. So $(s_1,\dots,s_n)A=0$. Hence $(t_1,\dots,t_n)A=0$. So $A\in\Rel(t_\blt)_y$. Since $G_{\blt,1},\dots,G_{\blt,k}$ generate $\Rel(t_\blt)_y$, we may write $A=GB$ for some $B\in\scr O_{X,y}^{k\times 1}$. So $(e_1,\dots,e_k)B=0$. Thus, as $E_{\blt,1},\dots,E_{\blt,m}$ generate $\Rel(e_\blt)_y$, we may write $B=EC$ for some $C\in\scr O_{X,y}^{m\times 1}$. Thus $A=FC$. So $A$ is an $\scr O_{X,y}$-linear combination of columns of $F$.
\end{proof}

\begin{co}\label{lb45}
$\scr E_1,\scr E_2$ are coherent $\scr O_X$-modules if and only if $\scr E_1\oplus\scr E_2$ is coherent.
\end{co}
\begin{proof}
The exactness of $0\rightarrow\scr E_1\rightarrow\scr E_1\oplus\scr E_2\rightarrow\scr E_2\rightarrow0$ shows that ``$\scr E_1,\scr E_2$ coherent" $\Rightarrow$ ``$\scr E_1\oplus\scr E_2$ coherent", and that if $\scr E_1\oplus\scr E_2$ is coherent then $\scr E_2$ is finite type and the sheaves of relations of $\scr E_1$ are finite-type. Exchanging the roles of $\scr E_1,\scr E_2$ shows that  ``$\scr E_1\oplus\scr E_2$ coherent" $\Rightarrow$ ``$\scr E_1,\scr E_2$ coherent".
\end{proof}


\begin{co}\label{lb46}
Let $\varphi:\scr F\rightarrow\scr G$ be a morphism of coherent $\scr O_X$-modules. Then $\Imag\varphi,\Ker\varphi,\Cok\varphi$ are coherent.
\end{co}

\begin{proof}
$\Imag\varphi$ is finite-type since  $\scr F\rightarrow\Imag\varphi$ is surjective and $\scr F$ is finite-type. The sheaves of relations of $\Imag\varphi$ are finite-type because $\scr G$ is coherent and $\Imag\varphi$ is its $\scr O_X$-submodule. So $\Imag\varphi$ is coherent. That $\Ker\varphi$ and $\Cok\varphi$ are coherent follows from Thm. \ref{lb20} and the exact sequences $0\rightarrow\Ker\varphi\rightarrow\scr F\rightarrow\Imag\varphi\rightarrow0$ and $0\rightarrow\Imag\varphi\rightarrow\scr G\rightarrow\Cok\varphi\rightarrow0$.
\end{proof}


\begin{co}\label{lb110}
If $\scr E,\scr F$ are coherent $\scr O_X$-submodules of a coherent $\scr O_X$-module $\scr G$, then $\scr E+\scr F$ and $\scr E\cap\scr F$ are coherent.
\end{co}

Note that the \textbf{intersection sheaf} \index{00@Intersection sheaves} $\scr E\cap\scr F$ is defined to be the sheaf of all sections of $\scr G$ whose germ at each $x\in X$ belongs to $\scr E_x\cap\scr F_x$. It is easy to check that $(\scr E\cap\scr F)_x$ is canonically equivalent to $\scr E_x\cap\scr F_x$.

\begin{proof}
Clearly $\scr E+\scr F$ is finite-type and hence coherent. So by Cor. \ref{lb46}, $\scr E/(\scr E\cap\scr F)\simeq(\scr E+\scr F)/\scr F$ is coherent, and hence $\scr E\cap\scr F$ is coherent.
\end{proof}

\begin{df}\label{lb171}
Let $\varphi:\scr F\rightarrow\scr G$ be a morphism of $\scr O_X$-module. If $\scr L$ is an $\scr O_X$-submodule of $\scr G$, we define $\varphi^{-1}(\scr L)$ \index{zz@$\varphi^{-1}(\scr L)$} to be the $\scr O_X$-module such that for each open $U\subset X$,
\begin{align}
\varphi^{-1}(\scr L)(U)=\{s\in\scr F(U):\varphi(s)_x\in\scr L_x\text{ for all } x\in U\}
\end{align}
where $\varphi(s)_x$ is the germ of $\varphi(s)$ at $x$. 
\end{df}

We have an obvious canonical equivalence
\begin{align}
\varphi^{-1}(\scr L)_x\simeq \varphi^{-1}(\scr L_x).
\end{align}
Therefore, by checking at the level of stalks, we see that the sequence
\begin{align}
0\rightarrow\ker(\varphi)\rightarrow\varphi^{-1}(\scr L)\rightarrow\scr L\rightarrow0
\end{align}
is exact. Thus, by Thm. \ref{lb20} and Cor. \ref{lb46}, we have:

\begin{co}\label{lb172}
Let $\varphi:\scr F\rightarrow\scr G$ be a morphism of $\scr O_X$-module. If $\scr L$ is a coherent $\scr O_X$-submodule of $\scr G$, then $\varphi^{-1}(\scr L)$ is $\scr O_X$-coherent.
\end{co}





\begin{thm}\label{lb48}
Assume that $\scr O_X$ is a coherent $\scr O_X$-module. Then an $\scr O_X$-module $\scr E$ is coherent if and only if for each $x\in X$ there is a neighborhood $U\ni x$ such that $\scr E|_U$ is isomorphic to $\Cok\varphi$ for some morphism of free $\scr O_U$-modules $\varphi:\scr O_U^m\rightarrow\scr O_U^n$ (where $m,n\in\Nbb$).
\end{thm}
Indeed, the ``only if" part does not need $\scr O_X$ to be coherent.

\begin{proof}
``If": Since $\scr O_U$ is coherent, $\scr O_U^m$ and $\scr O_U^n$ are coherent. So $\Cok\varphi$ is coherent by Cor. \ref{lb46}.

``Only if": Let $\scr E$ be coherent. Choose $x\in X$. Since $\scr E$ is finite-type, we may find a neighborhood $U$ such that there is a surjective $\psi:\scr O_U^n\rightarrow\scr E|_U$. Since $\scr E$ is coherent, $\Ker\psi$ is finite-type. Thus, after shrinking $U$, we may find a surjective $\pi:\scr O_U^m\rightarrow\Ker\psi$. Then $\scr E|_U\simeq\Cok(\iota\circ\pi)$ where $\iota:\Ker\psi\rightarrow\scr O_U^n$ is the inclusion. 
\end{proof}


\begin{co}
For any coherent $\scr O_X$-modules $\scr E,\scr F$, the tensor product $\scr E\otimes_{\scr O_X}\scr F$ is coherent.
\end{co}

\begin{proof}
Choose any $x\in X$. By Thm. \ref{lb48}, we may shrink $X$ to a neighborhood of $x$ such that $\scr E\simeq\Cok\varphi$ where $\varphi:\scr O_X^m\rightarrow\scr O_X^n$ is a morphism. By the right exactness of $-\otimes\scr F$ (cf. Prop. \ref{lb44}), $\scr E\otimes\scr F$ is equivalent to $\Cok (\scr O_X^m\otimes\scr F\rightarrow\scr O_X^n\otimes\scr F)$, which is $\Cok(\scr F^m\rightarrow\scr F^n)$. By Cor. \ref{lb45}, $\scr F^m,\scr F^n$ are coherent. So the cokernel is coherent by Cor. \ref{lb46}.
\end{proof}




We end this section with some more criteria on coherence.

\begin{pp}\label{lb53}
Let $\varphi:X\rightarrow S$ be a morphism of $\Cbb$-ringed spaces, and let $\scr E$ be a finite-type $\scr O_S$-module. Then $\varphi^*\scr E$ is a finite type $\scr O_X$-module. If moreover $\scr E$ is $\scr O_S$-coherent and $\scr O_X$ is $\scr O_X$-coherent, then $\varphi^*\scr E$ is a coherent $\scr O_X$-module.
\end{pp}

\begin{proof}
If $\scr E$ is finite-type, then for each $x\in X$, we may shrink $X$ to a neighborhood of $x$ such that $\scr E$ is generated by finitely many $s_1,s_2,\dots\in\scr E(X)$. So $\varphi^*\scr E=\scr O_X\otimes_{\scr O_S}\scr E$ is generated by all $\varphi^*s_i=1\otimes s_i$. So $\varphi^*\scr E$ is finite-type.

Now assume $\scr E$ is $\scr O_S$-coherent and $\scr O_X$ is $\scr O_X$-coherent. By Thm. \ref{lb48}, we may shrink $X$ so that $\scr E\simeq\Cok(\scr O_S^m\rightarrow\scr O_S^n)$. Then
\begin{align*}
&\varphi^*\scr E\simeq\scr O_X\otimes_{\scr O_S}\Cok(\scr O_S^m\rightarrow\scr O_S^n)\simeq \Cok(\scr O_X\otimes_{\scr O_S}\scr O_S^m\rightarrow\scr O_X\otimes_{\scr O_S}\scr O_S^n)\\
\simeq&\Cok(\scr O_X^m\rightarrow\scr O_X^n)
\end{align*}
which is $\scr O_X$-coherent by Thm. \ref{lb48}
\end{proof}


\begin{pp}[\textbf{Extension principle}]\label{lb73}
Let $Y=\Specan(\scr O_X/\mc I)$ be a closed complex subspace of a complex space $X$ where $\mc I$ is finite-type. Let $\iota:Y\rightarrow X$ be the inclusion, and let $\scr E$ be an $\scr O_Y$-module. Assume that $\scr O_X$ is a coherent $\scr O_X$-module. Then $\scr E$ is a coherent $\scr O_Y$-module if and only if $\iota_*\scr E$ is a coherent $\scr O_X$-module.
\end{pp}

Extension principle is an important special case of Finite mapping Thm. \ref{lb74} which we will prove later.


\begin{proof}
We identify $\scr E$ with $\iota_*\scr E$ and $\scr O_Y$ with $\iota_*\scr O_Y=\scr O_X/\mc I$. (Cf. Rem. \ref{lb52}.) Clearly $\mc I$ is $\scr O_X$-coherent. So $\scr O_Y$ is $\scr O_X$-coherent by Cor. \ref{lb46}.

Assume $\iota_*\scr E$ is $\scr O_X$-coherent. Then by Prop. \ref{lb53}, $\scr E\simeq\iota^*\iota_*\scr E$ is a finite-type $\scr O_Y$-module. Suppose that after shrinking $X$ we have a morphism $\alpha:\scr O_Y^n\rightarrow\scr E$. Since $\scr O_Y^n$ is $\scr O_X$-coherent, $\Ker\alpha$ is $\scr O_X$-coherent by Cor. \ref{lb46}. So $\Ker\alpha$ (or more precisely, $\iota_*(\Ker\alpha)$) is a finite-type $\scr O_X$-module. So by Prop. \ref{lb53}, it is a finite-type $\scr O_Y$-module.


Assume $\scr E$ is $\scr O_Y$-coherent. Then by Thm. \ref{lb48}, $\scr E\simeq\Cok(\scr O_Y^m\rightarrow\scr O_Y^n)$ after shrinking $X$ to a neighborhood of $x\in Y\subset X$. Since $\scr O_Y$ is $\scr O_X$-coherent, by Cor. \ref{lb45}, $\scr O_Y^m,\scr O_Y^n$ are $\scr O_X$-coherent. So $\scr E$ is $\scr O_X$-coherent by Cor. \ref{lb46}.
\end{proof}


\begin{co}\label{lb67}
Let $Y$ be a closed complex subspace of $X$. Assume $\scr O_X$ is $\scr O_X$-coherent. Then $\scr O_Y$ is $\scr O_Y$-coherent.
\end{co}

\begin{proof}
Write $Y=\Specan(\scr O_X/\mc I)$ where $\mc I$ is a finite-type ideal of $\scr O_X$. So $\mc I$ is $\scr O_X$-coherent. Hence $\scr O_Y=\scr O_X/\mc I$ is $\scr O_X$-coherent, and hence $\scr O_Y$-coherent by Extension principle.
\end{proof}



Thus, if we can show that $\scr O_{\Cbb^n}$ is coherent for any $n$, then all model spaces, and hence all complex spaces have coherent structure sheaves.





\section{Germs of coherent sheaves; coherence of hom sheaves}

Let $X$ be a $\Cbb$-ringed space.

An important reason for studying coherent sheaves is that germs of coherent sheaves are equivalent to finitely-generated modules of local analytic $\Cbb$-algebras, just as germs of complex spaces are equivalent to local analytic $\Cbb$-algebras (Thm. \ref{lb19}). Let us be more precise.


\begin{df}
Let $X$ be a $\Cbb$-ringed space and $x\in X$. The \textbf{category of germs of coherent modules at $x$} is the category whose objects are coherent $\scr O_U$-modules $\scr E_U$ where $U\ni x$ is open. If $V\subset U$ is a neighborhood of $x$, then $\scr E_U$ and $\scr E_V:=\scr E_U|_V$ are viewed as the same object. 

A \textbf{morphism} between two objects $\scr E_U,\scr F_U$ is an element $\varphi\in\Hom_{\scr O_V}(\scr E_V,\scr F_V)$ for a possibly smaller neighborhood $V\ni x$. Two morphisms are regarded as equal if then agree when restricted to a possibly smaller neighborhood of $x$ on which both are defined. Compositions of morphisms are defined in the obvious way. Thus, in this category the set of morphisms from $\scr E_U$ to $\scr F_U$ is precisely the stalk $\shom_{\scr O_U}(\scr E_U,\scr F_U)_x$ of $\shom_{\scr O_U}(\scr E_U,\scr F_U)$. \hfill\qedsymbol
\end{df}





\begin{thm}\label{lb49}
Let $X$ be a $\Cbb$-ringed space and $x\in X$. Assume that $\scr O_X$ is a coherent $\scr O_X$-module, and $\scr O_{X,x}$ is Noetherian. Then the functor $\fk F$ from the category of germs of coherent modules at $x$ to the category of finitely-generated $\scr O_{X,x}$-modules, sending $\scr E_U$ to the $\scr O_{X,x}$-module $\scr E_x$ and sending each $\varphi\in\shom_{\scr O_U}(\scr E_U,\scr F_U)_x$ (namely, each $\varphi\in\Hom_{\scr O_V}(\scr E_V,\scr F_V)$ for a possibly smaller neighborhood $V\ni x$) to the corresponding stalk map $\scr E_x\rightarrow\scr F_x$, is an \textbf{equivalence of categories}. \index{00@Equivalence of categories} Namely, the following two statements hold:
\begin{enumerate}[label=(\arabic*)]
\item For each objects $\scr E_U,\scr F_U$, the following $\scr O_{X,x}$-module morphism is bijective:
\begin{align}\label{eq23}
\fk F:\shom_{\scr O_U}(\scr E_U,\scr F_U)_x\xrightarrow{\simeq}\Hom_{\scr O_{X,x}}(\scr E_x,\scr F_x)
\end{align}
\item Each finitely-generated $\scr O_{X,x}$-module is isomorphic to $\fk F(\scr E_U)$ for some object $\scr E_U$. Namely, it is isomorphic to $\scr E_{U,x}$.
\end{enumerate}
\end{thm}


\begin{rem}
If only (1) resp. (2) is satisfied, we say $\fk F$ is \textbf{fully-faithful} resp. \textbf{essentially surjective}. \index{00@Fully faithful}  \index{00@Essentially surjective} These names also apply to contravariant functors.
\end{rem}

From the proof, we shall see that the $\fk F$ in \eqref{eq23} is an isomorphism even without assuming that $\scr O_X,\scr F_U$ are coherent or $\scr O_{X,x}$ is Noetherian. 


\begin{proof}[Proof of (2)]
Choose any finitely generated $\scr O_{X,x}$-module $\mc M$. Then we have a surjective morphism $\alpha:\scr O_{X,x}^n\rightarrow\mc M$. $\Ker\alpha$ is an $\scr O_{X,x}$-submodule of $\scr O_{X,x}^n$, which is finitely-generated since $\scr O_{X,x}$ is Noetherian. Thus we have a surjective $\beta:\scr O_{X,x}^m\rightarrow\Ker\alpha$. Let $\gamma:\scr O_{X,x}^m\rightarrow\scr O_{X,x}^n$ be the composition of $\beta$ and the inclusion $\iota:\Ker\alpha\rightarrow\scr O_{X,x}^n$. Then $\mc M\simeq\Cok\gamma$.

We can extend $\gamma$ to an $\scr O_U$-module morphism $\varphi:\scr O_U^m\rightarrow\scr O_U^n$ for some neighborhood $U\ni x$. Namely, the stalk map of $\varphi$ at $x$ is $\gamma$. (For instance, choose $U$ such that $s_1=\gamma(1,0,\dots,0),\dots,s_n=\gamma(0,0,\dots,1)\in\scr O_{X,x}^n$ can be defined on $U$. Then $\varphi$ is defined to be the $\scr O_U$-module morphism sending $(1,0,\dots,0)\in\scr O(U)^m$ to $s_1\in\scr O(U)^n$, etc., and $(0,0,\dots,1)$ to $s_n$.) Then $\Cok\varphi$ is a coherent $\scr O_U$-module (Cor. \ref{lb45} and \ref{lb46}) whose stalk at $x$ is $\Cok\gamma\simeq\mc M$.
\end{proof}


\begin{proof}[Proof of (1)]
Choose an $\scr O_U$-module morphism $\varphi:\scr E_U\rightarrow\scr F_U$ such that $\fk F(\varphi)=0$. So the stalk map $\varphi:\scr E_{U,x}\rightarrow\scr F_{U,x}$ is zero. Since $\scr E_U$ is finite-type, $\scr E_{U,x}$ is finitely-generated. So we may choose $s_1,\dots,s_n\in\scr E_{U,x}$ generating $\scr E_{U,x}$. We may find a neighborhood $V\ni x$ in $U$ such that $s_1,\dots,s_n\in\scr E(V)$, that $\varphi(s_1)=\cdots=\varphi(s_n)=0$ in $\scr F(V)$, and that (by Rem. \ref{lb17} and that $\scr E_U$ is finite-type) $s_1,\dots,s_n$ generate $\scr E_V$. So $\varphi$ sends all sections of $\scr E_V$ to $0$. This proves that $\fk F$ is injective and uses only the condition that $\scr E_U$ is finite-type.

We now prove that $\fk F$ is surjective. Choose any $\eta\in\Hom_{\scr O_{X,x}}(\scr E_x,\scr F_x)$. By Thm. \ref{lb48}, there is a neighborhood $V\ni x$ inside $U$ and an $\scr O_V$-module morphism $\alpha:\scr O_V^m\rightarrow\scr O_V^n$ such that $\scr E_V=\Cok(\alpha)$. Let $\pi_x:\scr O_{V,x}^n\rightarrow\scr E_x=\Cok(\alpha_x:\scr O_{V,x}^m\rightarrow\scr O_{V,x}^n)$ be the quotient map. Let $\eta'$ be $\scr O_{V,x}^n\xrightarrow{\pi_x}\scr E_x\xrightarrow{\eta}\scr F_x$. Then as argued in the proof of part (2), the stalk map $\eta'$ can be extended to an $\scr O_V$-module morphism $\wtd\eta':\scr O_V^n\rightarrow\scr F_V$ after shrinking $V$. $\wtd\eta'\circ\alpha:\scr O_V^m\rightarrow\scr F_V$ has stalk map $\eta\circ\pi_x\circ\alpha_x$ at $x$, which is $0$. So by the injectivity of $\fk F$, we may shrink $V$ so that $\wtd\eta'\circ\alpha=0$. So $\wtd\eta'$ equals $\scr O_V^n\xrightarrow{\pi} \scr E_V=\Cok(\alpha)\xrightarrow{\wtd\eta}\scr F_V$ for some $\scr O_V$-module morphism $\wtd\eta$. Then $\wtd\eta_x=\eta$, i.e. $\fk F(\wtd\eta)=\eta$.
\end{proof}



Let us emphasize the following crucial special case of Thm. \ref{lb49}:

\begin{co}\label{lb50}
Let $X$ be a $\Cbb$-ringed space and $x\in X$. Let $\scr E$ and $\scr F$ be $\scr O_X$-modules. Then the canonical $\scr O_{X,x}$-module morphism
\begin{align}
\fk F:\shom_{\scr O_X}(\scr E,\scr F)_x\rightarrow\Hom_{\scr O_{X,x}}(\scr E_x,\scr F_x)
\end{align}
is injective if $\scr E$ is finite-type, and is bijective if $\scr E$ is coherent.
\end{co}



\begin{co}\label{lb138}
Let $\scr F$ be an $\scr O_X$-module.
\begin{enumerate}
\item The contravariant functor  $\shom_{\scr O_X}(-,\scr F)$ on the category of coherent $\scr O_X$-modules is left exact, where the contravariant functor sends each $\varphi\in\Hom_{\scr O_X}(\scr E_1,\scr E_2)$ to $\shom_{\scr O_X}(\scr E_2,\scr F)\rightarrow\shom_{\scr O_X}(\scr E_1,\scr F),\psi\mapsto \psi\circ\varphi$.
\item Assume that $\scr F$ is coherent. Then the functor  $\shom_{\scr O_X}(\scr F,-)$ on the category of $\scr O_X$-modules is left exact, where the functor sends each $\varphi\in\Hom_{\scr O_X}(\scr E_1,\scr E_2)$ to $\shom_{\scr O_X}(\scr F,\scr E_1)\rightarrow\shom_{\scr O_X}(\scr F,\scr E_2),\psi\mapsto \varphi\circ\psi$.
\end{enumerate}

\end{co}
Note that these two exactness is equivalent to saying that we have equivalences
\begin{subequations}
\begin{gather}
\shom_{\scr O_X}\big(\Cok(\scr E_1\rightarrow\scr E_2),\scr F\big)\simeq\Ker\big(\shom_{\scr O_X}(\scr E_2,\scr F)\rightarrow\shom_{\scr O_X}(\scr E_1,\scr F)\big)\label{eq24}\\
\shom_{\scr O_X}\big(\scr F,\Ker(\scr E_1\rightarrow\scr E_2)\big)\simeq\Ker\big(\shom_{\scr O_X}(\scr F,\scr E_1)\rightarrow\shom_{\scr O_X}(\scr F,\scr E_2)\big)\label{eq25}
\end{gather}
\end{subequations}
induced by the obvious inclusions
\begin{gather*}
\shom_{\scr O_X}\big(\Cok(\scr E_1\rightarrow\scr E_2),\scr F\big)\hookrightarrow\shom_{\scr O_X}(\scr E_2,\scr F),\\
\shom_{\scr O_X}\big(\scr F,\Ker(\scr E_1\rightarrow\scr E_2)\big)\hookrightarrow\shom_{\scr O_X}(\scr F,\scr E_1).
\end{gather*}



\begin{proof}
Let $\scr E_1\rightarrow\scr E_2\rightarrow\scr E_3\rightarrow0$ be an exact sequence of coherent $\scr O_X$-modules. Then we have $0\rightarrow\shom(\scr F,\scr E_3)\rightarrow\shom(\scr F,\scr E_2)\rightarrow\shom(\scr F,\scr E_1)$ which, thanks to Cor. \ref{lb50}, gives stalk maps $0\rightarrow\Hom_{\scr O_{X,x}}(\scr F_x,\scr E_{3,x})\rightarrow\Hom_{\scr O_{X,x}}(\scr F_x,\scr E_{2,x})\rightarrow\Hom_{\scr O_{X,x}}(\scr F_x,\scr E_{1,x})$ at each $x\in X$  which is exact by Rem. \ref{lb51}. This proves part 1. Part 2 is proved in a similar way.
\end{proof}


\begin{co}\label{lb83}
Assume that $\scr E,\scr F$ are coherent $\scr O_X$-modules. Then $\shom_{\scr O_X}(\scr E,\scr F)$ is coherent. So $\scr E^\vee$ is coherent if $\scr E,\scr O_X$ are coherent.
\end{co}

\begin{proof}
If $\scr E=\scr O_X^n$ then $\shom(\scr E,\scr F)\simeq\scr F^n$ is coherent by Cor. \ref{lb45}. In the general case, choose $x\in X$. Then by Thm. \ref{lb48} we may shrink $X$ to a neighborhood of $x$ such that $\scr E\simeq\Cok(\scr E_1\rightarrow\scr E_2)$ where $\scr E_1,\scr E_2$ are free $\scr O_X$-modules. The coherence of $\shom(\scr E,\scr F)$ follows from \eqref{eq24} and Cor. \ref{lb46}.
\end{proof}


\section{Supports and annihilators of coherent sheaves; image spaces}


In this section, we assume $X,Y$ are complex spaces.

From Rem. \ref{lb52}, we know that if $\mc I$ is a finite-type ideal of $\scr O_X$ annihilating an $\scr O_X$-module $\scr E$, then the study of $\scr E$ is equivalent to the study of the $\scr O_Y$-module $\scr E|_Y$ where $Y=\Specan(\scr O_X/\mc I)$. A natural question is whether we can find a largest such $\mc I$, i.e., a smallest such $Y$. To study this problem, we introduce:

\begin{df}\label{lb104}
Let $\scr E$ be an $\scr O_X$-module. Then the \textbf{annihilator sheaf} \index{00@Annihilator sheaf $\sann_{\scr O_X}(\scr E)$} of $\scr E$, written as $\sann_{\scr O_X}(\scr E)$ or simply $\sann(\scr E)$, is the ideal sheaf of $\scr O_X$ defined to be the kernel of the $\scr O_X$-module morphism $\scr O_X\rightarrow\shom_{\scr O_X}(\scr E,\scr E)=:\send_{\scr O_X}(\scr E)$ \index{End@$\send_{\scr O_X}(\scr E)=\shom_{\scr O_X}(\scr E,\scr E)$} sending each $f\in\scr O_X$ to the multiplication of $f$ on $\scr E$. So we have an exact sequence
\begin{align}\label{eq26}
0\rightarrow\sann_{\scr O_X}(\scr E)\rightarrow \scr O_X\rightarrow\send_{\scr O_X}(\scr E).
\end{align} 
If $\scr E$ and $\scr O_X$ are coherent then so is $\sann_{\scr O_X}(\scr E)$ (due to Cor. \ref{lb46} and \ref{lb83}).

Similarly, if $A$ is a commutative ring and $\mc M$ an $A$-module, then the \textbf{annihilator} $\Ann_A(\mc M)$ \index{00@Annihilators of modules $\Ann_A(\mc M)$} is defined to be the kernel of $A\rightarrow\End_A(\mc M)$.  \hfill\qedsymbol
\end{df}



\begin{rem}
\eqref{eq26} gives an exact sequence of stalk maps at each $x$. Assume that $\scr E$ is $\scr O_X$-coherent. Then by Prop. \ref{lb50}, $\send_{\scr O_X}(\scr E)_x\simeq\End_{\scr O_{X,x}}(\scr E_x)$. This shows that we have a canonical equivalence of $\scr O_{X,x}$-modules
\begin{align}
\sann_{\scr O_X}(\scr E)_x\simeq\Ann_{\scr O_{X,s}}(\scr E_x)\label{eq36}
\end{align}
if $\scr E$ is coherent.
\end{rem}



\begin{df}
Assume $\scr O_X$ is coherent. Given a coherent $\scr O_X$-module $\scr E$, we define the \textbf{support of $\scr E$}, written as $\Supp(\scr E)$, \index{00@Support of a sheaf $\Supp(\scr E)$} to be the complex space
\begin{align}
\Supp(\scr E)=\Specan\big(\scr O_X/\sann_{\scr O_X}(\scr E)\big).
\end{align}
\end{df}

\begin{rem}
$\Ann(\scr E_x)=\scr O_{X,x}$ iff $1\in\Ann(\scr E_x)$ iff $1$ annihilates $\scr E_x$ iff $\scr E_{X,x}=0$. This shows that the underlying topological space of $\Supp(\scr E)$ defined above (i.e. the set of all $x$ such that $\scr O_{X,x}/\sann(\scr E)_x\neq 0$) agrees with the usual one (i.e. the set of all $x$ such that $\scr E_x\neq 0$) when $\scr E$ is coherent.
\end{rem}


\begin{rem}\label{lb167}
We know that the support  (as a set) of a finite-type $\scr O_X$-module is a closed subset of $X$ (Cor. \ref{lb43}). Now we know that if $\scr E,\scr O_X$ are coherent, then $\Supp(\scr E)$ as a set is an \textbf{analytic subset} \index{00@Analytic subsets} of $X$, which means that it is $N(\mc I)$ for a finite-type ideal $\mc I$.
\end{rem}

Our definition of analytic subsets seems stronger than the usual one, which says that a subset $A\subset X$ is analytic if each $x\in X$ is contained in a neighborhood $U$ such that $A\cap U$ is the zero set of finitely many elements of $\scr O(U)$. These two definitions are indeed equivalent, which follows from the coherence of the radicals of coherent ideals. See Cor. \ref{lb136}.


\begin{cv}
If $\scr E,\scr O_X$ are coherent, we understand $\Supp(\scr E)$ as a complex subspace of $X$. Otherwise we understand it as only a subset of $X$. 
\end{cv}


\begin{exe}
Show that if $\mc I$ is a finite-type (and hence coherent) ideal of $\scr O_X$, then
\begin{align}
\Supp(\scr O_X/\mc I)=\Specan(\scr O_X/\mc I).
\end{align}
\end{exe}


\begin{df}\label{lb76}
Let $\varphi:X\rightarrow Y$ be a holomorphic map of complex spaces. Assume that $\scr O_Y,\varphi_*\scr O_X$ are coherent $\scr O_Y$-modules and $\Imag(\varphi)=\{\varphi(x):x\in X\}$ is a closed subset of $Y$. We define the \textbf{image space $\varphi(X)$} \index{00@Image complex space $\varphi(X)$} of $\varphi$ to be
\begin{align}
\varphi(X)=\Supp(\varphi_*\scr O_X)=\Specan\big(\scr O_Y/\sann_{\scr O_Y}(\varphi_*\scr O_X)\big).
\end{align}
\end{df}

The notation $\varphi(X)$ and the name ``image space" is justified by the following lemma.

\begin{lm}
The underlying topological space of $\varphi(X)$ is the usual one $\Imag(\varphi)=\{\varphi(x):x\in X\}$. In particular, $\Imag(\varphi)$ is an analytic subset of $Y$.
\end{lm}


\begin{proof}
Choose $y\in Y$. We show that $(\varphi_*\scr O_X)_y=0$ iff $y\notin\Imag(\varphi)$.  First assume $(\varphi_*\scr O_X)_y=0$. Choose a neighborhood $V$ of $y$. The non-zero element $1\in(\varphi_*\scr O_X)(V)=\scr O_X(\varphi^{-1}(V))$ becomes $0$ in $(\varphi_*\scr O_X)_y$, which means that we may shrink $V$ so that $1=0$ in $\scr O_X(\varphi^{-1}(V))$. So $\varphi^{-1}(V)=\emptyset$. Hence $y\notin\Imag(\varphi)$. Conversely, suppose $y\notin\Imag(\varphi)$. Since $\Imag(\varphi)$ is closed, we may find a small enough neighborhood $V\ni y$ such that $\varphi^{-1}(V)=\emptyset$. So $(\varphi_*\scr O_X)_y=0$.
\end{proof}

\begin{rem}
In the setting of Def. \ref{lb76}, using \eqref{eq36}, it is easy to see that we have a canonical equivalence of $\scr O_{Y,y}$-modules
\begin{align}
\sann_{\scr O_Y}(\varphi_*\scr O_X)_y\simeq \Ker\big(\varphi^\#:\scr O_{Y,y}\rightarrow(\varphi_*\scr O_X)_y\big).\label{eq37}
\end{align}
\end{rem}


\begin{exe}\label{lb155}
Assume that $\varphi_*\scr O_X$ is $\scr O_Y$-coherent and $\varphi$ is a closed map. Show that if $X$ is reduced then the complex space $\varphi(X)$ is reduced. (Recall Def. \ref{lb154}.) Show that if $A$ is an analytic subset of $X$, then the set $\varphi(A)$ is analytic in $Y$.
\end{exe}



To study a coherent sheaf $\scr E$ one can restrict the underlying complex space to $\Supp(\scr E)$. Likewise, to study $\varphi$ when $\varphi_*\scr O_X$ and $\scr O_Y$ are coherent and $\Imag(\varphi)$ is closed, one can restrict the codomain of $\varphi$ to $\varphi(X)$:

\begin{pp}\label{lb77}
Let $\varphi:X\rightarrow Y$ be holomorphic. Assume that $\scr O_Y,\varphi_*\scr O_X$ are coherent $\scr O_Y$-modules and $\Imag(\varphi)$ is closed in $Y$. Then there is a unique holomorphic map $\wtd\varphi:X\rightarrow\varphi(Y)$ (the restriction of $\varphi$) such that the following diagram commutes:
\begin{equation*}
\begin{tikzcd}[column sep=small]
X \arrow[rr, "\varphi"] \arrow[rd, "\wtd\varphi"'] &                             & Y \\
                                                   & \varphi(X) \arrow[ru, hook] &  
\end{tikzcd}
\end{equation*}
\end{pp}

\begin{proof}
This follows immediately from Thm. \ref{lb13}.
\end{proof}


Let us give another application of supports of coherent sheaves. Recall that if $A$ is a commutative ring and $\mc M$ is an $A$-module, an element $a\in A$ is called a \textbf{zero divisor of $\mc M$} \index{00@Zero divisors and non-zero-divisors} if $a\xi=0$ for a non-zero $\xi\in\mc M$. Equivalently $a$ is a zero divisor iff $\Ker(\mc M\xrightarrow{\times a}\mc M)$ is non-zero. If $a$ is not a zero divisor of $\mc M$, we call it a \textbf{non zero-divisor of $\mc M$}, not to be confused with a \textbf{non-zero zero divisor}, which is by definition a zero divisor which itself is not zero. Finally, a zero divisor means a zero divisor of $A$.

In the following we assume $\scr O_X$ is coherent, which is redundant after Oka's coherence theorem is proved.

\begin{pp}\label{lb113}
Let $X$ be a complex space, $\scr E$ a coherent $\scr O_X$-module, and choose $f\in\scr O(X)$. Then 
\begin{align*}
Z=\{x\in X:\text{The germ of $f$ at $x$ is a zero divisor of $\scr E_x$}\}
\end{align*}
is an analytic subset of $X$. In particular, the set of $x\in X$ such that $f$ is a non zero-divisor of $\scr E_x$ is open in $X$.
\end{pp}


\begin{proof}
Let $\scr K=\Ker(\scr E\xrightarrow{\times f}\scr E)$, which is coherent by Cor. \ref{lb46}. Then $\Supp(\scr K)$ is a complex subspace of $X$. A point $x\in X$ belongs to $\Supp(\scr K)$ iff $\scr K_x=\Ker(\scr E_x\xrightarrow{\times f}\scr E_x)$ is non-zero iff $f$ is a zero divisor of $\scr E_x$. This shows that $Z$ equals $\Supp(\scr K)$ as sets.
\end{proof}














\section{Finite maps and proper maps}

The proof of coherence of the structure sheaves of complex spaces is closely related to the study of finite holomorphic maps $\varphi:X\rightarrow Y$ and the coherence of $\varphi_*\scr O_X$. In this section, we discuss finite maps in the purely topological setting. 

We assume $X,Y$ are topological spaces. Recall that a continuous map $\varphi:X\rightarrow Y$ is called \textbf{closed} if $\varphi$ sends closed subsets of $X$ to closed subsets of $Y$. \index{00@Closed maps}





\begin{pp}\label{lb54}
Let $\varphi:X\rightarrow Y$ be a continuous map. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is a closed map.
\item For each $y\in Y$,
\begin{align*}
\{\varphi^{-1}(V):V\subset Y\text{\normalfont{ is a neighborhood of }}y\}
\end{align*}
is a \textbf{basis of neighborhoods of $\varphi^{-1}(y)$} \index{00@Base of neighborhoods of a subset}, which means that for each open $U\subset X$ containing $\varphi^{-1}(y)$ there is a neighborhood $V\ni y$ such that $\varphi^{-1}(V)\subset U$.
\end{enumerate}
\end{pp}

\begin{proof}
Assume (1). For each open $U\subset X$ containing $\varphi^{-1}(y)$, let $V\subset Y$ be defined by $Y\setminus V=\varphi(X\setminus U)$ where $\varphi(X\setminus U)$ is closed because $\varphi$ is closed. So $V$ is open and clearly contains $y$. Since $V\cap\varphi(X\setminus U)=\emptyset$, $\varphi^{-1}(V)\cap (X\setminus U)=\emptyset$. So $\varphi^{-1}(V)\subset U$. This proves (2).

Assume (2). Choose any closed subset $E\subset X$. We shall show that $\varphi(E)$ is closed in $Y$. Choose any $y\in Y\setminus\varphi(E)$. Then $X\setminus E$ is a neighborhood of $\varphi^{-1}(y)$. So we can choose a neighborhood $V\subset Y$ of $y$ such that $\varphi^{-1}(V)\subset X\setminus E$. So $\varphi^{-1}(V)\cap E=\emptyset$, and hence $V\cap \varphi(E)=\emptyset$. This proves that $y$ is an interior point of $Y\setminus\varphi(E)$. So $Y\setminus\varphi(E)$ is open, and (1) is proved.
\end{proof}



\begin{rem}\label{lb88}
The above proposition shows that closedness is a local property (with respect to the base $Y$): If $Y$ has an open cover $(V_\alpha)_\alpha$ such that for each $\alpha$, the restriction $\varphi:\varphi^{-1}(V_\alpha)\rightarrow V_\alpha$ is closed. Then $\varphi:X\rightarrow Y$ is closed.
\end{rem}

\begin{df}
A continuous map $\varphi:X\rightarrow Y$ is called \textbf{finite} if it is a closed map and if $\varphi^{-1}(y)$ is a finite set for all $y\in Y$. \index{00@Finite (holomorphic) maps} The composition of two finite maps is clearly finite. If $\varphi:X\rightarrow Y$ is a holomorphic map of complex spaces which is finite as a continuous map of topological spaces, we say $\varphi$ is a \textbf{finite holomorphic map}.
\end{df}







\begin{rem}\label{lb55}
A main reason that we require finite maps to be closed is the following: Suppose $\varphi$ is finite. Given $y\in Y$, choose mutually disjoint neighborhoods $U_x\subset X$ for all $x\in\varphi^{-1}(y)$. Then by Prop. \ref{lb54}, there is a sufficiently small neighborhood $V\subset Y$ of $y$ such that
\begin{align}
\varphi^{-1}(V)=\coprod_{x\in\varphi^{-1}(y)} \varphi^{-1}(V)\cap U_x.\label{eq28}
\end{align}
In other words, we can shrink each $U_x$ to a smaller neighborhood of $x$ such that
\begin{align}
\varphi^{-1}(V)=\coprod_{x\in\varphi^{-1}(y)}U_x.\label{eq29}
\end{align}
From this it is clear that the restriction $\varphi|_{U_x}:U_x\rightarrow Y$ is finite.
\end{rem}

As applications of this observation, we prove several important facts about direct images.

\begin{pp}\label{lb56}
Let $\varphi:X\rightarrow Y$ be a finite continuous map, and let $\scr E$ be an $X$-sheaf. Then for each $y\in Y$, we have an isomorphism of abelian groups
\begin{align}\label{eq27}
\Phi:(\varphi_*\scr E)_y\xlongrightarrow{\simeq} \bigoplus_{x\in\varphi^{-1}(y)}\scr E_x
\end{align}
defined componentwisely by the obvious restriction maps.
\end{pp}
If $\varphi$ is a morphism of $\Cbb$-ringed spaces and $\scr E$ is an $\scr O_Y$-module, then $\Phi$ is clearly an isomorphism of $\scr O_{Y,y}$-modules. Moreover, \emph{$\Phi$ is an isomorphism of $(\varphi_*\scr O_X)_y$-modules} if we let $(\varphi_*\scr O_X)_y\simeq\bigoplus_{x\in\varphi^{-1}(y)}\scr O_{X,x}$ act on the codomain of $\Phi$ componentwisely.

\begin{proof}
$\Psi$ is defined by passing to the direct limit of the map
\begin{align}
\Phi_V:\scr E(\varphi^{-1}(V))\rightarrow\bigoplus_{x\in\varphi^{-1}(y)}\scr E_x
\end{align}
over all open $V\ni y$. If $s\in\scr E(\varphi^{-1}(V))$ and $\Phi_V(s)=0$, then we may find disjoint neighborhoods $U_x\ni x$ such that $s|_{U_x}=0$. After shrinking $V$ such that \eqref{eq28} holds, we have $s=0$. So $\Phi$ is injective.

On the other hand, choose $s_x\in\scr E_x$ for each $x\in\varphi^{-1}(y)$. Then we may choose small enough neighborhoods $U_x\ni x$ and $V\ni y$ such that $s_x\in\scr E(U_x)$ and \eqref{eq29} holds. Let $s\in\scr E(\varphi^{-1}(V))$ be $s_x$ when restricted to $U_x$. Then $\Phi_V(s)=s_x$. So $\Phi$ is surjective.
\end{proof}

Recall that for an arbitrary continuous map $\varphi$, the functor $\varphi_*$ is left exact.

\begin{co}\label{lb71}
Let $\varphi:X\rightarrow Y$ be a finite continuous map. Then $\varphi_*$ is an \textbf{exact functor} (i.e. a left and right exact functor) from the category of $X$-sheaves to that of $Y$-sheaves. \index{00@Exact (contravariant) functors} Namely: if a sequence of maps of $X$-sheaves
\begin{align}
0\rightarrow\scr E\rightarrow\scr F\rightarrow\scr G\rightarrow0,\label{eq35}
\end{align}
is exact, then the following is exact:
\begin{align}
0\rightarrow(\varphi_*\scr E)_y\rightarrow(\varphi_*\scr F)_y\rightarrow(\varphi_*\scr G)_y\rightarrow0.\label{eq30}
\end{align}


Indeed, \eqref{eq35} is exact if and only if \eqref{eq30} is exact.
\end{co}

\begin{proof}
By Prop. \ref{lb56}, \eqref{eq30} is the same as
\begin{align*}
0\rightarrow\bigoplus_{x\in\varphi^{-1}(y)}\scr E_x\rightarrow\bigoplus_{x\in\varphi^{-1}(y)}\scr F_x\rightarrow\bigoplus_{x\in\varphi^{-1}(y)}\scr G_x\rightarrow0.
\end{align*}
The equivalence of the exactness of \eqref{eq35} and \eqref{eq30} follows.
\end{proof}



\begin{pp}[\textbf{Base change proposition}]\label{lb59}
Let $\pi:X\rightarrow S$ be a finite continuous map. Let $\scr E$ be an $\scr O_X$-module and $\scr M$ an $\scr O_S$-module. Then we have a (clearly functorial) $\scr O_S$-module isomorphism 
\begin{gather}
\begin{gathered}
\Upsilon:(\pi_*\scr E)\otimes_{\scr O_S}\scr M\xlongrightarrow{\simeq} \pi_*(\scr E\otimes_{\scr O_S}\scr M)\\[0.8ex]
\sigma\otimes\mu\in \scr E(\pi^{-1}(W))\otimes_{\scr O_S(W)}\scr M(W)\quad\mapsto \quad \sigma\otimes\mu \in(\scr E\otimes_{\scr O_S}\scr M)(\pi^{-1}(W))
\end{gathered}
\end{gather}
for all open $W\subset S$.
\end{pp}

Note that the stalk map of $\Phi$ at any $t\in S$ is the canonical morphism
\begin{gather}
\Upsilon:(\pi_*\scr E)_t\otimes_{\scr O_{S,t}}\scr M_t\longrightarrow \pi_*(\scr E\otimes_{\scr O_S}\scr M)_t \label{eq42}
\end{gather}

\begin{proof}
By Prop. \ref{lb56}, the stalk map \eqref{eq42} can be extended to a commutative diagram
\begin{equation}
\begin{tikzcd}
(\pi_*\scr E)_t\otimes_{\scr O_{S,t}}\scr M_t \arrow[r,"\Upsilon"] \arrow[d,"\simeq"'] & \pi(\scr E\otimes_{\scr O_S}\scr M)_t \arrow[d,"\simeq"] \\
\left(\bigoplus_{x\in\pi^{-1}(t)}\scr E_x\right)\otimes_{\scr O_{S,t}}\scr M_t \arrow[r,"\simeq"]           & \bigoplus_{x\in\pi^{-1}(t)}(\scr E\otimes_{\scr O_S}\scr M)_x          
\end{tikzcd}
\end{equation}
where the other three morphisms of $\scr O_{S,t}$-modules are isomorphisms. So \eqref{eq42} is an isomorphism.
\end{proof}



\begin{lm}\label{lb87}
Let $\varphi:X\rightarrow Y$ be a finite continuous map. Assume that $\scr E$ is a coherent $\scr O_X$-module. Then each $y\in Y$ is contained in neighborhood $V\subset Y$ such that $\scr E|_{\pi^{-1}(V)}$ is the cokernel of a morphism of free $\scr O_{\pi^{-1}(V)}$-modules.
\end{lm}

\begin{proof}
Choose $V$ such that \eqref{eq29} holds and $U_x$ is a small enough neighborhood of $x\in\varphi^{-1}(y)$ such that $\scr E|_{U_x}$ is equivalent to $\Cok(\scr O_{U_x}^m\rightarrow\scr O_{U_x}^n)$. The natural numbers $m,n$ might initially depend on $x$, but we can enlarge $m,n$ so that they do not. Then $\scr E|_{\pi^{-1}(V)}$ is clearly the cokernel of a morphism $\scr O_{\pi^{-1}(V)}^m\rightarrow\scr O_{\pi^{-1}(V)}^n$.
\end{proof}







\begin{df}
A continuous map $\varphi:X\rightarrow Y$ is called \textbf{proper} \index{00@Proper maps} if for each compact subset $K\subset Y$, $\varphi^{-1}(K)$ is compact.
\end{df}

Finite maps are special cases of proper maps as shown by the following proposition. Indeed, a deep theorem by Grauert says that if $\varphi$ is a proper holomorphic map then $\varphi_*\scr E$ is $\scr O_Y$-coherent whenever $\scr E$ is $\scr O_X$-coherent. In particular, $\varphi_*\scr O_X$ is $\scr O_Y$-coherent. So we can study $f(X)$. In the special case that $\varphi$ is finite, the study of the coherence of $\varphi_*\scr O_X$ is crucial to the proof of coherence of all structure sheaves of complex spaces.


\begin{pp}\label{lb98}
Let $\varphi:X\rightarrow Y$ be a continuous map of topological spaces. If $X$ and $Y$ are locally compact and $Y$ is Hausdorff, then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is proper.
\item $\varphi$ is closed, and $\varphi^{-1}(y)$ is compact for each $y\in Y$.
\end{enumerate}
Thus, a finite map is precisely a proper map whose fibers $\varphi^{-1}(y)$ are all discrete sets.
\end{pp}
Note: To prove (1)$\Rightarrow$(2) we don't need $X$ to be locally compact. To prove (2)$\Rightarrow$(1) we don't need $Y$ to be Hausdorff.
\begin{proof}
Assume (1). Let us prove that $\varphi$ is closed by proving part (2) of Prop. \ref{lb54}. Choose $y\in Y$ and any neighborhood $U\supset\varphi^{-1}(y)$. Since $Y$ is locally compact, we can fix a precompact neighborhood $V_0\subset Y$ of $y$. Then $E:=(X\setminus U)\cap \varphi^{-1}(V_0^\cl)$ is compact by the properness of $\varphi$. Let $\fk V$ be the set of all precompact open subsets of $V_0$ containing $y$. Then $\bigcap_{V\in\fk V}V^\cl=\{y\}$  since $Y$ is Hausdorff, and hence $E\cap\bigcap_{V\in\fk V}\varphi^{-1}(V^\cl)=\emptyset$. So by the compactness of $E$, there is $V\in\fk V$ such that $E\cap\varphi^{-1}(V^\cl)=0$. So $\varphi^{-1}(V^\cl)\subset U$.

Assume (2). For each $y\in Y$, since $\varphi^{-1}(y)$ is compact and $X$ is locally compact, we may find a precompact neighborhood $U\subset X$ of $\varphi^{-1}(y)$. By Prop. \ref{lb54}, we can find a neighborhood $V$ of $y$ such that $\varphi^{-1}(V)\subset U$. So $\varphi^{-1}(V)^\cl$ is compact since it is closed in $U^\cl$. From this we conclude that any compact $K\subset Y$ can be covered by finitely many open sets $V_1,V_2,\dots$ such that $\varphi^{-1}(V_j)^\cl$ is compact. Then $\varphi^{-1}(K)$ as a closed subset of $\bigcup_j \varphi^{-1}(V_j)^\cl$ is compact.
\end{proof}





The following important fact says that properness and finiteness are preserved by base changes.
\begin{pp}\label{lb91}
Let $\pi:X\rightarrow S$ and $\psi:Y\rightarrow S$ be holomorphic maps of complex spaces. If $\pi$ is proper resp. finite, then $\pr_Y:X\times_SY\rightarrow Y$ is proper resp. finite.
\end{pp}


\begin{proof}
As a topological space, $X\times_SY$ is the closed subset of all $x\times y\in X\times Y$ such that $\pi(x)=\psi(y)$ (Rem. \ref{lb101}). The relation $\pr_Y^{-1}(y)=\pi^{-1}(\psi(y))\times y$ shows that the fibers of $\pr_Y$ are finite sets if those of $\pi$ are finite. It also shows that if $K\subset Y$ is compact then $\pr_Y^{-1}(K)$ is a (clearly closed) subset of $\pi^{-1}(\psi(K))\times K$ which is compact if $\pi$ is proper. So $\pr_Y$ is proper if $\pi$ is so.
\end{proof}








\section{Weierstrass maps and Weierstrass preparation theorem}


The goal of this section is to study an important class of finite holomorphic maps called Weierstrass maps. 




\begin{df}\label{lb57}
Let $S$ be a complex space. Let $k\in\Nbb$. For each $i=1,\dots,k$, we choose a polynomial of degree $n_i$
\begin{align*}
p_i(z_i)=1\otimes a_{i,0}+(1\otimes a_{i,1})z_i+\cdots +(1\otimes a_{i,n_i})z_i^{n_i}\qquad\in \scr O(\Cbb^k\times S)[z_i]
\end{align*}
where $a_{i,j}\in\scr O(S)$, $n_i\in\Zbb_+$, and $a_{i,n_i}(t)\neq 0$ for all $t\in S$. Consider $p_i$ as an element of $\scr O(\Cbb^k\times S)$. Let
\begin{gather}
X=\Specan(\scr O_{\Cbb^k\times S}/\mc I)\qquad \mc I=p_1\scr O_{\Cbb^k\times S}+\cdots+p_k\scr O_{\Cbb^k\times S}.
\end{gather}
Then the holomorphic map $\pi:X\rightarrow S$ defined by restricting the projection $\pr_S:\Cbb^k\times S\rightarrow S$ is called a \textbf{Weierstrass map}.
\end{df}

Recall that by our notations, $1\otimes a_{i,j}$ means $\pr_S^\# a_{i,j}=a_{i,j}\circ\pr_S$. We shall write $1\otimes a_{i,j}$ as $a_{i,j}$ if no confusion arises.


\begin{pp}
Weierstrass maps are finite.
\end{pp}

\begin{proof}
Clearly each fiber of $\pi:X\rightarrow S$ is a finite set. To check that $\pi$ is closed, by Rem. \ref{lb88}, it suffices to check it locally with respect to the base.

By Rem. \ref{lb16} we can shrink $S$ and find an open disc $D\subset\Cbb$ such that for each $t\in S$ and each $i$, the polynomial $p_i(z_i,t)$ of $z_i$ has $n_i$ zeros in $D$ counting multiplicities. So $X$ (as a topological space, namely $N(\mc I)$) is a closed subset of $(D^\cl)^k\times S$. Therefore $\pi:X\rightarrow S$ is the restriction of the projection $(D^\cl)^k\times S\rightarrow S$ to a closed subset, which is closed because the projection $(D^\cl)^k\times S\rightarrow S$ is proper and hence closed (Prop. \ref{lb98}).
\end{proof}


The next proposition says that a canonical pullback $Y\rightarrow T$ of a Weierstrass map $X\rightarrow S$ along a holomorphic map $\psi:T\rightarrow S$ is Weierstrass.
\begin{pp}\label{lb66}
Assume the setting of Def. \ref{lb57}. Let $\psi:T\rightarrow S$ be a holomorphic map of complex spaces. Set
\begin{gather*}
\wtd a_{i,j}=a_{i,j}\circ\psi\in\scr O(T)\\
\wtd p_i(z_i)=1\otimes \wtd a_{i,0}+(1\otimes \wtd a_{i,1})z_i+\cdots +(1\otimes \wtd a_{i,n_i})z_i^{n_i}\qquad\in \scr O(\Cbb^k\times T)[z_i]
\end{gather*}
and set
\begin{gather}
Y=\Specan(\scr O_{\Cbb^k\times T}/\mc J)\qquad \mc J=\wtd p_1\scr O_{\Cbb^k\times T}+\cdots+\wtd p_k\scr O_{\Cbb^k\times T}.
\end{gather}
Then the Cartesian square
\begin{equation*}
\begin{tikzcd}
\Cbb^k\times S \arrow[d] & \Cbb^k\times T \arrow[l, "\id\times\psi"'] \arrow[d] \\
S          & T \arrow[l, "\psi"']          
\end{tikzcd}
\end{equation*}
restricts to a Cartesian square
\begin{equation*}
\begin{tikzcd}
X \arrow[d,"\pi"'] & Y\arrow[l,"\wtd\psi"'] \arrow[d,"\wtd\pi"] \\
S          & T \arrow[l, "\psi"']          
\end{tikzcd}
\end{equation*}
\end{pp}


\begin{proof}
By Prop. \ref{lb39} we have a Cartesian square
\begin{equation*}
\begin{tikzcd}
X \arrow[d,hook'] & Y \arrow[d,hook'] \arrow[l] \\
\Cbb^k\times S           & \Cbb^k\times T \arrow[l]          
\end{tikzcd}
\end{equation*}
which, together with Rem. \ref{lb31}, proves our proposition.
\end{proof}










The following theorem is the first major result of this chapter. Many subsequent major results in this chapter are proved using this theorem.

\index{00@Fundamental theorem of Weierstrass maps}
\begin{thm}[\textbf{Fundamental theorem of Weierstrass maps}]\label{lb60}
Assume the setting of Def. \ref{lb57}. Then
\begin{align}\label{eq32}
\{z_1^{\nu_1}\cdots z_k^{\nu_k}:0\leq \nu_i\leq n_i-1\text{ for all }1\leq i\leq k\}
\end{align}
(or more precisely, these elements acted on by $\Pr_{\Cbb^k\times S\rightarrow \Cbb^k}^\#$) is a set of free generators of the $\scr O_S$-module $\pi_*\scr O_X$.
\end{thm}

In particular, $\pi_*\scr O_X$ is a free $\scr O_S$-module of rank $n_1n_2\cdots n_k$.



\begin{lm}\label{lb92}
If Thm. \ref{lb60} holds when $S$ is smooth, then Thm. \ref{lb60} holds when $S$ is any complex space.
\end{lm}

\begin{proof}
Note that Thm. \ref{lb60} is local by nature since it can be checked at the level of stalks. So we may assume $S$ is so small that it is a closed subspace of an open subset $\Omega\subset\Cbb^m$, and that each $a_{i,j}$ is the restriction of an element of $\scr O(\Omega)$. Therefore, by Prop. \ref{lb66}, we have a Weierstrass map $Y\hookrightarrow \Cbb^k\times\Omega\rightarrow\Omega$ (which we also denote by $\pi$) such that the following two squares are Cartesian.
\begin{equation*}
\begin{tikzcd}[row sep=small]
X \arrow[d, hook] \arrow[r, hook]              & Y \arrow[d, hook]            \\
\Cbb^k\times S \arrow[r, hook] \arrow[d] & \Cbb^k\times\Omega \arrow[d] \\
S \arrow[r, hook]                        & \Omega                      
\end{tikzcd}
\end{equation*}
In particular, $\pi:X\rightarrow S$ is the base change of $\pi:Y\rightarrow\Omega$ to $S$. 

Write $S=\Specan(\scr O_\Omega/\mc I)$. Then by Rem. \ref{lb58}, $\scr O_X$ is $\scr O_Y\otimes_{\scr O_\Omega}\scr O_S$ (if we regard $\scr O_X$ as an $\scr O_Y$-module and $\scr O_S$ as an $\scr O_\Omega$-module). By Base change Prop. \ref{lb59}, we have canonical isomorphisms of $\scr O_\Omega$-modules
\begin{align*}
\pi_*\scr O_X\simeq\pi_*(\scr O_Y\otimes_{\scr O_\Omega}\scr O_S)\simeq \pi_*\scr O_Y\otimes_{\scr O_\Omega}\scr O_S.
\end{align*}
Equivalently, $\pi_*\scr O_X\simeq\pi_*\scr O_Y|_S$ as $\scr O_S$-modules. Since we assume that Thm. \ref{lb60} holds for $\pi:Y\rightarrow \Omega$, we know that $\pi_*\scr O_Y$ is generated freely by \eqref{eq32}. So $\pi_*\scr O_X$ is generated freely by (the restrictions to $S$ of) \eqref{eq32}.
\end{proof}




Due to Lemma \ref{lb92}, we can assume that:
\begin{cv}
In the remaining part of this section, $S$ is an open subset of $\Cbb^m$. Let $t_\blt=(t_1,\dots,t_m)$ be the variables of $S$.
\end{cv}



To prepare for the proof, we let $N(p_i)\subset \Cbb\times S$ be the subset of all $(z_i,t_\blt)$ such that $p_i(z_i,t_\blt)=0$. For each $(t_\blt)\in S$, define a subset of $\Cbb$
\begin{align*}
N(p_i)_{t_\blt}=N(p_i)\cap\pr_{\Cbb\times S\rightarrow S}^{-1}(t_\blt),
\end{align*}
namely, the set of all  $z_i$ satisfying $p_i(z_i,t_\blt)=0$. Then by Prop. \ref{lb56}, we have an obvious isomorphism of $\scr O_{S,t_\blt}$-modules
\begin{align}
(\pi_*\scr O_X)_{t_\blt}\simeq\bigoplus_{\begin{subarray}{c}
w_i\in N(p_i)_{t_\blt}\\
1\leq i\leq k
\end{subarray}} \scr O_{\Cbb^k\times S,(w_\blt,t_\blt)}/\mc I_{(w_\blt,t_\blt)}\label{eq31}
\end{align}
where
\begin{align*}
\mc I_{(w_\blt,t_\blt)}=p_1\scr O_{\Cbb^k\times S,(w_\blt,t_\blt)}+\cdots+p_k\scr O_{\Cbb^k\times S,(w_\blt,t_\blt)}.
\end{align*}
Our goal is to show that \eqref{eq32} generates \eqref{eq31} freely.


\subsection{Proof of Thm. \ref{lb60}, I}


In this subsection, we assume $(t_\blt)=0\in S\subset\Cbb^m$ for simplicity, and show that $z_1,\dots,z_k$ generate $(\pi_*\scr O_X)_0$. We let $(\tau_\blt)$ denote a set of general variables of $S$. \eqref{eq31} reads
\begin{align}\label{eq33}
(\pi_*\scr O_X)_0\simeq\bigoplus_{\begin{subarray}{c}
w_i\in N(p_i)_0\\
1\leq i\leq k
\end{subarray}} \scr O_{\Cbb^k\times S,(w_\blt,0)}/\mc I_{(w_\blt,0)}.
\end{align}


\begin{lm}\label{lb62}
\eqref{eq32} generates $(\pi_*\scr O_X)_0$.
\end{lm}
\begin{proof}[Proof-special case]
We consider the special case that for each $i$, $N(p_i)_0$ is the single point $0$. In this case, $p_i(z_i,\tau_\blt)$ has order $n_i$ in $z_i$ (recall Def. \ref{lb61}). (Namely, $p_i$ is, up to multiplication by a nowhere zero element of $\scr O(S)$, a \emph{Weierstrass polynomial} of $z_i$.) Now \eqref{eq33} reads
\begin{align*}
(\pi_*\scr O_X)_0\simeq \scr O_{\Cbb^k\times S,(0,0)}/\mc I_{(0,0)}.
\end{align*}
We explain the proof when $k=2$. The general case follows from exactly the same argument.

Choose $f(z_1,z_2,\tau_\blt)\in\scr O_{\Cbb^2\times S,(0,0)}$. Then by WDT (Weierstrass division theorem), 
\begin{align*}
f(z_1,z_2,\tau_\blt)=\sum_{j=0}^{n_1-1}z_1^j\cdot g_j(z_2,\tau_\blt)\qquad \mathrm{mod~~}p_1\scr O_{\Cbb^2\times S,(0,0)}
\end{align*}
where $g_j\in\scr O_{\Cbb\times S,(0,0)}$. Apply WDT again, we have
\begin{align*}
g_j(z_2,\tau_\blt)=\sum_{l=0}^{n_2-1}z_2^l\cdot h_l(\tau_\blt)\qquad \mathrm{mod~~}p_2\scr O_{\Cbb\times S,(0,0)}
\end{align*}
where $h_l\in\scr O_{S,0}$. This finishes the proof.
\end{proof}

To prove the general case, for each $w_i\in N(p_i)_0$ we define integer
\begin{align*}
\mu_i(w_i)=\{\text{The multiplicity of the root }z_i=w_i\text{ of }p_i(z_i,0)\}
\end{align*}
So $0<\mu_i(w_i)\leq n_i$.

\begin{lm}\label{lb63}
For each $i$, choose $w_i\in N(p_i)_0$. Then there is an $\scr O_{S,0}$-coefficients polynomial $q_1(z_\blt,\tau_\blt)$ of $z_1,\dots,z_n$ with multi-degree $\leq \big(n_1-\mu_1(w_1),\dots,n_k-\mu_k(w_k)\big)$ satisfying the following conditions.
\begin{enumerate}[label=(\arabic*)]
\item Its germ at $(w_\blt,0)$ is an invertible element of the ring $\scr O_{\Cbb^k\times S,(w_\blt,0)}/\mc I_{(w_\blt,0)}$. 
\item Its germ at $(\wtd w_\blt,0)$ is $0$ in the ring $\scr O_{\Cbb^k\times S,(\wtd w_\blt,0)}/\mc I_{(\wtd w_\blt,0)}$ for any $(\wtd w_\blt)=(\wtd w_1,\dots,\wtd w_k)\in\Cbb^k$ such that $\wtd w_i\in N(p_i)_0$ (for all $i$) and that $(\wtd w_\blt)\neq (w_\blt)$.
\end{enumerate}
\end{lm}

This lemma can be viewed as a partition of unity of $(\pi_*\scr O_X)_0$. We postpone the proof of this lemma until after proving Lemma \ref{lb62}.

\begin{proof}[Proof of Lemma \ref{lb62}-general case]
In view of \eqref{eq33}, it suffices to show prove the following claim:
\begin{itemize}
\item Choose any $(w_\blt)\in\Cbb^k$ such that $w_i\in N(p_i)_0$, and choose any $f(z_\blt,\tau_\blt)\in(\pi_*\scr O_X)_0$ which is zero in $\scr O_{\Cbb^k\times S,(\wtd w_\blt,0)}/\mc I_{(\wtd w_\blt,0)}$ whenever $(\wtd w_\blt)\neq (w_\blt)$. Then $f$ belongs to the $\scr O_{S,0}$-submodule of $(\pi_*\scr O_X)_0$ generated by \eqref{eq32}.
\begin{itemize}
\item Namely, there is an $\scr O_{S,0}$-coefficients polynomial $q(z_\blt,\tau_\blt)$ of $z_\blt$ with multi-degree $\leq (n_1-1,\dots,n_k-1)$ whose germ at $(w_\blt,0)$ is equal to the germ of $f$ mod $\mc I_{(w_\blt,0)}$, and whose germ at $(\wtd w_\blt,0)$ (where $(\wtd w_\blt)\neq (w_\blt)$) is in $\mc I_{(\wtd w_\blt,0)}$.
\end{itemize}
\end{itemize}

Let $q_1$ be as in Lemma \ref{lb63}, whose germ at $(w_\blt,0)$ is an invertible element of $\scr O_{\Cbb^k\times S,(w_\blt,0)}$. Note that $f/q_1$ is in $\scr O_{\Cbb^k\times S,(w_\blt,0)}$ (but not in $(\pi_*\scr O_X)_0$). We now apply the proof of the special case to $f/q_1$. Then by WDT (noting that $p_i(z_i,\tau_\blt)$ has order $\mu_i(w_i)$ in $z_i-w_i$), there is an $\scr O_{S,0}$-coefficients polynomial $q_2(z_\blt,\tau_\blt)$ of $z_\blt$ with multi-degree $\leq (\mu_1(n_1)-1,\dots,\mu_k(n_k)-1)$ which equals $f/q_1$ in $\scr O_{\Cbb^k\times S,(w_\blt,0)}/\mc I_{(w_\blt,0)}$. Then $f$ and $q:=q_1q_2$ are clearly equal in $\scr O_{\Cbb^k\times S,(w_\blt,0)}/\mc I_{(w_\blt,0)}$. They are also equal in $\scr O_{\Cbb^k\times S,(\wtd w_\blt,0)}/\mc I_{(\wtd w_\blt,0)}$ since both are $0$.
\end{proof}

We are done with the proof of Lemma \ref{lb62}.


\subsection{Proof of Lemma \ref{lb63}}



\begin{df}
A polynomial $q(z,\tau_\blt)\in\Cbb\{\tau_\blt\}[z]$ is called a \textbf{Weierstrass polynomial of $z$} \index{00@Weierstrass polynomials} if it is monic and the degree equals the order in $z$. Namely,
\begin{align}
q(z,\tau_\blt)=a_0(\tau_\blt)+a_1(\tau_\blt)z+\cdots+a_{n-1}(\tau_\blt)z^{n-1}
+z^n
\end{align}
where $a_0,\dots,a_{n-1}\in\Cbb\{\tau_\blt\}$, and
\begin{align*}
a_0(0)=a_1(0)=\cdots=a_{n-1}(0)=0.
\end{align*}
\end{df}

\index{00@WPT: Weierstrass preparation theorem}
\begin{thm}[\textbf{Weierstrass preparation theorem (WPT)}]
Choose $f(z,\tau_\blt)\in\Cbb\{z,\tau_\blt\}$ with finite order $n$ in $z$. Then there exist a unique invertible $u\in\Cbb\{z,\tau_\blt\}$ and a Weiertrass polynomial $q\in\Cbb\{\tau_\blt\}[z]$ of $z$ such that in $\Cbb\{z,\tau_\blt\}$ we have
\begin{align*}
f=uq.
\end{align*}
\end{thm}

\begin{proof}
Uniqueness: $f=uq$ can be written as $q=u^{-1}f$. Write $q(z,\tau_\blt)=z^n-r$ where the polynomial $r\in\Cbb\{\tau_\blt\}[z]$ of $z$ has degree $<n$. Then $z^n=u^{-1}f+r$ gives the unique Weierstrass division of $z^n$ by $f$. So $u,q$ are unique.  

Existence: By WDT, we have $z^n=\alpha f+r$ where $\alpha\in\Cbb\{z,\tau_\blt\}$ and $r\in\Cbb\{\tau_\blt\}[z]$ has degree $<n$. Now, $z^n=\alpha(z,0)f(z,0)+r(z,0)$ gives the unique Weierstrass division of $z^n$ by $f(z,0)$. Since $f$ has order $n$ in $z$, we may write $f(z,0)=z^nh(z)$ where $h\in\Cbb\{z\}$ is invertible. So $z^n=h(z)^{-1}\cdot f(z,0)$ also gives a Weierstrass division. Therefore $r(z,0)=0$ and $\alpha(z,0)=h(z)^{-1}$. So $\alpha(0,0)\neq 0$, i.e. $\alpha$ is invertible in $\Cbb\{z,\tau_\blt\}$. We have $f=\alpha^{-1}q$ where $q=z^n-r$.
\end{proof}



We are ready to prove Lemma \ref{lb63}.

\begin{proof}[\textbf{Proof of Lemma \ref{lb63}}]
Recall the polynomials $p_i$ in Def. \ref{lb57}. By WPT, for each $w_i\in N(p_i)_0$,  in the ring $\Cbb\{z_i-w_i,\tau_\blt\}$, $p_i(z_i,\tau_\blt)$ equals a unit times a Weierstrass polynomial $r_{i,w_i}(z_i,\tau_\blt)$ of $z_i-w_i$. So $r_{i,w_i}(z_i,\tau_\blt)\in\scr O_{S,0}[z_i]$ has degree $\mu_i(w_i)$ in $z_i$, and $r_{i,w_i}(z_i,0)=(z_i-w_i)^{\mu_i(w_i)}$. So in the ring $\scr O_{\Cbb^k\times S,(\wtd w_\blt,0)}/\mc I_{(\wtd w_\blt,0)}$, $r_{i,w_i}$ is invertible when $\wtd w_i\neq w_i$ (since $r_{i,w_i}(\wtd w_i,0)\neq 0$), and is $0$ when $\wtd w_i=w_i$. Thus
\begin{align*}
R_i:=\prod_{\begin{subarray}{c}\wtd w_i\in N(p_i)_0\\
\wtd w_i\neq w_i\end{subarray}}r_{i,w_i}
\end{align*}
is invertible in $\scr O_{\Cbb^k\times S,(\wtd w_\blt,0)/\mc I_{(\wtd w_\blt,0)}}$ when $\wtd w_i=w_i$ and is zero when $\wtd w_i\neq w_i$. $R_i\in\scr O_{S,0}[z_i]$ has degree $n-\mu_i(w_i)$ in $z_i$. So $p_1=\prod_{i=1}^k R_i$ gives the desired polynomial.
\end{proof}



\subsection{Proof of Thm. \ref{lb60}, II}



\begin{proof}[\textbf{Finishing the proof of Thm. \ref{lb60}}]
We have already shown that the set \eqref{eq32} (which has $n_1\cdots n_k$ elements) generate $\pi_*\scr O_X$. In particular, $\pi_*\scr O_X$ is a finite-type $\scr O_S$-module. To show that \eqref{eq32} generates $\pi_*\scr O_X$ freely, by Prop. \ref{lb65}, it suffices to show that the fiber $(\pi_*\scr O_X)|y=(\pi_*\scr O_X)\otimes_{\scr O_S}(\scr O_S/\fk m_{S,y})$ has dimension $n_1\cdots n_k$ for each $y\in S$.

By Base change Prop. \ref{lb59}, $(\pi_*\scr O_X)|y$ is canonically equivalent to
\begin{align*}
\pi_*(\scr O_X\otimes_{\scr O_S}(\scr O_S/\fk m_{S,y})),
\end{align*}
which equals $\pi_*\scr O_{X_y}=\scr O(X_y)$ (where $X_y=\pi^{-1}(y)$ is the inverse image of $y$ and is a closed subspace of $X$) by Rem. \ref{lb58}. By Prop. \ref{lb66}, $\pi:\pi^{-1}(y)\rightarrow\{y\}$ is a Weierstrass map. It is the restriction of $\Cbb^k\rightarrow \{y\}$ to the complex subspace of $\Cbb^k$ defined by the ideal sheaf generated by $p_i(z_i,y)=a_{i,0}(y)+a_{i,1}(y)z_i+\cdots+a_{i,n_i}(y)z_i^{n_i}$ for all $1\leq i\leq k$. Thus, it suffices to prove the following lemma.
\end{proof}


\begin{lm}
Let $X=\Specan(\scr O_{\Cbb^k}/\mc I)$ where $\mc I$ is the ideal sheaf generated by $p_1,\dots,p_k$ where each $p_i(z_i)\in\Cbb[z_i]$ has degree $n_i$. Then $\scr O(X)$ has dimension $n_1\cdots n_k$.
\end{lm}

\begin{proof}
We are still in the setting of Def. \ref{lb57}, but assuming that $S$ is a single point $0$. So $N(p_i)_0=N(p_i)$. By \eqref{eq33},
\begin{align*}
\scr O(X)\simeq\bigoplus_{\begin{subarray}{c}
w_i\in N(p_i)\\
1\leq i\leq k
\end{subarray}} \scr O_{\Cbb^k,w_\blt}/\mc I_{w_\blt}.
\end{align*}
Clearly $\mc I_{w_\blt}$ is the ideal generated by $(z_i-w_i)^{\mu_i(w_i)}$ for all $1\leq i\leq k$. So
\begin{align*}
\left\{\prod_{i=1}^k(z_i-w_i)^{\nu_i}:0\leq\nu_i\leq \mu_i(w_i)-1\right\}
\end{align*}
is a basis of $\scr O_{\Cbb^k,w_\blt}/\mc I_{w_\blt}$. This calculates the dimension of $\scr O(X)$.
\end{proof}




\section{Coherence of $\scr O_X$}

The goal of this section is to prove that $\scr O_X$ is coherent for every complex space $X$. By Cor. \ref{lb67}, it suffices to prove that $\scr O_{\Cbb^n}$ is coherent. The role that Thm. \ref{lb60} plays in the proof of coherence of $\scr O_{\Cbb^n}$ is similar to the role that WDT plays in the proof that $\scr O_{\Cbb^n,0}$ is Noetherian.






\begin{lm}\label{lb69}
Assume that $X$ is an open subset of $\Cbb^n$. Assume that for each open connected $U\subset X$ and each non-zero $h\in\scr O(U)$, $\scr O_U/h\scr O_U$ is a coherent $\scr O_U/h\scr O_U$-module. Then $\scr O_X$ is a coherent $\scr O_X$-module. 
\end{lm}

More precisely, our assumption is that the structure sheaf of $\Specan(\scr O_U/h\scr O_U)$ is coherent.

\begin{proof}
Choose any open connected $U\subset X$ and $h_1,\dots,h_N\in\scr O(U)$. We want to show that $\Rel(h_1,\dots,h_N)$ is a finite-type $\scr O_U$-submodule of $\scr O_U^N$. We assume one of $h_1,\dots,h_N$ is non-zero, say $h_1\neq 0$; otherwise the proof is obvious. For each $f\in\scr O_U$, we let $[f]$ denotes its residue class in $\scr O_Y=(\scr O_U/h_1\scr O_U)\uph_{N(h_1\scr O_U)}$ where $Y=\Specan(\scr O_U/h_1\scr O_U)$.

Choose any $x\in U$. By assumption, $\scr O_Y$ is coherent. So $\Rel([h_2],\dots,[h_N])$ is a finite type $\scr O_Y$-submodule of $\scr O_Y^{N-1}$. Thus, after shrinking $U$ to a smaller neighborhood of $x$, we may find $(s_2^i,\dots,s_N^i)\in\scr O(U)$ (for finitely many $i$) such that $([s_2^i],\dots,[s_N^i])$ generate $\Rel([h_2],\dots [h_N])$. This means:
\begin{enumerate}[label=(\alph*)]
\item For each $i$, $s_2^ih_2+\cdots+s_N^ih_N\in h_1\scr O_U$. (This can be checked at the level of stalks.)
\item For each $y\in U$ and $(\sigma_2,\dots,\sigma_N)\in\scr O_{U,y}^{N-1}$ such that
\begin{align*}
\sigma_2h_2+\cdots+\sigma_N h_N\in h_1\scr O_{U,y},
\end{align*}
there exist $f_i\in\scr O_{U,y}$ for all $i$ and $g_2,\dots,g_N\in\scr O_{U,y}$ such that
\begin{align}
(\sigma_2,\dots,\sigma_N)=\sum_i f_i(s_2^i,\dots,s_N^i)+h_1(g_2,\dots,g_N).
\end{align}
\end{enumerate}

By (a), we may shrink $U$ further so that for each $i$, we may find $s_1^i\in\scr O(U)$ such that $s_1^ih_1+s_2^ih_2+\cdots+s_N^ih_N=0$. We claim that
\begin{align*}
(s_1^i,\dots,s_N^i)
\end{align*}
for all $i$ and 
\begin{align*}
(-h_2,h_1,0,\dots,0),\quad(-h_3,0,h_1,\dots,0),\quad\dots,\quad(-h_N,0,0,\dots,h_1)
\end{align*}
(which are clearly in $\Rel(h_1,h_2,\dots,h_N)$) generate $\Rel(h_1,h_2,\dots,h_N)$. 

Choose any $y\in U$ and $(\sigma_1,\dots,\sigma_N)\in\scr O_{U,y}^N$ in $\Rel(h_1,\dots,h_N)_y$, namely $\sigma_1h_1+\cdots+\sigma_Nh_N=0$. Then by (b), we can find $f_i,g_2,\dots,g_N\in\scr O_{U,y}$ such that the relation
\begin{align}
(\sigma_1,\sigma_2,\dots,\sigma_N)=&\sum_i f_i(s_1^i,s_2^i,\dots,s_N^i)\nonumber\\
&+\sum_{j=2}^N g_j(-h_j,0,\dots,\underset{
\begin{subarray}{c}
\uparrow\\
i\text{-th component}
\end{subarray}}{h_1},\dots,0)\label{eq34}
\end{align}
holds for the last $N-1$ components. To show that it holds also for the first component, we write the RHS of \eqref{eq34} as $(\wtd\sigma_1,\sigma_2,\dots,\sigma_N)$, which is an element of $\Rel(h_1,\dots,h_N)_y$. So
\begin{align*}
\sigma_1h_1+\sigma_2h_2\cdots+\sigma_Nh_N=\wtd\sigma_1h_1+\sigma_2h_2\cdots+\sigma_Nh_N=0,
\end{align*}
which shows $(\sigma_1-\wtd\sigma_1)h_1=0$. Since $h_1$ is a non-zero element of $\scr O(U)$, by the Identit\"atssatz \ref{lb68}, the germ of $h_1$ at $\scr O_{U,y}$ is non-zero. So $\sigma_1=\wtd\sigma_1$ since $\scr O_{U,y}$ is an integral domain. This proves \eqref{eq34}.
\end{proof}



\index{00@Oka's coherence theorem}
\begin{thm}[\textbf{Oka's coherence theorem}]\label{lb86}
For every complex space $X$, $\scr O_X$ is a coherent $\scr O_X$-module.
\end{thm}


\begin{proof}
We prove the coherence of $\scr O_{\Cbb^m}$ by induction on $m$. The case $m=0$ is obvious. Assume that $\scr O_{\Cbb^m}$ is coherent. Let us prove that $\scr O_{\Cbb^{m+1}}$ is coherent.

By Lemma \ref{lb69}, it suffices to show that for each open connected $U\subset \Cbb^{m+1}$ and non-zero $h\in\scr O(U)$, if we write $Y=\Specan(\scr O_U/h\scr O_U)$ then $\scr O_Y$ is a coherent $\scr O_Y$-module. Let $\scr K$ be the kernel of a morphism $\scr O_Y^N\rightarrow\scr O_Y$. Then we have an exact sequence of $\scr O_Y$-modules
\begin{align*}
0\rightarrow\scr K\rightarrow\scr O_Y^N\rightarrow\scr O_Y.
\end{align*}
We need to show that for each $x\in U$, say $x=0$, after shrinking $U$ to a neighborhood of $x$, $\scr K$ is $\scr O_U$-generated by finitely many elements of $\scr K(U)$.

The germ of $h$ in $\scr O_{U,x}$ is non-zero by the Identit\"atssatz \ref{lb68}. Thus, by choosing a new set of coordinates $(z,t_1,\dots,t_m)$ of $U$ such that $x=0$, we may assume that the germ of $h$ at $0$, which is an element of $\Cbb\{z,t_1,\dots,t_m\}$, has finite order $n$ in $z$. (Cf. the proof of Thm. \ref{lb70}). Thus, by WPT, after shrinking $U$ to a smaller neighborhood of $0$ we may assume that $h\in\Cbb\{t_\blt\}[z]$ is a Weierstrass polynomial of degree=order $n$ in $z$.

We assume $U=V\times W$ where $V\subset\Cbb$ and $W\subset\Cbb^m$ are neighborhoods of $0$. By Rem. \ref{lb16}, we may assume that $N(h)=\{(z,t_\blt)\in\Cbb\times W:h(z,t_\blt)=0\}$ is like Fig. \ref{fig1}: for each $(t_\blt)\in W$, the polynomial $h(z,t_\blt)$ of $z$ has $n$ zeros in $V$ counting multiplicities. Thus $N(h)\subset U$. Therefore
\begin{align*}
\scr O_U/h\scr O_U=\scr O_{\Cbb\times W}/h\scr O_{\Cbb\times W}.
\end{align*}
So the projection of $\pi:Y\rightarrow W$ (inherited from $\Cbb\times W\rightarrow W$) is a Weierstrass map. By the Fundamental Thm. \ref{lb60} of Weierstrass maps, $\pi_*\scr O_Y$ and hence $\pi_*(\scr O_Y^N)=(\pi_*\scr O_Y)^N$ are $\scr O_W$-free. So they are $\scr O_W$-coherent \emph{by our assumption that $\scr O_{\Cbb^m}$ is coherent}.  Therefore $\pi_*\scr K$ is $\scr O_W$-coherent by Cor. \ref{lb46} and the exactness of
\begin{align*}
0\rightarrow\pi_*\scr K\rightarrow \pi_*\scr O_Y^N\rightarrow\pi_*\scr O_Y.
\end{align*}
So $\scr K$ is $\scr O_Y$-finite-type by the following lemma.
\end{proof}


\begin{lm}\label{lb85}
Let $\pi:X\rightarrow S$ be a finite morphism of $\Cbb$-ringed spaces, and let $\scr E$ be an $\scr O_X$-module. If $\pi_*\scr E$ is $\scr O_S$-finite-type, then $\scr E$ is $\scr O_X$-finite-type.
\end{lm}


\begin{proof}
Choose any $t\in S$. By shrinking $S$ to a neighborhood of $t$ (and shrinking $X$ to $\pi^{-1}(S)$), we can find $\sigma_1,\dots,\sigma_k\in\scr E(X)=(\pi_*\scr E)(S)$ which $\scr O_S$-generate $\pi_*\scr E$. For each $x\in X$, by Prop. \ref{lb56}, $\scr E_x$ is a direct summand of the $\scr O_{S,\pi(x)}$-module $(\pi_*\scr E)_{\pi(x)}$. So $\scr E_x$ is $\scr O_{S,\pi(x)}$-generated (and hence $\scr O_{X,x}$-generated) by $\sigma_1,\dots,\sigma_k$. This proves that $\scr E$ is $\scr O_X$-generated by $\sigma_1,\dots,\sigma_k$.
\end{proof}


\begin{co}
Let $X$ be a complex space. An ideal of $\scr O_X$ is finite-type if and only if it is coherent.
\end{co}



\section{Finite mapping theorem}

The following two theorems are the main results of this section.


\begin{thm}[\textbf{Finite mapping theorem}]\label{lb74}
Let $\pi:X\rightarrow S$ be a finite holomorphic map of complex spaces, and let $\scr E$ be an $\scr O_X$-module. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\scr E$ is $\scr O_X$-coherent.
\item $\pi_*\scr E$ is $\scr O_S$-coherent.
\end{enumerate}
\end{thm}


\begin{thm}\label{lb75}
Let $\pi:X\rightarrow S$ be a holomorphic map of complex spaces. Let $t\in S$, and assume that $x\in\pi^{-1}(t)$ is an isolated point of $\pi^{-1}(t)$. Then there are neighborhoods $U\subset X$ of $x$ and $W\subset S$ of $\pi(U)$ such that $\pi$ restricts to a finite holomorphic map $\pi:U\rightarrow W$.
\end{thm}

\begin{rem}
It follows immediately from Thm. \ref{lb75} that if $\pi:X\rightarrow S$ is holomorphic and if $t\in S$ is such that $\pi^{-1}(t)$ is a finite set, then there are neighborhoods $U\subset X$ of $\pi^{-1}(t)$ and $W\subset S$ of $\pi(U)$ such that the restriction $\pi:U\rightarrow W$ is finite. 
\end{rem}


\begin{co}\label{lb173}
Let $X$ be a complex space which, as a set, is $\{x\}$. Then an $\scr O_X$-module $\scr E$ is $\scr O_X$-coherent if and only if $\scr E$ (or more precisely $\scr E(\{x\})$) is a finite-dimensional vector space.
\end{co}

\begin{proof}
Let $\pi:X\rightarrow\{0\}$ be the obvious map where $\{0\}$ is the reduced single point. (Note that $x$ is not assumed to be reduced.) Then $\pi$ is clearly finite. That $\scr E$ is finite-dimensional is equivalent to that $\pi_*\scr E$ is $\scr O_{\{0\}}$-coherent. Thus the proof is finished by Thm. \ref{lb74}.
\end{proof}






\subsection{Proof of the main results}



We begin with the following preliminary lemma.

\begin{lm}\label{lb72}
Given a finite holomorphic $\pi:X\rightarrow S$, if $\pi_*\scr O_X$ is $\scr O_S$-coherent, then for each coherent $\scr O_X$-module $\scr E$, $\pi_*\scr E$ is $\scr O_S$-coherent.
\end{lm}

\begin{proof}
Choose any $t\in S$. By Lemma \ref{lb87}, we can shrink $S$ to a neighborhood of $t$ and shrink $X$ to $\pi^{-1}(S)$ so that $\scr E\simeq\Cok(\scr O_X^m\rightarrow\scr O_X^n)$ for a morphism $\scr O_X^m\rightarrow\scr O_X^n$.
Thus, by the (right) exactness of $\pi_*$ (Cor. \ref{lb71}), $\pi_*\scr E\simeq\Cok(\pi_*\scr O_X^m\rightarrow\pi_*\scr O_X^n)$, which is coherent since $\pi_*\scr O_X$ is coherent.
\end{proof}









The crucial part of the proof is the following lemma.

\begin{lm}\label{lb78}
Choose open subsets $R\subset\Cbb^k$ and $S\subset \Cbb^m$. Let $X=\Specan(\scr O_{R\times S}/\mc I)$ where $\mc I$ is a coherent ideal of $\scr O_{R\times S}$. Let $\pi:X\rightarrow S$ be the holomorphic map restricted from the projection $R\times S\rightarrow S$. Let $t\in S$ and assume that $x\in\pi^{-1}(t)$ is an isolated point of $\pi^{-1}(t)$. Then there are neighborhoods $U\subset R$ of $x$ and $W\subset S$ of $\pi(U)$ such that the restriction $\pi:(U\times W)\cap X\rightarrow W$ is finite, and that $\pi_*\scr O_{(U\times W)\cap X}$ is $\scr O_W$-coherent.
\end{lm}


We assume $x=0_R$ and $t=0_S$ for simplicity, and prove the lemma by induction on $k$. 

\begin{proof}[Proof for the case $k=1$]
Shrink $R$ to a neighborhood of $0_R$ such that $\pi^{-1}(0_S)=(R\times 0_S)\cap N(\mc I)$ is $\{0\}$. So we may shrink $R$ further so that we can find $f\in\mc I(R\times S)$ such that $(R\times 0_S)\cap N(f)=\{0\}$. So $f$, as an element of $\Cbb\{z,t_1,\dots,t_m\}$, has finite order in $z$. So we may shrink $R,S$ further and replace $f$ by a Weierstrass polynomial of $z$, which we still denote by $f$.

Let $\mc J=f\scr O_{R\times S}$ and $Y=\Specan(\scr O_{R\times S}/\mc J)$. Let $\wtd\pi:Y\rightarrow S$ be the restriction of $R\times S\rightarrow S$ to $Y$. As in the proof of Oka's coherence theorem, we may shrink $R$ and $S$ so that Fig. \ref{fig1} holds, and hence that $\wtd \pi$ is a Weierstrass map.  So $\pi=\wtd\pi\circ\iota_{X,Y}$ is finite since both $\wtd\pi$ and the inclusion map $\iota=\iota_{X,Y}$ are finite.

By the Fundamental Thm. \ref{lb60} of Weierstrass maps (and Oka's coherence theorem), $\wtd\pi_*\scr O_Y$ is $\scr O_S$-coherent. So by Lemma \ref{lb72}, $\wtd\pi_*$ sends coherent $\scr O_Y$-modules to coherent $\scr O_S$-modules. But $\iota_*\scr O_X$ is $\scr O_Y$-coherent by Extension principle \ref{lb73}. So $\pi_*\scr O_X=\wtd\pi_*\iota_*\scr O_X$ is $\scr O_S$-coherent.
\end{proof}



\begin{proof}[Proof that case $k$ $\Rightarrow$ case $k+1$]
Assume that case $k$ is true. Now assume $R$ is an open subset of $\Cbb^{k+1}$. By shrinking $R$ to a neighborhood of $0_R$ we assume $R=U\times V$ where $U\subset\Cbb$ and $V\subset\Cbb^k$ are open subsets containing $0_\Cbb$ and $0_{\Cbb^k}$ respectively, and that $\pi^{-1}(0_S)=(U\times V\times 0_S)\cap N(\mc I)$ equals $\{0\}$. 

Let $\alpha:X\rightarrow V\times S$ be the restriction of the projection $U\times V\times S\rightarrow V\times S$. Then $\alpha^{-1}(0_{V\times S})=(U\times 0_V\times 0_S)\times N(\mc I)$ is $\{0\}$. So by the case $k=1$, we may shrink $U,V,S$ to smaller neighborhoods of $0_U,0_V,0_S$ respectively so that $\alpha$ is finite and $\alpha_*\scr O_X$ is $\scr O_{V\times S}$-coherent. By Def. \ref{lb76}, we can define the image space $\alpha(X)$  whose underlying topological space is $\Imag(\alpha)$, and by Prop. \ref{lb77}, $\alpha$ factors as the composition of a holomorphic $\wtd\alpha:X\rightarrow\alpha(X)$ and the inclusion $\alpha(X)\hookrightarrow V\times S$. We thus obtain a commutative diagram
\begin{equation*}
\begin{tikzcd}[row sep=small,column sep=large]
                                                             & V\times S \arrow[rd, "\pr_S"]                     &   \\
X=\Specan(\scr O_{U\times V\times S}/\mc I) \arrow[ru, "\alpha", shift left] \arrow[rd, "\wtd\alpha"'] &                                                   & S \\
                                                             & \alpha(X) \arrow[ru, "\wtd\pi"'] \arrow[uu, hook, "\iota"'] &  
\end{tikzcd}
\end{equation*}
where $\wtd\pi$ is the restriction of $\pr_S$ to $\alpha(X)$. We have $\pi=\pr_S\circ\alpha=\wtd\pi\circ\wtd\alpha$.

Clearly $\wtd\pi^{-1}(0_S)=\{0_{V\times S}\}$. Thus, by our assumption on case $k$, we may shrink $V,S$ so that $\wtd\pi$ is finite and (by Lemma \ref{lb72}) $\wtd\pi_*$ sends coherent $\scr O_{\alpha(X)}$-modules to coherent $\scr O_S$-modules. Note that we still have that $\alpha$ is finite and $\iota_*\wtd\alpha_*\scr O_X=\alpha_*\scr O_X$ is $\scr O_{V\times S}$-coherent after shrinking $V,S$ (but not shrinking $U$). So $\wtd\alpha$ is finite, and by Extension principle \ref{lb73}, $\wtd\alpha_*\scr O_X$ is $\scr O_{\alpha(X)}$-coherent. So $\pi=\wtd\pi\circ\wtd\alpha$ is finite, and $\pi_*\scr O_X=\wtd\pi_*\wtd\alpha_*\scr O_X$ is $\scr O_S$-coherent. We are done with the proof of Lemma \ref{lb78}.
\end{proof}



We are now ready to prove Thm. \ref{lb75} and more:

\begin{lm}\label{lb82}
Thm. \ref{lb75} is true. Moreover, in Thm. \ref{lb75}, $U$ and $W$ can be chosen so that (besides that $\pi$ is finite) $\pi_*\scr O_U$ is also $\scr O_W$-coherent.
\end{lm}


\begin{proof}
It suffices to assume that $X$ is a model space, say a closed subspace of an open $R\subset\Cbb^k$. We first assume $S$ is an open subset of $\Cbb^m$. Define $\varphi:X\rightarrow R\times S$ so that the following triangular diagram commutes
\begin{equation*}
\begin{tikzcd}[row sep=small]
                        & X\times S \arrow[rd,"\iota_{X,R}\times\id"] &                     &   \\
X \arrow[ru,"\id\vee\pi"] \arrow[rr,"\varphi"'] &                      & R\times S \arrow[r,"\pr_S"'] & S
\end{tikzcd}
\end{equation*}
By Prop. \ref{lb80} and Prop. \ref{lb32}, $\id\vee\pi$ and $\iota_{X,R}\vee\id$ are closed embeddings. So their composition $\varphi$ is a closed embedding (Cor. \ref{lb81}). By Prop. \ref{lb30},
\begin{align*}
\pr_S\circ\varphi=\pr_S\circ(\iota\times\id)\circ(\id\vee\pi)=\pr_S\circ (\iota\vee\pi)=\pi.
\end{align*}
Thus, by identifying $X$ with $\varphi(X)$, the assumptions of Lemma \ref{lb78} are satisfied. The conclusions of Lemma \ref{lb78} prove what we want to prove.

In the general case, we may shrink $S$ (and shrink $X$ accordingly) so that $S$ is a closed subspace of an open $\Omega\subset\Cbb^m$. Let $\iota:S\rightarrow\Omega$ be the inclusion. Then by shrinking $X$ and $\Omega$ (and $S$ accordingly) to neighborhoods of any given points, $\iota\circ\pi:X\rightarrow\Omega$ is finite and $\iota_*\pi_*\scr O_X$ is $\scr O_\Omega$-coherent. Clearly $\pi$ is finite, and by Extension principle \ref{lb73}, $\pi_*\scr O_X$ is $\scr O_S$-coherent.
\end{proof}



\begin{proof}[\textbf{Proof of Thm. \ref{lb74}, (1)$\Rightarrow$(2)}]
Let us prove that $\pi_*\scr O_X$ is coherent. Choose any $t\in S$. By Lemma \ref{lb82}, for each $x\in\pi^{-1}(t)$ we can choose neighborhoods $U_x\ni x$ and $W_x\supset \pi(U_x)$ such that $\pi_*\scr O_{U_x}$ is $\scr O_{W_x}$-coherent, and that $U_x\cap U_{x'}=\emptyset$ if $x\neq x'$. So for each open $W\subset \bigcap_{x\in\pi^{-1}(t)}W_x$, we have that $\pi_*\scr O_{U_x\cap\pi^{-1}(W)}$ is $\scr O_W$-coherent. Therefore, if we set $U=\bigcup_{x\in\pi^{-1}(t)}U_x$, then
\begin{align*}
\pi_*\scr O_{U\cap\pi^{-1}(W)}\simeq\bigoplus_{x\in\pi^{-1}(t)}\pi_*\scr O_{U_x\cap\pi^{-1}(W)}
\end{align*}
is $\scr O_W$-coherent.

Since $\pi:X\rightarrow S$ is finite, by Prop. \ref{lb54}, there is a neighborhood $W\ni t$ inside $\bigcap_{x\in\pi^{-1}(t)}W_x$ such that $\pi^{-1}(W)=U\cap\pi^{-1}(W)$. So $\pi_*\scr O_{\pi^{-1}(W)}=(\pi_*\scr O_X)|_W$ is $\scr O_W$-coherent.
\end{proof}


The proof of (2)$\Rightarrow$(1) is similar to that of Oka's coherence Thm. \ref{lb86}:
\begin{proof}[\textbf{Proof of Thm. \ref{lb74}, (2)$\Rightarrow$(1)}]
Assume that $\pi_*\scr E$ is coherent. Then $\scr E$ is $\scr O_X$-finite-type by Lemma \ref{lb85}. Let us show that the sheaves of relations of $\scr E$ are finite-type. By Prop. \ref{lb54} or Rem. \ref{lb55}, we have a neighborhood $W$ of $t$ such that
\begin{align*}
\pi^{-1}(W)=\coprod_{x\in\pi^{-1}(t)}U_x
\end{align*}
where each $U_x$ is a small enough neighborhood of $y$. Shrink $Y$ to $W$ and $X$ to $\pi^{-1}(W)$.  So we have an equivalence of $\scr O_W$-modules
\begin{align*}
\pi_*\scr E\simeq\bigoplus_{x\in\pi^{-1}(t)}\pi_*(\scr E|_{U_x}).
\end{align*}


Suppose $\alpha:\scr O_{U_x}^N\rightarrow\scr E_{U_x}$ is a morphism of $\scr O_{U_x}$-modules. Let $\scr K=\Ker(\alpha)$ so that we have an exact
\begin{align*}
0\rightarrow\scr K\rightarrow\scr O_{U_x}^N\rightarrow\scr E_{U_x}.
\end{align*}
We regard $\scr K,\scr O_{U_x},\scr E_{U_x}$ as $\scr O_X$-modules by identifying them with their direct images under $U_x\hookrightarrow X$. Clearly $\scr O_{U_x}$ is $\scr O_X$-coherent. So $\pi_*\scr O_{U_x}$ is $\scr O_S$-coherent. Also $\pi_*\scr E_{U_x}$ is $\scr O_S$-coherent since it is a direct summand of the coherent sheaf $\pi_*\scr E$ (cf. Cor. \ref{lb45}). Thus, the exact sequence of $\scr O_S$-modules
\begin{align*}
0\rightarrow \pi_*\scr K\rightarrow \pi_*\scr O_{U_x}^N\rightarrow\pi_*\scr E_{U_x}
\end{align*}
together with Cor. \ref{lb46} show that $\pi_*\scr K$ is $\scr O_S$-coherent. Therefore, by Lemma \ref{lb85}, $\scr K$ is $\scr O_X$-finite-type.
\end{proof}



We are done with the proofs of Thm. \ref{lb74} and \ref{lb75}. In the following, we give some applications.


\subsection{Applications}


\begin{co}\label{lb84}
Let $\varphi:X\rightarrow Y$ be a holomorphic map of complex spaces. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is a closed embedding.
\item $\varphi$ is an immersion of complex spaces, and it is a closed and injective map of topological spaces.
\end{enumerate}
\end{co}

\begin{proof}
(1)$\Rightarrow$(2) is obvious. Assume (2). Then as $\varphi$ is finite, $\varphi_*\scr O_X$ is $\scr O_Y$-coherent. By \eqref{eq37}, the coherent ideal
\begin{align*}
\mc J=\sann_{\scr O_Y}(\varphi_*\scr O_X)
\end{align*}
satisfies the assumptions in Prop. \ref{lb14}. Thus (1) follows from Prop. \ref{lb14}.
\end{proof}



Rem. \ref{lb40} tells us that any holomorphic map factors as the composition of a closed embedding and the projection of a direct product. When the holomorphic map is finite, such decomposition might not be useful because, although closed embeddings are finite, projections are usually not. The following proposition gives a refinement of this decomposition. It says that any finite holomorphic map locally factors as the composition of a closed embedding and a Weierstrass map. This result will be used e.g. in the proof of Base change Thm. \ref{lb94}.


\begin{pp}\label{lb89}
Let $\pi:X\rightarrow S$ be a finite holomorphic map of complex spaces. Then each $t\in S$ is contained in a neighborhood $W\subset S$ such that the restriction $\pi:\pi^{-1}(W)\rightarrow W$ is equivalent to the restriction of a Weierstrass map. More precisely, there exist a Weierstrass map $\kappa:Y\rightarrow W$ and a closed embedding $\varphi:\pi^{-1}(W)\rightarrow Y$ such that the following diagram commutes.
\begin{equation}
\begin{tikzcd}[column sep=small]
\pi^{-1}(W) \arrow[rd,"\pi"'] \arrow[rr,"\varphi"] &   & Y \arrow[ld,"\kappa"] \\
                        & W &             
\end{tikzcd}
\end{equation} 
\end{pp}



\begin{proof}[Proof-Step 1]
By Finite mapping theorem, $\pi_*\scr O_X$ is coherent. So we may shrink $S$ to a neighborhood of $t$ and shrink $X$ accordingly (i.e. replace $X$ by the new $\pi^{-1}(S)$) so that $\pi_*\scr O_X$ is $\scr O_S$-generated by $f_1,\dots,f_k\in\scr O(X)$. Consider $F=(f_1,\dots,f_k)$ as a holomorphic map $F:X\rightarrow\Cbb^k$ (Thm. \ref{lb7}). Then we have a commutative diagram
\begin{equation}\label{eq38}
\begin{tikzcd}[column sep=small]
X\arrow[rd,"\pi"'] \arrow[rr,"F\vee\pi"] &   & \Cbb^k\times S \arrow[ld,"\pr_S"] \\
                        & S &             
\end{tikzcd}
\end{equation}
We want to show that $F\vee\pi$ is a closed embedding.

Since $\pi$ is closed, one checks easily using \eqref{eq38} that $F\vee\pi$ is closed. To show that $F\vee\pi$ is injective, it suffices to show that $F$ is injective when restricted to each fiber $\pi^{-1}(\tau)$ (where $\tau\in S$). By Prop. \ref{lb56}, we have
\begin{align}
(\pi_*\scr O_X)_\tau\simeq\bigoplus_{x\in\pi^{-1}(\tau)}\scr O_{X,x}\label{eq39}
\end{align}
which is $\scr O_{S,s}$-generated by $f_1,\dots,f_k$. If $x,x'\in\pi^{-1}(\tau)$ and $x\neq x'$, then an $\scr O_{S,\tau}$-linear combination of $f_1,\dots,f_k$ is $1$ in $\scr O_{X,x}$ and $0$ in $\scr O_{X,x'}$. So a $\Cbb$-linear combination of $f_1,\dots,f_k$ takes value $1$ at $x$ and $0$ at $x'$. So $F(x)\neq F(x')$. To show that $F\vee\pi$ is an immersion, note that by \eqref{eq39}, the $\Cbb$-algebra morphism
\begin{align*}
F^\#:\scr O_{\Cbb^k,F(x)}\rightarrow \scr O_{X,x}
\end{align*}
sends $z_1,\dots,z_k$ to (the germs at $x$ of) $f_1,\dots,f_k$ respectively. So the morphism
\begin{align*}
(F\vee\pi)^\#:\scr O_{\Cbb^k\times S,x\times \tau}=\scr O_{\Cbb^k,x}\wht\otimes\scr O_{S,\tau} \longrightarrow \scr O_{X,x}
\end{align*}
sends $z_i\otimes h$ (where $h\in\scr O_{S,\tau}$) to $h\cdot f_i$. Thus, this morphism is surjective since $\scr O_{X,x}$ is $\scr O_{S,\tau}$-generated by $f_1,\dots,f_k$. So $F\vee\pi$ is an immersion. By Cor. \ref{lb84}, $F\vee\pi$ is a closed embedding.
\end{proof}


\begin{proof}[Proof-Step 2]
Since $(\pi_*\scr O_X)_t$ is a finitely generated module of the Noetherian ring $\scr O_{S,t}$, for each $i$, the $\scr O_{S,t}$-submodule of $(\pi_*\scr O_X)_t$ generated by all non-negative powers of $f_i$ is finitely generated. So $f_i$ is \textbf{integral over} $\scr O_{S,t}$. Namely, we may find $n_i\in\Zbb_+$ such that
\begin{align}
a_{i,0}+a_{i,1}f_i+\cdots+a_{i,n_i-1}f_i^{n_i-1}+f_i^{n_i}=0 \label{eq40}
\end{align}
where each $a_{i,j}\in\scr O_{S,t}$. 

Shrink $S$ to a neighborhood of $t$ (and shrink $X$ to $\pi^{-1}(S)$) so that all $a_{i,j}$ are elements of $\scr O(S)$, and that \eqref{eq40} holds at the level of $\scr O(X)$. Then
\begin{align*}
p_i(z_i)=a_{i_0}+a_{i,1}z_i+\cdots+a_{i,n_i-1}z_i^{n_i-1}+z_i^{n_i}
\end{align*}
is a monic polynomial of $z_i$, viewed as in $\scr O(\Cbb^k\times S)$. Note that $F\vee\pi$ is still a closed embedding. We let $\mc I$ be the ideal of $\scr O_{\Cbb^k\times S}$ generated by $p_1,\dots,p_k$, and let $Y=\Specan(\scr O_{\Cbb^k\times S}/\mc I)$. Then $\pr_S:\Cbb^k\times S\rightarrow S$ restricts to a Weierstrass map $\kappa:Y\rightarrow S$. By Thm. \ref{lb13}, $F\vee\pi:X\rightarrow\Cbb^k\times S$ restricts to $\varphi:X\rightarrow Y$, which is clearly a closed embedding. And we clearly have a commutative diagram
\begin{equation*}
\begin{tikzcd}[column sep=tiny]
X \arrow[rd,"\pi"'] \arrow[rr,"\varphi"] &   & Y \arrow[ld,"\kappa"] \\
                        & S &             
\end{tikzcd}
\end{equation*}
This finishes the proof.
\end{proof}








\section{Base change theorem for finite holomorphic maps}



In algebraic geometry, if $X,Y,S$ are affine schemes, then $\scr O(X\times_SY)\simeq\scr O(X)\otimes_{\scr O(S)}\scr O(Y)$. In complex analytic geometry, fiber products are in general related to completed tensor products. But in the case that one holomorphic map is finite, the usual (algebraic) tensor products are sufficient. The goal of this section is to explore the relationship between $X\times_SY$ and tensor products in the analytic setting and at the level of stalks. This goal will be achieved in Cor. \ref{lb97} which is crucial to the future proof that ``flatness of holomorphic maps is preserved by base change". We shall prove Cor. \ref{lb97} as a consequence of the Base change theorem of finite holomorphic maps.



\subsection{The setting}\label{lb93}

Consider a Cartesian square of holomorphic maps of complex spaces.
\begin{equation}\label{eq46}
\begin{tikzcd}
X \arrow[d, "\pi"'] & X\times_SY \arrow[l, "\pr_X"'] \arrow[d, "\pr_Y"] \\
S                       & Y \arrow[l, "\psi"']                              
\end{tikzcd}
\end{equation}
Let $\scr E$ be an $\scr O_X$-module. Then we have an $\scr O_Y$-module morphism
\begin{align}
\Psi:\psi^*\pi_*\scr E\longrightarrow \pr_{Y,*}\pr_X^*\scr E,
\end{align}
namely, a morphism
\begin{align}\label{eq43}
\Psi:(\pi_*\scr E)\otimes_{\scr O_S}\scr O_Y\longrightarrow \pr_{Y,*}(\scr E\otimes_{\scr O_X}\scr O_{X\times_SY})
\end{align}
such that for each open $V\subset Y$ and each open $W\subset S$ containing $\psi(V)$, $\Psi$ sends
\begin{align}
\sigma\otimes g\qquad\in \scr E(\pi^{-1}(W))\otimes_{\scr O_S(W)}\scr O_Y(V)
\end{align}
to
\begin{align}
\sigma\otimes \pr_Y^\#g\qquad\in\scr E(\pi^{-1}(W))\otimes_{\scr O_X(\pi^{-1}(W))}\scr O_{X\times_SY}(\pr_Y^{-1}(V)).
\end{align}
(Note that $\pr_X(\pr_Y^{-1}(V))\subset\pi^{-1}(W)$.) It is easy to see that $\Psi$ is functorial. We call $\Psi$ the \textbf{base change morphism}.


\begin{rem}
The stalk map of $\Psi$ at each $y\in Y$ is the $\scr O_{Y,y}$-module morphism determined by
\begin{gather}\label{eq41}
\begin{gathered}
\Psi:(\pi_*\scr E)_{\psi(y)}\otimes_{\scr O_{S,\psi(y)}}\scr O_{Y,y}\longrightarrow \pr_{Y,*}(\scr E\otimes_{\scr O_X}\scr O_{X\times_SY})_y\\[0.8ex]
\sigma\otimes 1\quad\mapsto\quad \sigma\otimes 1
\end{gathered}
\end{gather}
\end{rem}






\subsection{Base change theorem}




The following theorem is the main result of this section. Note that in the Cartesian square \eqref{eq46}, if $\pi$ is finite then $\pr_Y$ is finite (Prop. \ref{lb91}).



\begin{thm}[\textbf{Base change theorem}]\label{lb94}
In the setting of Subsec. \ref{lb93}, assume that $\pi:X\rightarrow S$ is finite and $\scr E$ is a coherent $\scr O_X$-module. Then the base change morphism $\Psi$ (cf. \eqref{eq43}) is an isomorphism of $\scr O_Y$-modules.
\end{thm}


Note that this theorem is local by nature. Namely, in the proof we may shrink $S$ to a neighborhood of any given point, and replace $X$ by $\pi^{-1}(S)$ and $Y$ by $\psi^{-1}(S)$. 

%Moreover, in that case we have $X\times_SY=X\times_\Omega Y$, and $\otimes_{\scr O_{S,\psi(y)}}$ equals $\otimes_{\scr O_{\Omega,\psi(y)}}$ since $\scr O_{\Omega,\psi(y)}\rightarrow\scr O_{S,\psi(y)}$ is surjective. Thus, in the proof of Base change theorem we may replace $S$ by $\Omega$. In other words, we may assume without loss of generality that $S$ itself is an open subset of $\Cbb^m$.

In the special case that $\scr E=\scr O_X$, we have:

\begin{co}\label{lb95}
Let \eqref{eq46} be a Cartesian square of holomorphic maps of complex spaces. Assume that $\pi:X\rightarrow S$ is finite. Then we have an $\scr O_Y$-module isomorphism
\begin{align}\label{eq44}
\Psi:(\pi_*\scr O_X)\otimes_{\scr O_S}\scr O_Y\xlongrightarrow{\simeq} \pr_{Y,*}\scr O_{X\times_SY}
\end{align}
whose stalk map at each $y\in Y$ is an $\scr O_{Y,y}$-module morphism determined by
\begin{gather}\label{eq45}
\begin{gathered}
\Psi:(\pi_*\scr O_X)_{\psi(y)}\otimes_{\scr O_{S,\psi(y)}}\scr O_{Y,y}\longrightarrow \pr_{Y,*}(\scr O_{X\times_SY})_y\\[0.8ex]
f\otimes 1\quad\mapsto\quad \pr_X^\#f
\end{gathered}
\end{gather}
\end{co}


\begin{co}\label{lb97}
Let \eqref{eq46} be a Cartesian square, and assume that $\pi:X\rightarrow S$ is finite. Then for each $x\in X$ and $y\in Y$ such that $\pi(x)$ equals $t=\psi(y)$, there is an isomorphism of $\scr O_{S,t}$-modules
 \begin{gather}\label{eq48}
\begin{gathered}
\scr O_{X,x}\otimes_{\scr O_{S,t}}\scr O_{Y,y}\xlongrightarrow{\simeq} \scr O_{X\times_SY,x\times y}\\[0.8ex]
f\otimes g\quad\mapsto\quad \pr_X^\#f\cdot \pr_Y^\#g
\end{gathered}
\end{gather}
\end{co}

\begin{proof}[First Proof]
By Thm. \ref{lb75}, we may shrink $X$ and $S$ to neighborhoods of $x$ and $t$ respectively, and shrink $Y$ to $\psi^{-1}(S)$, so that $\pi^{-1}(t)=\{x\}$ (as sets) and $\pi$ is still finite. Then in view of Prop. \ref{lb56}, we see that \eqref{eq45} becomes exactly \eqref{eq48}.
\end{proof}

\begin{proof}[Second Proof]
By Prop. \ref{lb56}, for each $y$ and $t=\psi(y)$, \eqref{eq45} is precisely the direct sum of \eqref{eq48} over all $x\in \pi^{-1}(t)=\pr_Y^{-1}(y)$. 
\end{proof}

The second proof shows that Cor. \ref{lb95} and Cor. \ref{lb97} are indeed equivalent.




\subsection{Proof of Base change Thm. \ref{lb94}}


\begin{lm}\label{lb96}
Assume that Thm. \ref{lb94} holds when $\scr E=\scr O_X$. Then Thm. \ref{lb94} holds for any coherent $\scr O_X$-module $\scr E$.
\end{lm}

\begin{proof}
If Thm. \ref{lb94} holds when $\scr E=\scr O_X$, then it holds when $\scr E$ is $\scr O_X$-free. Now in the general case, by Lemma \ref{lb87} we can assume that $S$ is so small that there is an exact sequence of $\scr O_X$-modules
\begin{align*}
\scr F\rightarrow\scr G\rightarrow\scr E\rightarrow0
\end{align*}
where $\scr F$ and $\scr G$ are $\scr O_X$-free. By the right exactness of $\psi^*$ and $\pi_*$ (Cor. \ref{lb71}), we have an exact sequence
\begin{align*}
\psi^*\pi_*\scr F\rightarrow\psi^*\pi_*\scr G\rightarrow\psi^*\pi_*\scr E\rightarrow0.
\end{align*}
Since the base change map $\Psi$ is functorial, we have a commutative diagram
\begin{equation*}
\begin{tikzcd}
\psi^*\pi_*\scr F \arrow[r] \arrow[d,"\Psi"',"\simeq"] & \psi^*\pi_*\scr G \arrow[r] \arrow[d,"\Psi"',"\simeq"] & \psi^*\pi_*\scr E \arrow[r] \arrow[d,"\Psi"'] & 0 \\
\pr_{Y,*}\pr_X^*\scr F \arrow[r]                           & \pr_{Y,*}\pr_X^*\scr G \arrow[r]                           & \pr_{Y,*}\pr_X^*\scr E \arrow[r]                           & 0
\end{tikzcd}
\end{equation*}
where the first two $\Psi$ are isomorphisms by assumption. So the third $\Psi$ is an isomorphism by Five Lemma.
\end{proof}









\begin{lm}
Cor. \ref{lb95} holds if $\pi:X\rightarrow S$ is a Weierstrass map.
\end{lm}


\begin{proof}
By Prop. \ref{lb66}, we may assume that $\pr_Y:X\times_SY\rightarrow Y$ is a Weierstrass map. More precisely, we may assume that \eqref{eq46} factors as
\begin{equation*}
\begin{tikzcd}[row sep=small]
X \arrow[d, hook]        & X\times_SY \arrow[l] \arrow[d, hook] \\
\Cbb^k\times S \arrow[d] & \Cbb^k\times Y \arrow[l] \arrow[d]   \\
S                        & Y \arrow[l]               
\end{tikzcd}
\end{equation*}
where the two small squares are Cartesian. By the Fundamental Thm. \ref{lb60} of Weierstrass maps, $\pi_*\scr O_X$ is $\scr O_S$-freely generated by \eqref{eq32}, and so $(\pi_*\scr O_X)\otimes_{\scr O_S}\scr O_Y$ is $\scr O_Y$-freely generated by  $\eqref{eq32}\otimes 1$. Also, $\pr_{Y,*}\scr O_{X\times_SY}$ is $\scr O_Y$-freely generated by \eqref{eq32}. Using e.g. \eqref{eq45} one checks that $\Psi$ sends the given free generators of $(\pi_*\scr O_X)\otimes_{\scr O_S}\scr O_Y$ bijectively to those of $\pr_{Y,*}\scr O_{X\times_SY}$. So $\Psi$ must be an isomorphism.
\end{proof}


\begin{proof}[\textbf{Proof of Thm. \ref{lb94}}]
By Lemma \ref{lb96}, it suffices to prove Cor. \ref{lb95}. By Prop. \ref{lb89}, we may assume $S$ is so small that $\pi:X\rightarrow S$ factors as $X\hookrightarrow Z\xrightarrow{\wtd\pi}S$ where $X$ is a closed subspace of $Z$ and $\wtd\pi$ is equivalent to a Weierstrass map. Thus, \eqref{eq46} factors as the combination of two Cartesian squares
\begin{equation}\label{eq47}
\begin{tikzcd}[row sep=scriptsize]
X \arrow[d, hook, "\iota"']        & X\times_SY \arrow[l] \arrow[d, hook, "\iota\times\id"] \\
Z \arrow[d, "\wtd\pi"'] & Z\times_S Y \arrow[l] \arrow[d,"\wtd\pr_Y"]   \\
S                        & Y \arrow[l,"\psi"']               
\end{tikzcd}
\end{equation}
where $\pr_Y:X\times_SY\rightarrow Y$ is $\wtd\pr_Y\circ(\iota\times\id)$.

We have proved that Cor. \ref{lb95} holds (and hence Thm. \ref{lb94} holds, cf. Lemma \ref{lb96}) for the lower Cartesian square. Apply Thm. \ref{lb94} to the lower square and the coherent $\scr O_Z$-module $\iota_*\scr O_X$: The domain of the isomorphism $\Psi$ is
\begin{align*}
(\wtd\pi_*\iota_*\scr O_X)\otimes_{\scr O_S}\scr O_Y=\pi_*\scr O_X\otimes_{\scr O_S}\scr O_Y
\end{align*}
and the codomain is
\begin{align*}
\wtd\pr_{Y,*}(\iota_*\scr O_X\otimes_{\scr O_Z}\scr O_{Z\times_SY})\simeq \wtd\pr_{Y,*}\big((\iota\times\id)_*\scr O_{X\times_SY}\big)=\pr_{Y,*}\scr O_{X\times_SY}.
\end{align*}
By checking stalkwisely with the help of \eqref{eq41} and \eqref{eq45} (and possibly Prop. \ref{lb56}), one sees that this morphism (i.e. the base change map for the lower square of \eqref{eq47} and the $\scr O_Z$-module $\iota_*\scr O_X$) agrees with the morphism $\Psi$ in Cor. \ref{lb95}. So the latter must be an isomorphism.
\end{proof}



\section{Analytic spectra $\Specan$}

We fix a complex space $S$.

\subsection{Main results}



\begin{df}
A \textbf{morphism} from a finite holomorphic map $\pi:X\rightarrow S$ to a finite holomorphic $\kappa:Y\rightarrow S$ is a holomorphic map $\varphi:X\rightarrow Y$ such that the following diagram commutes.
\begin{equation}\label{eq50}
\begin{tikzcd}[column sep=tiny]
X \arrow[rd,"\pi"'] \arrow[rr,"\varphi"] &   & Y \arrow[ld,"\kappa"] \\
                        & S &             
\end{tikzcd}
\end{equation}
The set of morphisms is denoted by $\Mor_S(X,Y)$. This defines the \textbf{category of finite holomorphic maps to $S$}.
\end{df}



\begin{df}
An \textbf{$\scr O_S$-algebra} is an $S$-sheaf of $\Cbb$-algebras $\scr A$ together with a morphism of sheaves of $\Cbb$-algebras $\scr O_S\rightarrow \scr A$. Since $\scr A$ is an $\scr A$-module, it becomes an $\scr O_S$-module. We say that $\scr A$ is a \textbf{coherent $\scr O_S$-algebra} if it is an $\scr O_S$-algebra which is coherent as an $\scr O_S$-module. 

A \textbf{morphism} of $\scr O_S$-algebras from $\scr B$ to $\scr A$ is by definition a morphism $\Phi:\scr B\rightarrow\scr A$ of sheaves of $\Cbb$-algebras such that the following diagram commutes.
\begin{equation}\label{eq51}
\begin{tikzcd}[column sep=tiny]
\scr A & & \scr B \arrow[ll,"\Phi"']\\
& \scr O_S \arrow[ul] \arrow[ru] &
\end{tikzcd}
\end{equation}
The commutativity of \eqref{eq51} is equivalent to saying that the morphism of sheaves of $\Cbb$-algebras $\Phi$ is also a morphism of $\scr O_S$-modules. The set of morphisms is denoted by $\Mor_{\scr O_S}(\scr B,\scr A)$. This defines the \textbf{category of coherent $\scr O_S$-algebras}. \hfill\qedsymbol
\end{df}

We have avoided using the symbol $\Hom_{\scr O_S}(\scr B,\scr A)$, which is the set of $\scr O_S$-module morphisms but not $\scr O_S$-algebra morphisms.


\begin{thm}\label{lb99}
The contravariant functor $\fk F$ from the category of finite holomorphic maps to $S$ to the category of coherent $\scr O_S$-algebras is an antiequivalence of categories. The functor $\fk F$ sends each finite holomorphic map $\pi:X\rightarrow S$ to the coherent $\scr O_S$-algebra $\pi_*\scr O_X$. At the level of morphisms the functor is
\begin{gather}
\fk F:\Mor_S(X,Y)\rightarrow\Mor_{\scr O_S}(\kappa_*\scr O_Y,\pi_*\scr O_X),\qquad \varphi\mapsto\varphi^\#.\label{eq49}
\end{gather}
\end{thm}


Thus, for each coherent $\scr O_S$-algebra $\scr A$ there is,  \emph{up to isomorphisms}, a unique finite holomorphic map $\pi:X\rightarrow S$ such that $\pi_*\scr O_X=\scr A$. We write this map as $\Specan(\scr A)\rightarrow S$ and call this map (or simply call the complex space $\Specan(\scr A)$) the \textbf{analytic spectrum} of $\scr A$. \index{00@Analytic spectra $\Specan$} 

Note that when $\scr A=\scr O_S/\mc I$ where $\mc I$ is a coherent ideal of $\scr O_S$, as before, $\Specan(\scr A)$ denotes the unique analytic spectrum as a closed subspace of $S$. For a general $\scr A$,  $\Specan(\scr A)$ is not unique.




\begin{co}
Let $\psi:Z\rightarrow S$ be a holomorphic map of complex spaces. Then
\begin{align*}
\Specan(\scr A\otimes_{\scr O_S}\scr O_Z)\simeq\Specan(\scr A)\times_SZ
\end{align*}
\end{co}
\begin{proof}
This is just a rephrasing of Cor. \ref{lb95}.
\end{proof}




\subsection{Proof of Thm. \ref{lb99}}


\begin{proof}[\textbf{Proof that \eqref{eq49} is injective}]
Let $\varphi,\psi\in\Mor_S(X,Y)$ such that $\psi^*,\varphi^*:\kappa_*\scr O_Y\rightarrow\pi_*\scr O_X$ are equal. By Prop. \ref{lb56}, for each $t\in S$, $\varphi^\#:(\kappa_*\scr O_Y)_t\rightarrow(\pi_*\scr O_X)_t$ is an $\scr O_{S,t}$-module morphism of the form
\begin{align*}
\varphi^\#:\bigoplus_{y\in\kappa^{-1}(t)}\scr O_{Y,y}\rightarrow\bigoplus_{x\in\pi^{-1}(t)}\scr O_{X,x}
\end{align*}
whose restriction to $\scr O_{Y,y}\rightarrow\scr O_{X,x}$ is non-zero iff $y=\varphi(x)$. A similar description holds for $\psi^\#$. It follows that $\varphi$ and $\psi$ must be equal, first of all as maps of sets, and then clearly as holomorphic maps.
\end{proof}


\begin{proof}[\textbf{Proof that \eqref{eq49} is surjective}]
Choose any $\Phi\in\Mor_{\scr O_S}(\kappa_*\scr O_Y,\pi_*\scr O_X)$. It suffices to show that $\Phi$ is locally realized by $\varphi_W$, i.e., that each $t\in S$ is contained in a neighborhood $W\subset S$ such that, after shrinking $S$ to $W$, $X$ to $\pi^{-1}(X)$, and $Y$ to $\kappa^{-1}(X)$, $\Phi$ equals $\varphi_W^\#$. Then by the injectivity of \eqref{eq49}, $\varphi_W$ and $\varphi_{W'}$ agree on $W\cap W'$. So these $\varphi_W$ can be glued together to realize $\Phi$ globally.  

To find $\varphi$ locally, we first assume that $\kappa$ is a Weierstrass map, which factors as $\kappa:Y\hookrightarrow\Cbb^k\times S\xrightarrow{\pr_S}S$. Consider $z_1,\dots,z_k$ as elements of $\scr O(\Cbb^k\times S)$ and also of $\scr O(Y)=(\kappa_*\scr O_Y)(S)$ by restriction. Let $f_i=\Phi(z_i)$, which is an element of $(\pi_*\scr O_X)(S)=\scr O(X)$. Regard $F=(f_1,\dots,f_k)$ as a holomorphic map $X\rightarrow \Cbb^k$ (Thm. \ref{lb7}). Then by Thm. \ref{lb13}, the holomorphic map $F\vee\pr_S:X\rightarrow\Cbb^k\times S$ restricts to a holomorphic $\varphi:X\rightarrow Y$. (This is similar to the Proof-Step 2 of Prop. \ref{lb89}. Note that one needs the commutativity of \eqref{eq51} to check condition (b) of Thm. \ref{lb13}!) Then \eqref{eq50} commutes because $\kappa\circ\varphi=\pr_S\circ(F\vee\pi)=\pi$. Both $\varphi^\#$ and $\Phi$ send each $z_i\in(\kappa_*\scr O_Y)(S)$ to $f_i$. So $\varphi^\#=\Phi$ because the powers of $z_1,\dots,z_k$ generate the $\scr O_S$-module $\kappa_*\scr O_Y$ by Thm. \ref{lb60}.

Now, in the general case, by Prop. \ref{lb89} we may assume $S$ is small enough such that $\kappa$ factors as
\begin{align*}
\kappa:Y\hookrightarrow Z\xrightarrow{\varpi} S
\end{align*}
where $\varpi:Z\rightarrow S$ is a isomorphic to a Weierstrass map and $Y=\Specan(\scr O_Z/\mc J)$ is a closed subspace of $Z$. We have a sequence of morphisms of $\scr O_S$-algebras
\begin{align*}
\pi_*\scr O_X\xlongleftarrow{\Phi}\kappa_*\scr O_Y\xlongleftarrow{\iota^\#}\varpi_*\scr O_Z.
\end{align*}
By the previous paragraph, there is $\psi\in\Mor_S(X,Z)$ such that $\psi^\#:\varpi_*\scr O_Z\rightarrow\pi_*\scr O_X$ equals $\Phi\circ\iota^\#$ and hence vanishes on $\varpi_*\mc J$. Thus, by Prop. \ref{lb56}, for each $x\in X$, $\psi^\#:\scr O_{Z,\psi(x)}\rightarrow\scr O_{X,x}$ vanishes on $\mc J_{\psi(x)}$. So Thm. \ref{lb13} tells us that $\psi$ restricts to a holomorphic $\varphi:X\rightarrow Y$. Namely $\psi=\iota\circ\varphi$. Clearly $\varphi\in\Mor_S(X,Y)$.

We have $\varphi^\#\circ\iota^\#=\psi^\#=\Phi\circ\iota^\#$. Thus, to show that $\varphi^\#=\Phi$, it suffices to show that $\iota^\#:\varpi_*\scr O_Z\rightarrow\kappa_*\scr O_Y$ is surjective. This is clear from Prop. \ref{lb56} and the fact that $Y$ is a closed subspace of $Z$.
\end{proof}

The above two proofs together show that $\fk F$ is fully faithful.


\begin{proof}[\textbf{Proof that $\fk F$ is essentially surjective}]
Given any coherent $\scr O_S$-algebra $\scr A$, our goal is to find a finite holomorphic map $\pi:X\rightarrow S$ (for some complex space $X$) such that $\pi_*\scr O_X$ is equivalent to $\scr A$ as $\scr O_S$-algebras.

We first show that the construction of $\pi$ is local by nature. Suppose that we have an open cover $(S_i)_{i\in I}$ of $S$ such that for each $i$ we have a finite holomorphic $\pi_i:X_i\rightarrow S_i$ such that there is an isomorphism of $\scr O_{S_i}$-algebras
\begin{align*}
\Phi_i:\pi_{i,*}\scr O_{X_i}\xlongrightarrow{\simeq}\scr A|_{S_i}.
\end{align*}
Write $S_{ij}=S_i\cap S_j$, $X_{ij}^i=\pi_i^{-1}(S_{ij})$, and let $\pi^i_{ij}:X^i_{ij}\rightarrow S_{ij}$ be the restriction of $\pi_i$. Then by the full-faithfulness of $\fk F$, there is a unique isomorphism $\gamma_{j,i}\in\Mor_{S_{ij}}(X_{ij}^i,X_{ij}^j)$ such that $\gamma_{j,i}^\#:\pi^j_{ij,*}\scr O_{X^j_{ij}}\rightarrow \pi^i_{ij,*}\scr O_{X^i_{ij}}$ equals $\Phi_i^{-1}|_{S_{ij}}\circ \Phi_j|_{S_{ij}}$. One checks easily that these $\gamma_{j,i}$ satisfy the cocycle condition so that they can be used as the gluing maps to glue all $\pi_i$ together and form a desired $\pi:X\rightarrow S$.

Let us construct $\pi$ locally. Choose $t\in S$. Using the methods in the proof of Prop. \ref{lb89}, one shows that if $S$ is sufficiently small then there exist a Weierstrass map $\kappa:Y\rightarrow S$ and $\Phi:\Mor_{\scr O_S}(\kappa_*\scr O_Y,\scr A)$ which is surjective as an $\scr O_S$-module morphism. $\mc T=\Ker(\Phi)$ is an ideal of $\kappa_*\scr O_Y$, i.e., an $\scr O_S$-submodule of $\kappa_*\scr O_Y$ whose stalks at each $\tau\in S$ is invariant under $(\kappa_*\scr O_Y)_\tau$. So $\mc T_\tau=\mc T_\tau\cdot (\kappa_*\scr O_Y)_\tau$. Thus, by Prop. \ref{lb56}, we have an $(\kappa_*\scr O_Y)_\tau$-module isomorphism
\begin{align*}
\kappa_*(\mc T\scr O_Y)_\tau\simeq\bigoplus_{y\in\kappa^{-1}(\tau)}(\mc T\scr O_Y)_y=\bigoplus_{y\in\kappa^{-1}(\tau)}\mc T_\tau\scr O_{Y,y}\simeq\mc T_\tau\cdot (\kappa_*\scr O_Y)_\tau= \mc T_\tau
\end{align*}
such that each $\sigma\in\mc T_\tau$ corresponds to $\sigma\cdot 1$ on the LHS.

$\mc T\scr O_Y$ is a finite-type ideal of $\scr O_Y$ since $\mc T$ is $\scr O_S$-coherent by Cor. \ref{lb46}. Define $X=\Specan(\scr O_Y/\mc T\scr O_Y)$, and let $\pi:X\rightarrow S$ be the restriction of $\kappa$. This gives the desired finite holomorphic map since, by the exactness of $\kappa_*$, we have an $\kappa_*\scr O_Y$-module isomorphism
\begin{align*}
\pi_*\scr O_X=\kappa_*(\scr O_Y/\mc T\scr O_Y)\simeq \kappa_*\scr O_Y/\kappa_*(\mc T\scr O_Y)\simeq \kappa_*\scr O_Y/\mc T\simeq\scr A.
\end{align*}
(These isomorphisms are explicit at the level of stalks.)
\end{proof}



\section{Nullstellensatz}


In this section, we give another application of Finite mapping Thm. \ref{lb74} and Thm. \ref{lb75}: we prove the complex analytic version of Hilbert Nullstellensatz, called R\"uckert Nullstellensatz in \cite{GR} and \cite{GPR}. Nullstellensatz will be used in an essential way to prove that every complex space $X$ has an associated reduced complex space $X_\red$, and that if $X$ is reduced at $x$ then $X$ is reduced near $x$. 





\subsection{Equivalent forms of Nullstellensatz}


\begin{thm}[\textbf{Nullstellensatz}]\label{lb114}
Let $X$ be a complex space. If $f\in\scr O(X)$ satisfies that $f(x)=0$ for all $x\in X$, then the germ of $f$ at each $x\in X$ is a nilpotent element of $\scr O_{X,x}$.
\end{thm}

The converse is clearly true: If $f$ is nilpotent at $\scr O_{X,x}$ for each $x$, then $f$ a zero continuous function.

Recall that if $I$ is an ideal of a commutative ring $A$, then its \textbf{radical} $\sqrt I$ is
\begin{align*}
\sqrt I=\{a\in A:a^n\in I\text{ for some }n\in\Zbb_+\}.
\end{align*}
Similarly: \index{00@Radicals $\sqrt I,\sqrt{\mc I}$}

\begin{df}
If $X$ is a $\Cbb$-ringed space and $\mc I$ is an ideal of $\scr O_X$, then the \textbf{radical of $\mc I$} is the ideal $\sqrt{\mc I}$ of $\scr O_X$ defined by
\begin{align*}
\sqrt{\mc I}(U)=\{f\in\scr O(U):f\in\sqrt{\mc I_x}\text{ for all }x\in U\}.
\end{align*}
So $\mc I$ is determined by $(\sqrt{\mc I})_x=\sqrt{\mc I_x}$ for all $x\in X$.
\end{df}

Then there is an equivalent way of stating Nullstellensatz: \index{00@Nullstellensatz}


\begin{thm}[\textbf{Nullstellensatz}]
Let $X$ be a complex space. Then the kernel of the reduction map $\red:\scr O_X\rightarrow\scr C_X$ (where $\scr C_X$ is the sheaf of germs of continuous functions) equals $\sqrt{0_X}$, the radical of the zero ideal of $\scr O_X$.
\end{thm}

We call $\sqrt{0_X}$ the \textbf{nilradical} of $\scr O_X$ (or of $X$). \index{00@Nilradical $\sqrt{0_X}$}



\begin{rem}\label{lb115}
There are some other equivalent statements of \textbf{Nullstellensatz}:
\begin{enumerate}
\item Let $\mc I$ be a coherent ideal of $\scr O_X$. Then $f\in\scr O(X)$ vanishes on the subset $N(\mc I)$ if and only if $f\in\sqrt{\mc I}$.
\item Let $\scr O_{X,x}$ be an analytic local $\Cbb$-algebra, and let $I$ be an ideal. Then $f\in\scr O_{X,x}$ is an nilpotent element of $I$ if and only if $f$ vanishes on the $\Specan(\scr O_{X,x}/I)$, the \textbf{germ of complex subspace} of $X$ defined by $I$. 

\item If $\scr E$ is a coherent sheaf on a complex space $X$. Then $f\in\scr O(X)$ vanishes on the subset $\Supp(\scr E)$ if and only if for each $x\in X$ there is $n\in\Zbb_+$ such that $f^n\scr E_x=0$.
\end{enumerate}
\end{rem}

\begin{proof}
1$\Leftrightarrow$Thm. \ref{lb114}: Let $Y=\Specan(\scr O_X/\mc I)$. Then $f\in\scr O_{X,x}$ belongs to $\sqrt{\mc I_x}$ iff  the residue class of $f$ in $\scr O_{Y,x}=\scr O_{X,x}/\mc I_x$ is nilpotent. 

1$\Leftrightarrow$2: Obvious. 3$\Rightarrow$ 1: Take $\scr E=\scr O_X/\mc I$. 1$\Rightarrow$3: Take $\mc I=\sann_{\scr O_X}(\scr E)$.
\end{proof}









\subsection{Proof of Nullstellensatz}

We start by proving a special case.

\begin{lm}\label{lb100}
Let $X$ be a neighborhood of $0\in\Cbb^{m+1}$ where $m\in\Nbb$. Let $(z,w,t_2,\dots,t_m)$ be the standard coordinates of $\Cbb^{m+1}$. Let $\mc I$ be a coherent ideal of $\scr O_X$ such that
\begin{align*}
N(\mc I)\subset\{(z,w,t_\blt)\in X:z=0\}.
\end{align*}
Then (the germ at $0$ of) $z$ is an element of $\sqrt{\mc I_0}$.
\end{lm}


\begin{proof}
We prove by induction on $m\in\Nbb$. The base case $m=0$ is elementary and is hence omitted. Assume the lemma holds for $m-1$ where $m\geq 1$. Let us prove it for $m$. Let $Y=\Specan(\scr O_X/\mc I)$.

We first assume that $\mc I_0$ contains
\begin{align}
h(z,w,t_\blt)=\sum_{n=0}^\infty a_n(w,t_\blt)z^n\label{eq52}
\end{align}
where $a_0\neq 0$. Then as in the proof of Thm. \ref{lb70}, we may choose a new set of coordinates $(w,t_\blt)$ for $\Cbb^m$ such that $a_0(w,t_\blt)=h(0,w,t_\blt)$ has finite order in $w$, i.e. $a(w,0)$ is non-zero. So $0_{\Cbb^{m+1}}$ is an isolated point of the fiber at $0_{\Cbb^m}$ of the holomorphic map $\pi:Y\rightarrow \Cbb^m$ defined by the restriction of $\Cbb^{m+1}\rightarrow\Cbb^m,(z,w,t_\blt)\mapsto (z,t_\blt)$. We shrink $X$ to a neighborhood of $0$ so that $0_{\Cbb^{m+1}}$ is the only point of that fiber, and that (by Thm. \ref{lb75}) $\pi:Y\rightarrow V$ is finite where  $V$ is a neighborhood of $0\in\Cbb^m$. See Fig. \ref{fig2}.
\begin{figure}[h]
	\centering



\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,310); %set diagram left start at 0, and has height of 310

%Straight Lines [id:da8716581873145328] 
\draw    (264,126.5) -- (234.24,154.98) ;
\draw [shift={(232.79,156.36)}, rotate = 316.27] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Straight Lines [id:da25538335623560116] 
\draw    (264,126.5) -- (263.02,82.45) ;
\draw [shift={(262.97,80.45)}, rotate = 88.72] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Straight Lines [id:da15856873623352485] 
\draw    (264,126.5) -- (321.32,126.8) ;
\draw [shift={(323.32,126.81)}, rotate = 180.3] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Curve Lines [id:da31658562114637734] 
\draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (237.03,115.3) .. controls (277.26,115.81) and (252.2,137.8) .. (290.2,135.13) ;
%Curve Lines [id:da7192611023303519] 
\draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (233.32,128.34) .. controls (258.74,147.7) and (267.21,107.96) .. (295.79,116.11) ;
%Shape: Parallelogram [id:dp48485531317354624] 
\draw  [color={rgb, 255:red, 126; green, 211; blue, 33 }  ,draw opacity=1 ][dash pattern={on 4.5pt off 4.5pt}] (240.24,105.92) -- (324.87,105.92) -- (293.06,141.13) -- (208.44,141.13) -- cycle ;
%Straight Lines [id:da4807100139421694] 
\draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ]   (296.42,153.81) -- (305.24,146.55) -- (313.94,139.29) ;
\draw [shift={(315.48,138.01)}, rotate = 140.2] [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Straight Lines [id:da9540546352598236] 
\draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ]   (297.48,162.47) -- (306.29,155.21) -- (315,147.95) ;
\draw [shift={(316.54,146.67)}, rotate = 140.2] [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;
%Straight Lines [id:da49858931103629067] 
\draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ]   (309.66,161.96) -- (318.47,154.7) -- (327.18,147.44) ;
\draw [shift={(328.72,146.16)}, rotate = 140.2] [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][line width=0.75]    (6.56,-1.97) .. controls (4.17,-0.84) and (1.99,-0.18) .. (0,0) .. controls (1.99,0.18) and (4.17,0.84) .. (6.56,1.97)   ;

% Text Node
\draw (252.28,72.04) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {$\displaystyle z$};
% Text Node
\draw (221.02,157.09) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {$\displaystyle x$};
% Text Node
\draw (323.76,114.8) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize] [align=left] {$\displaystyle y$};
% Text Node
\draw (283.85,159.17) node [anchor=north west][inner sep=0.75pt]  [font=\footnotesize,color={rgb, 255:red, 245; green, 166; blue, 35 }  ,opacity=1 ] [align=left] {$\displaystyle \pi $};


\end{tikzpicture}
	\caption{}
	\label{fig2}
\end{figure}

By Finite mapping Thm. \ref{lb74}, $\pi_*\scr O_Y$ is a coherent $\scr O_V$-module. By assumption, the Nullstellensatz holds for any coherent ideal $\mc J$ of $\scr O_V$ such that
\begin{align*}
N(\mc J)\subset\{(z,t_\blt)\in V:z=0\}.
\end{align*}
Choose $\mc J=\sann_{\scr O_V}(\pi_*\scr O_Y)$. Then the assumption tells us that there is $n\in\Zbb_+$ such that $z^n\in\scr O_{\Cbb^m,0}$ kills the stalk $(\pi_*\scr O_Y)_0\simeq \scr O_{Y,0}$ (Prop. \ref{lb56}).  So $\pi^\# z^n$ (or simply $z^n$ as an element of $\scr O(\Cbb^{m+1})$) kills $\scr O_{Y,0}=\scr O_{\Cbb^{m+1},0}/\mc I_0$. Therefore $z^n\in\mc I_0$.

Now, in the general case, note that it suffices to prove that $z$ is nilpotent in $z^{-k}\mc I_0=\{f\in\scr O_{\Cbb^{m+1},0}:z^kf\in\mc I_0\}$ for some $k\in\Nbb$. This statement is true if we can find $k$ and $h\in z^{-k}\mc I_0$ whose series expansion as in \eqref{eq52} has non-zero constant term. This follows by choosing a non-zero $g\in\mc I_0$, letting $k$ be the smallest power of $z$ such that the series expansion of $g$ in $z$ has non-zero coefficient before $z^k$, and setting $h=z^{-k}g$.
\end{proof}



\begin{proof}[\textbf{Proof of Nullstellensatz}]
Let $X$ be a complex space, and assume that $f\in\scr O(X)$ vanishes at every $x\in X$. We now fix $x\in X$ and show that $f$ is nilpotent in $\scr O_{X,x}$. Consider the graph $\fk G(f)$ of $f$, namely the image of the closed embedding $f\vee \id:X\rightarrow \Cbb\times X$ (cf. Prop. \ref{lb80}). Assume $X$ is a small enough neighborhood of $x$ so that $X$ is a closed subspace of an open $U\subset\Cbb^m$ and $x=0_{\Cbb^m}$. Then $\fk G(f)$ is a closed subspace of $\Cbb\times U$. 

As a set, $\fk G(f)$ is contained in $0\times U$. Let $z\in\scr O(\Cbb)$ be the standard coordinate of $\Cbb$. Then by Lemma \ref{lb100}, $z\otimes 1\in\scr O_{\Cbb\times U,0\times 0}$ is nilpotent in $\scr O_{\fk G(f),0\times 0}$. But the restriction $f\vee\id:X\rightarrow\fk G(f)$ is a biholomorphism, and it pulls $z\otimes 1=\pr_\Cbb^\# z$ (where $\pr_\Cbb:\Cbb\times U\rightarrow\Cbb$ is the projection) back to $z\circ \pr_\Cbb\circ(f\vee\id)=z\circ f=f$. So $f$ is nilpotent in $\scr O_{X,0}$.
\end{proof}




\begin{subappendices}
\section{Kernels and cokernels in categories of modules}

In a category $\mc C$, if $\varphi,\psi:X\rightarrow Y$ are two morphisms of objects, then the equalizers of double arrow
$\begin{tikzcd}
X \arrow[r,shift left, "\varphi"] \arrow[r,shift right,"\psi"'] & Y
\end{tikzcd}$
can be defined in the same way as in Def. \ref{lb139}. Likewise, a \textbf{coequalizer} \index{00@Coequalizers} of this double arrow is an object $C\in\mc C$ and a morphism $\pi:Y\rightarrow C$ such that $\pi\circ\varphi=\pi\circ\psi$, and that for every object $T$ and morphism $\nu:Y\rightarrow Y$ there is a unique morphism $\wtd\nu:C\rightarrow T$ such that $\nu=\wtd\nu\circ\pi$.
\begin{equation}
\begin{tikzcd}
X \arrow[r, "\varphi", shift left] \arrow[r, "\psi"', shift right] & Y \arrow[r, "\pi"] \arrow[rd, "\nu"'] & C \arrow[d, "\wtd\nu", dashed] \\
                                                                   &                                       & T                             
\end{tikzcd}
\end{equation}


Thus, if a functor (resp. contravariant functor) $\fk F:\mc C\rightarrow\mc D$ is an equivalence (resp. antiequivalence) of categories (cf. Thm. \ref{lb19} and \ref{lb49}), then $\fk F$ sends the (co)equalizer of a double arrow $\begin{tikzcd}
X \arrow[r,shift left, "\varphi"] \arrow[r,shift right,"\psi"'] & Y
\end{tikzcd}$
(on the $\mc C$ side) to a (co)equalizer of 
$\begin{tikzcd}
\fk F(X) \arrow[r,shift left, "\fk F(\varphi)"] \arrow[r,shift right,"\fk F(\psi)"'] & \fk F(Y)
\end{tikzcd}$
(resp. sends equalizers to coequalizers of $\begin{tikzcd}
\fk F(Y) \arrow[r,shift left, "\fk F(\varphi)"] \arrow[r,shift right,"\fk F(\psi)"'] & \fk F(X)
\end{tikzcd}$ and coequalizers to equalizers).


The category of modules of a commutative rings and the one of (coherent) $\scr O_X$-modules (where $X$ is a $\Cbb$-ringed space) are both additive categories, which means roughly that one can take direct sums,  that the morphism spaces are abelian groups, and that there is a zero object. A functor between additive functions, called an \textbf{additive functor}, is assumed to preserve the abelian group structures of the morphism spaces. 

Moreover, the above categories are \textbf{abelian categories}. This means that the kernel of a morphism $\varphi:\mc M\rightarrow\mc N$ (which is an object together with the ``inclusion" morphism) is equivalent to the equalizer of $\begin{tikzcd}
\mc M \arrow[r,shift left, "\varphi"] \arrow[r,shift right,"0"'] & \mc N
\end{tikzcd}$
and that the cokernel is equivalent to the coequalizer of this double arrow. From this, it is clear that if a functor (resp. contravariant functor) $\fk F:\mc C\rightarrow\mc D$ is an equivalence (resp. antiequivalence) of abelian categories, then {\color{red}\emph{$\fk F$ must be an exact functor}}, because $\fk F$ commutes with kernels and cokernels (resp. sends kernels to cokernels and cokernels to kernels).



We refer the readers to \cite[Chapter 1]{Vak17} for a more detailed introduction to abelian categories.






\end{subappendices}












\chapter{Dimensions and local geometry of complex spaces}



\section{Prime decomposition}

We fix a commutative ring $\mc A$. Recall that $\mc A$ is called \textbf{reduced} \index{00@Reduced ring} if $\mc A$ has no non-zero nilpotent elements. This is equivalent to saying that $\{0\}=\sqrt{\{0\}}$. If $I$ is an ideal of $\mc A$, then $\mc A/I$ is reduced iff $\sqrt{I}=I$.

\begin{rem}\label{lb105}
Recall the general fact that for any ideals $I_1,\dots,I_k$ of $\mc A$ we have
\begin{gather}\label{eq53}
\sqrt{I_1\cdots I_k}=\sqrt{I_1\cap\cdots\cap I_k}=\sqrt{I_1}\cap\cdots\cap\sqrt{I_k}.
\end{gather}
In view of Nullstellensatz, the first equality says that ``the zero sets defined by $I_1\cdots I_k$ and defined by $I_1\cap \cdots\cap I_k$ are equal" (namely, they are equal to the union of the zero sets of $I_1,\dots,I_k$). The second equality implies that if $I_i=\sqrt{I_i}$ for each $i$, then $I_1\cap\cdots\cap I_k$ is its own radical.
\end{rem}


\begin{proof}
The two equalities in \eqref{eq53} are clearly $\subset$. If $f\in\cap_i\sqrt I_i$ then $f^{n_i}\in I_i$ for some $n_i\in\Zbb_+$. Then $f^{n_1+\cdots+n_k}\in I_1\cdots I_k$, and hence $f\in\sqrt{I_1\cdots I_k}$. This proves \eqref{eq53}.
\end{proof}

\begin{pp}\label{lb103}
Let $\fk p\subsetneq\mc A$ be an ideal.\footnote{Recall that a prime ideal $\pk$ is required not to be the whole ring $\mc A$.} Then the following are equivalent.
\begin{enumerate}[label=(\alph*)]
\item $\pk$ is a prime ideal. Equivalently, $\mc A/\pk$ is an integral domain.
\item $\pk=\sqrt\pk$. Moreover, if $\pk=I_1\cap I_2$ where $I_1,I_2$ are ideals of $\mc A$, then $I_1=\pk$ or $I_2=\pk$.
\item $\pk=\sqrt\pk$.  Moreover, if $\pk=I_1\cap I_2$ where $I_1,I_2$ are ideals of $\mc A$ satisfying $I_1=\sqrt{I_1}$ and $I_2=\sqrt{I_2}$, then $I_1=\pk$ or $I_2=\pk$.
\end{enumerate}
\end{pp}

We leave it to the readers to figure out the geometric meaning of this lemma (in the case that $\mc A$ is an analytic $\Cbb$-algebra).

\begin{proof}
By replacing $\mc A$ by $\mc A/\pk$, we may assume $\pk=\{0\}$. Clearly (b)$\Rightarrow$(c).

(a)$\Rightarrow$(b): Assume $\{0\}$ is prime. Then clearly $\{0\}=\sqrt{\{0\}}$. Suppose $\{0\}=I_1\cap I_2$ and $I_1,I_2\neq\{0\}$. Then we may choose non-zero $f_i\in I_i$. And $f_1f_2\in I_1\cdot I_2\subset I_1\cap I_2=\{0\}$. So $f_1f_2=0$, contradicting that $\{0\}$ is prime. So (b) follows.

(c)$\Rightarrow$(a). Assume (c). Suppose that there are non-zero $f,g\in \mc A$ such that $fg\in\{0\}$, i.e. $fg=0$. Then as $\mc A$ is reduced, $\{0\}=\sqrt{\{0\}}=\sqrt{f\mc A\cdot g\mc A}=\sqrt{f\mc A}\cap\sqrt{g\mc A}$. This contradicts (c).
\end{proof}


\begin{thm}\label{lb102}
If $\mc A$ is Noetherian and reduced, then there are prime ideals $\fk p_1,\dots,\fk p_N$ of $\mc A$ such that
\begin{align}
\{0\}=\fk p_1\cap\cdots\cap \fk p_N\label{eq55}
\end{align}
and that for each $1\leq i\leq N$,
\begin{align}
\{0\}\neq \bigcap_{j\neq i}\fk p_j.\label{eq56}
\end{align}
Moreover the prime ideals $\pk_1,\dots,\pk_N$ satisfying \eqref{eq55} and \eqref{eq56} are unique. We call this unique decomposition the \textbf{prime decomposition of $\{0\}\subset\mc A$}. \index{00@Prime decomposition}
\end{thm}

The geometric meaning of \eqref{eq55} is that an element $f\in \mc A$ is zero iff $f$ restricts to zero on $\mc A/\pk_i$ (i.e. ``$f$ vanishes on the zero set $N(\pk_i)$") for all $i$.

Note that if $\fk a=\sqrt{\fk a}$ is an ideal of a Noetherian ring $\mc A$, then Thm. \ref{lb102} applied to $\mc A/\fk a$ says that there are prime ideals $\pk_1,\dots,\pk_N$ of $\mc A$ such that
\begin{subequations}\label{eq72}
\begin{gather}
\fk a=\pk_1\cap\cdots\cap\pk_N\\
\fk a\neq \bigcap_{j\neq i}\fk p_j\qquad\forall 1\leq i\leq N
\end{gather}
\end{subequations}
called the \textbf{prime decomposition of $\fk a$}.


\begin{proof}[Proof of the existence]
We first note that if we can find prime ideals $\pk_1,\dots,\pk_N$ satisfying \eqref{eq55}, then by discarding some members of these ideals so that the intersection of the remaining ones is still $\{0\}$ until we cannot do this anymore, \eqref{eq56} is automatically satisfied. So we only need to find prime ideals satisfying \eqref{eq55}.

Let $\fk A$ be the set of all ideals $\fk a$ not equal to $\mc A$ such that $\fk a=\sqrt{\fk a}$ and that $\fk a\subset\mc A$ has no prime decomposition (equivalently, $\fk a$ is not a finite intersection of prime ideals). Note that if $\fk a\in\fk A$, then $\fk a=\sqrt{\fk a}$ and $\fk a$ is not prime. So by Prop. \ref{lb103}, $\fk a=\fk b\cap \fk c$ where the ideals $\fk b,\fk c$ are not $\fk a$ and are the radicals of themselves. One of $\fk b,\fk c$ is not a finite intersection of prime ideals, otherwise $\fk a$ is a finite intersection of prime ideals. So one of $\fk b,\fk c$ is in $\fk A$. 

The above argument shows that if $\fk a_1=\{0\}$ belongs to $\fk A$, then we can construct a strictly increasing infinite chain of elements of $\fk A$: $\fk a_1\subsetneq\fk a_2\subsetneq\fk a_3\subsetneq\cdots$, contradicting that $\mc A$ is Noetherian. So $\{0\}\notin\fk A$.
\end{proof}


\begin{rem}\label{lb106}
In Thm. \ref{lb102}, \eqref{eq55} and \eqref{eq56} imply that
\begin{align*}
\bigcap_{j\neq i}\pk_j\Big\backslash\pk_i\neq\emptyset.
\end{align*}
This means that we can find $f\in \mc A$ which is non-zero when restricted to $\mc A/\pk_i$ (i.e. ``non-zero on $N(\pk_i)$") and zero in the other $\mc A/\pk_j$. Thus, by taking linear combinations, we see that there always exists $f\in \mc A$ which is non-zero precisely when restricted to the given ones of $\mc A/\pk_1,\dots,\mc A/\pk_N$. 
\end{rem}


We remark that when $\mc A$ is not necessarily reduced, there is a generalization called \textbf{primary decomposition}, cf. \cite{AM}. We will not use this notion in out notes.


To prove the uniqueness part of Thm. \ref{lb102} we first need:

\begin{lm}\label{lb107}
In Thm. \ref{lb102}, for each $f\in \mc A$, the annihilator $\Ann_{\mc A}(f)$ equals
\begin{align}\label{eq54}
\Ann_{\mc A}(f)=\bigcap_{
\begin{subarray}{c}
1\leq i\leq N\\[0.2ex]
f\notin\pk_i
\end{subarray}
} \pk_i
\end{align}
\end{lm}

Recall that $\Ann_{\mc A}(f)=\Ann_{\mc A}(f\mc A)$ is the ideal of all $a\in \mc A$ satisfying $af=0$ (Def. \ref{lb104}). Then \eqref{eq54} says that $af=0$ iff $a$ ``vanishes on all $N(\pk_i)$ where $f$ is non-zero on $N(\pk_i)$".





\begin{proof}
Suppose $a\in \mc A$ and $af=0$. Then $af$ restricts to $0$ on the integral domain $\mc A/\pk_i$. If $f\notin \pk_i$ then $f$ is nonzero in $\mc A/\pk_i$. So $a$ is $0$ in $\mc A/\pk_i$. Hence $a\in\pk_i$. Conversely, if $a\in\pk_i$ for all $i$ such that $f\notin\pk_i$, then $af$ belongs to $\pk_i$ for all $1\leq i\leq N$. So $af\in\cap_i\pk_i=\{0\}$.
\end{proof}


Note that $f$ is a non zero-divisor iff $\Ann_{\mc A}(f)=\{0\}$. Therefore:
\begin{co}\label{lb120}
In Thm. \ref{lb102}, $f\in \mc A$ is a non zero-divisor if and only if $f\notin\pk_i$ for all $1\leq i\leq N$.
\end{co}






Now the uniqueness of prime decomposition follows immediately from the following fact:

\begin{pp}
In Thm. \ref{lb102}, $\pk_1,\dots,\pk_N$ are precisely the \textbf{associated primes} \index{00@Associated primes} of $\mc A$, i.e. prime ideals of the form $\Ann_{\mc A}(f)$ for some $f\in \mc A$.
\end{pp}


\begin{proof}
We first note that an intersection of more than one members of $\pk_1,\dots,\pk_N$ is not prime. This together with Lemma \ref{lb107} would imply that $\Ann_{\mc A}(f)$ is prime only if $\Ann_{\mc A}(f)=\pk_i$ for some $i$, and hence that the associated primes are among $\pk_1,\dots,\pk_N$. To prove the claim, consider for instance $\pk=\pk_1\cap\pk_2\cap\cdots\cap\pk_k$ where $k>1$. Suppose $\pk$ is prime. Then by Prop. \ref{lb103}, either $\pk_1$ or $\pk_2\cap\cdots\cap\pk_k$ equals $\pk$, contradicting \eqref{eq56}. So $\pk$ cannot be prime.

For each $i$, by Rem. \ref{lb106} we can choose $f\in \mc A$ non-zero on $\mc A/\pk_i$ but zero on $\mc A/\pk_j$ whenever $j\neq i$. Then $\pk_i=\Ann_{\mc A}(f)$ by Lemma \ref{lb107}, which shows that $\pk_i$ must be an associated prime.
\end{proof}



\section{Reduction $\red(X)$ and coherence of $\sqrt{\mc I}$}


In this section we study the reduction of complex spaces. The main results Thm. \ref{lb108} and equivalently Thm. \ref{lb109} are originally due to Oka and H. Cartan. Some key ingredients of the proof are prime decomposition, Nullstellensatz, and the ranks of Jacobian matrices (which are a guise for embedding dimensions to be studied later). Our approach follows \cite{GPR}.

\subsection{Main results and consequences}

\begin{thm}\label{lb108}
Let $X$ be a complex space reduced at a point $x$. There $X$ is reduced on a neighborhood $U$ of $x$.
\end{thm}



This theorem is equivalent to:

\begin{thm}\label{lb109}
Let $X$ be a complex space. Then for each coherent ideal $\mc I$ of $\scr O_X$, its radical $\sqrt{\mc I}$ is coherent.
\end{thm}


\begin{rem}
Note that Thm. \ref{lb109} is equivalent to the seemingly special case that for each complex space $X$, $\sqrt{0_X}$ is coherent. Indeed, if this special case is true, let $Y=\Specan(\scr O_X/\mc I)$. Then $\sqrt{0_Y}$ is (or more precisely, $\iota_{Y,X,*}\sqrt{0_Y}$ is)
\begin{align}
\sqrt{0_Y}=\sqrt{\mc I}/\mc I.
\end{align}
So $\sqrt{\mc I}/\mc I$ is coherent, and hence $\sqrt{\mc I}$ is coherent. Therefore Thm. \ref{lb109} holds.
\end{rem}


\begin{proof}[Proof that Thm. \ref{lb108} and \ref{lb109} are equivalent]
Assume Thm. \ref{lb109}. Then $\sqrt{\mc I}$ is coherent and its stalk at $x$ is $0$. So its stalk is zero on a neighborhood $U$ of $x$. Then $X$ is reduced everywhere on $U$.

Assume Thm. \ref{lb108}. Choose any complex space $X$ and coherent ideal $\mc I$. Choose $x\in X$. Since $\scr O_{X,x}$ is Noetherian, $\sqrt{\mc I}_x$ is generated by finitely many elements $f_1,f_2,\dots$. By shrinking $X$ to a neighborhood of $x$, we assume $f_1,f_2,\dots\in\sqrt{\mc I}(X)$. Let $\mc J$ be the ideal generated by $f_1,f_2,\dots$. Then $\mc J\subset\sqrt{\mc I}$ and $\mc J_x=\sqrt{\mc I}_x$. This implies that  $Y=\Specan(\scr O_X/\mc J)$ is reduced at $x$ (since $\sqrt{0_{Y,x}}=\sqrt{\mc J_x}/\mc J_x$). 

$\mc J_x=\sqrt{\mc I}_x$ also implies $\mc I_x\subset\mc J_x$. So by shrinking $X$ we have $\mc I\subset\mc J$. We conclude that
\begin{align*}
\mc I\subset\mc J\subset\sqrt{\mc I}\subset \sqrt{\mc J}.
\end{align*}
By Thm. \ref{lb108}, we may shrink $X$ so that $Y$ is reduced everywhere on $X$. This means $\mc J=\sqrt{\mc J}$, which proves that $\sqrt{\mc I}$ equals $\mc J$ and is therefore coherent.
\end{proof}

\begin{co}
Let $X$ be a complex space. Then for each analytic subset $A$ of $X$, the \textbf{ideal associated to $A$} defined by \index{00@Ideal $\scr I_A$ associated to an analytic subset} \index{IA@$\scr I_A$}
\begin{align}
\scr I_A=\{f\in\scr O_X:f(x)=0\quad\forall x\in A\cap\text{domain of }f\} \label{eq67}
\end{align}
is coherent.
\end{co}




\begin{proof}
If locally $A=N(\mc I)$ for some coherent ideal $\mc I$ then
\begin{align}
\scr I_A=\sqrt{\mc I}.
\end{align}
\end{proof}

\begin{rem}\label{lb118}
Let $X$ be a reduced complex space. By Nullstellensatz, we have a bijection
\begin{gather}
\begin{gathered}
\{\text{Analytic subsets of $X$}\}\xleftrightarrow{\simeq} \{\text{Coherent ideals  $\mc I\subset\scr O_X$ satisfying }\mc I=\sqrt{\mc I}\}\\
A\mapsto \scr I_A\qquad N(\mc I)\mapsfrom \mc I
\end{gathered}
\end{gather}
If $A,B$ are analytic subsets of $X$ then clearly
\begin{align*}
A\subset B\quad \Longleftrightarrow \quad \scr I_A\supset\scr I_B
\end{align*}
$A\cap B$ and $A\cup B$ are both analytic subsets of $X$, and we indeed have
\begin{gather}
\scr I_{A\cap B}=\sqrt{\scr I_A+\scr I_B}\qquad \scr I_{A\cup B}=\scr I_A\cap\scr I_B=\sqrt{\scr I_A\cdot\scr I_B}
\end{gather}
\end{rem}

\begin{proof}
It is clear that the coherent ideals (cf. Cor. \ref{lb110} for the coherence) $\scr I_A+\scr I_B$ has zero set $A\cap B$ and $\scr I_A\cdot\scr I_B$ has zero set $A\cup B$.  And $\sqrt{\scr I_A\cdot\scr I_B}=\scr I_A\cap\scr I_B$ by Rem. \ref{lb105}.
\end{proof}



\begin{rem}\label{lb127}
We often identify an analytic subset $A$ with the corresponding reduced complex subspace $\Specan(\scr O_X/\scr I_A)$. In that case ``analytic subsets" and ``reduced complex subspaces" are synonymous. But there is one exception. The intersection of analytic subsets $A\cap B$ are usually not the intersection of two (reduced) complex spaces (as defined in Exp. \ref{lb79}): In the former case $A\cap B$ is determined by the ideal $\scr I_{A\cap B}=\sqrt{\scr I_A+\scr I_B}$ and the latter case $\scr I_A+\scr I_B$. {\color{red}\emph{So we will make distinctions between analytic subsets and reduced complex subspaces when taking intersections.}} 

There is no such a problem when taking unions: We haven't defined unions for closed complex subspaces, since both $\mc I_1\cap \mc I_2$ and $\mc I_1\cdot\mc I_2$ are reasonable ideals for defining the union. Certainly, for analytic subspaces, $\scr I_{A\cap B}$ is the correct ideal defining the union.   \hfill\qedsymbol
\end{rem}



\begin{co}\label{lb135}
Let $X$ be a complex space. Then the set of all non-reduced points of $X$ is an analytic subset of $X$.
\end{co}


\begin{proof}
$x\in X$ is not reduced iff $x\in\Supp(\sqrt{0_X})$.
\end{proof}



\begin{co}\label{lb136}
Let $A$ be a subset of a complex space $X$. Then the following are equivalent:
\begin{enumerate}[label=(\arabic*)]
\item $A$ is an analytic subset of $X$. (Recall this means that $A=N(\mc I)$ for a coherent ideal $\mc I\subset\scr O_X$.)
\item Each $x\in X$ is contained in a neighborhood $U$ such that $A\cap U$ is analytic in $U$.
\end{enumerate}
\end{co}


Therefore $A$ is analytic iff each $x\in X$ is contained in a neighborhood $U$ such that $A\cap U$ is the zero set of finitely many elements of $\scr O(U)$.


\begin{proof}
Clearly (1)$\Rightarrow$(2). Assume (2). Let $\scr I_A$ be defined by \eqref{eq67}. For each $x\in X$ there is a neighborhood $U$ of $x$ such that $A\cap U$ is analytic, i.e. $A\cap U=N(\mc I_U)$ for a coherent ideal $\mc I_U$ of $\scr O_U$. Then $\scr I_A|_U$ equals $\scr I_{A\cap U}=\sqrt{\mc I_U}$ which is coherent. Therefore $\scr I_A$ is coherent. We have $N(\scr I_A)=A$ since $N(\scr I_A)\cap U=N(\scr I_{A\cap U})=A\cap U$. So $A$ is analytic.
\end{proof}








\begin{df}
Let $X$ be a complex space. Then the reduced space \index{00@Reduction $\red(X)$ of a complex space $X$}
\begin{align*}
\red(X)=\Specan(\scr O_X/\sqrt{0_X})
\end{align*}
is called the \textbf{reduction} of $X$.
\end{df}







\subsection{Proof of Thm. \ref{lb108}}

\begin{df}
We say that a complex space $X$ is \textbf{irreducible at $x$} \index{00@Irreducible at a point} if $\scr O_{X,x}$ is an integral domain. (Note that if $X$ is irreducible at $x$ then $X$ is reduced at $x$.) We say that $X$ is \textbf{locally irreducible} \index{00@Locally irreducible} if $X$ is irreducible at every point of $X$.  If $X$ is not irreducible at $x$, we say that $X$ is \textbf{reducible at $x$}. \index{00@Reducible at a point} (Note that ``reducible"$\neq$``reduced"!)
\end{df}



\begin{lm}\label{lb117}
Suppose that Thm. \ref{lb108} holds whenever $X$ is irreducible at $x$. Then Thm. \ref{lb108} holds in general.
\end{lm}


\begin{proof}
Assume $\scr O_{X,x}$ is reduced. Apply prime decomposition (Thm. \ref{lb102}) to $A=\scr O_{X,x}$ to get $\{0\}=\pk_1\cap\cdots\cap\pk_N$. By shrinking $X$ to a neighborhood of $x$ we assume each $\pk_i$ is the stalk $\scr P_{i,x}$ of a coherent ideal $\scr P_i$ of $\scr O_X$. Let $Y_i=\Specan(\scr O_X/\scr P_i)$. Then $Y_i$ is irreducible at $x$. Since $\bigcap_{i=1}^N\scr P_i$ is $\scr O_X$-coherent (Cor. \ref{lb110}), we may shrink $X$ so that $\bigcap_i \scr P_{i,y}=\{0\}$ for all $y\in X$.

By assumption, we can shrink $X$ further so that each $Y_i$ is reduced everywhere. This means that for each $y\in X$ we have $\scr P_{i,y}=\sqrt{\scr P_{i,y}}$. Therefore by Rem. \ref{lb105}, the zero ideal of $\scr O_{X,y}$ is its own radical. So $\scr O_{X,y}$ is reduced.
\end{proof}







\begin{lm}\label{lb112}
Let $X$ be a model space irreducible at $0\in X$. Then after shrinking $X$ to a neighborhood of $0$, there exists $\varDelta\in\scr O(X)$ whose germ is non-zero at $0$ such that $X$ is smooth outside $N(\varDelta)$. 
\end{lm}








\begin{proof}[\textbf{Proof of Thm. \ref{lb108}}]
By Lemma \ref{lb117}, it suffices to assume that $X$ is a complex model space irreducible (and hence reduced) at $0$.  Assume that the statement in Lemma \ref{lb112} holds. Since $\varDelta$ is non-zero in the integral domain $\scr O_{X,0}$, $\varDelta$ is a non zero-divisor of $\scr O_{X,0}$. Therefore, by Prop. \ref{lb113}, we may shrink $X$ to a neighborhood of $0$ so that $\varDelta$ is a non zero-divisor of $\scr O_{X,x}$ for all $x\in X$.

Choose any open $V\subset X$ and $f\in\sqrt{0_X}(V)$. Since $X\setminus N(\varDelta)$ is a complex manifold, $\sqrt{0_{X\setminus N(\varDelta)}}=0$. So the support of $f$, or more precisely $\Supp(f\scr O_V)$, is inside $N(\varDelta)$. So $\varDelta$ vanishes on $\Supp(f\scr O_V)$. Therefore, by Nullstellensatz (Rem. \ref{lb115}-3), for each $x\in V$ there is $n\in\Nbb$ such that $f\varDelta^n=0$ in $\scr O_{X,x}$. This proves $f=0$ in $\scr O_{X,x}$ because $\varDelta$ is a non zero-divisor. Therefore $\sqrt{0_X}=0$.
\end{proof}







The proof of Lemma \ref{lb112} is postponed to Sec. \ref{lb119}. We first give a preliminary lemma which will aid in the proof of Lemma \ref{lb112}.



\begin{lm}\label{lb111}
Let $(w_1,\dots,w_m,z_1,\dots,z_n)$ be the standard coordinates of $\Cbb^{m+n}$. Let $I$ be an ideal of $\scr A=\scr O_{\Cbb^{m+n},0}$ such that $I\neq\scr A$. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $I\subset w_1\scr A+\cdots+w_m\scr A$.
\item $\partial_{z_j}I\subset I$ for all $1\leq j\leq n$.
\end{enumerate}
\end{lm}


\begin{proof}
By taking power series expansions one sees immediately (1)$\Rightarrow$(2). Now let us assume (2) and prove (1). Note that $I\neq\scr A$ means that all elements of $I$ vanish at $0$. Now (2) implies that all higher partial derivatives over $z_1,\dots,z_n$ of $f\in I$ are in $I$, and hence vanish at $0$. Therefore the restriction of $f$ to $0_{\Cbb^m}\times\Cbb^n$ must be constantly zero, since its power series expansion at $0$ is zero. But the ideal of elements of $\scr A$ vanishing on $0\times\Cbb^n$ is precisely $w_1\scr A+\cdots+w_m\scr A$. This proves (1).
\end{proof}



\section{Local decomposition of reduced complex spaces}


\subsection{Germs of analytic subsets and ideals}\label{lb157}


Fix a complex space $X$. Suppose that $X$ is reduced and $x\in X$. Then similar to Rem. \ref{lb118}, we have a bijection $A\mapsto I_A,N(I)\mapsfrom I$:
\begin{enumerate}[label=(\arabic*)]
\item Germs of analytic subsets of $X$ at $x$.
\item Ideals $I\subset\scr O_{X,x}$ satisfying $I=\sqrt I$.
\end{enumerate}
Indeed, (1) are precisely the germs of closed reduced complex subspaces of $X$ passing through $x$, and (2) are precisely the germs of coherent ideals $\mc I\subset\scr O_X$ at $x$ satisfying $\mc I=\sqrt{\mc I}$ (cf. Thm. \ref{lb49}). 

\begin{rem}
To be more explicit, if a germ $A$ in (1) is represented by an analytic subset $A$ closed in a neighborhood $U$ of $x$, then the stalk at $x$ of $\scr I_A=\{f\in\scr O_U:f(y)=0,\forall y\in A\}$ gives the corresponding ideal $I_A$ in (2). Conversely, given an ideal $I$ in (2) which is finitely generated because $\scr O_{X,x}$ is Noetherian, let $f_1,\dots,f_k\in I$ generated $I$, and choose a neighborhood $U\subset X$ of $x$ such that $f_1,\dots,f_k\in\scr O_X(U)$. Then the germ at $x$ of $N(f_1\scr O_U+\cdots+f_k\scr O_U)$ gives the germ $N(I)$ in (1).
\end{rem}




\begin{rem}\label{lb128}
We list some easy but useful facts about this correspondence. Let $(X,x)$ be a germ of reduced complex space.
\begin{itemize}
\item $I_{A\cup B}=I_A\cap I_B=\sqrt{I_A\cdot I_B}$.
\item By Prop. \ref{lb103}-(c), $\scr O_{X,x}$ is an integral domain if and only if $(X,x)$ is an irreducible germ, namely if $(X,x)=(A,x)\cup (B,x)$ where $(A,x),(B,x)$ are germs of analytic subsets then $(A,x)=(X,x)$ or $(B,x)=(X,x)$.
\begin{itemize}
\item More precisely, $\scr O_{X,x}$ is an integral domain iff for every neighborhood $U$ of $x$ written as $U=A\cup B$ where $A,B$ are analytic subsets of $U$, one of $A$ and $B$ contains a neighborhood of $x\in X$.
\end{itemize}
\end{itemize}
\end{rem}

\subsection{Local decomposition}


\begin{thm}\label{lb124}
Let $X$ be a reduced complex space and $x\in X$. Then after shrinking $X$ to a neighborhood of $x$, we have
\begin{align}
X=X_1\cup\cdots\cup X_N  \label{eq61}
\end{align}
where each $X_i$ is an analytic subset of $X$ which is irreducible at $x$, and for each $1\leq i\leq N$,
\begin{align}
\bigcup_{j\neq i}X_j\quad\textnormal{contains no neighborhoods of }x\in X.\label{eq62}
\end{align}
Such decomposition of $X$ is unique up to shrinking $X$ to smaller neighborhoods of $x$. We call it the \textbf{local decomposition of $X$ at $x$}. \index{00@Local decomposition of $X$ at $x$} Moreover, we have
\begin{align}
\{0\}=\scr I_{X_1,x}\cap\cdots\cap\scr I_{X_N,x}  \label{eq63}
\end{align}
which gives the prime decomposition of $\{0\}\subset\scr O_{X,x}$.
\end{thm}

Note that (assuming \eqref{eq61} then) \eqref{eq62} is equivalent to saying that
\begin{align}\label{eq64}
X\Big\backslash \bigcup_{j\neq i}X_j=X_i\Big\backslash \bigcup_{j\neq i}X_j\quad\text{intersects every neighborhood of }x\in X.
\end{align}


\begin{proof}
Uniqueness: Every local decomposition \eqref{eq61} clearly gives a prime decomposition \eqref{eq63}, where the condition $\bigcap_{j\neq i}\scr I_{X_j,x}\neq 0$ corresponds precisely to \eqref{eq62}. The uniqueness of prime decomposition implies the uniqueness of local decomposition.

Existence: Let $\{0\}=\pk_1\cap\cdots\cap\pk_N$ be the prime decomposition of $\{0\}\subset\scr O_{X,x}$. By shrinking $X$, for each $i$ we may find a coherent ideal $\scr P_i$ whose stalk at $x$ is $\pk_i$. Since $\scr P_1\cap\cdots\cap\scr P_N$ is coherent (Cor. \ref{lb110}), we can shrink $X$ further so that $\scr P_1\cap\cdots\cap\scr P_N=0_X$. So by Rem. \ref{lb105},
\begin{align*}
X=N(0_X)=N(\scr P_1\cap\cdots\cap\scr P_N)=N(\scr P_1\cdots\scr P_N)=X_1\cup\cdots\cup X_N.
\end{align*}
This gives a local decomposition.
\end{proof}


Property \eqref{eq62} can be upgraded to the following form:

\begin{thm}\label{lb125}
Let $X=X_1\cup\cdots\cup X_N$ be a local decomposition of a reduced complex space $X$ at $x$. Then after shrinking $X$ to a neighborhood of $x$, for each $i\neq j$,
\begin{align}
X_i\cap X_j~~\text{is nowhere dense in }X_i\label{eq65}
\end{align}
In that case, $X$ is reducible at each point of $X_i\cap X_j$ where $i\neq j$.
\end{thm}

Note that \eqref{eq65} implies, for instance, that if $1\leq k<N$ then $(X_1\cup\cdots\cup X_k)\cap (X_{k+1}\cup\cdots\cup X_N)$ is nowhere dense in every $X_i$. Hence it is nowhere dense in any union of subclass of $X_1,\dots,X_N$.


We will prove Thm. \ref{lb125} in Sec. \ref{lb126}. Note that (cf. Rem. \ref{lb127}) here $X_i\cap X_j$ means set-theoretic intersection (i.e. intersection of analytic subsets), but not intersection of complex spaces. But this is not really a big issue here; we are just reminding the readers of the conventions we set before.







\section{Non zero-divisors and nowhere dense analytic subsets}\label{lb126}


As an application of local decomposition, we give a useful method for showing that an analytic subset is nowhere dense:





\begin{pp}\label{lb121}
Let $X$ be a reduced complex space and $x\in X$. Choose $f\in\scr O(X)$. Then the following are equivalent. 
\begin{enumerate}[label=(\arabic*)]
\item $f$ is a non zero-divisor of $\scr O_{X,x}$.
\item There is a neighborhood $U\subset X$ of $x$ such that $N(f)\cap U$ is nowhere dense in $U$.
\end{enumerate}
\end{pp}

\begin{proof}
Assume (1) is true. Then by Prop. \ref{lb113}, after shrinking $X$ to a neighborhood of $x$, $f$ is a non-zero divisor of $\scr O_{X,p}$ for all $p\in X$. If $N(f)$ contains an open subset $V$ of $X$, then $f$ takes value zero everywhere on $V$. So $f|_V=0$ because $X$ is reduced, contradicting the fact that $f$ is a non zero-divisor of $\scr O_{V,p}$ when $p\in V$.  So (2) must be true.

Assume that (1) is not true. By shrinking $X$, we may find a local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$. By Cor. \ref{lb120}, the germ of $f$ at $x$ belongs to $\scr I_{X_i,x}$ for some $i$. Shrink $X$ so that $f\in\scr I_{X_i}(X)$. Then $f$ vanishes on $X_i$. Thus, after shrinking $X$ to any neighborhood $U$ of $x$, $N(f)\supset X_i$ contains an open subset $X\setminus \bigcup_{j\neq i}X_j$ of $X$ which is non-empty by \eqref{eq34}. So (2) is not true.
\end{proof}


In the case that $X$ is irreducible at $x$, Condition-(2) of Prop. \ref{lb121} is equivalent to the seemingly weaker statement that $N(f)$ contains no neighborhoods of $x\in X$:


\begin{co}\label{lb177}
Let $X$ be a complex space irreducible at $x$. If $A$ is an analytic subset of $X$ containing no neighborhoods of $x\in X$, then there is a neighborhood $U$ of $x\in X$ such that $A\cap U$ is nowhere dense in $U$.
\end{co}

\begin{proof}
Since $A$ contains no neighborhoods of $x\in X$, the germs $(A,x)$ and $(X,x)$ are not equal. So $\scr I_{A,x}$ is not equal to $\scr I_{X,x}=0$. Thus, after shrinking $X$ to a neighborhood of $x$, we may find $f\in\scr I_A(X)$ non-zero in the integral domain $\scr O_{X,x}$. By Prop. \ref{lb121}, we may shrink $X$ further so that $N(f)$ is nowhere dense in $X$. So $A\subset N(f)$ is nowhere dense.
\end{proof}





\begin{rem}\label{lb122}
Prop. \ref{lb121} can be used in the following way. 
\begin{itemize}
\item Suppose $A$ is an analytic subset of a reduced space $X$. To show that $A$ is nowhere dense, it suffices to prove that for each $x\in A$ there is a non zero-divisor $f\in\scr O_{X,x}$ vanishing on $A\cap U$ for a neighborhood $U$ of $x$. Then after shrinking $U$, $N(f)\cap U$ is nowhere dense. So its subset $A\cap U$ is nowhere dense.
\end{itemize}
Actually, if $A$ is expected to be nowhere dense, then one must be able to find such $f$ due to the following generalization of Prop. \ref{lb121}:
\end{rem}



\begin{pp}\label{lb123}
Let $X$ be a reduced complex space and $\mc I$ a coherent ideal of $\scr O_X$. Let $A=N(\mc I)$. The following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $A$ is nowhere dense in $X$.
\item For each $x\in X$, $\mc I_x$ contains a non zero-divisor of $\scr O_{X,x}$.
\end{enumerate}
\end{pp}

Another description of nowhere dense analytic subsets is given by Ritt's lemma \ref{lb147}.


\begin{proof}
(2)$\Rightarrow$(1) is already explained in Rem. \ref{lb122}. Let us prove (1)$\Rightarrow$(2).

Assume that $A$ is nowhere dense. By shrinking $X$ to a neighborhood of $x$ we may find a local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$.  For each $i$, we have $(X_i,x)\nsubset(A,x)$, namely, we cannot find any neighborhood $U\subset X$ of $x$ such that $X_i\cap U\subset A\cap U$: Otherwise, by \eqref{eq64}, $X_i$ contains an open subset (namely $X_i\setminus\bigcap_j X_j$) which intersects $U$, contradicting the fact that $A$ is nowhere dense. 

Therefore, we have $\scr I_{A,x}\nsubset \scr I_{X_i,x}$ for all $i$. Since $\sqrt{\mc I_x}=\scr I_{A,x}$ and $\scr I_{X_i,x}$ is its own radical, we have $\mc I_x\nsubset\scr I_{X_i,x}$. The existence of a non zero-divisor follows from the next lemma.
\end{proof}






\begin{lm}\label{lb145}
Let $X=X^1\cup\cdots\cup X^N$ be a decomposition of reduced complex space $X$ into analytic subsets. Let $x\in X$, and assume that each $X^j$ has a local decomposition at $x$:
\begin{align*}
X^j=X^j_1\cup X^j_2\cup\cdots
\end{align*}
Suppose that we have a linear subspace $\scr W\subset\scr O_{X,x}$ such that
\begin{align*}
\scr W\nsubset \scr I_{X^j_i,x}\qquad (\forall i,j)
\end{align*}
Then there is an element of $\scr W$ which is a non zero-divisor of $\scr O_{X^1,x},\dots,\scr O_{X^N,x}$.
\end{lm}

\begin{proof}
Since each $\scr W\cap \scr I_{X^j_i,x}$ is not the full space $\scr W$, the \emph{finite} union $\bigcup_{i,j} (\scr W\cap\scr I_{X_i^j,x})=\scr W\cap \big(\bigcup_{i,j}\scr I_{X_i^j,x}\big)$ is not $\scr W$. So there is an element $f\in\scr W$ which is not in $\bigcup_{i,j}\scr I_{X_i^j,x}$. By Cor. \ref{lb120}, $f$ is a non zero-divisor of each $\scr O_{X^j,x}$.
\end{proof}

Note that in the above proof we have used the fact that $\Cbb$ is an infinite field. Over a finite field, a finite union of proper linear subspaces might be the full linear space.



We are now ready to prove Thm. \ref{lb125}.



\begin{proof}[\textbf{Proof of Thm. \ref{lb125}}]
We set $A=X_i,B=X_j$ for simplicity. In view of Prop. \ref{lb123}, proving \eqref{eq65} means proving the following claim: After shrinking $X$ to a neighborhood of $x$, for each $y\in A\cap B$, $\scr I_{A\cap B,y}$ contains a non zero-divisor of $\scr O_{A,y}$.

Note that $\scr I_{A\cap B}\supset\scr I_{A}+\scr I_{B}$. Since $\{0\}=\scr I_{X_1,x}\cap\cdots\cap\scr I_{X_N,x}$ is a prime decomposition, we have $\scr I_{B,x}\nsubset\scr I_{A,x}$. Therefore $(\scr I_{A,x}+\scr I_{B,x})\setminus \scr I_{A,x}$ is non-empty. Choose any element $f$ of this set. Then since $\scr I_{A,x}$ is prime, $f$ is a non zero-divisor of $\scr I_{A,x}$. By shrinking $X$ to a neighborhood of $x$, we have that $f\in (\scr I_{A}+\scr I_{B})(U)$ and that (by Prop. \ref{lb113}) $f$ is a non zero-divisor of $\scr O_{A,y}$ for all $y\in X$. This proves the claim.

Now assume that \eqref{eq65} holds for all $i\neq j$. Let us prove the last sentence of Thm. \ref{lb125}. Let $X_2'=X_2\cup X_3\cup\cdots\cup X_N$. Then $X_1\cap X_2'$ is nowhere dense in $X_1$ and in $X_2'$. Therefore we have decomposition $X=X_1\cup X_2'$, and for each $y\in X_1\cap X_2\subset X_1\cap X_2'$, $X_1$ and $X_2'$ contain no neighborhoods of $y$ in $X$. So by Rem. \ref{lb128}, the germ $(X,y)$ is not reducible when $y\in X_1\cap X_2$, and similarly when $y\in X_i\cap X_j$ for all $i\neq j$.
\end{proof}





















\section{Ranks of Jacobian matrices and singular loci}\label{lb119}



The goal of this section is to prove Lemma \ref{lb112}, a crucial ingredient in the proof that any complex space reduced at a point is reduced near that point (Thm. \ref{lb108}). Indeed, even if we assume that a complex space is reduced everywhere, this lemma still tells us something interesting: it says that if $X$ is irreducible at $0$ then, after shrinking $X$ to a neighborhood of $0$, $X$ is smooth outside a nowhere dense analytic subset (due to Prop. \ref{lb121}). 

The proof of Lemma \ref{lb112} relies on Jacobian matrices, which are very useful for determining the singular locus of a complex space.


\begin{df}
If $X$ is a complex space, we define the \textbf{singular locus} of $X$ \index{00@Singular locus $\Sing(X)$} to be the closed (cf. Cor. \ref{lb130}) subset 
\begin{align*}
\Sing(X)=\{x\in X:X\text{ is not smooth at }x\}.
\end{align*}
\end{df}



\subsection{Jacobian matrices}\label{lb116}




Assume $X=\Specan(\scr O_U/\mc I)$ is a closed subspace of an open $U\subset\Cbb^m$, where $\mc I$ is generated by $f^1,\dots,f^n\in\scr O(U)$. Let $(z_1,\dots,z_m)$ be the standard coordinates of $\Cbb^m$, and consider the Jacobian matrix function
\begin{align*}
\partial_{z_\blt}(f^\blt)=\Big(\partial_{z_i}f^j\Big)_{1\leq i\leq m}^{1\leq j\leq n}
\end{align*}
which is an $m\times n$ matrix valued function on $U$ whose $i\times j$ entry is $\partial_{z_i}f^j$. 


For each $k\in\Nbb$, let
\begin{align}
Z_k=\{x\in U:\rank~ \partial_{z_\blt}(f^\blt)(x)\leq k\}.
\end{align}
Then clearly
\begin{align}
Z_0\subset Z_1\subset\cdots\subset Z_{m-1}\subset Z_m= Z_{m+1}=Z_{m+2}=\cdots=U.
\end{align}
Each $Z_k$ is an analytic subset of $U$, because
\begin{align}\label{eq59}
Z_k=\bigcap_{
\begin{subarray}{c}
1\leq i_1<\cdots <i_{k+1}\leq m\\
1\leq j_1<\cdots<j_{k+1}\leq n
\end{subarray}}
N\left(\det~\partial_{z_\blt}(f^\blt)\Big|_{i=i_1,\dots,i_{k+1}}^{j=j_1,\dots,j_{k+1}}\right)
\end{align}




\subsection{Proof of Lemma \ref{lb112}}





\begin{proof}[\textbf{Proof-Step 1}]
Assume the setting of Subsec. \ref{lb116}, and assume $0\in X$. In this first step, we construct $\varDelta$.  Fix $r\in\Nbb$ to be 
\begin{align*}
r=\text{``the smallest number such that $(Z_r\cap X,0)=(X,0)$"}
\end{align*}
where $(Z_r\cap X,0),(X,0)$ are germs of sets at $0$. Namely, $r$ is the smallest number such that $Z_r\cap X$ contains a neighborhood of $0\in X$. Thus, we may shrink\footnote{This is the only place we shrink $U$ in Step 1 and 2 of the proof.} $U$  so that
\begin{align*}
X\subset Z_r
\end{align*}
at the level of sets. More precisely, $N(\mc I)\subset Z_r$.



Since $Z_{r-1}\cap X$ containes no neighborhoods of $0\in X$, by \eqref{eq59} we can choose an $r\times r$-submatrix, say the first $r$ rows and the first $r$ columns:
\begin{align*}
\partial_{z_\blt}(f^\blt)\Big|_{\leq r}^{\leq r}=\Big(\partial_{z_i}f^j\Big)_{1\leq i\leq r}^{1\leq j\leq r},
\end{align*}
such that the zero set of its determinant
\begin{align*}
\varDelta=\det~\partial_{z_\blt}(f^\blt)\Big|_{\leq r}^{\leq r}\qquad\in\scr O(U)
\end{align*}
intersected with $X$ contains no neighborhoods of $0\in X$. (Note that $Z_{r-1}\subset N(\varDelta)$.) This implies that $\varDelta$ is non-zero in $\scr O_{X,0}$. Our goal is to show that $X\setminus N(\varDelta)$ is smooth.
\end{proof}

\begin{proof}[\textbf{Proof-Step 2}]
Set 
\begin{align*}
w_1=f^1,\dots,w_r=f^r,\qquad w_{r+1}=z_{r+1},\dots,w_m=z_m.
\end{align*}
Then by inverse function theorem, each point $x\in U\setminus N(\varDelta)$ has a neighborhood on which $w_1,\dots,w_m$ are a set of coordinates. Recall that $\mc I_x$ is generated by $w_1,\dots,w_r$ and $f^{r+1},\dots,f^n$. If we can show for each $x\in X\setminus N(\varDelta)$ that $\mc I_x$ is generated by $w_1,\dots,w_r$, then $X$ is smooth at $x$, since $X$ is near $x$ the $(m-r)$-dimensional submanifold defined by $w_1=\cdots=w_r=0$. Thus $\Sing(X)\subset N(\varDelta)$.


\begin{itemize}
\item Claim: After possibly shrinking $X$ to a neighborhood of $0$, for each $x\in X\setminus N(\varDelta)$ we have
\begin{align*}
\partial_{w_i}f^j\in\mc I_x\qquad (\forall i,j>r)
\end{align*}
\end{itemize}
If this is proved, then for each $i>r$, $\partial_{w_i}f^j$ belongs to $\mc I_x$ for all $j$ since it is zero when $j\leq r$. Then $\partial_{w_i}\mc I_x\subset\mc I_x$. Thus by Lemma \ref{lb111}, $\mc I_x$ is generated by $w_1,\dots,w_r$, finishing the proof. (We warn the reader that $\partial_{w_i}$ is not equal to $\partial_{z_i}$ even if $i>r$, and is not defined on $N(\varDelta)$.)

Let us take a closer look at the relationship between the Jacobians of $(f^\blt)$ over $z_\blt$ and over $w_\blt$. On $U\setminus N(\varDelta)$ we have
\begin{align}\label{eq57}
\partial_{z_\blt}(f^\blt)=\left[
\begin{array}{c|c}
\partial_{z_\blt}(f^\blt)\Big|_{\leq r}^{\leq r} & 0\\[1.4ex]
\hline & \\[-2.3ex]
\text{\larger[2]$*$} & I_{(m-r)\times (m-r)}
\end{array}
\right] \cdot \partial_{w_\blt}(f^\blt)
\end{align}
and also
\begin{align}\label{eq58}
\partial_{w_\blt}(f^\blt)=\left[
\begin{array}{c|c}
I_{r\times r} & \clubsuit\\[0.2ex]
\hline & \\[-1.8ex]
0 & \partial_{w_\blt}(f^\blt)\Big|_{> r}^{> r}
\end{array}
\right]
\end{align}
where $\text{\larger[2]$*$}\in\scr O(U)$ and $\clubsuit\in\scr O(U\setminus N(\varDelta))$. From these two relations we observe:
\begin{enumerate}[label=Ob \arabic*.]
\item $\partial_{z_\blt}(f^\blt)\big|_{\leq r}^{\leq r}\cdot \clubsuit$ equals the upper right block of $\partial_{z_\blt}(f^\blt)$ which is holomorphic on $U$. So by inverse matrix formula/Cramer's rule, $\varDelta\cdot \clubsuit$ can be extended to an element of $\scr O(U)$. So the same can be said about $\varDelta\cdot \partial_{w_\blt}(f^\blt)\big|_{> r}^{> r}$. We conclude
\begin{align*}
\partial_{w_i}f^j=h_i^j/\varDelta \qquad\text{for some }h_i^j\in\scr O(U)\qquad (\forall i,j>r)
\end{align*}
\item At each $x\in X\setminus N(\varDelta)\subset Z_r\setminus Z_{r-1}$, the rank of $\partial_{w_\blt}(f^\blt)$ equals that of $\partial_{z_\blt}(f^\blt)$, which is $r$. Therefore, by \eqref{eq58}, for all $i,j>r$, $\partial_{w_i}f^j$ vanishes on $X\setminus N(\varDelta)$, and hence $h_i^j$ vanishes on $X\setminus N(\varDelta)$.
\end{enumerate}
\end{proof}



Observation 2 shows that if we already know that $X$ is reduced, then every holomorphic function vanishing on $X\setminus N(\varDelta)$, in particular $\partial_{w_i}f^j$ where $i,j>r$, must be an element of $\mc I(X\setminus N(\varDelta))$. Then the Claim in Step 2 follows and hence $\Sing(X)\subset N(\varDelta)$. But since we cannot assume what we want to prove, we need a little more effort to prove the Claim.



In Step 1 and 2, we have not used the fact that $X$ is irreducible at $x$. This condition enters Step 3 of the proof. Indeed, we only need the weaker condition that $X$ is reduced at $x$.


\begin{proof}[\textbf{Proof-Step 3}]
Assume that $\scr O_{X,0}$ is an integral domain, and hence reduced. For each $i,j>r$, the two observations in Step 2 show that the holomorphic function $\varDelta\cdot h_i^j$ on $U$ takes value zero at every point of $X$. So its germ at $0$ is a nilpotent element of $\scr O_{X,0}$ by Nullstellensatz, and hence is zero. We can thus shrink $U$ to a neighborhood of $0$ so that $\varDelta\cdot h_i^j$ is zero in $\scr O_X(X)$ for all $i,j>r$. If $x\in X\setminus N(\varDelta)$, then $\varDelta(x)\neq 0$ and hence $\varDelta$ is invertible in $\scr O_{X,x}$. Therefore in $\scr O_{X,x}$ we have $h_i^j=0$ and hence $\partial_{w_i}f^j=0$ if $i,j>r$. This proves the claim in Step 2 that $\partial_{w_i}f^j$ is in $\mc I_x$.
\end{proof}

We are done with the proof of Lemma. \ref{lb112}.


\subsection{Additional comments}

Assume the setting of Subsec. \ref{lb116}, and assume moreover that $X$ is reduced. Assume $U$ is small enough so that $X\subset Z_r$. Then Proof-Step 1\&2 show that $\Sing(X)\subset X\cap N(\varDelta)$ (see the comments before Step 3), and that $X\setminus N(\varDelta)$ is an $m-r$ dimensional complex manifold.  Note that in the proof we take $\varDelta$ to be the determinant of one $r\times r$ submatrix of $\partial_{z_\blt}f^\blt$, and we may well take other submatrices. By \eqref{eq59},  $Z_{r-1}$ is the intersection of $N(\varDelta)$ where $\varDelta$ runs through the determinants of all $k\times k$ submatrices of $\partial_{z_\blt}f^\blt$. Therefore $\Sing(X)\subset X\cap Z_{r-1}$.


It is natural to ask if we have $\Sing(X)= X\cap Z_{r-1}$. In Sec. \ref{lb131}, we will prove Lemma \ref{lb132} saying that this is indeed true if $X\cap Z_{r-1}$ is nowhere dense in $X$. Note that if $X$ is irreducible at $0$, then $\varDelta$ is non-zero in $\scr O_{X,0}$ and hence is a non zero-divisor. Thus, by Prop. \ref{lb121}, we can shrink $X$ to a neighborhood of $0$ so that $X\cap N(\varDelta)$ and hence $X\cap Z_{r-1}$ are nowhere dense in $X$.

\begin{lm}\label{lb132}
Assume the setting of Subsec. \ref{lb116}.
\begin{enumerate}[label=(\arabic*)]
\item Assume that $X$ is reduced, that $X\subset Z_r$, and that $X\cap Z_{r-1}$ is nowhere dense in $X$. Then
\begin{align*}
\Sing(X)=X\cap Z_{r-1}
\end{align*}
and $X\setminus Z_{r-1}$ is an $(m-r)$-dimensional complex manifold.
\item If the $X$ in Subsec. \ref{lb116} is irreducible at $0\in X$, then we can shrink $U$ to a neighborhood of $0\in U$ (and replace $X$ by $X\cap U$) so that the assumptions in (1) are satisfied for some $r\in\Nbb$.
\end{enumerate}
\end{lm}

The only thing in Lemma \ref{lb132} unproved so far is $\Sing(X)\supset X\cap Z_{r-1}$. 


















\section{Embedding dimensions and singular loci}\label{lb131}



The rank of $\partial_{z_\blt}f^\blt$ in Subsec. \ref{lb116} depends on how $X$ is embedded into an open subset of a number space. Using Jacobi criterion, we can relate this rank to intrinsic numbers of $X$ call embedding dimensions.

\subsection{Embedding dimensions}



\begin{df}\label{lb149}
Let $X$ be a complex space and $x\in X$. The \textbf{embedding dimension} of $X$ at $x$, \index{00@Embedding dimension $\emb_xX=\emb\scr O_{X,x}$} denoted by $\emb_xX$ or $\emb\scr O_{X,x}$, is the smallest $n$ such that a neighborhood $U$ of $x$ can be closely embedded to an open subset of $\Cbb^n$. 

Equivalently (Prop. \ref{lb21}), $\emb_xX$ is the smallest $n$ such that there is a neighborhood $U$ of $x$ and a holomorphic $f:U\rightarrow\Cbb^n$ which is an immersion at $x$.  \hfill\qedsymbol
\end{df}


\begin{pp}\label{lb133}
For each complex space $X$ and $x\in X$,
\begin{align}
\emb_xX=\emb\scr O_{X,x}=\dim_\Cbb\fk m_{X,x}/\fk m_{X,x}^2.
\end{align}
\end{pp}

\begin{proof}
If $\varphi:X\rightarrow \Cbb^n$ is an immersion at $x$, then by Thm. \ref{lb25}, $n\geq\dim\fk m_{X,x}/\fk m_{X,x}^2$. We can choose $n$ to be  $\dim\fk m_{X,x}/\fk m_{X,x}^2$ by shrinking $X$ to a neighborhood of $x$, and choosing $f_1,\dots,f_n\in\scr O(X)$ generating $\fk m_{X,x}/\fk m_{X,x}$. Then $\varphi=(f_1,\dots,f_n)$ is an immersion at $x$ due to Thm. \ref{lb25}.
\end{proof}


As an immediate consequence of Prop. \ref{lb133}, $\Cbb^n$ has embedding dimension $n$ everywhere. Thus, for complex manifolds, embedding dimensions agree with the usual dimensions. 



\begin{pp}\label{lb178}
Let $Z$ be a complex space and $\mc I$ a coherent ideal of $\scr O_Z$. Let $X=\Specan(\scr O_Z/\mc I)$ and $x\in X$, and define the quotien map $d_x:\fk m_{Z,x}\rightarrow\fk m_{Z,x}/\fk m_{Z,x}^2$ (the differential map of $Z$ at $x$). Then
\begin{align}
\emb_x X+\dim_\Cbb d_x(\mc I_x)=\emb_xZ.\label{eq77}
\end{align}
\end{pp}

\begin{proof}
We have an exact sequence
\begin{align*}
0\rightarrow \frac{\fk m_{Z,x}^2+\mc I_x}{\fk m_{Z,x}^2} \rightarrow \frac{\fk m_{Z,x}}{\fk m_{Z,x}^2}\rightarrow \frac{\fk m_{Z,x}}{\fk m_{Z,x}^2+\mc I_x}\rightarrow 0
\end{align*}
where $\frac{\fk m_{Z,x}}{\fk m_{Z,x}^2+\mc I_x}=\fk m_{X,x}/\fk m_{X,x}^2$ since $\fk m_{X,x}=\fk m_{Z,x}/\mc I_x$. Thus \eqref{eq77} follows.
\end{proof}



\index{00@Jacobi criterion}
\begin{co}[\textbf{Jacobi criterion}]
Let $U$ be an open subset of $\Cbb^m$, let $\mc I$ be the ideal of $\scr O_U$ generated by $f^1,\dots,f^n\in\scr O(U)$, and let $X=\Specan(\scr O_U/\mc I)$. Then for each $x\in X$,
\begin{align}
\emb_xX+\rank_x\big(\partial_{z_\blt}f^\blt\big)=m.
\end{align}
\end{co}


\begin{proof}
One checks easily that $\rank_x\big(\partial_{z_\blt}f^\blt\big)$ equals $\dim_\Cbb d_x(\mc I_x)$.
\end{proof}



\subsection{Analysis of singular loci}



\begin{proof}[\textbf{Proof of Lemma \ref{lb132}}]
Under the assumptions of (1), we need to show that each $x\in X\cap Z_{r-1}$ is a singular point. If $x$ is smooth, we can find a neighborhood $W\subset X$ of $x$ which is a complex manifold. In particular, the embedding dimensions of $W$ must be constant on $W$. Thus, by Jacobi criterion, the ranks of $\partial_{z_\blt}f^\blt$ are constant on $W$.

Notice the assumptions in (1) that $X\cap Z_{r-1}$ is nowhere dense in $X$. So $W\nsubset X\cap Z_{r-1}$. From the definition of $Z_\blt$, we know that the ranks of $\partial_{z_\blt}f^\blt$ on $Z_{r-1}$ (and in particular at $x\in W$) are $\leq r-1$, and that the rank on the non-empty set $W\setminus Z_{r-1}$ is $r$ (since $X\subset Z_r$). This is impossible. So $x$ is singular.
\end{proof}



Lemma \ref{lb132} shows that if $X$ is irreducible at $0$, then the singular locus of a neighborhood of $0\in X$ is a nowhere dense analytic subset of that neighborhood. This property can be generalized.

\begin{pp}\label{lb134}
Let $X$ be a complex space reduced at $x$. Then after shrinking $X$ to a neighborhood of $x$, there is a local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$ such that
\begin{align}\label{eq66}
\Sing(X)=\Big(\bigcup_{i\neq j}X_i\cap X_j\Big)\cup\Big(\bigcup_i\Sing(X_i)\Big).
\end{align}
In particular, after shrinking $X$ further, $\Sing(X)$ is a nowhere dense analytic subset of $X$.
\end{pp}

Note that each $\Sing(X_i)$ can be described by Lemma \ref{lb132}. We thus have an explicit local description of singular loci of reduced complex spaces.

\begin{proof}
Clearly we have $\subset$ in \eqref{eq66}. To show $\supset$ we only need to show that $\Sing(X)\supset X_i\cap X_j$ if $i\neq j$ and after shrinking $X$. This is due to Thm. \ref{lb125}, since a reducible point must be singular.
\end{proof}

\begin{thm}\label{lb179}
Let $X$ be a complex space. Then $\Sing(X)$ is an analytic subset of $X$. If $X$ is reduced, then $\Sing(X)$ is nowhere dense in $X$.
\end{thm}

\begin{proof}
Prop. \ref{lb134} (together with Lemma \ref{lb132}) shows that if $X$ is reduced, then each $x\in X$ is contained in a neighborhood $U_x\subset X$ such that $\Sing(X)\cap U_x$ is analytic and nowhere sense in $U_x$. Therefore by Cor. \ref{lb136}, $\Sing(X)$ is analytic and nowhere dense in $X$. In the general case, $X=X'\cup (X\setminus X')$ where $X'$ is the set of non-reduced points of $X$, which is an analytic subset by Cor. \ref{lb105}. Clearly
\begin{align}
\Sing(X)=X'\cup\Sing(X\setminus X').
\end{align}
So $\Sing(X)$ must be analytic.
\end{proof}



\section{Products of reduced spaces are reduced}



In this section, we give our first application of Thm. \ref{lb179}: We study the reducedness of complex spaces with the help of their singular loci.
\begin{pp}\label{lb181}
Let $X$ be a complex space and $x\in X$. Let $\mc I$ be a coherent ideal of $\scr O_X$ such that $N(\mc I)=\Sing(X)$. (For instance, $\mc I=\scr I_{\Sing(X)}$.) Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $X$ is reduced at $x$.
\item $\mc I_x$ contains a non zero-divisor of $\scr O_{X,x}$.
\end{enumerate}
\end{pp}

\begin{proof}
Assume (1). We may shrink $X$ to a neighborhood of $x$ so that $X$ is reduced. Then by Thm. \ref{lb179}, $N(\mc I)$ is nowhere dense in $X$. Thus (2) follows from Prop. \ref{lb123}.

Assume (2). Shrink $X$ so that there is $f\in\mc I(X)$ which is a non zero-divisor of $\scr O_{X,x}$. To prove (1), we need to show that every $g\in\sqrt{0_{X,x}}$ is zero. Shrink $X$ further so that $g\in\scr O(X)$ and $g^n$ is zero in $\scr O(X)$ for some $n\in\Zbb_+$. Since $X\setminus N(X)$ is smooth, $g|_{X\setminus N(X)}=0$. So $\Supp(g)=\Supp(g\scr O_X)$ is inside $N(\mc I)$. Since $f$ vanishes on $N(\mc I)$, by Nullstellensatz (Rem. \ref{lb115}-3), there is $k\in\Zbb_+$ such that in $\scr O_{X,x}$ we have $f^kg=0$, and hence $g=0$ because $f$ is a non zero-divisor. 
\end{proof}

Note that the proof of (2)$\Rightarrow$(1) is similar to that of Thm. \ref{lb108}. (See the proof above Lemma \ref{lb111}.)


We shall proved that the direct product of two reduced complex spaces is reduced. To prove this fact, we first need a result on the tensor product of non zero-divisors.

\begin{pp}\label{lb180}
Let $X,Y$ be complex spaces and $x\in X,y\in Y$. Let $f\in\scr O_{X,x}$ be a non zero-divisor of $\scr O_{X,x}$ and $g\in\scr O_{X,x}$ be a non zero-divisor of $\scr O_{Y,y}$. Then $f\otimes g$ is a non zero-divisor of $\scr O_{X,x}\wht\otimes\scr O_{Y,y}=\scr O_{X\times Y,x\times y}$.
\end{pp}


Recall the meaning of $f\otimes g$ in \eqref{eq78}. Since $f\otimes g=(f\otimes 1)(1\otimes g)$ and the product of two non zero-divisors is a non zero-divisor, it suffices to prove that $f\otimes 1$ is a non zero-divisor.



 
\begin{proof}[Proof-Step 1]
We prove Prop. \ref{lb180} under the assumption that $y$ is the only point of $Y$. Then the obvious projection $Y\rightarrow\{0\}$, where $\{0\}$ is the \emph{reduced} single point, is finite.  Therefore, by Cor. \ref{lb97}, we have
\begin{align*}
\scr O_{X\times Y,x\times y}\simeq \scr O_{X,x}\otimes_\Cbb\scr O_{Y,y}.
\end{align*}
Note that by Thm. \ref{lb74}, $\scr O_{Y,y}$ is a finite-dimensional vector space. Then one checks easily that $f\otimes 1$ is a non zero-divisor: choose any element of  $\scr O_{X,x}\otimes_\Cbb\scr O_{Y,y}$ which can be written as a finite sum $h=\sum_i h_i\otimes e_i$ where $\{e_i\}$ is a basis of $\scr O_{Y,y}$. If $(f\otimes 1)h=\sum_i fh_i\otimes e_i$ is zero, then each $fh_i=0$, and hence $h_i=0$.
\end{proof}


\begin{proof}[Proof-Step 2]
We now prove the general case. Choose any $h\in\scr O_{X\times Y,x\times y}$ such that $(f\otimes 1)h=0$. We shall prove that $h\in \fk m_{Y,y}^k\cdot\scr O_{X\times Y,x\times y}$ for all $k\in\Nbb$. Then since $\fk m_{Y,y}^k\cdot\scr O_{X\times Y,x\times y}\subset\fk m_{X\times Y,x\times y}^k$, we have $h=0$ by Krull's intersection Thm. \ref{lb162}.


Let $\mc J$ be $\scr I_{\{y\}}$, the ideal sheaf of all sections of $\scr O_{Y}$ vanishing at $y$. Then $\mc J_y=\fk m_{Y,y}$. Thus, what we need to prove is that $h$ is zero in $\scr O_{X\times Y,x\times y}/\mc J_y^k\scr O_{X\times Y,x\times y}$ for all $k$. Let $Y^k=\Specan(\scr O_Y/\mc J^k)$ whose underlying topological space is $\{y\}$ but might be non-reduced. Let $\pr_Y:X\times Y\rightarrow Y$ be the projection. Then by Rem. \ref{lb58} and Prop. \ref{lb32}, $\scr O_{X\times Y,x\times y}/\mc J_y^k\scr O_{X\times Y,x\times y}$ is the stalk at $x\times y$ of
\begin{align*}
\scr O_{X\times Y}/\mc J^k\scr O_{X\times Y}=\scr O_{\pr_Y^{-1}(Y^k)}=\scr O_{X\times Y^k}.
\end{align*}
Note that by Prop. \ref{lb32}, the inclusion $\iota_{X\times Y^k,X\times Y}$ equals $\id_X\times\iota_{Y^k,Y}$. Thus, the residue class of $f\otimes 1_{\scr O_{Y,y}}=\pr_{X\times Y,X}^*f$ in $\scr O_{X\times Y^k,x\times y}$ is
\begin{align*}
(\id_X\times\iota_{Y^k,Y})^*\pr_{X\times Y,X}^*f=\pr_{X\times Y^k,X}^*f=f\otimes 1_{\scr O_{Y^k,y}}
\end{align*}
which,  by Step 1, is a non zero-divisor of $\scr O_{X\times Y^k,x\times y}$. So $h$ is $0$ in $\scr O_{X\times Y^k,x\times y}$. This finishes the proof.
\end{proof}




\begin{thm}
Let $X,Y$ be reduced complex spaces. Then the direct product $X\times Y$ is reduced.
\end{thm}

\begin{proof}
Since reducedness is a local property, we may assume that $X$ and $Y$ are small enough. Choose any $x\in X$ and $y\in Y$. Since $X,Y$ are reduced, by Prop. \ref{lb181}, we may shrink $X,Y$ to  neighborhoods of $x,y$ respectively so that we can find $f\in\scr I_{\Sing(X)}(X)$ which is a non zero-divisor of $\scr O_{X,x}$, and find $g\in\scr I_{\Sing(Y)}(Y)$ which is a non zero-divisor of $\scr O_{Y,y}$. Since $f$ takes value zero on $\Sing(X)$, $f\otimes 1$ takes value zero on $\Sing(X)\times Y$, and similarly $1\otimes g$ takes value zero on $X\times\Sing(Y)$. Thus $f\otimes g=(f\otimes 1)(1\otimes g)$ vanishes on
\begin{align}
(\Sing(X)\times Y)\cup (X\times\Sing(Y))\supset \Sing(X\times Y).
\end{align}
The above $\supset$ is due to the fact that the product of smooth spaces is smooth, according to Exp. \ref{lb182}. 

Now we have $f\otimes g\in\scr I_{\Sing(X\times Y)}(X\times Y)$. By Prop. \ref{lb180}, $f\otimes g$ is a non zero-divisor of $\scr O_{X\times Y,x\times y}$. So by \ref{lb181}, $X\times Y$ is reduced at $x\times y$.
\end{proof}










\section{Non locally-free loci of coherent sheaves}


In this section, we use (co)rank functions to study the non locally-free loci of coherent sheaves.

\begin{df}
Let $X$ be a complex space and $\scr E$ an $\scr O_X$-module. We say that $\scr E$ is \textbf{locally free at $x$} \index{00@Locally free at a point} if there is a neighborhood $U\subset X$ of $x$ such that $\scr E|_U$ is $\scr O_U$-free. (Recall our convention that free sheaves are assumed to have finite ranks). When $\scr E$ is $\scr O_X$-coherent, then this is equivalent to saying that $\scr E_x$ is a free $\scr O_{X,x}$-module (Thm. \ref{lb49}).

The (clearly closed) subset of all $x\in X$ at which $\scr E$ is not locally free is called the \textbf{non locally-free locus} of $\scr E$. \index{00@Non locally-free loci}   \hfill\qedsymbol
\end{df}


\begin{lm}\label{lb137}
Let $\mc A$ be a commutative Noetherian local ring and $\mc M$ an $\mc A$-module together with a surjective morphism of $\mc A$-modules $\varphi:\mc A^n\rightarrow\mc M$. Then $\mc M$ is $\mc A$-free if and only if the morphism
\begin{align*}
\varphi_*:\Hom_{\mc A}(\mc M,\mc A^n)\rightarrow \Hom_{\mc A}(\mc M,\mc M),\qquad \alpha\mapsto \varphi\circ\alpha
\end{align*}
is surjective.
\end{lm}

\begin{proof}
If $\mc M$ is free then $\varphi_*$ is surjective because $\Hom_{\mc A}(\mc M,-)$ is right exact. Conversely, if $\varphi_*$ is surjective, then the fact that $\id_{\mc M}$ is in the image of $\varphi_*$ means that there is a lift $\psi:\mc M\rightarrow\mc A^n$ such that $\varphi\circ\psi=\id_{\mc M}$. This proves that $\mc M$ is a direct summand of $\mc A^n$, and hence that $\mc M$ is a projective $\mc A$-module. So it is flat, and hence free.
\end{proof}



\begin{thm}\label{lb168}
Let $X$ be a complex space and $\scr E$ a coherent $\scr O_X$-module. Then
\begin{align*}
E=\{x\in X:\scr E\text{ is not locally free at }x\}
\end{align*}
is an analytic subset of $X$. If $X$ is reduced, then $E$ is nowhere dense.
\end{thm}



\begin{proof}[Proof-Step 1]
Let us prove that $E$ is analytic. By Cor. \ref{lb136}, it suffices to show that each $x\in X$ is contained in a neighborhood such that $E\cap U$ is analytic in $U$. So let us assume $X$ is so small that there is a surjective $\scr O_X$-module morphism $\varphi:\scr O_X^n\rightarrow\scr E$. This yields a morphism of coherent modules (cf. Cor. \ref{lb138})
\begin{align*}
\shom_{\scr O_X}(\scr E,\scr O_X^n)\rightarrow\shom_{\scr O_X}(\scr E,\scr E).
\end{align*}
The support of the cokernel of this morphism is, by Lemma \ref{lb137}, the set of all $x$ such that $\scr E_x$ is not $\scr O_{X,x}$-free, namely $E$. So $E$ is analytic since it is (as a set) the support of a coherent sheaf.
\end{proof}



\begin{proof}[Proof-Step 2]
Assume that $X$ is reduced. We need to show that $E$ contains no nonempty open subsets of $X$. By shrinking $X$, it suffices to prove that $E\neq X$. So let us assume $E=X$ and find a contradiction. 

Now our assumption is that $\scr E$ is nowhere locally free on $X$. By shrinking $X$, we assume that 
\begin{align*}
\scr E\simeq\Cok(\varphi:\scr O_X^m\rightarrow\scr O_X^n).
\end{align*}
Let $\xi_1=\varphi(1,0,\dots,0),\dots,\xi_m=\varphi(0,0,\dots,1)$, which are elements of $\scr O(X)^n$. Then $F=(\xi_1,\dots,\xi_m)$ can be viewed as an element of $\scr O(X)^{n\times m}$, i.e. an $n\times m$ matrix-valued holomorphic function on $X$. And for each $x\in X$, setting $\Cbb_x=\scr O_{X,x}/\fk m_{X,x}\scr O_{X,x}$, we have
\begin{align*}
&n-\rank F(x)=\dim\Cok(\varphi(x):\Cbb_x^m\rightarrow\Cbb_x^n)\\
=&\dim \Cok(\varphi\otimes 1:\scr O_X^m\otimes_\Cbb \Cbb_x\rightarrow\scr O_X^n\otimes_\Cbb \Cbb_x)\\
=&\dim \Cok(\varphi:\scr O_X^m\rightarrow\scr O_X^n)\otimes_\Cbb \Cbb_x=\dim(\scr E|x).
\end{align*}

As in Subsec. \ref{lb116}, for each $k\in\Nbb$, the set
\begin{align*}
\Gamma_k=\{x\in X:\rank F(x)\leq k\}
\end{align*}
is an analytic subset of $X$. We let $r$ be the smallest number such that $\Gamma_r$ contains a nonempty open subset of $X$. Then $\Gamma_r\setminus \Gamma_{r-1}$ also contains a non-empty open subset $U\subset X$. By restricting $X$ to $U$, we assume that $X=\Gamma_r$. So the dimensions of the fibers $\dim(\scr E|x)$ are constant on $X$. Therefore, since $X$ is reduced, Prop. \ref{lb65} implies that $\scr E$ is locally free on $X$. Impossible.
\end{proof}


\begin{exe}
Let $X$ be a reduced complex space irreducible at $x\in X$. Show that after shrinking $X$ to a neighborhood of $x$, there is $r\in\Nbb$ such that $X=\Gamma_r$ and that $\Gamma_{r-1}$ is nowhere dense in $X$. Show that if $X=\Gamma_r$ and if $\Gamma_{r-1}$ is nowhere dense then $\Gamma_{r-1}$ is the non locally-free locus of $\scr E$.
\end{exe}




\section{Dimensions}



\begin{df}\label{lb140}
Let $X$ be a complex space and $x\in X$. The \textbf{(Chevalley) dimension of $\scr O_{X,x}$}, also called the  \textbf{dimension of $X$ at $x$} \index{00@Dimension at a point $\dim_xX=\dim\scr O_{X,x}$} and denoted by $\dim\scr O_{X,x}$ or equivalently $\dim_xX$, is the smallest $n\in \Nbb$ such that:
\begin{itemize}
\item There exists a neighborhood $U$ of $x$ and $f_1,\dots,f_n\in\scr O(U)$ such that $x$ is an isolated point of $N(f_1,\dots,f_n)$.
\end{itemize}
It is clear that $\dim_xX=0$ iff $x$ is an isolated point of $X$. 
%We set
%\begin{align}
%\dim_xX=-1\qquad\text{if }x\notin X.
%\end{align}

The \textbf{global dimension} \index{00@Global dimension $\dim X$} is defined to be
\begin{align*}
\dim X=\sup_{x\in X}\dim_xX.
\end{align*}
We say that $X$ is \textbf{(resp. locally) pure dimensional} \index{00@Pure dimensional and locally pure dimensional complex spaces} if $x\in X\mapsto\dim_xX$ is a (resp. locally) constant function. We say that $X$ has \textbf{pure dimension $n$ at $x$} \index{00@Pure dimensional at a point} if $X$ has dimension $n$ at every point of a neighborhood of $x$. \hfill\qedsymbol
\end{df}

\subsection{Basic facts about dimensions}


\begin{pp}\label{lb142}
Let $X$ be a complex space and $x\in X$. Then
\begin{align*}
\dim_xX=\dim_x\red(X).
\end{align*}
Equivalently, for $\scr A=\scr O_{X,x}$ we have
\begin{align*}
\dim\scr A=\dim\scr A/\sqrt{0_{\scr A}}.
\end{align*}
\end{pp}

\begin{proof}
If $X$ is small enough such that $f_1,\dots,f_n\in\scr O(X)$ makes $x$ an isolated point of $N(f_\blt)$, then their restrictions to $\red(X)$ (i.e. their residue classes in $\red(X)$) also make $x$ an isolated point of the zero set. 

Conversely, if $f_1,\dots,f_n\in\scr O(\red(X))$ makes $x$ an isolated point of $N(f_\blt)$, then after shrinking $X$ to a neighborhood of $x$, we can assume $f_1,\dots f_n$ are the restrictions of elements of $\scr O(X)$, whose zero set also has $x$ as an isolated point.
\end{proof}

\begin{pp}\label{lb141}
We have $\dim_xX\leq n$ if and only if there exist a neighborhood $U_x\subset X$ of $x$, an open subset $V\subset\Cbb^n$, and a finite holomorphic map $F:U_x\rightarrow V$.
\end{pp}

\begin{proof}
The ``if" part is clear. The ``only if" part follows by choosing $F=(f_1,\dots,f_n)$ (where $f_\blt$ are in Def. \ref{lb140}) and applying Thm. \ref{lb75} to deduce the finiteness.
\end{proof}

\begin{co}\label{lb153}
For each complex space $X$, the dimension function
\begin{align*}
X\rightarrow \Nbb\qquad x\mapsto\dim_xX
\end{align*}
is upper semicontinuous.
\end{co}


\begin{proof}
Fix any $p\in X$ and let $n=\dim_pX$. Then by Prop. \ref{lb141}, we may shrink $X$ to a neighborhood of $p$ and find an open subset $V\subset\Cbb^n$ such that there is a finite map $\varphi:X\rightarrow\Cbb^n$. Then clearly $\dim_xX\leq n$ for each $x\in X$.
\end{proof}

\begin{co}\label{lb143}
Let $\varphi:X\rightarrow Y$ be a finite holomorphic map. Then for each $x\in X$,
\begin{align}
\dim_x X\leq \dim_{\varphi(x)}Y.
\end{align}
\end{co}

\begin{proof}
Let $y=\varphi(x)$ and $n=\dim_yY$. By Prop. \ref{lb141}, after shrinking $Y$ and replacing $X$ by $\varphi^{-1}(Y)$, we have a finite holomorphic may $\pi:Y\rightarrow V$ where $V$ is an open subset of $\Cbb^n$. Since $F\circ\varphi:X\rightarrow V$ is finite, by Prop. \ref{lb141} we conclude $\dim_xX\leq n$.
\end{proof}








\begin{pp}
Let $X$ be a complex space and $x\in X$. The following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\dim_xX=0$, namely, $x$ is an isolated point of $X$.
\item $\scr O_{X,x}$ is a finite-dimensional vector space.
\item $\scr O_{X,x}$ is an Artinian ring.
\end{enumerate}
\end{pp}


\begin{proof}
(1)$\Rightarrow$(2): By shrinking $X$, we assume $x$ is the only point of $X$. Let $\{0\}$ be the reduced single point (whose structure sheaf is $\Cbb$). Then the obvious holomorphic map $X\rightarrow\{0\}$ is finite. Therefore, by Thm. \ref{lb74}, $\scr O_{X,x}$ is $\Cbb$-coherent, i.e., $\Cbb$-finite-dimensional.

(2)$\Rightarrow$(3): Obvious.

(3)$\Rightarrow$(1): Let $X$ be a closed subspace of an open subset $V$ of $\Cbb^n$ and assume $x=0$. Then for each $1\leq i\leq n$, we have a decreasing sequence of ideals
\begin{align*}
\fk m_{X,x}\supset z_i\fk m_{X,x}\supset z_i^2\fk m_{X,x}\supset\cdots
\end{align*}
which must be stable at $z_i^k\fk m_{X,x}$ for some $k\in\Zbb_+$ independent of $i$. So $z_i^k\fk m_{X,x}=z_i^{k+1}\fk m_{X,x}$ and hence $z_i^k=z_i^{k+1}f_i$ for some $f_i\in \fk m_{X,x}$. Hence
\begin{align*}
z_i^k(1-z_if_i)=0.
\end{align*}
Since $f_i(0)=0$, $1-z_if_i$ is invertible in $\scr O_{X,x}$. So $z_i^k=0$ in $\scr O_{X,x}$. Thus, after shrinking $V$ to a neighborhood of $0$, the residue class of  $z_i^k\in\scr O(V)$ is zero in $\scr O(X)$. Therefore the underlying set of $X$ is contained in $N(z_1^k,\dots,z_n^k)=\{0\}$.
\end{proof}




\section{Active lemma for dimensions}


Let $X$ be a complex space.

\subsection{Active lemma}



\begin{df}
An element $f\in\scr O(X)$ is called \textbf{active at $x$} or \textbf{active in $\scr O_{X,x}$} \index{00@Active elements} if $f$ (or more precisely $\red(f)$) is a non zero-divisor of $\scr O_{\red(X),x}$.
\end{df}

Non zero-divisors are always active, but the converse is not true.

\begin{pp}
If $f\in\scr O(X)$ is a non zero-divisor of $\scr O_{X,x}$, then $f$ is active in $\scr O_{X,x}$.
\end{pp}

\begin{proof}
Let $\scr A=\scr O_{X,x}$. Suppose that $f$ is not active at $x$, i.e. $f$ is a zero-divisor of $\scr A/\sqrt{0}$. Then $fg\in\sqrt{0}$ for some $g\in\scr A$ and $g\notin\sqrt{0}$. So for some $n\in\Zbb_+$ we have $f^ng^n=0$ in $\scr A$. Notice that $g^n\neq 0$. So we can find $k\in\Nbb$ such that in $\scr A$ we have $f^kg^n\neq 0$ and $f\cdot f^kg^n=0$. Therefore $f$ is a zero-divisor of $\scr A$.
\end{proof}



\index{00@Active lemma}



\begin{thm}[\textbf{Active lemma}]
Let $f\in\scr O(X)$ and $x\in N(f)$. If $f$ is a non zero-divisor of $\scr O_{X,x}$, then
\begin{align}
\dim_x N(f)=\dim_x X-1.\label{eq68}
\end{align}
Thus, by Prop. \ref{lb142}, if $f$ is active at $x$ then \eqref{eq68} also holds.
\end{thm}



One may compare Active lemma with Prop. \ref{lb178}.





\begin{proof}
Let $m=\dim_x N(f)$ and $n=\dim_xX$. Then, after shrinking $X$ to a neighborhood of $x$, there are $g_1,\dots,g_m\in\scr O(X)$ such that $N(f)\cap N(g_1,\dots,g_m)=\{x\}$.  Thus $n\leq m+1$.

Let us prove $m\leq n-1$. Let $A=N(f)$. By Prop. \ref{lb141}, we may shrink $X$ and find a finite holomorphic map $\varphi:X\rightarrow V$ sending $x$ to $0$, where $V\subset\Cbb^n$ is open. By Exe. \ref{lb155}, $\varphi(A)$ is an analytic subset of $V$. So $m\leq \dim_0\varphi(A)$ by Cor. \ref{lb143}. Therefore, it suffices to prove $\dim_0\varphi(A)\leq n-1$.

By Thm. \ref{lb74}, $\varphi_*\scr O_X$ is $\scr O_V$-coherent. Therefore $\scr O_{X,x}$ is a finitely-generated $\scr O_{V,0}$-module since it is a direct summand of $(\varphi_*\scr O_X)_x$ (cf. Prop. \ref{lb56}). Thus, as $\scr O_{X,x}$ is Noetherian, the germ of $f$ in $\scr O_{X,x}$ is integral over $\scr O_{V,0}$, i.e.
\begin{align*}
f^N+a_{N-1}f^{N-1}+\cdots+a_kf^k=0
\end{align*}
for some $a_k,\dots,a_{N-1}\in\scr O_{V,0}$ where $a_k$ is non-zero in $\scr O_{V,0}$. Since $f$ is a non zero-divisor of $\scr O_{X,x}$, we conclude that $a_k$ (or more precisely  $\varphi^\# a_k$) equals
\begin{align*}
-f^{N-k}-a_{N-1}f^{N-k-1}-\cdots-a_{k+1}f
\end{align*}
in $\scr O_{X,x}$. Therefore, after shrinking $V$ to a neighborhood of $0$ and replacing $X$ by $\varphi^{-1}(V)$, we have $a_k\in\scr O(V)$ and that $\varphi^\#a_k$ takes value zero on $N(f)$. Therefore $\varphi(A)\subset N(a_k)$. So it suffices to prove $\dim_0 N(a_k)\leq n-1$.

Since $a_k$ is non-zero in $\scr O_{V,0}$, as in the proof of Thm. \ref{lb70} we may choose a new set of coordinates $(z_1,\dots,z_n)$ of $\Cbb^n$ such that $a_k$ has finite order in $z_1$. So $0_{\Cbb^n}$ is an isolated point of the fiber $\pi^{-1}(0_{\Cbb^{n-1}})$, where $\pi:N(a_k)\rightarrow\Cbb^{n-1}$ is the restriction of $\pr_{\Cbb^{n-1}}:\Cbb\times\Cbb^{n-1}\rightarrow\Cbb^{n-1}$. This proves $\dim_0 N(a_k)\leq n-1$.
\end{proof}


\begin{rem}\label{lb148}
Assume $\dim_xX>0$. By taking local decomposition of $\red(X)$ at $x$ and using Cor. \ref{lb120} or Lemma \ref{lb145}, we can find $f\in\fk m_{X,x}$ which is an active germ of $X$ at $x$. By Active lemma, we can repeat this procedure to obtain $f_1,\dots,f_n\in\fk m_{X,x}$ such that, after shrinking $X$ to a neighborhood of $x$, each $f_i$ is in $\scr O(X)$ and is an active germ of $N(f_1,\dots,f_{i-1})$ at $x$. And $x$ is an isolated point of $N(f_1,\dots,f_n)$.

Contrary to active elements, if $\scr O_{X,x}$ is not reduced then $\fk m_{X,x}$ might not contain a non zero-divisor of $\scr O_{X,x}$. Thus, we may not be able to find $f_1,\dots,f_n\in\fk m_{X,x}$ such that each $f_i$ is a non zero-divisor of $\scr O_{X,x}/(f_1\scr O_{X,x}+\cdots+f_{i-1}\scr O_{X,x})$. In the case that we can, we will call $\scr O_{X,x}$ a \textbf{Cohen-Macaulay ring}. 
\end{rem}







\subsection{Immediate consequences of Active lemma}


\index{00@Ritt's lemma}




\begin{co}
If $x\in\Cbb^n$ then
\begin{align*}
\dim_x\Cbb^n=n.
\end{align*}
\end{co}
\begin{proof}
This is clear when $n=0$. That $\dim_x\Cbb^n=n$ implies $\dim_x\Cbb^{n+1}=n+1$ follows from Active lemma.
\end{proof}




\begin{co}[\textbf{Ritt's lemma}]\label{lb147}
Let $A$ be an analytic subset of a complex space $X$. The following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $A$ is nowhere dense in $X$.
\item $\dim_xA<\dim_xX$ for all $x\in X$.
\end{enumerate}
\end{co}


\begin{proof}
By Prop. \ref{lb142}, it suffices to assume that $X$ is reduced. Clearly (2)$\Rightarrow$(1). Assume (1). Then by Prop. \ref{lb123}, for each $x$ there is a non zero-divisor $f\in\scr O_{X,x}$ vanishing on the germ $(A,x)$. Therefore $\dim_xA\leq \dim_xN(f)=\dim_xX-1$ by Active lemma. This proves (2).
\end{proof}




\begin{pp}\label{lb146}
Let $X=A_1\cup\cdots\cup A_N$ be a union of analytic subsets. Then
\begin{align}
\dim_xX=\sup_{1\leq i\leq N}\dim_xA_i\label{eq69}
\end{align}
\end{pp}

\begin{proof}
By Prop. \ref{lb142}, we may assume that $X$ is reduced. ``$\geq$" clearly holds. We prove ``$\leq$" by induction on $m=\max_i\dim_xA_i$. We may assume that $x$ is in each $A_i$ and hence $\dim_xA_i\geq0$. 

The base case $m=0$ is obvious. Assume that \eqref{eq69} holds for any decomposition such that $\max_i\dim_xA_i=m-1$. Now assume $\max_i\dim_xA_i=m$. Shrink $X$ to a neighborhood of $x$ so that each $A_i$ has a local decomposition $A_i=B_{i,1}\cup B_{i,2}\cup\cdots$ at $x$. Then for each $i,j$ we have $\scr O_{X,x}\nsubset\scr I_{B_{i,j},x}$ since $1\notin\scr I_{B_{i,j},x}$. Therefore, by Lemma \ref{lb145}, we can find $f\in\scr O_{X,x}$ which is a non zero-divisor of $\scr O_{X,x}$ and of every $\scr O_{A,x}$. Thus, by Active lemma, $\dim_xN(f)=\dim_xX-1$ and $\max_i\dim_x N(f)\cap A_i=m-1$, and these two numbers are equal by our assumption that \eqref{eq69} So $\dim_xX=m$.
\end{proof}


\begin{pp}\label{lb152}
Let $X,Y$ be complex spaces and $x\in X,y\in Y$. Then
\begin{align}
\dim_{x\times y} X\times Y=\dim_xX+\dim_yY.\label{eq70}
\end{align}
\end{pp}



\begin{proof}
We prove this by induction on $m=\dim_xX$. The case $\dim_xX=0$ is obvious. Suppose \eqref{eq70} holds whenever $\dim_xX=m-1$. In the case that $\dim_xX=m$, choose  $f\in\fk m_{X,x}$ active at $x$ (Rem. \ref{lb148}). By shrinking $X$ to a neighborhood of $x$ we may assume $f\in\scr O(X)$. By Prop. \ref{lb121}, we may shrink $X$ further so that $N(f)$ is nowhere dense in $X$. So $N(f\otimes 1)=N(f)\times Y$ is nowhere dense in $Y$. By Prop. \ref{lb121} again, $f\otimes 1$ is an active germ of $X\times Y$ at $x\times y$. Therefore, by Active lemma,  $\dim_{x\times y}N(f)\times Y=\dim_{x\times y}X\times Y-1$, and $\dim_x N(f)=\dim X-1$. By assumption, $\dim_{x\times y}N(f)\times Y=\dim_xN(f)+\dim_yY$. This proves \eqref{eq70}.
\end{proof}

\subsection{Comparing different versions of dimensions}

We first compare (Chevalley) dimensions and embedding dimensions.

\begin{pp}
Let $X$ be a complex space and $x\in X$. Then $\dim_xX\leq \emb_xX$. Moreover, $X$ is smooth at $x$ if and only if $\dim_xX=\emb_xX$.
\end{pp}


\begin{proof}
Clearly $\dim_x X\leq\emb_xX$ in general (Recall Def. \ref{lb149}) and $\dim_xX=\emb_xX$ if $X$ is smooth at $x$. We now assume $n:=\emb_xX$ equals $\dim_xX$ and prove that $X$ is smooth at $x$. 

By Def. \ref{lb149}, after shrinking $X$ to a neighborhood of $x$, we may view $X$ as a closed subspace of an open subset $V$ of $\Cbb^n$. Write $X=\Specan(\scr O_V/\mc I)$. We claim that $\mc I_x=0$. Then we can choose a neighborhood $W\subset V$ of $x$ such that $\mc I|_W=0$ (Rem. \ref{lb17}), and clearly the complex subspace $X\cap W$ of $X$ is smooth. Hence $X$ is smooth at $x$.

Suppose $\mc I_x\neq0$. Then $\mc I_x$ contains a nonzero element $f$, which is a non zero-divisor of the integral domain $\scr O_{\Cbb^n,0}$. Since $f$ vanishes on the germ $(X,0)$, by Active lemma we have $\dim_xX\leq n-1$, which is  impossible. 
\end{proof}



In algebraic geometry, the dimension of a commutative ring usually means Krull dimension. Fortunately, it agrees with Chevalley dimension when the ring is an analytic local $\Cbb$-algebra.

\begin{df}
Let $\mc A$ be a commutative ring. The \textbf{Krull dimension} of $\mc A$ is the largest $n\in\Nbb$ such that there exists a chain $\pk_0\subsetneq\pk_1\subsetneq\cdots\subsetneq \pk_n$ of prime ideals of $\mc A$. If such $n$ can be arbitrarily large, we set the Krull dimension to be $+\infty$.
\end{df}








\begin{lm}\label{lb150}
Let $\pk'\subsetneq\pk$ be prime ideals of $\scr O_{X,x}$. Then
\begin{align}
\dim\scr O_{X,x}/\pk<\dim\scr O_{X,x}/\pk'. \label{eq71}
\end{align}
\end{lm}
Recall that a prime ideal of $\scr O_{X,x}$ is not equal to $\scr O_{X,x}$, and hence is contained in $\fk m_{X,x}$.

\begin{proof}
By replacing $\scr O_{X,x}$ by $\scr O_{X,x}/\pk'$ (and replacing $X$ by a closed subspace of a neighborhood of $x$), it suffices to assume that $\pk'=0$ and that $\scr A=\scr O_{X,x}$ is an integral domain. Then $0\subsetneq\pk\subsetneq\scr A$. Choose a non-zero $f\in\pk$. Then $f$ is a non zero-divisor of $\scr A$. Thus by Active lemma, $\dim\scr A/\pk\leq \dim\scr A/f\scr A=\dim\scr A-1$. This proves \eqref{eq71}.
\end{proof}

\begin{pp}
$\dim_xX$ equals the Krull dimension of $\scr O_{X,x}$.
\end{pp}


\begin{proof}
Lemma \ref{lb150} shows that $n=\dim_xX$ is no less than the Krull dimension of $\scr O_{X,x}$. To prove the equality, we need to show the existence of a chain of prime ideals $\pk_0\subsetneq\pk_1\subsetneq\cdots\subsetneq \pk_n$. We prove this by induction on $n$. The case $n=0$ is obvious. Assume this is true whenever $\dim_xX=n-1$. Now assume $\dim_xX=n$. By Rem. \ref{lb148}, we can find an active germ $f\in\fk m_{X,x}$ at $x$. Then $\dim_x N(f)=n-1$ by Active lemma. By Prop. \ref{lb146}, in the prime decomposition of $f\scr O_{X,x}\subset\scr O_{X,x}$ there is a prime component $\pk_0$ such that $\dim\scr O_{X,x}/\pk_0=n-1$. By assumption, we have a strictly increasing chain of $n$ prime ideals of  $\scr O_{X,x}/\pk_0$. These are prime ideals of $\scr O_{X,x}$ containing $\pk_0$. In this way, we get a strictly increasing chain of $n+1$ prime ideals of $\scr O_{X,x}$.
\end{proof}



\section{Noether property for coherent sheaves}

Let $X$ be a complex space. In this section, we use dimension theory and Active lemma to prove the Noether property for coherent sheaves of $X$.

\begin{df}
Let $\scr E$ be a coherent $\scr O_X$-module. An \textbf{ascending chain of coherent $\scr O_X$-submodules} of $\scr E$ is a collection $(\scr E_i)_{i\in\fk I}$ where $\fk I$ is a directed set, and $\scr E_i\subset\scr E_j$ if $i\leq j$. We say that the chain is \textbf{stationary at $x\in X$} if there is a neighborhood $U\subset X$ of $x$ and $i\in\fk I$ such that $\scr E_i|_U=\scr E_j|_U$ for all $j\geq i$. We say that $\scr E$ satisfies \textbf{Noether property at $x$} \index{00@Noether property for coherent sheaves} every every ascending chain of coherent submodules of $\scr E$ is stationary at $x$. We say that $\scr E$ satisfies \textbf{Noether property} if it satisfies Noether property at every $x\in X$.
\end{df}

It is clear that if $\scr E$ satisfies Noether property, then any ascending chain of submodules of $\scr E$ is stationary on any precompact open subset of $X$.


\begin{lm}\label{lb175}
Let $0\rightarrow\scr E\rightarrow\scr F\xrightarrow{\psi}\scr G\rightarrow0$ be an exact sequence of $\scr O_X$-modules. If $\scr F$ satisfies Noether property at $x$ then so does $\scr G$. If $\scr E$ and $\scr G$ satisfy Noether property at $x$ then so does $\scr F$.
\end{lm}


\begin{proof}
Assume that $\scr F$ satisfies Noether property at $x$. Let $(\scr G_i)_{i\in\fk I}$ be an ascending chain of coherent submodules of $\scr G$. By Cor. \ref{lb172}, $\psi^{-1}(\scr G_i)$ is $\scr O_X$-coherent. So we have an ascending chain $(\scr G_i)_{i\in\fk I}$ which is stationary at $x$. Then $(\scr G_i)_{i\in\fk I}=(\psi(\psi^{-1}(\scr G_i)))_{i\in\fk I}$ is stationary at $x$.

Now assume that $\scr E$ and $\scr G$ satisfy Noether property at $x$. Let $(\scr F_i)_{i\in\fk I}$ be an ascending chain of coherent submodules of $\scr F$. We regard $\scr E$ as a submodule of $\scr F$. Then $(\psi(\scr F_i))_{i\in\fk I}$ and $(\scr E\cap\scr F_i)_{i\in\fk I}$ are ascending chains of coherent submodules of $\scr G$ and $\scr E$ respectively, where the coherence is due to Cor. \ref{lb46} and \ref{lb110}. So they are stationary at $x$. From this one deduces that $(\scr F_i)_{i\in\fk I}$ is stationary at $x$.
\end{proof}


\begin{lm}\label{lb174}
Let $\varphi:X\rightarrow Y$ be a finite holomorphic map of complex spaces, and let $\scr E$ be an $\scr O_X$-module. Let $x\in X$. If $\varphi_*\scr E$ satisfies Noether property at $y=\varphi(x)$, then $\scr E$ satisfies Noether property at $x$. 
\end{lm}


\begin{proof}
Let $(\scr E_i)_{i\in\fk I}$ be an ascending chain of coherent submodules of $\scr E$. Then $(\varphi_*\scr E_i)_{i\in\fk I}$ is an ascending chain of coherent submodules of $\varphi_*\scr E$. By assumption, after shrinking $Y$ to a neighborhood of $y$ and shrinking $X$ to $\varphi^{-1}(Y)$, there is $i\in\fk I$ such that for all  $j\geq i$ we have $\varphi_*\scr E_i=\varphi_*\scr E_j$, namely $(\varphi_*\scr E_i)_\yk=(\varphi_*\scr E_j)_\yk$ for all $\yk\in Y$. This means, by Prop. \ref{lb56}, that $\scr E_{i,\xk}=\scr E_{j,\xk}$ for all $\xk\in\varphi^{-1}(\yk)$ and $j\geq i$. So $\scr E_i=\scr E_j$ when $j\geq i$.
\end{proof}


\begin{lm}\label{lb176}
Let $X$ be a connected open subset of $\Cbb^n$, and let $\mc I$ be a coherent ideal of $\scr O_U$. If $\mc I\neq 0_X$, then $\mc I_x\neq 0$ for every $x\in X$.
\end{lm}

\begin{proof}
We know that $\Supp(\mc I)$ is a (closed) analytic subset of $X$. If we can show that $\Supp(\mc I)$ is open in $X$, then $\Supp(\mc I)=X$, which finishes the proof of the lemma. 

Choose any $x\in\Supp(\mc I)$. Then $\mc I_x\neq 0$. There are a connected neighborhood $U$ of $x$ and $f\in\mc I(U)$ such that $f$ is non-zero in $\scr O_{U,x}$. By Identit\"atssatz \ref{lb68}, $f$ is non-zero in $\scr O_{U,p}$ for all $p\in U$, which shows $U\subset\Supp(\mc I)$.
\end{proof}




\begin{thm}
Let $X$ be a complex space and $\scr E$ a coherent $\scr O_X$-module. Then $\scr E$ satisfies Noether property.
\end{thm}


\begin{proof}
We need to prove that any coherent module $\scr E$ satisfies Noether property at $x$. We prove this by induction on $\dim_xX$. Then case $\dim_xX=0$ is obvious since $\scr E$ is a finite-dimensional vector space (Cor. \ref{lb173}). Now assume that coherent sheaves satisfy Noether property at $x$ (for all $X$ and $x\in X$) whenever $\dim_xX\leq n-1$ and $n\in\Zbb_+$. Let us prove that this is true when $\dim_xX\leq n$.

By Prop. \ref{lb141}, after shrinking $X$ to a neighborhood of $x$, we may find a finite map from $X$ to an open subset of $\Cbb^n$. Therefore, by Lemma \ref{lb174}, it suffices to assume that $X$ is an open subset of $\Cbb^n$. Let $\scr E$ be a coherent $\scr O_{X,x}$-module. After shrinking $X$ further, $\scr E$ is the cokernel of a morphism of free $\scr O_X$-modules (Thm. \ref{lb48}). Thus, by Lemma \ref{lb175}, it suffices to assume that $\scr E$ is $\scr O_X$-free, and hence that $\scr E=\scr O_X$.

Let $(\mc I_i)_{i\in\fk I}$ be an ascending chain of ideals of $\scr O_X$. We need to show that it is stationary at $x$. It suffices to assume that $\mc I_k\neq 0_X$ for some $k$. By Lemma \ref{lb176}, $\mc I_{k,x}\neq 0$. Shrink $X$ so that we can find $f\in\mc I_k(X)$ non-zero in $\scr O_{X,x}$. By discarding all $i<k$, we assume that $f\scr O_X\subset\mc I_i$ for all $i\in\fk I$. Let $\mc J_i=\mc I_i/f\scr O_X$, which is an $\scr O_X$-submodule of $\scr O_X/f\scr O_X$. Identify $\mc J_i$ with its restriction to $Y=\Specan(\scr O_X/f\scr O_X)$. Then $(\mc J_i)_{i\in\fk I}$ is an ascending chain of coherent ideals of $\scr O_Y$. Since $\scr O_{X,x}$ is an integral domain, we have $\dim \scr O_{Y,x}=\dim\scr O_{X,x}-1=n-1$ by Active lemma. Thus, by assumption, $(\mc J_i)_{i\in\fk I}$ is stationary at $x$. Therefore $(\mc I_i)_{i\in\fk I}$ is stationary at $x$.
\end{proof}




















\section{Openness and dimensions of fibers I}

\begin{df}
Let $\varphi:X\rightarrow Y$ be a continuous map of topological spaces. We say that $\varphi$ is \textbf{open at $x\in X$} \index{00@Open maps} if for each neighborhood $U\subset X$ of $x$, $\varphi(U)$ contains a neighborhood of $\varphi(x)$. We say that $\varphi$ is \textbf{open (on $X$)} if $\varphi$ is open at every point of $X$.

It is clear that $\varphi$ is open at $x$ iff
\begin{align*}
\{U\subset X:U\text{ is a neighborhood of }X\text{ and }\varphi(U)\text{ is open in }Y\}
\end{align*}
is a base of neighborhoods of $x$. \hfill\qedsymbol
\end{df}



\subsection{Dimension Formula \eqref{eq73}}



In the following, $\varphi:X\rightarrow Y$ always denotes a holomorphic map of complex spaces. For each $y\in Y$, the \textbf{fiber} $X_y$ means the inverse image $\varphi^{-1}(y)$ (cf. Prop. \ref{lb39}), \index{00@Fiber $X_y=\varphi^{-1}(y)$} namely
\begin{align*}
X_y=\varphi^{-1}(y)=\Specan(\scr O_X/\fk m_{Y,y}\scr O_X).
\end{align*}


\begin{pp}\label{lb151}
The following are true for $\varphi:X\rightarrow Y$.
\begin{enumerate}[label=(\arabic*)]
\item For each $x\in X$,
\begin{align}
\dim_x X_{\varphi(x)}\geq\dim_x X-\dim_{\varphi(x)} Y.
\end{align}
\item The function $x\in X\mapsto \dim_x X_{\varphi(x)}$ is upper semicontinuous.
\end{enumerate}
\end{pp}

Note that part (1) generalizes Cor. \ref{lb143}, and part (1) generalizes Cor. \ref{lb153}.


\begin{proof}
Fix $x\in X$. Let $m=\dim_x X_{\varphi(x)}$ and $n=\dim_{\varphi(x)}Y$. By the definition of dimensions, we may shrink $Y$ to a neighborhood of $y=\varphi(x)$ and $X$ to a neighborhood of $x$ inside $\varphi^{-1}(Y)$ such that there exist $f_1,\dots,f_m\in\scr O(X)$ such that $x$ is the only point of $N(f_1,\dots,f_m)\cap X_y$. Consider $(f_\blt)\in\scr O(X)^m$ as a holomorphic map $X\rightarrow\Cbb^m$, and let $\Psi=(f_\blt)\vee\varphi:X\rightarrow \Cbb^m\times Y$. Then $x$ is the only point of $\Psi^{-1}(\Psi(x))=\Psi^{-1}(0\times y)$. Therefore, by Thm. \ref{lb75}, we may shrink $X$ and $Y$ further so that $\Psi$ is finite. Then by Cor. \ref{lb143} and Prop. \ref{lb152},
\begin{align*}
\dim_xX\leq\dim_{0\times y}\Cbb^m\times Y=m+n.
\end{align*}
This proves (1) .

Since $\Psi$ is finite, each $p\in X$ is an isolated point of $\Psi^{-1}(\Psi(p))$. Since
\begin{align*}
\Psi^{-1}(\Psi(p))=N(f_1-f_1(p),\dots,f_m-f_m(p))\cap X_{\varphi(p)}
\end{align*}
we must have $\dim_pX_{\varphi(p)}\leq m$. This proves (2).
\end{proof}

Our main goal of this section and the next one is to understand when the following \textbf{Dimension Formula} holds:
\begin{align}
{\color{red}\dim_x X_{\varphi(x)}=\dim_x X-\dim_{\varphi(x)} Y}\label{eq73}
\end{align}
More precisely, our goal is to understand the following result of Remmert which relates the openness of $\varphi$ and \eqref{eq73}.
\begin{co}\label{lb159}
Assume that $Y$ is locally irreducible. Then $\varphi:X\rightarrow Y$ is open if and only if Dimension Formula \eqref{eq73} holds for all $x\in X$.
\end{co}
\begin{proof}
This follows from Thm. \ref{lb164} and \ref{lb165}, together with the fact that every locally irreducible space is locally pure dimensional (Thm. \ref{lb170}).
\end{proof}



The following proposition is helpful for the proof of Thm. \ref{lb164} and \ref{lb165}.

\begin{pp}\label{lb160}
Assume that $X$ and $Y$ are locally pure dimensional. If Dimension Formula \eqref{eq73} holds at $x_0\in X$, then it holds everywhere on a neighborhood of $x_0$.
\end{pp}

\begin{proof}
Since $X$ and $Y$ are locally pure dimensional, we may shrink $X$ to a neighborhood of $x_0$ so that the RHS of \eqref{eq73} is constant over all $x\in X$. By Prop. \ref{lb151}-(2), after further shrinking $X$, $\dim_x X_{\varphi(x)}\leq \dim_{x_0} X_{\varphi(x_0)}$ for all $x\in X$. By Prop. \ref{lb151}-(1), ``$\geq$" holds if \eqref{eq73} holds at $x$. So ``$=$" holds. So $\dim_x X_{\varphi(x)}$ is constant over $x\in X$. Therefore \eqref{eq73} holds for all $x\in X$. 
\end{proof}
















\subsection{Openness and Dimension Formula: the finite case}



In this subsection, we study the relation between Dimension Formula and openness when $\varphi$ is finite.


\begin{lm}\label{lb156}
Assume that $\varphi:X\rightarrow Y$ is finite. Let $x\in X$ and $y=\varphi(x)$, and assume that $x$ is the only point of $\varphi^{-1}(y)$. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is open at $x$.
\item The set $\varphi(X)$ contains a neighborhood of $y$ in $Y$.
\end{enumerate}
\end{lm}
\begin{proof}
Clearly (1)$\Rightarrow$(2). Assume (2). By Prop. \ref{lb54}, for each neighborhood $U\subset X$ of $x$ there is a neighborhood $V\subset Y$ of $y$ such that $\varphi^{-1}(V)\subset U$. Then $\varphi(U)$ contains $\varphi(\varphi^{-1}(V))=V\cap\varphi(X)$, and $V\cap\varphi(X)$ contains a neighborhood of $y\in Y$ by (2). This proves (1).
\end{proof}


\begin{thm}\label{lb158}
Assume that $\varphi:X\rightarrow Y$ is finite, and let $x\in X$. Consider the following statements:
\begin{enumerate}[label=(\arabic*)]
\item $\varphi$ is open at $x$.
\item Dimension Formula \eqref{eq73} holds at $x$, namely
\begin{align}
\dim_xX=\dim_{\varphi(x)}Y. \label{eq74}
\end{align}
\end{enumerate}
Then (1)$\Rightarrow$(2). If $Y$ is irreducible at $\varphi(x)$, then (2)$\Rightarrow$(1).
\end{thm}


\begin{proof}[Proof of (1)$\Rightarrow$(2)]
Assume for simplicity that $X,Y$ are reduced, and that (by Thm. \ref{lb75}) $x$ is the only point of $\varphi^{-1}(y)$ where $y=\varphi(x)$. Assume (1). If $\dim_xX=0$ then $y$ contains a neighborhood of itself. So $y$ is isolated in $Y$ and hence \eqref{eq74} holds.

Now assume $\dim_xX>0$. By Prop. \ref{lb54}, after shrinking $Y$ to a neighborhood of $y$ and shrinking $X$ to $\varphi^{-1}(Y)$, we may assume that $X$ has local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$. Then $x$ is not an isolated point of any $X_i$, otherwise \eqref{eq64} does not hold. Thus $\dim_x X_i>0$.

Recall that each $Y_i=\varphi(X_i)$ is an analytic subset (i.e. reduced complex subspace) of $Y$, cf. Exe. \ref{lb155}. By Cor. \ref{lb143}, $\dim_y Y_i>0$. Therefore, after shrinking $Y$ and $X$ further, we have a local decomposition $Y_i=Y_{i,1}\cup Y_{i,2}\cup\cdots$ at $y$ for all $i$, and $y$ is not an isolated point of each $Y_{i,j}$. Therefore $\scr I_{Y_{i,j},y}\subsetneq \fk m_{Y,y}$ for each $i,j$. By Lemma \ref{lb145}, there exists $g\in\fk m_{Y,y}$ which is a non zero-divisor of $\scr O_{Y_{i,j},y}=\scr O_{Y,y}/\scr I_{Y_{i,j},y}$ for all $i,j$. Shrink $Y$ and shrink $X$ to $\varphi^{-1}(X)$ so that $g\in\scr O(Y)$. Then, by Active lemma, $\dim_y N(g)\cap Y_{i,j}=\dim Y_{i,j}-1$. Thus, by Prop. \ref{lb146}, $\dim_y N(g)=\dim_y Y-1$.

We have
\begin{align*}
\scr O_{Y_i,y}=\big(\varphi_*\scr O_{X_i}/\sann(\varphi_*\scr O_{X_i})\big)_y=\scr O_{X_i,x}/\Ann_{\scr O_{Y,y}}((\varphi_*\scr O_{X_i})_y),
\end{align*}
where we have used Prop. \ref{lb56} in the last equality. Since $g$ is nonzero in $\scr O_{Y,y}$, $g\circ\varphi$ is non-zero in the integral domain $\scr O_{X_i,x}$. So by Active lemma, $\dim_y N(g\circ\varphi)=\dim_xX-1$. Clearly the restriction $\varphi:N(g\circ\varphi)\rightarrow N(\varphi)$ is finite and open. Therefore, if (2) holds for this restriction then (2) holds for $\varphi:X\rightarrow Y$. This proves (2) by induction on $\dim_xX$.
\end{proof}



\begin{proof}[Proof of (2)$\Rightarrow$(1)]
Assume that (1) is not true and that $Y$ is irreducible at $y=\varphi(x)$. By Thm. \ref{lb75}, we may assume that $x$ is the only point of $\varphi^{-1}(y)$. By Lemma \ref{lb156}, the analytic subset $\varphi(X)$ contains no neighborhoods of $y\in Y$. Equivalently, the germs of sets $(\varphi(X),y)$ and $(Y,y)$ are not equal. So $\scr I_{\varphi(X),y}$ is not $0$ in $\scr O_{Y,y}$  (cf. Subsec. \ref{lb157}). After shrinking $Y$ and shrinking $X$ to $\varphi^{-1}(Y)$, we may find $g\in\scr O(Y)$ non-zero in $\scr O_{Y,y}$ and vanishing on $\varphi(X)$. Since $Y$ is irreducible at $y$, $g$ is a non zero-divisor of $\scr O_{Y,y}$. So by Cor. \ref{lb143} and Active lemma,
\begin{align*}
\dim_xX\leq\dim_y\varphi(X)\leq\dim_y N(g)=\dim_yY-1.
\end{align*}
This disproves (2).
\end{proof}



\begin{eg}
Consider analytic subsets $X=0\times 0\times\Cbb^2$ and $Y=(\Cbb^2\times 0\times 0)\cup (0\times 0\times\Cbb^2)$ of $\Cbb^4$, viewed as reduced complex spaces. Then $Y$ is pure dimensional but is reducible at $0$. Dimension Formula \eqref{eq73} holds for the inclusion map $\iota_{X,Y}$ at every point of $X$, but $\iota_{X,Y}$ is not open at $0$. Therefore, in Thm. \ref{lb158}, to deduce (2)$\Rightarrow$(1) one cannot remove the irreducibility condition.
\end{eg}



\begin{co}[\textbf{Invariance of dimensions}]
Assume that $\varphi:X\rightarrow Y$ is finite, and let $y\in Y$. Then
\begin{align}
\dim_y \varphi(X)=\sup_{x\in X_y} \dim_x X.
\end{align}
\end{co}


\begin{proof}
By Rem. \ref{lb55}, we may assume $Y$ is small enough such that $\varphi^{-1}(Y)$ is a disjoint union $\coprod_{x\in X_y}U_x$ where each $U_x$ is a neighborhood of $x\in X$, and each restriction $\varphi:U_x\rightarrow Y$ is finite. Then $\varphi(X)=\bigcup_{x\in X_y}\varphi(U_x)$, and so by Prop. \ref{lb146}, we have $\dim_y\varphi(X)=\sup_{x\in X_y}\dim_y\varphi(U_x)$. By Lemma \ref{lb156}, $\varphi:U_x\rightarrow\varphi(U_x)$ is open at $x$. Thus, by Thm. \ref{lb158}, $\dim_y\varphi(U_x)=\dim_x U_x=\dim_x X$.
\end{proof}











\section{Openness and dimensions of fibers II}


We fix a holomorphic map $\varphi:X\rightarrow Y$. 

\subsection{Openness and Dimension Formula: the general case}

The following theorem generalizes the part (2)$\Rightarrow$(1) of Thm. \ref{lb158}.


\begin{thm}\label{lb163}
Let $x\in X$, and assume that $Y$ is irreducible at $\varphi(x)$. If Dimension Formula \eqref{eq73} holds at $x$, then $\varphi$ is open at $x$.
\end{thm}

\begin{proof}
Let $y=\varphi(x)$ and $\dim_xX_y=m$, and assume that \eqref{eq73} holds at $x$. We may shrink $X$ to a neighborhood of $x$ so that there exist $f_1,\dots,f_m\in\scr O(X)$ such that $N(f_1,\dots,f_m)\cap X_y=\{x\}$. Consider $F=(f_1,\dots,f_m)$ as a holomorphic map $X\rightarrow\Cbb^m$. Then $\Upsilon=\varphi\vee F:X\rightarrow Y\times \Cbb^m$ satisfies that $x$ is the only point of $\Upsilon^{-1}(y\times 0)$. Since the projection $\pr_Y:Y\times\Cbb^m\rightarrow Y$ is open and $\varphi=\pr_Y\circ\Upsilon$, in order to show that $\varphi$ is open at $x$ it suffices to show that $\Upsilon$ is open at $x$. 

By Thm. \ref{lb75}, we may shrink $X$ further so that $\Upsilon$ is finite map from $X$ to a neighborhood of $y\times 0$ in $Y\times\Cbb^m$. By assumption, Dimension formula holds for $\Upsilon$ at $x$. Thus, $\Upsilon$ is open at $x$ by Thm. \ref{lb158} and the fact that $Y\times\Cbb^m$ is irreducible at $y\times 0$ (due to Lemma \ref{lb161}).
\end{proof}

\begin{lm}\label{lb161}
If $Y$ is irreducible at $y$, then $Y\times\Cbb^m$ is irreducible at $y\times 0$.
\end{lm}

\begin{proof}
By induction, it suffices to assume $m=1$. Let $\scr A=\scr O_{Y,y}$ and $\scr B=\scr O_{Y\times\Cbb,y\times 0}$. It suffices to prove that there is a monomorphism of $\Cbb$-algebras $\scr B\rightarrow \scr A[[z]]$ where $\scr A[[z]]$ is the algebra of formal power series of $z$ whose coefficients are elements of $\scr A$. Then since $\scr A$ is an integral domain, $\scr A[[z]]$ is clearly also an integral domain, and so is $\scr B$.

We may write $\scr A=\scr O_{\Cbb^n,0}/J$ where $J$ is an ideal of $\scr O_{\Cbb^n,0}$, and write $y=0$ (in $\Cbb^n$). Let $(w_1,\dots,w_n,z)$ be the set of coordinates of $\Cbb^{n+1}$. Then we have a $\Cbb$-algebra monomorphism $\Phi:\scr O_{\Cbb^{n+1},0}\rightarrow\scr O_{\Cbb^n,0}[[z]]$ defined by taking power series expansions with respect to $z$. More precisely, if $f(w_\blt,z)$ is in $\scr O_{\Cbb^{n+1},0}$, then $\Phi(f)=\sum_{k\in\Nbb} a_k(w_\blt)z^k$ where
\begin{align*}
a_k(w_\blt)=\Res_{z=0}f(w_\blt,z)z^{-k-1}dz.
\end{align*}
This formula shows that if $f(w_\blt,z)$ belongs to $J\scr O_{\Cbb^{n+1},0}$ (i.e. $f$ is a (finite) $\scr O_{\Cbb^{n+1},0}$-linear combination of elements $g(w_\blt)\in J$) then each coefficient $a_k$ belongs to $J$. Thus $\Phi$ restricts to a morphism
\begin{align*}
\Psi:\scr B=\scr O_{\Cbb^{n+1},0}/J\scr O_{\Cbb^{n+1},0}\rightarrow\scr A[[z]]=(\scr O_{\Cbb^n,0}/J)[[z]]
\end{align*} 

If $\Psi$ sends the residue class $[f]\in\scr B$ of $f\in\scr O_{\Cbb^{n+1},0}$ to the zero element of $\scr A[[z]]$, then each $a_k$ belongs to $J$. The power series expansion $f=\sum_k a_kz^k$ shows that $[f]$ belongs to $z^k\scr B\subset\fk m_{Y\times\Cbb,0}^k$ for all $k\in\Nbb$. Thus $[f]=0$ by Krull's intersection Thm. \ref{lb162}. This proves that $\Psi$ is injective.
\end{proof}


\begin{thm}\label{lb164}
Assume that $Y$ is locally pure dimensional. If $\varphi:X\rightarrow Y$ is open, then Dimension Formula \eqref{eq73} holds for every $x\in X$. 
\end{thm}

This theorem can not be proved by Thm. \ref{lb158}. Instead, a prototype of this theorem is Prop. \ref{lb165}-A which can be proved before we prove Thm. \ref{lb164}.

\begin{proof}
Assume that $Y$ has pure dimensions $n$. Fix $x\in X$ and $y=\varphi(x)$. Then \eqref{eq73} obviously holds when $n=0$. Now assume $n>0$. To prove \eqref{eq73} by induction on $n$, it suffices to show that after shrinking $Y$ to a neighborhood of $y$ and $X$ to $\varphi^{-1}(Y)$, there exists $g\in\scr O(Y)$ with $g(y)=0$ such that
\begin{enumerate}[label=(\alph*)]
\item $N(g)$ has pure dimension $n-1$.
\item $\dim_x N(g\circ\varphi)=\dim_xX-1$.
\end{enumerate}
Then \eqref{eq73} holds at $x$ for the restriction of $\varphi$ to $N(g\circ\varphi)\rightarrow N(g)$ (since it is clearly open), and hence holds for $\varphi:X\rightarrow Y$.

By Rem. \ref{lb148}, we may shrink $Y$ (and shrink $X$ accordingly) so that there exists $g\in\scr O(Y)$ with $g(y)=0$ so that $g$ is active in $\scr O_{Y,y}$. Then by Active lemma, Dimension Formula \eqref{eq73} holds for $g:Y\rightarrow\Cbb$ at $y$. Thus, by Prop. \ref{lb160}, \eqref{eq73} holds for $g$ at every point of $Y$. This proves (a). It also proves, together with Thm. \ref{lb163}, that $g:Y\rightarrow\Cbb$ is open. So $g\circ\varphi:X\rightarrow\Cbb$ is open. Thus, by Prop. \ref{lb165}-A to be proved in the next subsection, $g\circ\varphi$ is active in $\scr O_{X,x}$. This proves (b) by Active lemma.
\end{proof}



\begin{co}
Let $\varphi:X\rightarrow S$ and $\psi:Y\rightarrow S$ be open holomorphic maps of complex spaces. Assume that $S$ is locally pure dimensional. Then for each $x\in X,y\in Y$ such that $s=\varphi(x)$ equals $\psi(y)$,
\begin{align}
\dim_{x\times y}X\times_SY=\dim_x X+\dim_y Y-\dim_sS.
\end{align}
\end{co}

\begin{proof}
By Thm. \ref{lb164}, Dimension Formula \eqref{eq73} holds at $x\times y$ for both $\varphi\times\psi:X\times Y\rightarrow S\times S$ (which, together with Prop. \ref{lb152}, shows that as an analytic subset of $X\times Y$ the fiber $X_s\times Y_s=(X\times_SY)_s$ has dimension $\dim_x X+\dim_yY-2\dim_sS$ at $x\times y$) and $X\times_SY\rightarrow S$ (which shows that $\dim_{x\times y}X\times_SY$ equals $\dim_{x\times y}(X\times_SY)_s+\dim_sS$).
\end{proof}





\subsection{Openness and active elements}



Active lemma tells us that Dimension Formula \eqref{eq73} holds if $Y=\Cbb$ and $\varphi:X\rightarrow\Cbb$ (considered as a holomorphic function) is active at $x$. This suggests that active elements are related to openness. Let us give a result indicating their relationship.

\begin{pp}\label{lb165}
Let $f\in\scr O(X)$. Consider the following conditions for $x\in X$.
\begin{enumerate}[label=(\arabic*)]
\item The holomorphic map $f:X\rightarrow\Cbb$ is open at $x$.
\item $f-f(x)$ is active in $\scr O_{X,x}$.  
\end{enumerate}
Then the following are true.
\begin{enumerate}[label=\boxed{\Alph*}]
\item If (1) holds for all $x\in X$ then (2) holds for all $x\in X$.
\item If (2) holds for a given $x\in X$ then (1) holds for the same point $x$.
\end{enumerate}
\end{pp}



\begin{proof}[Proof of $\boxed{A}$]
Assume that $f$ is open on $X$. Choose any $x\in X$. Let us prove (2) for $x$. Assume for simplicity that $X$ is reduced and $f(x)=0$. If $f$ is not active, then after shrinking $X$ to a neighborhood of $x$, there exists a non-zero $g\in\scr O(X)$ such that $fg=0$ in $\scr O(X)$. Then $U=\{p\in X:g(p)\neq 0\}$ is a non-empty open subset of $X$, and $f(U)=\{0\}$. This contradicts the fact that $f$ is open.
\end{proof}




\begin{proof}[Proof of $\boxed{B}$]
Assume that (2) is true for a given $x\in X$. Then by Active lemma, \eqref{eq73} holds for $f:X\rightarrow \Cbb$ at $x$. Thus $f$ is open at $x$ by Thm. \ref{lb163}.
\end{proof}



The proof of B shows that for any $f\in\scr O(X)$,
\begin{gather}\label{eq75}
\begin{gathered}
f-f(x)\text{ is active in }\scr O_{X,x}\\
\Downarrow\\
\text{Dimension Formula \eqref{eq73} holds for $f:X\rightarrow \Cbb$ at }x\\
\Downarrow\\
f:X\rightarrow\Cbb\text{ is open at }x
\end{gathered}
\end{gather}



The following example shows that in Thm. \ref{lb164}, knowing that $\varphi$ is open at a point $x$ is not sufficient to imply Dimension Formula \eqref{eq73} at $x$. It also shows that in Prop. \ref{lb165}, knowing that (1) holds at $x$ is not sufficient to imply (2) at $x$.





\begin{eg}
Let $X$ be reduced with local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$ where $N\geq 2$. Let $n=\dim_xX>0$. By Rem. \ref{lb106}, we may shrink $X$ to a neighborhood of $x$ and find $f\in\scr O(X)$ which belongs to $\scr I_{X_2,x},\dots,\scr I_{X_N,x}$ but not to $\scr I_{X_1,x}$. Then $f|_{X_1}$ is active in the integral domain $\scr O_{X_1,x}=\scr O_{X,x}/\scr I_{X_1,x}$, and hence $f(X_1)$ contains a neighborhood of $0=f(x)$ in $\Cbb$ by Prop. \ref{lb165}-B. This shows that $f$ is open at $x$. However, by Cor. \ref{lb120}, $f$ is not active in $\scr O_{X,x}$. 

Now we assume that $\dim_xX_1=\dim_x X_2=n$. By Active lemma, $\dim_x N(f)\cap X_1=n-1$ and $\dim_x N(f)\cap X_2=n$. Apply Prop. \ref{lb146} to $N(f)=\bigcup_i (N(f)\cap X_i)$. Then we see that $\dim_x N(f)=n$. So Dimension Formula \eqref{eq73} does not hold for $f:X\rightarrow\Cbb$ at $x$.
\end{eg}



\begin{co}[\textbf{Open mapping theorem}]
Assume that $X$ is reduced, and choose $f\in\scr O(X)$ and $x\in X$. If $f$ is not a constant function on any neighborhood of $x\in X$, then $f:X\rightarrow\Cbb$ is open at $x$.
\end{co}

Note that the condition that $f$ is not constant on neighborhoods of $x$ means precisely that $f-f(x)$ is not zero in $\scr O_{X,x}$.


\begin{proof}
We may assume $X$ is small enough that there is a local decomposition $X=X_1\cup\cdots\cup X_N$ at $x$, corresponding to the prime decomposition $\{0\}=\scr I_{X_1,x}\cap\cdots\cap\scr I_{X_N,x}$. Since $f-f(x)$ is not zero in $\scr O_{X,x}$, it does not belong to $\scr I_{X_i,x}$ for some $i$. So $f-f(x)$ is active in $\scr O_{X_i,x}=\scr O_{X,x}/\scr I_{X_i,x}$. Therefore, for each neighborhood $U$ of $x\in X$, Prop. \ref{lb165} implies that $f(X_i\cap U)$ contains a neighborhood of $f(x)\in\Cbb$. So $f(U)$ contains a neighborhood of $f(x)$. $f$ is open at $x$. 
\end{proof}












\section{Openness and torsion sheaves; irreducible and pure dimensional}


The goal of this section is to use torsion sheaves to establish a relationship between irreducibility and pure dimensionality.

\subsection{Coherence of torsion sheaves}


\begin{df}
Let $\mc A$ be a commutative ring and $\mc M$ an $\mc A$-module. A \textbf{torsion element} of $\mc M$ \index{00@Torsion elements and torsion modules $T_{\mc A}(\mc M)$} is an element $\xi\in\mc M$ such that $a\xi=0$ for a non zero-divisor $a\in \mc A$ of $\mc A$. The set of torsion elements clearly form an $\mc A$-submodule, and is denoted by $T_{\mc A}(\mc M)$ or simply $T(\mc M)$ and called the \textbf{torsion module} of $\mc M$. We say that $\mc M$ is \textbf{torsion free} \index{00@Torsion free} if $T(\mc M)=0$. In general, $\mc M/T(\mc M)$ is always torsion free.
\end{df}



\begin{df}
Let $X$ be a complex space and $\scr E$ and $\scr O_X$-module. The \textbf{torsion sheaf} \index{00@Torsion sheaf $\scr T_{\scr O_X}(\scr E)$} of $\scr E$, denoted by $\scr T_{\scr O_X}(\scr E)$ or simply $\scr T(\scr E)$, is the sheaf associating to each open $U\subset X$:
\begin{align*}
\scr T_{\scr O_X}(\scr E)(U)=\{s\in\scr E(U):\text{the stalk }s_x\in T_{\scr O_{X,x}}(\scr E_x), \forall x\in U\}
\end{align*}
We have a canonical equivalence
\begin{align}
\scr T_{\scr O_X}(\scr E)_x \simeq T_{\scr O_{X,x}}(\scr E_x).\label{eq76}
\end{align}
\end{df}

Note that to show \eqref{eq76} one needs the fact that any $s\in\scr T(\scr E)$ torsion in $\scr E_x$ is torsion in $\scr E_p$ for all $p$ in a neighborhood of $x$. This follows from Prop. \ref{lb113}.



There is a geometric description of torsion elements:

\begin{pp}
Let $X$ be a reduced complex space, $\scr E$ a coherent $\scr O_X$-module, and $s\in\scr E(X)$. Then $s$ belongs $\scr T(\scr E)(X)$ if and only if $\Supp(s):=\Supp(s\scr O_X)$ is nowhere dense in $X$.
\end{pp}

Applying this proposition to sufficiently small neighborhoods of $x$, we see that the stalk $s_x$ belongs to $T(\scr E_x)$ iff $\Supp(s)\cap U$ is nowhere dense in $U$ for a neighborhood $U$ of $x$. When $X$ is irreducible at $x$, then by Cor. \ref{lb177}, $s_x\in T(\scr E_x)$ iff $\Supp(s)$ contains no neighborhoods of $x\in X$.

\begin{proof}
Assume that $s\in\scr T(\scr E)(X)$. Then each $x\in X$ is contained in a neighborhood $U$ such that there is $f\in\scr O(U)$ such that $fs=0$ and that $f$ is a non zero-divisor of $\scr O_{X,x}$. Then $\Supp(s)\cap U\subset N(f)$, and by Prop. \ref{lb121}, $N(f)$ is nowhere dense after shrinking $U$ to a smaller neighborhood of $x$. This proves that $\Supp(s)$ is nowhere dense.

Conversely, suppose that $\Supp(s\scr O_X)$ is nowhere dense. Recall that $\Supp(s)$ is the zero set of $\sann(s\scr O_X)$. Thus, by Prop. \ref{lb123}, there is a non zero-divisor $f\in\scr O_{X,x}$ such that $f\in\sann(s\scr O_X)_x=\Ann(s\scr O_{X,x})$. So $fs=0$. Therefore $s$ belongs to $R(\scr E_x)$ for every $x$.
\end{proof}




In the following discussion of torsion sheaves, we are mainly interested in integral domains and locally irreducible spaces.


\begin{pp}
Let $\mc M$ be a finitely generated module of an integral domain $\mc A$. Then $T_{\mc A}(\mc M)$ is the kernel of the canonical morphism $\mc M\rightarrow\mc M^{\vee\vee}$, where $\mc M^{\vee\vee}$ is the double dual of $\mc M$. 
\end{pp}





\begin{proof}
Choose any $\xi\in\mc M$. Then $\xi$ belongs to the kernel of $\Phi:\mc M\rightarrow\mc M^{\vee\vee}$ iff $\psi(\xi)=0$ for all $\psi\in\mc M^\vee=\Hom_{\mc A}(\mc M,\mc A)$. If $\xi\in T(\mc M)$ then $a\xi=0$ for a nonzero $a\in\mc A$. So $a\psi(\xi)=\psi(a\xi)=0$, and hence $\psi(\xi)=0$ because $a$ is a non zero-divisor.

Conversely, choose any $\xi\in\mc M\setminus T(\mc M)$. We need to show that there exists $\psi\in\mc M^\vee$ such that $\psi(\xi)\neq 0$. Let $\mc M/\mc A^\times$ be the division of $\mc M$ by $\mc A^\times=\{a\in\mc A:a\neq 0\}$, which is a vector space over the factional field $\mc Q=\mc A/\mc A^\times$. (So elements of $\mc M/\mc A^\times$ are of the form $\xi/a,\eta/b,\dots$ where $\xi,\eta\in\mc M$ and $a,b\in\mc A^\times$. $\xi/a=\eta/b$ iff $ca\xi=cb\eta$ for some $c\in\mc A^\times$. See \cite[Chapter 3]{AM} for details). So $\xi/1$ is not zero in $\mc M/\mc A^\times$. We can thus choose a $\mc Q$-linear functional $\lambda:\mc M/\mc A^\times\rightarrow\mc Q$ such that $\lambda(\xi/1)\neq 0$.

Since $\mc M$ is $\mc A$-generated by finitely many elements $\eta_1,\eta_2,\dots$, we may find $a\neq 0$ in $\mc A$ such that $a\lambda(\eta_i)\in\mc A$ for each $i$. Then
\begin{align*}
\psi:\mc M\rightarrow\mc M/\mc A^\times\xrightarrow{a\lambda}\mc A
\end{align*}
is an $\mc A$-module morphism non-zero at $\xi$.
\end{proof}



From this proposition it follows immediately that:

\begin{co}\label{lb166}
Let $X$ be a locally irreducible complex space and $\scr E$ a coherent $\scr O_X$-module. Then $\scr T_{\scr O_X}(\scr E)$ is the kernel of the canonical morphism $\scr E\rightarrow\scr E^{\vee\vee}$. Consequently, $\scr T_{\scr O_X}(\scr E)$ is $\scr O_X$-coherent.
\end{co}

\begin{rem}
In Cor. \ref{lb166}, note that the support of $\scr T(\scr E)$ (as a set) is an analytic subset of $X$ (Rem. \ref{lb167}). It is clearly inside the non locally-free locus of $\scr E$. Therefore, by Thm. \ref{lb168}, the support of $\scr T(\scr E)$ is nowhere dense in $X$.
\end{rem}


\subsection{Openness and torsion sheaves}


\begin{pp}\label{lb169}
Let $\varphi:X\rightarrow Y$ be a finite holomorphic map of complex spaces. Let $y\in Y$. Consider the following statements:
\begin{enumerate}[label=(\arabic*)]
\item $(\varphi_*\scr O_X)_y$ is a torsion free $\scr O_{Y,y}$-module.
\item $\varphi$ is open at every $x\in X_y=\varphi^{-1}(y)$. 
\end{enumerate}
Then the following are true.
\begin{enumerate}[label=\boxed{\Alph*}]
\item If $Y$ is irreducible at $y\in Y$ then (1)$\Rightarrow$(2).
\item If $X$ is irreducible at every $x\in X_y$ then (2)$\Rightarrow$(1).
\end{enumerate}
\end{pp}

Recall that $\varphi_*\scr O_X$ is $\scr O_Y$-coherent by Thm. \ref{lb74}. Also, note that $(\varphi_*\scr O_X)_y=\bigoplus_{x\in X_y}\scr O_{X,x}$ by Prop. \ref{lb56}. Thus $(\varphi_*\scr O_X)_y$ is $\scr O_{Y,y}$-torsion-free iff $\scr O_{X,x}$ is $\scr O_{Y,y}$-torsion-free for every $x\in X_y$.


\begin{proof}[Proof of \boxed{A}]
Assume that $Y$ is irreducible at $y\in Y$ and (2) is not true. Then $\varphi$ is not open at some $x\in X$. By Thm. \ref{lb75} there is a neighborhood $U$ of $x$ and $V$ of $\varphi(U)$ so that $\varphi$ restricts to a finite holomorphic map $\varphi:U\rightarrow W$ such that $x$ is the only point of $U_y=U\cap\varphi^{-1}(y)$. By Lemma \ref{lb156}, the germ of analytic subset $(\varphi(U),y)$ does not equal $(W,y)$. Thus, after shrinking $U$ and $W$ to smaller neighborhoods of $x$ and $y$ respectively, we can find $g\in\scr O(W)$ non-zero in the integral domain $\scr O_{Y,y}$ such that $g$ vanishes on $\varphi(U)$. So $g\circ\varphi$ takes value zero on $U$. Thus, by Nullstellensatz, $g^n$ annihilates $1\in\scr O_{X,x}$ for some $n\in\Zbb_+$. Thus $\scr O_{X,x}$ is not $\scr O_{Y,x}$-torsion-free. Therefore (1) is not true.
\end{proof}



\begin{proof}[Proof of \boxed{B}]
Assume that $X$ is irreducible at every $x\in X_y$ and (2) is true. If $\scr O_{X,x}$ is not $\scr O_{X,x}$-torsion free for some $x\in X_y$, then we can find a non zero-divisor $g\in\scr O_{Y,y}$ and nonzero $f\in\scr O_{X,x}$ such that $fg=0$. More precisely: $(g\circ\varphi)\cdot f=0$. Since $\scr O_{X,x}$ is an integral domain, $g\circ\varphi$ is zero in $\scr O_{X,x}$. Shrink $Y$ to a neighborhood of $y$ so that $g\in\scr O(Y)$, and shrink $X$ to $\varphi^{-1}(Y)$. Then we can find a neighborhood $U$ of $x$ such that $g\circ\varphi$ is zero in $\scr O(U)$. Therefore $g$ takes zero value on $\varphi(U)$. Since $\varphi$ is open at $x$, $\varphi(U)$ contains a neighborhood of $y$. Therefore, by Nullstellensatz, $g$ is nilpotent in $\scr O_{Y,y}$, contrary to the fact that $g$ is a non zero-divisor. So (1) must be true.
\end{proof}


\begin{eg}
Every Weierstrass map $\pi:X\rightarrow S$ is open. One can check that this follows from Rem. \ref{lb16}. But it also follows from Prop. \ref{lb169}, as explained below.
\end{eg}

\begin{proof}
By Thm. \ref{lb60}, $\pi_*\scr O_X$ is $\scr O_S$-free. So by Prop. \ref{lb169}, $\pi$ is open if $S$ is smooth. In the general case, we may assume that $S$ is small enough such that it is a closed subspace of an open subset $\Omega$ of $\Cbb^n$. Then by Prop. \ref{lb66}, we have a Cartesian square
\begin{equation}
\begin{tikzcd}
X \arrow[r, hook] \arrow[d, "\pi"'] & Y \arrow[d, "\varpi"] \\
S \arrow[r, hook]                   & \Omega               
\end{tikzcd}
\end{equation} 
where $\varpi$ is a Weierstrass map. So $\varpi$ is open. Choose any open $U\subset X$. Then $U=X\cap V$ for an open $V\subset Y$. $\varpi(V)$ is open in $\Omega$. So $\varpi(V)\cap S=\pi(V\cap X)=\pi(U)$ is open in $S$. This proves that $\pi$ is open.
\end{proof}



\subsection{Irreducible and pure dimensional}

\begin{thm}\label{lb170}
Let $X$ be a complex space irreducible at $x$. Then $X$ is pure dimensional at $x$.
\end{thm}


Recall Def. \ref{lb140} for the definition of pure dimensionality at a point.


\begin{proof}
We may shrink $X$ so that $X$ is reduced. Let $n=\dim_xX$. Then after shrinking $X$ further, we may find a finite holomorphic map $\varphi:X\rightarrow V$ such that $V$ is open in $\Cbb^n$, $\varphi(x)=0$, and $x$ is the only point of $\varphi^{-1}(0)$ (due to Thm. \ref{lb75}). By Thm. \ref{lb158}, $\varphi$ is open at $x$. So by Prop. \ref{lb169}, $(\varphi_*\scr O_X)_0$ is $\scr O_{V,0}$-torsion-free.  By Cor. \ref{lb166}, $\scr T(\varphi_*\scr O_X)$ is $\scr O_V$-coherent. Thus, after shrinking $V$ to a neighborhood of $0$ and replacing $X$ by $\varphi^{-1}(V)$, $\varphi_*\scr O_X$ is $\scr O_V$-torsion-free. By Prop. \ref{lb169}, $\varphi$ is open at every point of $X$. Therefore, by Thm. \ref{lb158}, $X$ has pure dimension $n$. 
\end{proof}





\begin{co}
Let $X$ be a complex space and $x\in X$. Let $n\in\Nbb$. Then the following are equivalent.
\begin{enumerate}[label=(\arabic*)]
\item In the prime decomposition $\sqrt{0_{X,x}}=\pk_1\cap\cdots\cap\pk_N$ of $\sqrt{0_{X,x}}\subset\scr O_{X,x}$ we have
\begin{align*}
\dim \scr O_{X,x}/\pk_i=n
\end{align*}
for all $1\leq i\leq N$.
\item $X$ has pure dimension $n$ at $x$.
\end{enumerate}
\end{co}

\begin{proof}
This is clear from Thm. \ref{lb170}, Prop. \ref{lb146}, and \eqref{eq64} (for the direction (2)$\Rightarrow$(1)).
\end{proof}






\begin{eg}
Let $\varphi:X\rightarrow Y$ be a finite holomorphic map of complex spaces. Assume that $Y$ is locally irreducible. Let $x\in X$ and $y=\varphi(x)$. If $X$ is pure dimensional at $x$ and $\varphi$ is open at $x$, then $\varphi$ is open on a neighborhood of $X$. 
\end{eg}


\begin{proof}
By Thm. \ref{lb170}, $Y$ is locally pure dimensional. By Thm. \ref{lb75}, we may shrink $X$ and $Y$ to neighborhoods of $x$ and $y$ respectively such that $X$ has pure dimension $m$ and $Y$ has pure dimension $n$, and that $\varphi$ is still finite. By Thm. \ref{lb158}, Dimension Formula \eqref{eq73} holds for $\varphi$ at $x$. Thus, by Prop. \ref{lb160}, we may shrink $X$ and $Y$ further so that $\varphi$ is finite and \eqref{eq73} holds at every point of $X$. So $\varphi$ is open by Thm. \ref{lb158}.
\end{proof}









\printindex	
	\begin{thebibliography}{999999}
		\footnotesize	


\bibitem[AM]{AM}
M. Atiyah and I. Macdonald, Introduction to Commutative Algebra, Addison-Wesley Publ. Co., Reading, MA, 1969


\bibitem[GPR]{GPR}
Grauert, H., Peternell, T., and Remmert, R. eds., 1994. Several complex variables VII: sheaf-theoretical methods in complex analysis. Springer-Verlag.


\bibitem[GR]{GR}
Grauert, H., \& Remmert, R. (1984). Coherent analytic sheaves (Vol. 265). Springer Science \& Business Media.

%\bibitem[Lee]{Lee}
%J.M. Lee, Introduction to Smooth Manifolds, 2nd edition, Springer, New York, 2013



%\bibitem[Gui22]{Gui22}
%B. Gui, Lectures on Vertex Operator Algebras and Conformal Blocks, 2022

\bibitem[Vak17]{Vak17}
Vakil, R. (2017). The rising sea: Foundations of algebraic geometry. preprint. November 18, 2017 draft
		
		
\end{thebibliography}

\noindent {\small \sc Yau Mathematical Sciences Center, Tsinghua University, Beijing, China.}

\noindent {\textit{E-mail}}: binguimath@gmail.com\qquad bingui@tsinghua.edu.cn
\end{document}










